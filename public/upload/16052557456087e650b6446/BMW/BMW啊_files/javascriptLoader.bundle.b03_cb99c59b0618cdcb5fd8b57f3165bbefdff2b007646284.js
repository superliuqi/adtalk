var rlAbstractFormFieldSet=function(){var C=true;var A=undefined;function B(F,E,D){var I=[];var G=(typeof D!=="undefined")?D:E;var H=(typeof D!=="undefined")?E:D;if(typeof G!=="undefined"){jq.each(F,function(K,J){switch(typeof G[J]){case"boolean":case"number":case"string":if(typeof H[J]==="undefined"||G[J]!==H[J]){I[I.length]=J}break;case"object":if(typeof H[J]==="undefined"){I[I.length]=J}else{var L=B(F,H[J],G[J]);if(L.length>0){I[I.length]=J;jq.each(L,function(N,M){I[I.length]=J+"$"+M})}}break;case"undefined":if(typeof H!=="undefined"&&typeof H[J]!=="undefined"){I[I.length]=J}break;case"function":break}})}return I}return{__init__:function(){},getForm:function(){return A},initDefaultActions:function(E){var D=E.getListAreaId();A=jq("#"+D+"form").closest("form");if(typeof A==="object"&&A.length===0){console.warn(D+" no enclosing form found")}else{A.bmwValidate({bmwValidate:{highlightErrorClass:"componentSetHighlightError"},invalidHandler:function(H,F){if(typeof H!=="undefined"&&typeof H.target!=="undefined"&&typeof H.target.id!=="undefined"&&H.target.id=="registerForm"){var L=F.numberOfInvalids();if(L){var K=jq("html,body");var G=F.errorList[0].element.id;var J=jq("#"+G)[0];var I=0;if(typeof J!=="undefined"&&J!=null){if(J.offsetParent){do{if(J.id=="glassPaneLayer"){K=jq(".glassPaneLayerScrollableArea");I-=45;break}I+=J.offsetTop}while(J=J.offsetParent);K.animate({scrollTop:I},1000)}else{K.animate({scrollTop:J.offsetTop},1000)}}}}},errorClass:"componentSetFieldErrorTextArea"})}},setEditMode:function(D,E){C=D;console.log("Set Edit Mode = "+C);this.fillFieldValues(E);if(C){jq("#"+E+" .componentSetViewArea").hide();jq("#"+E+" .componentSetEditArea").show()}else{jq("#"+E+" .componentSetEditArea").hide();jq("#"+E+" .componentSetViewArea").show()}},fillFieldValues:function(D){jq("#"+D+" .componentSetEditArea input[type='text']").each(function(E){var F=jq(this).attr("id");jq("#"+D+" .componentSetViewArea #"+F).val(jq(this).val())});jq("#"+D+" .componentSetEditArea input[type='radio']:checked").each(function(E){var F=jq(this).attr("id");jq("#"+D+" .componentSetViewArea #"+F).val(jq(this).val())});jq("#"+D+" .componentSetEditArea select:selected").each(function(E){var F=jq(this).attr("id");jq("#"+D+".componentSetViewArea #"+F).val(jq(this).val())})},onErrors:function(D,E){if(typeof D!=="undefined"){var G=E||{};D=[].concat(D);for(var F=D.length;F--;){G[D[F].fieldName]=D[F].errorMessage||""}return G}else{return undefined}},onError:function(G,E,D){if(typeof G!=="undefined"&&typeof E!=="undefined"){var F=D||{};F[G]=E.errorMessage;return F}else{return undefined}},getDiffs:function(D,F,E){return B(D,F,E)}}}();var rlAccessoriesFinder=function(){var B,C,A;return{__start__:function(){},__init__:function(){},setStatisticsInformation:function(G,H,F){var E=rlAccessoriesSearchFilter.getBasicUrlFilterGroup();if(F==="Active"||E===""){var D=G?B:C;D=H+" "+D;jq("#accessoriesFinderNumberProducts").html(D)}},setMsgSearchResultStatistics:function(D){B=D},setMsgSearchResultsStatistics:function(D){C=D},setNumResultPage:function(D){A=D},getNumResultPage:function(){return A},setResetButton:function(D,G,F,E){jq("#"+G).unbind();if(D===""){D="q="}if(!F){F="href"}jq("#"+G).attr(F,D);rlSearchUtil.linkWithAnchor(rlAccessoriesSearchField.getSearchResult,F,jq("#"+G))},resetAllFilter:function(){var D=rlSearchUtil.convertSeachParametersToBase64("q=");rlAccessoriesSearchField.getSearchResult(D)},resetDynamicNavigation:function(){var I={};I.num=rlAccessoriesFinder.getNumResultPage();var H="/"+rlMandator.replaceCoreUrl("_{countryMandatorContext}")+"/search/accessories/search/";var G=rlAccessoriesSearchFilter.getActiveCategory();var D=rlAccessoriesSearchFilter.getActiveTopic();var E="inmeta:productOnline";if(G!==""){E="inmeta:productCategory%3D"+G}else{if(D!==""){E="inmeta:productTopics%3D"+D}}var F={};F.query="-";F.resultsPerPage=I.num;F.startPage=0;F.as_q=E;F.as_oq="-";F.sort="-";F.accessoriesSort="-";F.accessoriesStart="-";H=rlSearchUtil.getXssCleanParams(H);H=rlPage.getNextCoreUrl()+cfGsaBaseUrl+H;rlCrossSubDomainAjax.call({url:H,type:"POST",scriptCharset:"UTF-8",data:F,success:function(J){rlAccessoriesSearchFilter.clearCountDynamicNavigation();jq("#searchResultDynamicNavigationTarget").html(J);if(typeof wa_s_rc!="undefined"&&wa_s_rc>0&&wa_s_rc<1000){jq("#accessoriesFinderProductSort").appendTo("#accessoriesFinderProductSortTarget");jq("#accessoriesFinderProductSort").css({display:"inline"});jq("#accessoriesFinderSortBox").show();if(jq("#accessoriesFinderProductSortRelevance").length>0&&jq("#cf_accessoriesfinder_relevant").length>0){rlAccessoriesSearchField.labelSortingLanguageKeys()}jq("#accessoriesFinderProductSort option").each(function(K,L){rlSearchUtil.linkWithAnchor(rlAccessoriesSearchField.getSearchResult,"value",L)});jq("#accessoriesFinderProductSort").unbind().bind("change",function(){location.hash=jq("#accessoriesFinderProductSort option:selected").attr("value");if(jq.browser.msie){jq(window).trigger("hashchange")}})}else{jq("#accessoriesFinderProductSort").hide();jq("#accessoriesFinderSortBox").hide()}},error:function(J,L,K){jq("#accessoriesFinderResultTeaser").hide();jq("#accessoriesFinderResultTarget").html(cfMsgSearchEngineTechnicalError);jq("#accessoriesFinderResultTarget").show()}})},zsoErrorImage:function(E,D){D.onerror=null;D.src=E+GLOBAL_ZSO_ERROR_IMAGE}}}();var rlAccessoriesSearchField=function(){var F,G,B;var I=24;var A=false;var E="";var H="";var D;var C;return{__start__:function(){jq("#"+B).val(G)},__init__:function(){rlAccessoriesSearchField.setGsaProxyHost(rlPage.getNextCoreUrl()+cfGsaBaseUrl);rlAccessoriesSearchField.setSearchAccessoriesFieldId("accessoriesFinderSearchFieldInput");rlAccessoriesSearchField.initSearchAccessoriesField();rlAccessoriesSearchField.initAutosuggest()},setDisableAJAXHistorySearch:function(J){A=J},go2result:function(M){var L=(M)?M:jq("#"+B).val();if(M){L=M}var K="";if(typeof dynamicNavigationPropertiesActive!=="undefined"){K=dynamicNavigationPropertiesActive.basicUrlSearch}if(K===""){if(E!==""){K="&as_q=inmeta:productCategory%3D"+E}else{if(H!==""){K="&as_q=inmeta:productTopics%3D"+H}}}var N=rlSearchUtil.mergeBasicUrlParameters(K,L,"q");var J=rlSearchUtil.convertSeachParametersToBase64(N);if(location.href.indexOf(C)!=-1){location.href="#"+J}else{location.href=C+"#"+J}},setAccessoriesSearchPagePath:function(J){C=J+".html"},setActiveCategory:function(J){E=J},setActiveTopic:function(J){H=J},getActiveCategory:function(){return E},getActiveTopic:function(){return H},setNumResultPage:function(J){I=J},getNumResultPage:function(){return I},setGsaProxyHost:function(J){F=J},setSearchAccessoriesFieldInitValue:function(J){G=J},setSearchAccessoriesFieldId:function(J){B=J},fixLoadingDivHeight:function(){jq("#searchResultContentLoading").height(jq("#searchResultContentWrapper").height())},getAccessorySearchPath:function(P){if(!P){return false}var O=jq.base64Decode(P);if(O.indexOf("}")=="-1"){return false}if(P){location.hash=P}var Q=jq.secureEvalJSON(O);Q.num=I;var L="-";if(typeof Q.q!="undefined"&&Q.q){L=rlSearchUtil.getConvertedSearchStringBackward(Q.q);jq("#"+B).val(L);jq("#accessoriesFinderSearchFieldFormResetButton").addClass("linkArrow13px").removeClass("linkArrow13pxInactive")}else{jq("#"+B).val(G);jq("#accessoriesFinderSearchFieldFormResetButton").addClass("linkArrow13pxInactive").removeClass("linkArrow13px")}var J=(typeof Q.as_q!="undefined"&&Q.as_q)?Q.as_q:"-";var N=(typeof Q.as_oq!="undefined"&&Q.as_oq)?Q.as_oq:"-";var S=(typeof Q.start!="undefined"&&Q.start)?Q.start:"-";var R=(typeof Q.sort!="undefined"&&Q.sort)?Q.sort:"-";var K=(typeof Q.sortAcc!="undefined"&&Q.sortAcc)?Q.sortAcc:"-";var M=(typeof Q.startAcc!="undefined"&&Q.startAcc)?Q.startAcc:"-";var T={};T.query=rlSearchUtil.getConvertedSearchString(L);T.resultsPerPage=Q.num;T.startPage=S;T.as_q=rlSearchUtil.getConvertedSearchString(J);T.as_oq=rlSearchUtil.getConvertedSearchString(N);T.sort=rlSearchUtil.getConvertedSearchString(R);T.accessoriesSort=rlSearchUtil.getConvertedSearchString(K);T.accessoriesStart=rlSearchUtil.getConvertedSearchString(M);var U=rlMandator.replaceCoreUrl("/_{mandatorContext}")+"/search/accessories/search/";U=rlSearchUtil.getXssCleanParams(U);U=rlPage.getNextCoreUrl()+cfGsaBaseUrl+U;return[U,T]},getSearchResult:function(L,K){rlAccessoriesSearchField.fixLoadingDivHeight();var M;if(!L){M=window.location.hash.substring(1)}else{rlAccessoriesSearchField.setDisableAJAXHistorySearch(true);window.setTimeout(function(){rlAccessoriesSearchField.setDisableAJAXHistorySearch(false)},1000);M=L}if(M===""){return }if(location.href.indexOf(C)==-1){var N=jq.base64Decode(M);if(N.indexOf("}")=="-1"){return false}else{location.href=C+"#"+M;return }}var O=rlAccessoriesSearchField.getAccessorySearchPath(M);if(!O){rlAccessoriesSearchField.hideSearchResultLoading();return false}var Q=O[1];var P=Q.as_q;var J="";if(Q.as_oq==="-"&&Q.query==="-"&&P!=="-"&&P.lastIndexOf("inmeta")==0&&P.indexOf(":productCategory")>1&&Q.accessoriesSort==="-"){J=P.substr(P.indexOf("%3D")+3,P.length)}if(J!==""&&jq("#"+J).length>0){var R=jq("#"+J).attr("href");location.href=R}else{jq("#accessoriesFinderResultTeaser").hide();jq("#searchResultContentLoading").show();D=window.setTimeout(function(){jq("#searchResultContentSlowLoading").show()},2000);rlCrossSubDomainAjax.call({url:O[0],type:"POST",scriptCharset:"UTF-8",data:Q,success:function(S){rlSearchUtil.afClearCountDynamicNavigation();jq("#accessoriesFinderProductSort").remove();jq("#accessoriesFinderResultTarget").html(S);jq("#accessoriesFinderResultTarget").show();if(typeof wa_s_rc!="undefined"&&wa_s_rc>0){rlAsrInclude.registerLoad(page_query,page_start,page_site)}if(typeof wa_s_rc!="undefined"&&wa_s_rc>0&&wa_s_rc<1000){jq("#accessoriesFinderProductSort").appendTo("#accessoriesFinderProductSortTarget");jq("#accessoriesFinderProductSort").css({display:"inline"});jq("#accessoriesFinderSortBox").show()}else{jq("#accessoriesFinderProductSort").hide();jq("#accessoriesFinderSortBox").hide()}if(jq("#accessoriesFinderProductSortRelevance").length>0&&jq("#cf_accessoriesfinder_relevant").length>0){rlAccessoriesSearchField.labelSortingLanguageKeys()}jq("#accessoriesFinderHeadTarget").show();var T=true;rlProductTile.injectAnimation(jq(".accessoriesFinderTileContainer"),T);jq(".searchResultPageNavi a").each(function(U,V){rlSearchUtil.linkWithAnchor(rlAccessoriesSearchField.getSearchResult,"href",V)});jq("#accessoriesFinderProductSort option").each(function(U,V){rlSearchUtil.linkWithAnchor(rlAccessoriesSearchField.getSearchResult,"value",V)});jq("#accessoriesFinderProductSort").unbind().bind("change",function(){location.hash=jq("#accessoriesFinderProductSort option:selected").attr("value");if(jq.browser.msie){jq(window).trigger("hashchange")}});if(jq("div#accessoriesFinderResultTarget span.p").length!=0){jq("#accessoriesFinderResultTarget").html(jq("#hiddenAccessoriesFinderErrorMsg").clone().html())}rlAccessoriesSearchField.hideSearchResultLoading();if(typeof K!="undefined"&&K&&K==="value"){}else{jq("html, body").scrollTop(100)}if(jq("#searchEngineSuggest a").length>0){rlSearchUtil.linkWithAnchor(rlAccessoriesSearchField.getSearchResult,"href",jq("#searchEngineSuggest a"))}window.setTimeout(function(){jq("#searchResultContentSlowLoading").hide();rlAccessoriesSearchField.hideSearchResultLoading()},2000)},error:function(S,U,T){jq("#accessoriesFinderResultTarget").html(cfMsgSearchEngineTechnicalError);jq("#accessoriesFinderResultTarget").show();rlAccessoriesSearchField.hideSearchResultLoading()}})}},registerAjaxHistory:function(K){var J=location.hash;if(J==""){}else{if(!A){rlAccessoriesSearchField.getSearchResult(J)}A=false}},hideSearchResultLoading:function(){jq("#searchResultContentLoading").hide();jq("div.searchQueryLiveSearchLayer").fadeOut();jq("#searchResultContentSlowLoading").hide();if(D){window.clearTimeout(D)}},initSearchAccessoriesField:function(){jq("#"+B).focus(function(){if(G&&G!=""){if(jq(this).val()==G){jq(this).val("")}}jq(this).css("color","#000000")});jq("#"+B).blur(function(){if(jq(this).val()==""){if(G&&G!=""){jq(this).val(G)}}jq(this).css("color","")});jq("#"+B).val(G)},initAutosuggest:function(){rlAutosuggest.autosuggest("accessories",{id:B,className:"accessoriesFinderSearchField",suggestServletName:"",minCharsForAutoSuggest:cfMinCharAutoSuggest,minCharsForLiveSearch:cfMinCharLiveSearch,numLiveSearchResults:cfNumLiveSearchResults,numAutoSuggestResults:cfNumAutoSuggestResults,rtnIDs:false,searchFunction:rlAccessoriesSearchField.go2result,methodType:"GET",dataFile:F})},labelSortingLanguageKeys:function(){jq("#accessoriesFinderProductSortRelevance").html(jq("#cf_accessoriesfinder_relevant").html());jq("#accessoriesFinderProductSortDate").html(jq("#cf_accessoriesfinder_latest").html());jq("#accessoriesFinderProductSortPriceAsc").html(jq("#cf_accessoriesfinder_price_asc").html());jq("#accessoriesFinderProductSortPriceDesc").html(jq("#cf_accessoriesfinder_price_desc").html());jq("#accessoriesFinderProductSortNameAsc").html(jq("#cf_accessoriesfinder_ABC_asc").html());jq("#accessoriesFinderProductSortNameDesc").html(jq("#cf_accessoriesfinder_ABC_desc").html());jq("#accessoriesFinderProductSortIdAsc").html(jq("#cf_accessoriesfinder_id_asc").html());jq("#accessoriesFinderProductSortIdDesc").html(jq("#cf_accessoriesfinder_id_desc").html());jq(".productTileDetailsLink a:first-child").html(jq("#cf_accessoriesfinder_productDetailsLink").html())}}}();var rlAccessorySeo=function(){return{__start__:function(){},__init__:function(){},removeFirstKRKContent:function(){jq(".accessorySeoIFrameWrapper .iframeContainer").html("")}}}();var rlActivationError=function(){return{__init__:function(){jq("#activationErrorButton").click(function(){var A={protocol:window.location.protocol,hostname:window.location.hostname};rlUserDialog.redirectToMyDashboard(A)})}}}();var rlAddressRefToggle=function(){function A(J,C){var I=CoreFormsBase.inheritanceFrom(rlFormFieldSet.createFS(J,C));var F=I.parent;I.typeName="rlAddressRefToggle";var E=J.parent().find(".addressRefRequiredFS");var G=J.parent().find(".addressRefNotRequiredFS");function D(L,K){L.find("[data-field]").each(function(N,P){var O=jq(P);var M=K.find("[data-field='"+O.attr("data-field")+"']");var Q="select,input";O.find(Q).andSelf().filter(Q).each(function(S,V){var R=jq(V);var T=R.val();if(R.is(":radio")){var U=':radio[value="'+T+'"]';B(M.find(U).andSelf().filter(U),R.is(":checked"))}else{B(M.find("input").andSelf().filter("input"),T)}})})}function B(M,L){if(M){var K=jq(M);if(K.is("select")){L=[].concat(L);K.find("option").each(function(N,O){var P=jq(O);if(jq.inArray(P.val(),L)>=0){P.prop("selected",true).click()}else{P.prop("selected",false)}})}else{if(K.is(":checkbox")){if(K.prop("checked")!=(L===true)){K.prop("checked",L===true)}}else{if(K.is(":radio")){if(L===true){K.prop("checked",true).click()}else{K.prop("checked",false)}}else{if(K.is("input")){K.val(L)}else{console.warn("Field must be an input element:");console.warn(K)}}}}}}function H(K,L){if(L===true){D(G,E);G.hide();G.find("fieldset").first().prop("disabled",true);E.show();E.find("fieldset").first().prop("disabled",false)}else{D(E,G);E.hide();E.find("fieldset").first().prop("disabled",true);G.show();G.find("fieldset").first().prop("disabled",false)}}I.preInit=function(){if(!rlPage.isEditMode()){C.containerEvents.subscribe(C.containerEvents.names.STATUS_RFI_CHECK_BOX,function(K,L){H(K,L)})}};G.find(".addressRefFS fieldset").first().attr("data-no-meta-required-validators","");return I}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlAdfreshmentArea=function(){var B;function D(){B=rlMandator.replaceCoreUrl(rlPage.getNextCoreUrl()+"/perso/services/_{mandatorContext}/campaign/default")}function A(E){return decodeURI((RegExp(E+"=(.+?)(&|$)").exec(location.search)||[,null])[1])}function C(F){var G=F.indexOf("<body>");if(G===-1){console.log("Can't find adfreshment body start.");return""}var E=F.indexOf("</body>");if(E===-1){console.log("Can't find adfreshment body end.");return""}return F.substring(G+"<body>".length,E)}return{__init__:function(){D()},__start__:function(){if(!rlPage.isEditMode()){var E=jq(".adfreshmentAreaContainer");var F=function(G){if(G.campaign!=undefined){var I=G.campaign.adfreshmentURL;if(I!=null){var H=A("wcmmode");if(H&&H.length>0&&H!="null"){I+="?wcmmode="+H}jq.ajax({url:I,context:E,success:function(K){var J=C(K);jq(this).html(J);jq(this).css("display","block")},error:function(){}})}}};rlCrossSubDomainAjax.call({type:"POST",url:B,contentType:"application/json",success:function(G){F(G)},error:function(G,I,H){}})}}}}();rlAnchorNavAuto=function(){function A(C){var B=[];jq(C).each(function(E,F){var D=F.getAttribute("name");if(D===undefined||D===null||D===""){return }B.push({title:jq.trim(jq(F).text()),name:D})});return B}return{__init__:function(){},__start__:function(){},regenerateAnchorNav:function(B,D){var C=A(D);jq(B).each(function(H,I){var G=jq(I);G.html("");for(var H=0;H<C.length;++H){var F=C[H];var E=jq(jq(".anchorNavAutoTemplate > li")[0]).clone();jq(".anchorNavLink",E).attr("href","#"+F.name);jq(".anchorNavLinkText",E).text(F.title);G.append(E)}})}}}();var rlBmwTabsContainer=function(){var C=0;var E=false;function F(I){var K=I.offsetTop;var J=I.offsetLeft;var H=I.offsetWidth;var G=I.offsetHeight;while(I.offsetParent){I=I.offsetParent;K+=I.offsetTop;J+=I.offsetLeft}return(K>=window.pageYOffset&&J>=window.pageXOffset&&(K+G)<=(window.pageYOffset+window.innerHeight)&&(J+H)<=(window.pageXOffset+window.innerWidth))}function A(G){var H=G.find("ul:first");if(H.length&&!F(H[0])){var I=H.offset();scroll(0,I.top)}}function D(H,J){var G=J.attr("id");var I=jq("#tab_"+G).val();H.tabs("add","#"+G,I)}function B(I){function G(P,M,L){var N={title:undefined,url:undefined,clickhandler:undefined};function O(Q){return(typeof Q.title!="undefined"&&Q.title!=null&&Q.title!="")}N.title=P;N.url=M;N.clickhandler=L;return(O(N))?N:undefined}var H=I.find(".ui-state-active");var K=H.find("h4").text();var J=H.find("a").attr("href");return G(K,J)}return{__init__:function(){jq(".bmwTabsContainer").each(function(){var G=jq(this);var J=G.attr("id");var I=G.children("ul:first");if(I.size()){var K=jq(".bmwTabItemComponent",G);if(K.length==1){G.show();return }G.tabs({tabTemplate:'<li><div class="bmwTabsHeadlineContainer"><a href="#{href}"><h4 class="bmwTabsTabHeadline">#{label}</h4></a></div></li>',select:function(N,O){if(O.panel.className.indexOf("bmwTabItemWithSubMenu")>0){jq(this).addClass("bmwTabItemWithSubMenu");jq(".myBmwNavigationTabContainerBottomLine").show(0)}else{jq(this).removeClass("bmwTabItemWithSubMenu");jq(".myBmwNavigationTabContainerBottomLine").hide()}jq.cookie(J,O.index,{});if(E){window.location.hash=O.tab.hash;A(G)}if(window.bmwcsaPageID&&O.panel){var L=jq(O.panel).find('input[name="tabtracking"]');if(L&&L.length>0){var M=new Object();M.id=window.bmwcsaPageID+"/"+L[0].id;M.tagName="DIV";if(window.bmwcsaclick){window.bmwcsaclick(M)}}}},show:function(L,N){var M={index:N.index,tabId:jq(".bmwTabContent:first",N.panel)[0].id};jq(window).trigger("bmwTabsContainer.select",[M]);rlBreadcrumbDynamic.render()}});K.each(function(){var L=jq(this);D(G,L)});G.show();var H=parseInt(jq.cookie(J));if(H>0){G.tabs("option","selected",H)}else{G.tabs("option","selected",1);G.tabs("select","#"+jq(".bmwTabItemComponent")[0].id)}if(document.location.hash){E=true;G.tabs("select",document.location.hash);A(G)}}})},__start__:function(){},addTabItem:function(G,H){D(G,H)},getBreadcrumbEntries:function(G){return B(G)}}}();var rlCampaignInfoMaterialFS=function(){function A(B,F){var C=CoreFormsBase.inheritanceFrom(rlInfoMaterialFS.createFS(B,F));var E=C.parent;C.typeName="rlCampaignInfoMaterialFS";C.preInit=function(){E.preInit();F.containerEvents.subscribe(F.containerEvents.names.POLL_NEED_RFI_METADATA,function(H,G){C.triggerEvent(F.allEvents.names.NEED_RFI_METADATA,true)})};C.onSelectionAreasDisplayed=function(G){C.triggerEvent(F.allEvents.names.STATUS_RFI_CHECK_BOX,G)};var D=function(H){var G=true;jq.each(H,function(J,I){if(I.typeName=="rlRfiCheckBoxFS"){B.find(".notUniqueFieldSetNagMessage").css("display","block");G=false;return G}});return G};C.getAuthorValidationRules=function(){var G=E.getAuthorValidationRules();return G.concat([{validate:D},rlFormFieldSetDefaults.getAuthorValidationRules().requireAddressRefToggle(B)])};return C}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlCampaignResponseFormDS=function(){function A(F){var B=CoreFormsBase.inheritanceFrom(rlUserFormDS.createDS(F));var D=B.parent;B.typeName=" rlCampaignResponseFormDS";var E=rlCoreServices.getServersConfig();var C=E.requestServiceHostSSL+E.me_core+"/usermgmt-rfx/services/_{mandatorContext}/request/me/campaign";B.setCreateUserUrl(C);B.updateUser=function(H,G,J,I){};return B}return{__init__:function(){},__start__:function(){},createDS:function(B){return A(B)}}}();var rlCampaignsandoffersstagearea=function(){function C(D){B(D)}function A(D){rlCoreServices.isLoggedIn({loggedIn:function(){rlStageTeaser.loadStageTeaserContent(function(E){D(E,E!="")})},loggedOut:function(){D("",false)},error:function(){D("",false)}})}function B(D){A(function(F){if(F!=""){var E=jq(F).attr("id","campaignsAndOffersStageTeaser");jq("#"+D).append(E)}else{jq("#"+D+" .noCampaignsAndOfferLargeTeaser").show()}jq(window).trigger("stagearea-teaser-changed")})}return{__init__:function(){},loadCampaignsAndOffersLargeTeaser:function(D){A(D)},initComponent:function(D){C(D)}}}();var rlCartBox=function(){var Q,P,J,K;var C=true;var L="#cartBoxSummary";var E="#cartBoxExtraCosts";var A="#cartBoxChainman";function N(S){if(typeof S!=="object"){console.log("Cartbox got no configdata")}else{console.debug("Cartbox got new config",S);B(S);clearInterval(P);jq(".cartBoxVehicleDetails").fadeIn(700);jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_PAGE_CHANGE_NOTIFICATION)}}function B(S){console.log("cartbox.updateCartBox",S);G(S.modelSection.modelCode.value);if(!C){P=setInterval(function(){M()},100);jq(".cartBoxContentLoading, .cartBoxContentLoadingAnimation").show()}jq("#cartBoxLinkToNCC").attr("href",rlEspBasket.getCurrentInstance().addBasketIdToURL(S.accessUrl.value,false));jq("#cartBoxModelTitle").text(S.modelSection.title.value);jq("#cartBoxVisual").css({backgroundImage:"url("+S.imageUrlFrontBig.value+")"});jq("#cartBoxExtraCosts").empty();jq("#cartBoxVehiclePrice").empty();if(rlEspBasket.getCurrentInstance().mayShowCartBoxExtraCosts()){if(S.priceSection&&S.priceSection.extraCost){H(S.priceSection.extraCost)}if(jq("#cartBoxExtraCosts .cartBoxEntryRow").length>0){if(S.priceSection&&S.priceSection.vehicleTotalPrice){I("cartBoxVehicleGrossPrice","#cartBoxVehiclePrice",S.priceSection.vehicleTotalPrice.grossPrice.name,S.priceSection.vehicleTotalPrice.grossPrice.value,S.priceSection.vehicleTotalPrice.infoUrl,"BasisPrice");jq("#cartBoxVehiclePrice").css({display:"table"})}jq("#cartBoxExtraCosts").css({display:"table"})}}else{jq("#cartBoxExtraCosts").hide()}jq("#cartBoxSummary").empty();if(S.priceSection&&S.priceSection.totalOrderPrice&&S.priceSection.totalOrderPrice.grossPrice){I("cartBoxSummaryGrossPrice","#cartBoxSummary",S.priceSection.totalOrderPrice.grossPrice.name,S.priceSection.totalOrderPrice.grossPrice.value,S.priceSection.totalOrderPrice.infoUrl,"Price");if(rlEspBasket.getCurrentInstance().mayShowFinanceProductCosts()){R(S)}jq("#cartBoxSummary").css({display:"table"});jq("#cartBoxSummary .cartBoxEntryLabel, #cartBoxSummary .cartBoxEntryValue").addClass("headlineh2").addClass("headlineNormal")}if(jq(A).length>0){F()}jq(".cartBoxContentLoading, .cartBoxContentLoadingAnimation").hide();C=false;clearInterval(P);O()}function G(S){rlContextObjectModelCodeUpdater.setModelCode(S);jq(window).bind("renderSalesBar",function(){if(rlContextObject.getDeliveryTime()){jq(".cartBoxInfoBoxContentValue").text(rlContextObject.getDeliveryTime());jq(".cartBoxInfoBox").show()}else{jq(".cartBoxInfoBox").hide()}})}function H(S){jq(S).each(function(T,U){I("cartBoxExtraCosts"+T,"#cartBoxExtraCosts",U.name,U.grossPrice.value,U.infoUrl,"ExtraCost_"+(1+T))})}function I(X,T,S,Y,Z,U){var a=rlContextLayer.buildNewLayer({replaceIconByDivText:false,componentId:X,contentType:"dynamic"});var W='<div class="cartBoxEntryRow">';W+='<span class="cartBoxEntryLabel">'+S+"</span>";W+='<span class="cartBoxEntryValue">'+Y+"</span>";W+='<span class="cartBoxEntryInfoIcon" data-tracking-id="cartBoxEntryInfoIcon" data-tracking-info="'+U+'"></span>';W+="</div>";var V=jq(W);V.find(".cartBoxEntryInfoIcon").append(jq(a.dom));jq(T).append(V);a.callback();jq(T).find("#"+X).hide();if(typeof Z!=="undefined"){jq.get(Z,function(d){var c=jq(".infoIconLayerIcon","#"+X);var e=c.data("contextLayerContent");var f="";if(e&&d&&d.content&&d.content.data){var b=rlContextLayerParser.parse(jq.evalJSON(d.content.data));if(b!==""){e.html('<div class="contextLayerContentContainer">'+b+"</div>");jq(T).find("#"+X).show()}}},"json")}}function R(S){if(S&&S.financeSection&&S.financeSection.financeProductName){I("cartBoxSummaryGrossRentalPrice","#cartBoxSummary",S.financeSection.financeProductName.name,S.financeSection.visiblePayment,S.financeSection.infoUrl,"Rate")}}function F(){function S(T){if(T&&!rlEspBasket.getCurrentInstance().isCashBasketOption()){jq(A).show()}else{jq(A).hide()}}rlNccEspApp.isInContentDisclaimerVisible(S)}function M(){var S=jq(".cartBoxVehicleDetails .cartBoxContentLoadingAnimation");var T=jq(".cartBoxVehicleDetails").attr("data-spinnerposition");S.css("background-position","-"+(T*37)+"px 0");T++;if(T==18){T=0}jq(".cartBoxVehicleDetails").attr("data-spinnerposition",T)}function O(){var U=jq(window).scrollTop();var V=jq(window).height();var T=jq("#espProcessContent").height();var S=jq("footer").height();if(V<cartHeight&&T>cartHeight){if(U>115+cartHeight-V+90+200){jq("#espProcessCartContent").css({position:"fixed",top:V-cartHeight-90-200})}if(U<=115+cartHeight-V+90+200){jq("#espProcessCartContent").css({position:"relative",top:"0"})}}else{if(U>(T-S)&&T>cartHeight){jq("#espProcessCartContent").css({position:"fixed",bottom:(cartHeight+S+35)+"px",top:"inherit"})}else{if(U>280&&T>cartHeight){jq("#espProcessCartContent").css({position:"fixed",top:"-156px"})}}if(U<=280&&T>cartHeight){jq("#espProcessCartContent").css({position:"relative",top:"0"})}}}function D(){jq(window).scroll(function(S){O()})}return{__init__:function(){},__start__:function(){P=setInterval(function(){M()},100);jq(window).bind(rlCoreFormEvents.ENUM.NAMES.VEHICLE_CONFIG_CHANGED,function(T,S){N(S)});cartHeight=jq("#espProcessCart").height();D()}}}();var rlCartBoxDeliveryInformation=function(){return{__init__:function(){},__start__:function(){jq(window).bind("renderSalesBar",function(){rlCartBoxDeliveryInformation.update()})},update:function(){if(rlContextObject.getDeliveryTime()){jq(".cartBoxInfoBoxContentValue").text(rlContextObject.getDeliveryTime());jq(".cartBoxInfoBoxContent").show()}else{jq(".cartBoxInfoBoxContent").hide()}}}}();var rlCartBoxTeaserRfo=function(){function C(){B();rlRFOButton.click()}function B(){rlContextObject.setVehicleRFO(true);A()}function A(){var D=rlEspBasket.getCurrentInstance().getConfigId();if(D){rlContextObject.setConfigId(D)}else{if(!rlContextObject.getContextObject().vehicle.configId){throw new Error("No config ID found in ESP and rlContextObject")}}}return{__init__:function(){},__start__:function(){jq("#cartBoxTeaserRfoLink").click(C)}}}();var rlChangeLoginForm=function(){function A(C,E){var M=CoreFormsBase.inheritanceFrom(rlMyAccountForm.create(C,E));var K=M.parent;M.typeName="rlChangeLoginForm";var I="input[name='oldLogin']";var G="input[name='newLogin']";var H="span[name='oldLogin']";var L=null;function J(){if(!rlPage.isEditMode()&&!rlPage.isDesignMode()){C.find(".myAccountFormSaveButton").unbind("click");C.find(".myAccountFormSaveButton").click(B)}}function B(O){if(M.validate()){var N=rlEventTracker.create(M.getModuleId()+"/change");N.trackCustomEvent("mybmwLoginData/editLogin","mybmwAction/userprofile");M.suspendEvent(O);F(O)}}M.switchToEditMode=function(){K.switchToEditMode();if(L){C.find(I).val(L).change()}C.addClass("formFieldSetInlineFormButtonEditMode");C.removeClass("formFieldSetInlineFormButtonViewMode")};M.switchToViewMode=function(){K.switchToViewMode();C.addClass("formFieldSetInlineFormButtonViewMode");C.removeClass("formFieldSetInlineFormButtonEditMode")};function F(N){rlDither.on(C);rlCoreServices.changeLogin({data:{login:jq.trim(C.find(G).val())},success:function(O){M.switchToViewMode();M.trackEvent(N);rlUserDialog.redirectToUsernameChangeInfoDialog()},validationError:function(P){var O=[];if(!jq.isArray(P.validationErrors.validationError)){P.validationErrors.validationError=[P.validationErrors.validationError]}jq.each(P.validationErrors.validationError,function(Q,R){var S=D(R);if(typeof S!=="undefined"){O.push(S)}});M.showBackendMessages(O)},error:function(O){rlErrorService.handleError({actor:rlErrorService.ACTOR_USER})},complete:function(){rlDither.off(C)}})}function D(N){if(N.errorFieldKey==="account$login"||N.errorCodeId==="UM_GCDM_NOT_UNIQUE"){return{fieldName:"user.newLogin",level:"ERROR",errorKey:N.errorCodeId}}}J();M.switchToViewMode();return M}return{__init__:function(){},__start__:function(){},create:function(B,C){return A(B,C)}}}();var rlCheckBoxFS=function(){function A(B,E){var C=CoreFormsBase.inheritanceFrom(rlFormFieldSet.createFS(B,E));var D=C.parent;C.typeName="rlCheckBoxFS";C.getValueRenderers=function(F){F.singleCheckbox=function(J,I,G,H){if(I===true){H.text(" ").addClass("spriteLabel spriteLabelCheckedGreen12")}else{H.removeClass("spriteLabel spriteLabelCheckedGreen12");H.text("--")}};return F};C.getFieldMappers=function(F){F.checkboxWithLabel={get:function(I,H){var G=H.parents(".fieldSetEditAreaRow").find("label");if(H.attr("checked")==="checked"){return G.text()+": true"}else{return G.text()+": false"}},set:function(I,H,G){}};F.singleCheckbox={get:function(H,G){return G.attr("checked")==="checked"},set:function(I,H,G){if(H===true){G.attr("checked","checked")}else{G.removeAttr("checked")}}};return F};return C}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlCommunicationsFS=function(){function A(M,C){var L=CoreFormsBase.inheritanceFrom(rlBaseListFS.createFS(M,C));var K=L.parent;L.typeName="rlCommunicationsFS";L.retriveFullObject=true;var B=L.getFieldsetProperties();var H={};var D=false;L.mergeValueObject=function(P,Q){var O=jq.extend({},P);O.value=Q.value;O.preferred=Q.preferred};L.getValidationRules=function(O){O.telephoneUsageRequiresPhoneNumber={event:O.requiredValue.event,when:"ELEM_INVALIDATED_BY_FORM",rule:function(X,P){var S=jq("fieldset.acceptedWebPolicyFS [data-validators$='telephoneUsageRequiresPhoneNumber']").parents("fieldset");if(S.length===0){return }var V=S.find(".fieldSetViewMode input[name='TelephoneUsage']");if(V.length===0||!V.is(":checked")){return }var U=["phone","businessPhone","mobile","businessMobile"];for(var R=0;R<U.length;R++){var T=M.find("[data-field='user.profile."+U[R]+"'] input");if(T.length>0&&T.val()!=""){return }}if(M.find("[data-validationplacements*='telephoneUsageRequiresPhoneNumber']").length===0){var Q=M.find("[data-validationplacements]").first();var W=Q.attr("data-validationplacements");if(W==""){W=telephoneUsageRequiresPhoneNumber}else{W=W+",telephoneUsageRequiresPhoneNumber"}Q.attr("data-validationplacements",W)}return{fieldName:X,level:"ERROR",errorKey:"telephoneUsageRequiresPhoneNumber",messageText:L.getFieldsetProperties()["telephoneusagerequiresphoneerror"],validationGroup:"telephoneUsageRequiresPhoneNumber"}}};O.requiredAtLeastOneComm={event:"focusout",when:"ELEM_INVALIDATED_BY_FORM",rule:function(S,Q,R){var P=false;M.find("[data-isrequiredcomm]").each(function(U,T){if(typeof (O.requiredValue.rule(S,jq(T)))==="undefined"){P=true}});if(!P){return{fieldName:S,level:"ERROR",errorKey:"atLeastOneCommRequired",validationGroup:"requiredAtLeastOneComm"}}}};O.dynamicRequiredAtLeastOnePhoneNumber={event:"focusout",when:"ELEM_INVALIDATED_BY_FORM",rule:function(T,R,S){function P(V,U){return !isDefined(O.requiredValue.rule(V,U))}if(D){var Q=false;M.find('div[data-validators*="dynamicRequiredAtLeastOnePhoneNumber"]').each(function(U,V){if(P(T,jq(V))){Q=true}});if(!Q){return{fieldName:T,level:"ERROR",errorKey:"atLeastOneCommRequired",validationGroup:"dynamicRequiredAtLeastOnePhoneNumber"}}}}};return O};L.onDynamicValidatorActivated=function(){D=true;L.renderRequiredFieldIndicators()};L.onDynamicValidatorDeactivated=function(){D=false;L.renderRequiredFieldIndicators()};L.getValueRenderers=function(O){O.commMethodPreferred=function(S,R,P,Q){if(typeof R!=="undefined"&&(R===true||R==="true")&&B&&B.preferredlabeltext.length>0){Q.text("("+B.preferredlabeltext+")")}else{Q.text("")}};return O};L.getFieldMappers=function(O){O.communicationMethod={get:F,set:E};return O};function F(R,P){var Q=P.find("input[type='text']").val();var O=P.find("input[type='radio']").length>0?(P.find("input[type='radio']:checked").length>0?"true":"false"):null;return{value:Q,preferred:O}}function E(Q,P,O){if(typeof P=="undefined"||P.value==null||P.value==""){O.find("input[type='text']").val("");O.find("input[type='radio']").attr("disabled","disabled").removeAttr("checked")}else{O.find("input[type='text']").val(P.value);O.find("input[type='radio']").removeAttr("disabled").removeAttr("checked");if(P.preferred==true||P.preferred=="true"){O.find("input[type='radio']").attr("checked","checked")}}}function J(){M.find("input[type='text']").each(function(P,Q){var S=jq(Q);var O=S.parents(".fieldSetEditAreaRow").find("input[type='radio']");if(O.length>0){var R=function(T){if(S.val().length==0){O.attr("disabled","disabled");O.removeAttr("checked")}else{O.removeAttr("disabled")}I()};S.change(R);S.keyup(R)}})}function I(){if(M.find("input[type='radio']:checked").length==0){M.find("input[type='radio']:enabled").first().attr("checked","checked")}}L.allScoringFieldsFilled=function(){var O=false;M.find("span[data-field]").each(function(P,Q){if(jq(Q).text()!=""&&jq(Q).text()!="--"){O=true;return false}});return O};L.setData=function(P){K.setData(P);var O=(P&&P.user&&P.user.profile&&P.user.profile.email);C.allEvents.trigger(C.allEvents.names.USER_PROFILE_EMAIL_CHANGED,O?P.user.profile.email.value:undefined)};L.onFormClosing=function(){C.validatorEventsController.removeCommunicationsFSDynamicValidatorListener()};function N(){C.allEvents.subscribe(C.allEvents.names.PING_EMAIL_PROVIDER,function(O){O.trigger(C.allEvents.names.PONG_EMAIL_PROVIDER)});C.validatorEventsController.setCommunicationsFSDynamicValidatorListener(L)}L.renderRequiredFieldIndicators=function(){jq("#"+L.getFieldSetId()).find(".fieldSetEditMode [data-validators]").each(function(Q,T){T=jq(T);var V=false;var P=false;var U=false;var O=jq.trim(T.attr("data-validators")).split(",");for(var S=0;S<O.length;S++){var R=O[S];if(R.toLowerCase().indexOf("required")>=0&&R!=="requiredAtLeastOneComm"&&R!=="dynamicRequiredAtLeastOnePhoneNumber"){V=true}if(R==="requiredAtLeastOneComm"){P=true}if(R==="dynamicRequiredAtLeastOnePhoneNumber"&&D){U=true}}if(V){T.find(".requireMarker").text("*")}else{if(P||U){T.find(".requireMarker").text("(*)")}else{T.find(".requireMarker").text("")}}})};function G(){var O="[data-isRequiredComm],[data-validators*='dynamicRequiredAtLeastOnePhoneNumber'";var P=M.find(O).first().find(".fieldSetValidationFeedback");var Q=P.attr("data-validationplacements");if(Q==""){P.attr("data-validationplacements","atLeastOneCommRequired")}else{P.attr("data-validationplacements",Q+",atLeastOneCommRequired")}}L.init=function(){K.init();J();G()};N();return L}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlComponentSetInputCaching=function(){var O={secure:true,path:"/"};var A={};var C=250;var L=false;function M(R,T){var U=true;var S=T;var Q=R;if(S==null||typeof S==="undefined"){console.warn("Component '"+Q+"' will not be cached/restored since it is invalid.");return false}if(typeof A[Q]==="object"&&typeof A[Q].isValid==="boolean"){return A[Q].isValid}if(S.cachingDisabled===true){U=false;console.warn("Component '"+Q+"' will not be cached/restored since 'cachingDisabled' is set to true.")}else{if(typeof S.getDataToCache!=="function"&&typeof S.callbackBeforeSaveData!=="function"){U=false;console.warn("Component '"+Q+"' will not be cached/restored since it has no method 'getDataToCache/callbackBeforeSaveData'.")}else{if(typeof S.setDataFromCache!=="function"&&typeof S.callbackLoadedData!=="function"){U=false;console.warn("Component '"+Q+"' will not be cached/restored since it has no method 'setDataFromCache/callbackLoadedData'.")}else{if(typeof S.getCacheFieldsNames!=="function"&&typeof S.getFieldsNames!=="function"){U=false;console.warn("Component '"+Q+"' will not be cached/restored since it has no method 'getCacheFieldsNames/getFieldsNames'.")}}}}A[Q]=S;A[Q].isValid=U;return U}function P(R){var U={};if(!R instanceof Array){console.error("'"+R+"' must be an Array.");return U}for(var T=0;T<R.length;T++){var Q=R[T];if(Q=="optionalfield"){var V=jq(".field-opt");V.each(function(Y,X){field=jq(X);Q=field.attr("name");var W=rlAbstractForm.getComponent(Q);if(M(Q,W)){U[Q]=W}})}else{var S=rlAbstractForm.getComponent(Q);if(M(Q,S)){U[Q]=S}}}return U}function G(Q){var R=[];if(typeof Q.getCacheFieldsNames==="function"){R=Q.getCacheFieldsNames()}else{if(typeof Q.getFieldsNames==="function"){R=Q.getFieldsNames()}}return R}function H(){return typeof rlAbstractUserManagementForm==="object"&&rlAbstractUserManagementForm.isListLoaded()===true}function B(W,Q){if(typeof Q==="undefined"){console.warn("Registering blur events on components:'"+W+"' will not occur since context: '"+Q+"' is invalid.");return }if(!H()){console.info("Wait for list to load before registering blur events.");window.setTimeout(function(){B(W,Q)},C)}else{var T=P(W);for(var V in T){var X=T[V];var S=G(X);var U=jq("."+V.replace(/\$/g,"\\$"),Q);for(var R=0;R<S.length;R++){var Y=S[R];K(Y,V,X,Q,U)}}}}function K(X,T,V,S,R){var W=X;var Q=T;var U=V;R.delegate('input[name="'+W+'"], textarea[name="'+W+'"], select[name="'+W+'"]',"blur",function(){I(Q,U)});R.delegate('input[name="'+W+'"]:radio, input[name="'+W+'"]:checkbox',"click",function(){I(Q,U)})}function J(S){var T=S;for(var Q in T){var R=T[Q];I(R)}}function I(R,T){var Q=R;var S=T;console.info("Start caching component: '"+Q+"'");var U=D(Q,S);F(Q,U);console.info("End caching component: '"+Q+"'")}function D(S,U){var Q={};var T=U;var R=S;if(typeof T.getDataToCache==="function"){Q=T.getDataToCache()}else{if(typeof T.callbackBeforeSaveData==="function"){Q=T.callbackBeforeSaveData({})}}return Q}function N(V){if(!H()){console.info("Wait for list to load before restoring components.");window.setTimeout(function(){N(V)},C)}else{var T=P(V);for(var U in T){console.info("Start restoring component: '"+U+"'");var Y=E(U);var W=T[U];var S=G(W);if(typeof W.setDataFromCache==="function"){W.setDataFromCache(Y)}else{for(var R=0;R<S.length;R++){var X=S[R];var Q="value" in Y?Y:Y[X];if(Q!=null&&typeof Q!=="undefined"){console.info("  Restoring field: '"+X+"' with value: '"+Q+"'");W.callbackLoadedData(X,Q)}}}console.info("End restoring component: '"+U+"'")}jq(window).trigger(rlAbstractForm.getTriggerNameRestoredFromCache())}}function F(Q,R){if(!L){var S=(typeof R!=="undefined")?jq.lzCompressToBase64(jq.toJSON(R)):"";jq.cookie(Q,S,O)}}function E(Q){try{var S=jq.cookie(Q);if(S!=null){S=jq.lzDecompressFromBase64(S)}var R=jq.secureEvalJSON(S);return R||{}}catch(T){console.warn("Problem occurred decoding cookie: "+T);return{}}}return{__init__:function(){},cacheComponentsOnFieldBlur:function(R,Q){rlCoreServices.isLoggedIn({loggedOut:function(){B(R,Q)}})},restoreComponents:function(Q){rlCoreServices.isLoggedIn({loggedOut:function(){N(Q)}})},suspendCaching:function(){L=true},resumeCaching:function(){L=false}}}();var rlConfigstage=function(){var k;var I=false;var Z=0;var n;var V;var q=rlBrowser.getInternetExplorerVersion();function P(s){jq(".configStageImageContainer").animate({opacity:0},0,function(){window.bmwConfigId=s.configId;b(s,k);Y(k);Q(s,k);if(s.lastUpdate&&s.lastUpdate.value){var w=s.lastUpdate.value.split("T")[0];var v=w.split("-");var x=new Date(v[0],v[1]-1,v[2]);jq("span.configStageLastChangeDate").html(rlFormatter.formatDate(x));jq("div.configStageLastChanged").show()}else{jq("div.configStageLastChanged").hide()}var u=(typeof s.imageUrlFront820==="undefined")||(typeof s.imageUrlInterior==="undefined")||(typeof s.imageUrlBack==="undefined");if(u){jq("div.configStagePreviewExterior").hide();jq("div.configStagePreviewInterior").hide();jq("div.configStagePreviewInteriorMask").hide();jq("div.configStagePreviewExteriorRear").hide();jq("div.configStageImagePerspective").fadeOut(400)}else{jq(".exteriorImage").hide();jq(".exteriorImageRear").hide();jq(".interiorImage").hide();jq(".interiorImageMask").hide();jq("div.configStagePreviewExterior").html("<img src='"+s.imageUrlFront820.value+"' class='exteriorImage'>");jq("div.configStagePreviewExteriorRear").html("<img src='"+s.imageUrlBack.value+"' class='exteriorImageRear'>");jq("div.configStagePreviewInterior").html("<img src='"+s.imageUrlInterior.value+"' class='interiorImage'>");jq(".exteriorImage").bind("load",function(){console.log("exteriorImage loaded");jq(this).fadeIn(700)});jq(".exteriorImageRear").bind("load",function(){console.log("exteriorImageRear loaded");jq(this).show()});jq(".interiorImage").bind("load",function(){console.log("interiorImage loaded");jq(this).show()});jq("div.configStageImagePerspective").fadeIn(700)}if(typeof s.accessByIdUrl!=="undefined"){jq("a.configStageOpenConfigInNCC").attr("href",s.accessByIdUrl.value)}else{if(typeof s.accessUrl!=="undefined"){jq("a.configStageOpenConfigInNCC").attr("href",s.accessUrl.value)}else{jq("a.configStageOpenConfigInNCC").attr("href","javascript:void(0)")}}if(typeof rlShareButton!=="undefined"){rlComponentLoader.deferredExec(["shareButton"],function(){if(typeof s.configUrl!=="undefined"){var y=s.configUrl.value;if(y.indexOf("://")<0){y="http://"+y}rlShareButton.setShareUrl(y);rlShareButton.setTitleParam(s.modelSection.title.value)}else{rlShareButton.setShareUrl("");rlShareButton.setTitleParam("")}})}var t=(typeof s.valid!=="undefined"&&s.valid==="false");if(k.showToolbox){if(t){jq(".configStageToolboxContainer").hide();jq(".configStageShowDetailsLink").hide();jq(".configStageDeleteConfigLink").show()}else{jq(".configStageDeleteConfigLink").hide();jq(".configStageToolboxContainer").show();jq(".configStageShowDetailsLink").show()}}if(t){jq("div.configStageNoLongerBuildable").show()}else{jq("div.configStageNoLongerBuildable").hide()}jq(".configStageShowDetailsLink").click(function(){window.location.href="myconfigurations.html#"+s.configId});rlMyConfigsController.applySubBrandStyling(s,".configStageContent");g();j()})}function b(s,t){jq("h1.configStageHeadline").html((s.modelSection.title.value).slice(0,-1)+"<span style='letter-spacing : -1px;'>"+(s.modelSection.title.value).slice(-1)+"</span>");jq("span.configStageSubheadline").html(s.note.value);if(s.bestConfiguration&&s.bestConfiguration==="true"){jq("div.configStageBestConfigStar").show();jq(".configStageSetAsPrimaryLinkContainer").hide()}else{jq("div.configStageBestConfigStar").hide();if(jq(".configStageSetAsPrimaryLinkContainer").is(":hidden")||jq(".configStageSetAsPrimaryLinkContainer").css("opacity")==0){jq(".configStageSetAsPrimaryLinkContainer").show();if(t.showToolbox&&jq(".configStageSetAsPrimaryLinkContainer").css("opacity")==0){jq(".configStageSetAsPrimaryLinkContainer").show();jq(".configStageSetAsPrimaryLinkContainer").animate({opacity:1},700,function(){if(q>0&&q<9){jq(this).css("filter","none")}})}}}}function Y(s){if(!s.showToolbox){jq(".configStageRenameLinkContainer").show();jq(".configStageDeleteLinkContainer").show();jq(".configStageAddToMyVehiclesLinkContainer").show();jq(".configStageAddAccessoriesLinkContainer").show()}}function Q(s,t){if(rlNccServices.isSubBrandBMWi(s)){if(s.dealerShare&&s.dealerShare==="true"){jq(".configStageShareLinkContainer").hide();jq(".configStageUnShareLinkContainer").show()}else{jq(".configStageShareLinkContainer").show();jq(".configStageUnShareLinkContainer").hide()}}else{jq(".configStageShareLinkContainer").hide();jq(".configStageUnShareLinkContainer").hide()}H()}function E(){jq(".configStageEditModeToolbox").hide()}function p(){P({configId:"dummy",bestConfiguration:true,modelSection:{title:{value:"Name of vehicle model"}},note:{value:"User-specified note"},imageUrlFront:{value:""},imageUrlBack:{value:""},imageUrlInterior:{value:""},lastUpdate:{value:"2011-11-11"}});jq(".configStageEditModeWithoutConfigs").click(function(){F()});jq(".configStageEditModeWithConfigs").click(function(){g()});F();jq(".configStageEditModeToolbox").show()}function l(){jq(".configStageExteriorIcon").click(function(){U("Exterior",true)});jq(".configStageExteriorRearIcon").click(function(){U("ExteriorRear",true)});jq(".configStageInteriorIcon").click(function(){U("Interior",true)});jq("div.configStagePreviewInterior").hide()}function H(){X()}function d(){if(V){X()}else{A()}}function A(){jq(".configStageToolboxLinksContainer").css("display","block");var u=jq(".configStageToolboxLinksContainer").outerHeight(true)+35;var t=jq(".configstage").height()-u;var s=3;jq(".configStageToolboxOuterContainer").animate({top:t+"px",height:u+"px"},700,function(){V=true});jq(".configStageToolboxInnerContainer").animate({top:s+"px"});jq(".configStageToolboxLinkNodeContainer").animate({opacity:1},700,function(){if(q>0&&q<9){jq(this).css("filter","none")}jq(".configStageToolboxMoreOptionsContainer").removeClass("spriteIconArrowToggleUpSmall");jq(".configStageToolboxMoreOptionsContainer").addClass("spriteIconArrowToggleBottomSmall");jq(".configStageToolboxInnerContainer").removeClass("containerSmall")})}function X(){var u=35;var t=jq(".configstage").height()-35;var s=6;jq(".configStageToolboxLinkNodeContainer").animate({opacity:0},400,function(){jq(".configStageToolboxMoreOptionsContainer").removeClass("spriteIconArrowToggleBottomSmall");jq(".configStageToolboxMoreOptionsContainer").addClass("spriteIconArrowToggleUpSmall");jq(".configStageToolboxInnerContainer").addClass("containerSmall")});jq(".configStageToolboxOuterContainer").animate({top:t+"px",height:u+"px"},400,function(){jq(".configStageToolboxLinksContainer").css("display","none");V=false});jq(".configStageToolboxInnerContainer").animate({top:s+"px"})}function c(){jq(".configStageSetAsPrimaryLink").click(C);jq(".configStageRenameLink").click(S);jq(".configStageDeleteLink").click(r);jq(".configStageDeleteConfigLink").click(r);jq(".configStageShareLink").click(K);jq(".configStageUnShareLink").click(O);jq(".configStageAddAccessoriesLink").click(N);jq(".configStageAddToMyVehiclesLink").click(o)}function e(){jq(".configStageToolboxMoreOptionsContainer").click(function(){d()})}function R(){jq(".configStageToggleCongigurtionsLayerLink").click(function(){rlUserDialog.showConfigSelector()})}function J(){jq(".configStagePreviousConfigButton").click(function(){L();rlMyConfigsController.getPreviousConfig()});jq(".configStageNextConfigButton").click(function(){L();rlMyConfigsController.getNextConfig()})}function m(){jq(window).bind(rlNccServices.EVENT_CONFIG_USERNOTE_CHANGED,B);jq(window).bind(rlNccServices.EVENT_CONFIG_WASDELETED,T);jq(window).bind(rlNccServices.EVENT_CONFIG_SETASPRIMARY,f);jq(window).bind(rlNccServices.EVENT_CONFIG_SHARED,f);jq(window).bind(rlNccServices.EVENT_CONFIG_UNSHARED,f)}function B(t,s){if(s.configId==rlMyConfigsController.getCurrentConfigId()){jq("span.configStageSubheadline").html(s.userNote);var u=rlTime.convertUTCDateToLocal(rlTime.convertDateToISO8601(new Date()));jq("span.configStageLastChangeDate").html(u.day+"."+u.month+"."+u.year);jq("div.configStageLastChanged").show()}}function T(t,s){if(s.configId==rlMyConfigsController.getCurrentConfigId()){rlNccServices.getConfigCount({success:function(u){if(u>0){rlMyConfigsController.loadPrimaryConfiguration()}else{F()}},error:function(){W()},fail:function(){W()}})}}function f(t,s){if(s.configId==rlMyConfigsController.getCurrentConfigId()){rlMyConfigsController.loadConfiguration(rlMyConfigsController.getCurrentConfigId())}}function C(){jq(".contextLayerDialogMain").hide();rlNccServices.setPrimaryConfig({configId:rlMyConfigsController.getCurrentConfigId(),success:function(s){L()},error:function(){rlErrorService.handleError({actor:rlErrorService.ACTOR_USER})},fail:function(){rlErrorService.handleError({actor:rlErrorService.ACTOR_USER})}})}function S(){jq(".contextLayerDialogMain").hide();rlUserDialog.showConfigRenameDialog({onClose:function(s){if(s){L()}}})}function r(){jq(".contextLayerDialogMain").hide();rlUserDialog.showConfigDeleteDialog({configId:rlMyConfigsController.getCurrentConfigId(),onClose:function(s){if(s){L()}}})}function K(){jq(".contextLayerDialogMain").hide();rlUserDialog.showConfigShareDialog({configId:rlMyConfigsController.getCurrentConfigId(),onClose:function(s){if(s){L()}}})}function O(){jq(".contextLayerDialogMain").hide();rlNccServices.shareConfig({doShare:false,configId:rlMyConfigsController.getCurrentConfigId(),_charset_:"UTF-8",success:function(s){if(s&&s.status&&s.status.responseStatus==="OK"){jq(window).trigger("config_data_changed");rlUserDialog.showConfigUnShareDialog({configId:rlMyConfigsController.getCurrentConfigId(),onClose:function(t){if(t){L()}}})}else{rlErrorService.handleError({actor:rlErrorService.ACTOR_SYSTEM})}},error:function(){rlErrorService.handleError({actor:rlErrorService.ACTOR_SYSTEM})}})}function N(){var s=rlMyConfigsController.getCurrentConfig();var u=s.modelSection.modelCode.value;var t={modelCode:u,success:function(w){if(typeof w.series==="undefined"){rlErrorService.handleError({actor:rlErrorService.ACTOR_USER});return }var v=w.series.code;var x=jq.base64Encode('{"as_q":"inmeta:availableForSeries%3D'+v+" inmeta:availableForModels%3D"+u+'"}');window.location.href=k.accessoriesLink+"#"+x;console.log(w.series.code)}};rlNccServices.getVehicleModel(t)}function o(){jq(".contextLayerDialogMain").hide();rlUserDialog.showConfigBuyDialog({configId:rlMyConfigsController.getCurrentConfigId(),onClose:function(s){if(s){L()}}})}function g(){jq("div.configErrorTeaser").hide();jq("div.configStageContent").show();jq(".configStageImageContainer").animate({opacity:1},700,function(){if(q>0&&q<9){jq(this).css("filter","none")}});jq("div.configStageTeaser").hide();if(k.showConfigLayer){G()}jq(window).trigger("stagearea-teaser-changed")}function F(){jq("div.configErrorTeaser").hide();jq("div.configStageContent").hide();jq("div.configStageTeaser").show();D();jq(window).trigger("stagearea-teaser-changed")}function W(){jq("div.configStageContent").hide();jq("div.configStageTeaser").hide();jq("div.configErrorTeaser").show();D();jq(window).trigger("stagearea-teaser-changed")}function G(){jq(".configStageToggleConfigurationsLayerLink").show()}function M(){jq(".configStageToggleConfigurationsLayerLink").show()}function a(){rlDither.on(".configStage")}function j(){setTimeout(function(){rlDither.off(".configStage")},500)}function D(){rlDither.off(".configStage")}function L(){if(V){X()}}function U(v,u){var s;if(v==="Exterior"){s=["ExteriorRear","Interior","InteriorMask"]}else{if(v==="ExteriorRear"){s=["Exterior","Interior","InteriorMask"]}else{if(v==="Interior"){s=["Exterior","ExteriorRear"]}else{return }}}jq(".configStage"+v+"Icon").hide();if(u){if(v==="Interior"||n==="Interior"){jq(".configStagePreview"+v).fadeIn(700)}if(v==="Interior"){jq(".configStagePreviewInteriorMask").fadeIn(700)}if(v!="Interior"){jq(".configStagePreview"+v).delay(400).fadeIn(700)}}else{jq(".configStagePreview"+v).show()}for(var t=0;t<s.length;t++){jq(".configStage"+s[t]+"Icon").show();if(u){jq(".configStagePreview"+s[t]).fadeOut(400)}else{jq(".configStagePreview"+s[t]).hide()}}if(v==="Interior"){jq(".configStageContent").attr("data-stagebackgroundcolor","Dark");jq(".configStageTurnsWhiteOnInt").css("color","white");jq(".configStageShowDetailsLink").addClass("linkArrow13pxWhite");jq(".configStageShowDetailsLink").removeClass("linkArrow13px");jq(".configStageBestConfigStar").addClass("spriteLabelFavoritWhite12");jq(".configStageBestConfigStar").removeClass("spriteLabelFavoritGrey12");jq(".configStageNoLongerBuildableIcon").addClass("spriteLabelWarningWhite24");jq(".configStageNoLongerBuildableIcon").removeClass("spriteLabelWarningGrey24")}else{jq(".configStageContent").attr("data-stagebackgroundcolor","Light");jq(".configStageTurnsWhiteOnInt").css("color","");jq(".configStageShowDetailsLink").addClass("linkArrow13px");jq(".configStageShowDetailsLink").removeClass("linkArrow13pxWhite");jq(".configStageBestConfigStar").addClass("spriteLabelFavoritGrey12");jq(".configStageBestConfigStar").removeClass("spriteLabelFavoritWhite12");jq(".configStageNoLongerBuildableIcon").addClass("spriteLabelWarningGrey24");jq(".configStageNoLongerBuildableIcon").removeClass("spriteLabelWarningWhite24")}jq(window).trigger("stagearea-teaser-changed");n=v}return{__init__:function(){l();Z=rlNccServices.getMaxNumberOfConfigs();jq(".rfxButtonRFI").find("a").attr("id","MyBMWConfigStageRFI");jq(".rfxButtonRFO").find("a").attr("id","MyBMWConfigStageRFO");jq(".rfxButtonTDA").find("a").attr("id","MyBMWConfigStageTDA");jq(".configStageOpenConfigInNCC").attr("id","MyBMWConfigStageConfig");if(!rlPage.isEditMode()){c();e();R();rlComponentLoader.deferredExec("nccServices",function(){m()});J()}},__start__:function(){},initController:function(s){k=s;if(jq(".configStageRequestsBar").find(".buttonBlue").length>1){jq(".configStageOpenConfigInNCC").removeClass("buttonBlue")}jq(".rfxButton").children().appendTo(".configStageRequestsBar");jq(".configStageRequestsButtonOpenConfigInNCCContainer").children().appendTo(".configStageRequestsBar");jq("div.configStageTeaser .buttonConfigureNow>a").attr("id","noConfigConfigureNow");if(rlPage.isEditMode()){p();return }else{E()}d();window.onbeforeunload=function(){I=true};rlCoreServices.isLoggedIn({loggedOut:function(){F()}});rlCoreServices.addLoggedOutListener(function(){F();M()});rlMyConfigsController.addConfigLoadedListener({success:function(t){rlConfigstage.onConfigLoadedSuccess(t);if(jq(".configStage").is(":visible")){rlMyConfigsController.broadcastCurrentConfiguration()}},error:function(t){W()}});rlMyConfigsController.addConfigListLoadedListener({success:function(v){if(v.length==0){F()}if(v.length==1){jq(".configStageSkipButton").hide()}else{jq(".configStageSkipButton").show()}var t=jq(".configStageToggleCongigurtionsLayerLink");if(!t.attr("data-template")){t.attr("data-template",t.html())}if(t.attr("data-template")!=undefined){var u=t.attr("data-template").replace("${configLength}",v.length);t.html(u)}},error:function(t){W()}});rlMyConfigsController.addConfigStartedLoadingListener({success:function(){jq("div.configStageTeaser").hide();U("Exterior",false);a()},error:function(){W()}})},onConfigLoadedSuccess:function(s){P(s)}}}();rlContactDataSink=function(){function A(E){var B=CoreFormsBase.inheritanceFrom(rlRfxBaseDataSink.createDataSink());var D=B.parent;B.typeName="rlContactDataSink";B.prepareData=function(H){var I=D.prepareData(H);if(typeof I.options!=="undefined"){if(typeof I.options.REASON_FOR_CONTACT!=="undefined"){I.options.reasonForContact=I.options.REASON_FOR_CONTACT;delete I.options.REASON_FOR_CONTACT}if(typeof I.options.MOTORBIKE!=="undefined"){I.options.motorbike=I.options.MOTORBIKE;delete I.options.MOTORBIKE}if(typeof I.options.ORIGIN_OF_CONTACT!=="undefined"){I.options.originOfContact=I.options.ORIGIN_OF_CONTACT;delete I.options.ORIGIN_OF_CONTACT}}if(I.user){F(I.user,"vehicleInterests");F(I.user,"technologyInterests")}if(typeof window.dealerOfferReferenceId!=="undefined"){I.requestId=window.dealerOfferReferenceId}I.policy=C(I);I=G(I);return I};function G(K){if(K&&K.customDealerPolicyInfo&&jq.isPlainObject(K.customDealerPolicyInfo)){var I=K.customDealerPolicyInfo;var L={entry:[]};for(var H in I){if(I.hasOwnProperty(H)){if(typeof H!=="undefined"&&H!==null&&H.length>0){var J=I[H];J=(typeof J==="undefined"||J===null)?"":J;L.entry.push({key:H,value:J})}}}K.customDealerPolicyInfo=L}return K}function C(H){var I=H.policyCurrent_CONTACT||H.policyCurrent_CONTACT_DEALER;delete H.policyCurrent_CONTACT;delete H.policyCurrent_CONTACT_DEALER;return I}B.save=function(I){var H=B.prepareData(E);rlCoreServices.sendContact(H,function(J){I.success(J)||function(K){}},function(J){console.log(J);B.handleErrors(J,I.error,I.validation)},function(J){console.log(J);B.handleValidationErrors(J,I.validation)})};function F(H,I){if(H&&H[I]){var L=[];for(var K=0;K<H[I].length;K++){var J=H[I][K];if(J.action!="DELETE"){L.push(J)}}H[I]=L}}return B}return{__init__:function(){},__start__:function(){},createDataSink:function(B){return A(B)}}}();var rlContactDateFS=function(){function A(B,H){var C=CoreFormsBase.inheritanceFrom(rlFormFieldSet.createFS(B,H));var F=C.parent;C.typeName="rlContactDateFS";C.jqFS=B;var D={};var E={};C.getValueRenderers=function(I){I.suggestedAppointments=function(M,L,J,K){K.html("");if(typeof L!=="undefined"){jq.each(L,function(V,O){var Q=jq("<div />").addClass("fieldSetViewAreaRow clearfix");var Z=rlContactDateUI.constructDateTime(O);var T=rlFormatter.formatDate(Z.date);var Y=(V+1)+". ";var N=Y+D.datePickerLabel;if(V==0&&D.showAsMandatoryField==true){N+="*"}var X=jq("<div />").addClass("fieldSetLayoutCol1").append(jq("<label />").addClass("fieldSetRowLabel").text(N));var U=jq("<div />").addClass("fieldSetCopyText fontBold").text(T);var R=jq("<div />").addClass("fieldSetCopyText fontBold").text(D.datePickerTimeFromText);var S=jq("<div />").addClass("fieldSetCopyText fontBold").text(Z.time);var P=jq("<div />").addClass("fieldSetCopyText fontBold").text(D.clockTimeText);var W=jq("<div />").addClass("fieldSetLayoutCol2 fieldSetMultiFieldGroup clearfix").append(U,R,S,P);Q.append(X,W);K.append(Q)})}};return I};C.getValidationRules=function(I){I.requiredContactDate={event:"change",when:"ELEM_INVALIDATED_BY_FORM",rule:function(M,J,L){var K=G(J);if(K.length==0){return{fieldName:"suggestedAppointments",level:"ERROR",errorKey:L[0]||"requiredValue"}}}};return I};C.getFieldMappers=function(I){I.suggestedAppointments={get:function(L,J){var K=new Array();K=G(J);if(K.length==0){K=""}return K},set:function(M,L,K){if(typeof L!=="undefined"){var J=K.closest("fieldset");rlContactDateUI.ensureDateRows(J,L.length,D);K.find("."+E.dateRowClass).each(function(O,Q){if(O<L.length){var P=Q.getAttribute("id");var N=rlContactDateUI.constructDateTime(L[O]);jq(Q).find("#"+P+E.dateInputDateName).datepicker("setDate",N.date);jq(Q).find("#"+P+E.dateInputStartTimeName).val(N.time).change()}})}}};return I};C.getStateForInputCache=function(){var I=new Array();C.jqFS.find("."+E.dateRowClass).each(function(J,N){var M=N.getAttribute("id");var L=jq(N).find("#"+M+E.dateInputDateName).val();if(!(typeof L!=="undefined"&&L!="")){L=null}var K=jq(N).find("#"+M+E.dateInputStartTimeName).val();I.push({date:L,time:K})});return I};C.setStateFromInputCache=function(I){if(typeof I!=="undefined"){rlContactDateUI.ensureDateRows(C.jqFS,I.length,D);C.jqFS.find("."+E.dateRowClass).each(function(J,L){if(J<I.length){var K=L.getAttribute("id");jq(L).find("#"+K+E.dateInputDateName).datepicker("setDate",I[J].date);jq(L).find("#"+K+E.dateInputStartTimeName).val(I[J].time).change()}})}};C.init=function(){F.init();jq.extend(E,rlContactDateUI.getClasses());rlContactDateUI.initDatePickerOptions(B,D);rlContactDateUI.addDateRow(B,D);rlContactDateUI.showAddLink(B,false,false,D);rlContactDateUI.showContainer(B);rlContactDateUI.addDateLinkListener(B,D)};C.getMailSummary=function(I,J,K){B.find(".contactDateRow").each(function(M,P){P=jq(P);var N=P.find("label.fieldSetRowLabel").text();var O=P.find("input.dateInputField").val();if(O!==""){var L=P.find("select").find("option:selected").text();I.push({type:J.KEY_VALUE,key:N,value:jq.trim(O+" "+L),id:(K!==true)?undefined:B.find('[data-field]:not([data-field=""])').attr("data-field")})}})};function G(I){var J=[];I.find("."+E.dateRowClass).each(function(K,Q){var P=Q.getAttribute("id");var O=jq(Q).find("#"+P+E.dateInputDateName).val();var M=jq(Q).find("#"+P+E.dateInputStartTimeName).val();if(typeof O!=="undefined"&&O!=""){var N=jq.datepicker.parseDate(D.datepicker.dateFormat,O);var L=rlContactDateUI.combineDateAndTime(N,M);if(typeof L!=="undefined"){J.push(L)}}});return J}return C}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlContactDateUI=function(){var R={contactDateEditClass:"fieldSetEditMode",contactDateViewClass:"fieldSetViewMode",dateRowContainerClass:"contactDateRowContainer",dateRowClass:"contactDateRow",dateLinkAddClass:"contactDateAdd",dateRemoveClass:"spriteIconDeleteMedium",dateInputDateName:"_date",dateInputStartTimeName:"_startTime"};var A;var N;function H(U){return U.find("."+R.dateRowClass).length}function J(b,Y){var f=0;if(H(b)>0){var s=b.find("."+R.dateRowClass+":last").attr("id");var m=s.substring(R.dateRowClass.length);f=1+parseInt(m)}var e=R.dateRowClass+f;var W=e+R.dateInputDateName;var a=Y.datePickerLabel;if(f==0&&Y.showAsMandatoryField==true){a+="*"}var V=jq("<div />").addClass(R.dateRowClass).addClass("fieldSetEditAreaRow clearfix").attr("id",e);var d=jq("<div />").addClass("fieldSetLayoutCol1").append(jq("<label />").addClass("fieldSetRowLabel").attr("for",W).text(a));var q=jq("<div />").addClass("fieldSetLayoutCol23 fieldSetMultiFieldGroup clearfix");var r=jq('<input type="text" readonly="true" />').addClass("fieldSetFieldText xlarge dateInputField").attr("id",W).attr("name",W);if(Y.isWeekPicker){var l=jq('<input type="text" readonly="true" />').addClass("fieldSetFieldText xlarge dateInputField weekDisplay").attr("id",W+"_weekDisplay").attr("name",W+"_weekDisplay");q.addClass("weekPickerRow").append(r,l)}else{var n=jq("<div />").addClass("fieldSetCopyText").text(Y.datePickerTimeFromText);var p=jq("<select>").addClass("fieldSetFieldSelect small").attr("id",e+R.dateInputStartTimeName).attr("name",e+R.dateInputStartTimeName);for(var o=0;o<Y.datePickerTimeValueList.length;o++){var j=jq("<option />").attr("value",Y.datePickerTimeValueList[o]).text(Y.datePickerTimeValueList[o]);p.append(j)}var X=jq("<div />").addClass("fieldSetCopyText").text(Y.clockTimeText);var k=jq('<a href="javascript: void(0);" />').addClass(R.dateRemoveClass+" baseIconSprite baseIconSizeMedium");q.append(r,n,p,X,k)}var g=V.append(d,q).hide();Q(b).append(g);K(b,Y);var t="#"+e+" a."+R.dateRemoveClass;var c=b.find(t);if(H(b)>1){c.show()}else{c.hide()}if(H(b)<=1){V.show()}else{rlRfxViewHelper.showElement(g)}var Z=jq.extend(Y.datepicker,{beforeShowDay:function(u){return T(u,Y)}});if(Y.isWeekPicker){Z.onSelect=function(y,x){var w=jq(this).datepicker("getDate");var v=parseInt(Y.datepicker.firstDay);var u=x.settings.dateFormat||jq.datepicker._defaults.dateFormat;A=new Date(w.getFullYear(),w.getMonth(),w.getDate()-w.getDay()+v);N=new Date(w.getFullYear(),w.getMonth(),w.getDate()-w.getDay()+6+v);jq(this).next().val(jq.datepicker.formatDate(u,A,x.settings)+" - "+jq.datepicker.formatDate(u,N,x.settings))};Z.beforeShowDay=function(v){var u="";if(v>=A&&v<=N){u="ui-datepicker-current-day"}return T(v,Y,u)};Z.beforeShow=function(u,v){window.setTimeout(function(){jq(".ui-datepicker-calendar td.ui-datepicker-days-cell-over a").removeClass("ui-state-hover")},10)};Z.onChangeMonthYear=function(u,v){window.setTimeout(function(){jq(".ui-datepicker-calendar td.ui-datepicker-days-cell-over a").removeClass("ui-state-hover")},10)}}b.find("#"+W).datepicker(Z);jq.datepicker.formatDate=function(v,u){return rlFormatter.formatDate(u)};var U=jq(".gplnContentValue");if(U.length>0){U.bind("scroll",function(){b.find("#"+W).datepicker("hide")})}b.find(t).click(function(){rlRfxViewHelper.hideElement(jq(this).closest("div#"+e),function(u){E(b,u);K(b,Y)});B(b,true,true,Y);return false});if(Y.isWeekPicker){jq(".ui-datepicker-calendar tr").live("mousemove",function(){jq(this).find("td a").addClass("ui-state-hover")});jq(".ui-datepicker-calendar tr").live("mouseleave",function(){jq(this).find("td a").removeClass("ui-state-hover")});b.find("#"+W+"_weekDisplay").click(function(){b.find("#"+W).focus()})}}function E(U,V){V.remove();if(H(U)==1){U.find("."+R.dateRemoveClass).hide()}}function K(U,V){if(V.isWeekPicker){return }var W=U.find("."+R.dateRowClass+" div label");jq.each(W,function(Y,X){var Z=(Y+1)+". "+V.datePickerLabel;if(Y==0&&V.showAsMandatoryField==true){Z+="*"}X.innerHTML=Z});U.find("."+R.dateRowClass).first().addClass("followsCopyText")}function T(U,b,c){if(typeof c==="undefined"){c=""}var V=jq.datepicker.noWeekends(U);if(V[0]){for(var W=0;W<b.datepicker.holidays.length;W++){var X=b.datepicker.holidays[W].split("-");var Z=(typeof X[0]!=="undefined")?jq.trim(X[0]):"";var Y=(typeof X[1]!=="undefined")?jq.trim(X[1]):"";var a=(typeof X[2]!=="undefined")?jq.trim(X[2]):"";if((U.getFullYear()==Z||Z=="xxxx")&&U.getMonth()==Y-1&&U.getDate()==a){return[false,b.datepicker.holidays[W]+"_day"]}}return[true,c]}return V}function O(U){var V=parseInt(U.datepicker.minDate,10);var W=I(V,U);U.datepicker.minDate="+"+W+"d"}function I(W,V){var X=new Date();var U=0;while(W>0){X.setTime(X.getTime()+86400000);U++;if(L(X,V)[0]){W--}}return U}function L(V,U){var W=jq.datepicker.noWeekends(V);if(W[0]){return T(V,U)}else{return W}}function B(V,X,U,Y){var W=M(V);if(U||(H(V)<Y.maxNumContactDates)){if(X){rlRfxViewHelper.showElement(W)}else{W.show()}}else{if(X){rlRfxViewHelper.hideElement(W)}else{W.hide()}}}function Q(U){return U.find("."+R.contactDateEditClass+" ."+R.dateRowContainerClass)}function M(U){return U.find("."+R.dateLinkAddClass)}function F(U){Q(U).show().css({opacity:1})}function D(U,V){M(U).unbind("click").click(function(){J(U,V);B(U,true,false,V);return false})}function P(V,W){var U=V.data("config");W=jq.extend(W,U);O(W)}function S(U,V,W){while(V>H(U)){J(U,W)}while(V<H(U)){var X=U.find("div."+R.dateRowClass+":last");E(U,X)}B(U,false,false,W)}function C(W){var b=W.split("T");var Y={};var V=b[0].split("-");var Z=V[1]-1;Y.date=new Date(V[0],Z,V[2]);if(isDefined(b[1])){var a=b[1].split(":");var U=parseInt(a[0],10);var X=new Date();X.setUTCHours(U);Y.time=X.getHours()+":"+a[1]}return Y}function G(V,Z){var X={day:V.getDate(),month:V.getMonth()+1,year:V.getFullYear()};if(isDefined(Z)){var Y=Z.split(":");var U=parseInt(Y[0],10);var W=parseInt(Y[1],10);if(!isNaN(U)){X.hours=U}if(!isNaN(W)){X.minutes=W}}return rlTime.convertLocalDateToUTC(X)}return{__init__:function(){},__start__:function(){},getClasses:function(){return R},constructDateTime:function(U){return C(U)},combineDateAndTime:function(U,V){return G(U,V)},ensureDateRows:function(U,V,W){S(U,V,W)},initDatePickerOptions:function(U,V){P(U,V)},addDateRow:function(U,V){J(U,V)},showAddLink:function(V,W,U,X){B(V,W,U,X)},showContainer:function(U){F(U)},addDateLinkListener:function(U,V){D(U,V)},getDateRowCount:function(U){return H(U)},getEditRowContainer:function(U){return Q(U)},getAddDateLink:function(U){return M(U)},removeRow:function(U,V){E(U,V)},renumberLabel:function(U,V){K(U,V)}}}();var rlCoreFormEvents=function(){var A={NAMES:{PING_POLICY_PROVIDER:"PING_POLICY_PROVIDER",PONG_POLICY_PROVIDER:"PONG_POLICY_PROVIDER",PING_EMAIL_PROVIDER:"PING_EMAIL_PROVIDER",PONG_EMAIL_PROVIDER:"PONG_EMAIL_PROVIDER",PING_FIELDSET_SUMMARY:"PING_FIELDSET_SUMMARY",PONG_FIELDSET_SUMMARY:"PONG_FIELDSET_SUMMARY",PING_FIELDSET_PDF_SUMMARY:"PING_FIELDSET_PDF_SUMMARY",PONG_FIELDSET_PDF_SUMMARY:"PONG_FIELDSET_PDF_SUMMARY",USER_PROFILE_EMAIL_CHANGED:"USER_PROFILE_EMAIL_CHANGED",USER_POLICY_CHANGED:"USER_POLICY_CHANGED",WIZARD_STEP_REQUEST_JUMP:"WIZARD_STEP_REQUEST_JUMP",WIZARD_STEP_WILL_CHANGE:"WIZARD_STEP_WILL_CHANGE",WIZARD_STEP_DID_CHANGE:"WIZARD_STEP_DID_CHANGE",SHOW_DLO_FS:"SHOW_DLO_FS",HIDE_DLO_FS:"HIDE_DLO_FS",DEACTIVATE_DLO_FS:"DEACTIVATE_DLO_FS",START_ROUTE_PLANNING:"START_ROUTE_PLANNING",SHOW_ROUTE_RESULTS:"SHOW_ROUTE_RESULTS",CLEAR_ROUTE_RESULTS:"CLEAR_ROUTE_RESULTS",FIELDSET_REMOVED_ITSELF:"FIELDSET_REMOVED_ITSELF",FIX_DOUBLED_STRUCTURE_ELEMENTS:"FIX_DOUBLED_STRUCTURE_ELEMENTS",PING_ADDRESS_REF_TOGGLE:"PING_ADDRESS_REF_TOGGLE",PONG_ADDRESS_REF_TOGGLE:"PONG_ADDRESS_REF_TOGGLE",STATUS_RFI_CHECK_BOX:"STATUS_RFI_CHECK_BOX",POLL_NEED_RFI_METADATA:"POLL_NEED_RFI_METADATA",NEED_RFI_METADATA:"NEED_RFI_METADATA",ESP_WIZARD_STEP_DID_CHANGE:"ESP_WIZARD_STEP_DID_CHANGE",VEHICLE_CONFIG_CHANGED:"VEHICLE_CONFIG_CHANGED",FORM_SUMMARY_RENDERED:"FORM_SUMMARY_RENDERED",MANUAL_VIN_MAPPING_MODELS:"MANUAL_VIN_MAPPING_MODELS"}};function B(F,J){var D={};var I=Object.keys;var H=/\s+/;D.names=A.NAMES;function C(L,K){if(typeof _eventLogs!="undefined"&&_eventLogs){console[L](K)}}var G=I||function(M){var L=[];for(var K in M){if(M.hasOwnProperty(K)){L[L.length]=K}}return L};function E(Q,L,O){if(!L){return true}if(typeof L==="object"){for(var N in L){if(L.hasOwnProperty(N)){D[Q].apply(D,[N,L[N]].concat(O))}}return false}else{if(H.test(L)){var P=L.split(H);for(var M=0,K=P.length;M<K;M++){D[Q].apply(D,[P[M]].concat(O))}return false}else{return true}}}D._events={};D.subscribe=function(K,N,L){if(K&&E("subscribe",K,[N,L])&&N){C("log","FormEvents: subscribe callbacks for event with name:"+K+",callback:"+N+" and context:"+L);var M=D._events[K]||(D._events[K]=[]);M.push({callback:N,context:L,ctx:L||D})}else{C("warn","FormEvents: Cannot subscribe callbacks to event "+K)}return D};D.unsubscribeAll=function(){C("log","FormEvents: clear all events");D._events={};return D};D.unsubscribe=function(K,T,L){var S,O,U,R,P,Q,N,M,V;if(D._events&&E("unsubscribe",K,[T,L])&&(K||T||L)){R=K?[K]:G(D._events);C("log","FormEvents: unsubscribe callbacks for events "+K);for(P=0,Q=R.length;P<Q;P++){V=R[P];U=D._events[V];if(U){S=[];D._events[V]=S;if(T||L){for(N=0,M=U.length;N<M;N++){O=U[N];if((T&&T!==O.callback)||(L&&L!==O.context)){S.push(O)}}}if(!S.length){delete D._events[V]}}}}else{C("warn","FormEvents: Cannot unsubscribe callbacks from event "+K)}return D};D.trigger=function(M){if(!D._events){return D}var L=[].slice.call(arguments,1);L.unshift(D);if(E("trigger",M,L)){C("log","FormEvents: trigger callback for event "+M);var P=D._events[M];if(P){var N=-1,O=P.length,K;while(++N<O){K=P[N];K.callback.apply(K.ctx,L)}}}return D};return D}return{ENUM:A,__init__:function(){},__start__:function(){},create:function(C,D){return B(C,D)}}}();var rlCurrentDealerDS=function(){function A(D){var B=CoreFormsBase.inheritanceFrom(rlBaseDataSource.createDS(D));var C=B.parent;B.typeName="rlCurrentDealerDS";B.get=function(E){rlComponentLoader.deferredExec(["currentDealerModel"],function(){B.parent.get.call(B,E)})};B.getUserData=function(F,E){if(B.getUseMock()){F(null)}else{rlCurrentDealerModel.requestCurrentDealer(function(G){F(G)},function(G){E(G)})}};B.getMetaData=function(F,E){F(null)};return B}return{__init__:function(){},__start__:function(){},createDS:function(B){return A(B)}}}();rlCurrentDealerMockData=function(){return{getMockData:function(){var A={key:"10055_1",name:"Stephen James Enfield",state:"Middlesex",country:"United Kingdom",countryCode:"GB",city:"Enfield",postalCode:"EN1 1SW",street:"Lincoln Road",lat:51.646631,lng:-0.0670697,distance:0,category:"BMW",attributes:{distributionPartnerId:"10055",outletId:"1",homepage:"http://www.stephenjamesenfieldbmw.co.uk/",phone:"+44 (8442) 451304",fax:"+44 (20) 83670649",mail:"mail@stephenjames.bmw-net.co.uk",services:{},distributionBranches:["T","F"],businessTypeCodes:["NO"],distributionCode:"EH",outletTypes:["FU"],portfolioCodes:["BM"],requestServices:["RFO","TDA","RID"]},lastVisitedDealer:true};return A}}}();var rlCurrentDealerModel=function(){var E=null;var I={ERROR:0,NOT_LOADED:1,IN_PROGRESS:2,LOADED:3};var B=I.NOT_LOADED;var G=[];function F(){B=I.LOADED;jq.each(G,function(){this.onSuccess(E)});G=[]}function A(J){B=I.ERROR;jq.each(G,function(){this.onError(J)});G=[]}function C(){var J=false;if(rlPage.isEditMode()||rlPage.isDesignMode()){J=true}else{if(rlPage.isUseMock()){J=true}}return J}function D(J){rlDealerInfoServices.requestDealersFromAllSources([J],function(K){if(isDefined(K)&&K.length>0){E=K[0]}F()},function(K){A(K)})}function H(J,L){if(B==I.LOADED){J(E)}else{if(C()){E=rlCurrentDealerMockData.getMockData();B=I.LOADED;J(E)}else{var K={onSuccess:J,onError:L};G.push(K);if(B!=I.IN_PROGRESS){B=I.IN_PROGRESS;rlCoreServices.getCurrentDealerForRfx(function(M){if(M!=null){var N=M.distributionPartnerId+"_"+M.outletId;D(N)}else{F()}},function(M){A(M)})}}}}return{requestCurrentDealer:function(J,K){H(J,K)}}}();var rlCurrentVehicleDetailsForm=function(C,D){function A(J,K){var G=CoreFormsBase.inheritanceFrom(rlMyAccountForm.create(J,K));var I=G.parent;G.typeName="rlCurrentVehicleDetailsForm";G.BUTTONBAR_SELECTOR=".myAccountFormButtonBar";G.EDITBUTTON_SELECTOR=".curBmwEditButton";G.SAVEBUTTON_SELECTOR=".curBmwSaveButton";G.CANCELBUTTON_SELECTOR=".curBmwCancelButton";G.onAction_Edit=function(){G.switchToEditMode()};G.onAction_Save=function(){if(G.validate()){var L=rlEventTracker.create();L.trackCustomEvent("mybmwMyVehicleDetailsChanged","mybmwAction/myvehicles");F()}};G.onAction_Cancel=function(){G.switchToViewMode()};function H(){J.find(G.EDITBUTTON_SELECTOR).click(function(L){G.onAction_Edit(L)});J.find(G.CANCELBUTTON_SELECTOR).click(function(L){G.onAction_Cancel(L)});if(!rlPage.isEditMode()&&!rlPage.isDesignMode()){J.find(G.SAVEBUTTON_SELECTOR).click(function(L){G.onAction_Save(L)})}}G.setData=function(L){I.setData(L)};function F(){G.showDitherLayer();var L={currentVehicle:{vehicleId:rlMyVehiclesController.getCurrentVehicle().vehicleId,version:rlMyVehiclesController.getCurrentVehicle().version,freeTextNote:rlMyVehiclesController.getCurrentVehicle().freeTextNote,vin:rlMyVehiclesController.getCurrentVehicle().vin,brand:rlMyVehiclesController.getCurrentVehicle().brand,series:rlMyVehiclesController.getCurrentVehicle().series,model:rlMyVehiclesController.getCurrentVehicle().model}};var M=G.getEditedData(L).currentVehicle;if(!M.vin){M.vin=undefined}if(!M.initialRegistration){M.initialRegistration=undefined}rlMyVehiclesController.updateVehicle({vehicle:M,errorCallback:function(){G.hideDitherLayer()},validationCallback:function(O){G.hideDitherLayer();for(var N=0;N<O.length;N++){O[N].fieldName="currentVehicle."+O[N].fieldName}G.showBackendMessages(O)}})}function E(){rlMyVehiclesController.addVehicleListLoadedListener({success:function(L){if(L.length===0){J.fadeOut()}else{if(!J.is(":visible")){J.fadeIn()}}}});rlMyVehiclesController.addVehicleLoadedListener({success:function(){rlDither.off(J);if(J.find("[data-mode=edit]").length>0){G.switchToViewMode()}K.reinitialise()}});rlMyVehiclesController.addVehicleStartedLoadingListener({success:function(){rlDither.on(J,false)}})}E();H();G.switchToViewMode();return G}function B(){rlDataSourceFactory.registerExternalFactory({canBuild:function(E){return E.id==="currentVehicle"},createDS:function(G){var F=CoreFormsBase.inheritanceFrom(rlVehicleFormDS.createDS(G));var E=F.getMetaData;F.getUserData=function(H){H(rlMyVehiclesController.getCurrentVehicle())};F.getMetaData=function(I,H){E(function(J){I({currentVehicle:J.vehicle})},H)};return F}})}return{__init__:function(){B()},__start__:function(){},create:function(E,F){return A(E,F)}}}();var rlDataSourceFactory=function(){var B=[];function D(E){B.push(E)}function C(F){for(var E=0;E<B.length;E++){if(B[E].canBuild(F)){return B[E]}}return undefined}function A(F){var E=C(F);if(E){return E.createDS(F)}return undefined}return{__init__:function(){},__start__:function(){},registerExternalFactory:function(E){if(typeof E.canBuild!=="function"){throw ("External data source factory must define method 'canBuild'")}else{if(typeof E.createDS!=="function"){throw ("External data source factory must define method 'createDS'")}else{D(E)}}},createDS:function(H){var F;if(H.id==="user"){F=rlUserFormDS.createDS(H)}else{if(H.id==="vehicle"){F=rlVehicleFormDS.createDS(H)}else{if(H.id==="vehicleRFXProfile"){F=rlVehicleRFXProfileDS.createDS(H)}else{if(H.id==="vehicleMyBMWProfile"){F=rlVehicleMyBMWProfileDS.createDS(H)}else{if(H.id==="acceptedWebPolicy"){F=rlAcceptedWebPolicyFormDS.createDS(H)}else{if(H.id==="infoMaterialPrint"){F=rlInfoMaterialDS.createDS(H,"PRINT")}else{if(H.id==="infoMaterialDownload"){F=rlInfoMaterialDS.createDS(H,"DOWNLOAD")}else{if(H.id==="preferredDealers"){F=rlPreferredDealersDS.createDS(H)}else{if(H.id==="currentDealer"){F=rlCurrentDealerDS.createDS(H)}else{if(H.id==="implicitLogin"){F=rlImplicitLoginFormDS.createDS(H)}else{if(H.id.indexOf("policyCurrent_")===0){var E=H.id.substr("policyCurrent_".length,H.id.length);if(E){F=rlPolicyCurrentFormDS.createDS(H,E)}}else{if(H.id.indexOf("policyInfoLayer_")===0){var E=H.id.substr("policyInfoLayer_".length,H.id.length);F=rlPolicyInfoLayerDS.createDS(H,E)}else{var G=A(H);if(typeof G==="undefined"){throw ("Invalid data source requested: "+H.id)}else{F=G}}}}}}}}}}}}}F.id=H.id;F.arrayOfFS=H.arrayOfFS;return F}}}();var rlDealerDataBuilder=function(){var A;var B="[rlDealerDataBuilder] ";function C(G){var E={};var D=F();function F(){return jq("<div/>").addClass("dealerData")}E.addName=function(){var L=jq("<div/>").addClass("dealerName");if(G.primary!=true){L.text(G.name)}else{var O=jq("<span/>").addClass("nameWrapper").text(G.name);var N=jq("<div/>").addClass("primaryMarker baseLabelSprite spriteLabelFavoritGrey12");if(rlDloSharedConfig.labels.starTooltip.length>0){N.attr("title",rlDloSharedConfig.labels.starTooltip)}L.append(O,N)}if(rlJQuery_queryParams.getQueryParam("showDealerId")=="true"){L.css("position","relative");var M=jq("<div/>").html(G.key);M.css({position:"absolute",top:"-13px",left:0,"font-size":"8px","background-color":"#fff",opacity:0.7});L.append(M)}D.append(L)};E.addAddress=function(){var O=jq("<div/>").addClass("dealerAddress");var N=A.split("|");for(var M=0;M<N.length;++M){O.append(jq("<div/>").addClass("addressFormat"));var Q=N[M].split(" ");for(var L=0;L<Q.length;++L){var P=J(Q[L]);if(typeof G[P]!=="undefined"){var R=jq("<span/>").addClass("addressFormat").text(G[P]+" ");O.find(".addressFormat").last().append(R)}}}D.append(O)};E.addTelephoneAndFax=function(){var O=G.attributes;var M=isDefined(O.phone)&&O.phone.length>0;var L=isDefined(O.fax)&&O.fax.length>0;if(M||L){var N=jq("<div/>").addClass("dealerTelephoneAndFax");var P=rlDloSharedConfig.labels;if(M){N.append(K(O,P))}if(L){N.append(H(O,P))}D.append(N)}};function J(L){switch(L){case"zip":return"postalCode";default:return L}}function K(L,M){return jq("<div/>").addClass("dealerPhone").html(M.phone+" "+L.phone)}function H(L,M){return jq("<div/>").addClass("dealerFax").html(M.fax+" "+L.fax)}E.addDistanceAndShowDetailsLink=function(){var N=jq("<div/>").addClass("clearfix").addClass("resultListInset");var M=jq("<div/>").addClass("dealerDistance").text(I());var L=jq("<a/>").attr("href","javascript://").addClass("detailLink").text(rlDloSharedConfig.labels.showDetails);N.append(M);N.append(L);D.append(N)};function I(){if(isDefined(G.dist)){var M,L;if(rlDloSharedConfig.initParams.isDistanceUnitMiles){M=Math.round(G.dist*10)/10;L="mi"}else{if(G.dist>=1){M=Math.round(G.dist*10)/10;L="km"}else{M=Math.round(G.dist*1000);L="m"}}return M+" "+L}else{return""}}E.addDither=function(){D.addClass("ditherWrapper");D.prepend(jq("<div/>").addClass("ditherOverlay"))};E.build=function(){return D};return E}return{__init__:function(){console.log(B+"rlDealerDataBuilder init");A=rlDealerConfig.getAddressFormat()},__start__:function(){},create:function(D){return C(D)}}}();var rlDealerFilterHelper=function(){var B={TDA:"TDA",RFO:"RFO",RFP:"RFP",RFA:"RFA",RFS:"RFS",RFI:"RFI",ESP:"ESP"};function I(R,P,Q){if(!R){return true}else{var O=C(R,Q);var S=J(R,P,Q);return O||S}}function C(P,O){return F(O,P.attributes.portfolioCodes)==false}function J(S,P,Q){if(isUndefined(P)||P===""){console.warn("RfxFormType is not set!");return false}var O=S;if(L(O)){var T=O.attributes.subBrandAttributes[Q];O.attributes.requestServices=isDefined(T)?T.requestServices:[];O.attributes.distributionBranches=isDefined(T)?T.distributionBranches:[];O.attributes.outletTypes=isDefined(T)?T.outletTypes:[]}if(P==B.RFP||P==B.ESP){return N(O)==false}else{if(P==B.RFI){return K(O)==false}else{var R=A(P);return F(R,O.attributes.requestServices)==false}}}function L(O){return isDefined(O.attributes.subBrandAttributes)}function K(O){var P=isDefined(O.attributes.distributionBranches)&&F("F",O.attributes.distributionBranches)&&(F("RFI",O.attributes.requestServices)||F("RID",O.attributes.requestServices));return P}function N(O){var P=false;if(isDefined(O.attributes.distributionBranches)&&isDefined(O.attributes.outletTypes)){P=F("F",O.attributes.distributionBranches)&&(F("FU",O.attributes.outletTypes)||F("SP",O.attributes.outletTypes))}return P}function M(P,R,O){var Q=[];Q=H(P,R);Q=G(Q,O);return Q}function E(O){var P=false;if(isDefined(O)){jq.each(B,function(Q,R){if(R.toUpperCase()==O.toUpperCase()){P=true;return false}})}return P}function D(P,R,U,O){var S=false;var T=P.poi.values.attributes.distributionBranches;if(R!=""){S=J(P.poi.values,R,O)==false;if(!S){return false}}var Q="";jq.grep(U.filter,function(V){if(V.checked){Q+=V.type}});switch(Q){case"":S=true;break;case"TF":case"FT":if(isDefined(U.filterLogic)&&U.filterLogic=="filterLogicOr"){S=(jq.inArray("T",T)!==-1)||(jq.inArray("F",T)!==-1)}else{S=(jq.inArray("T",T)!==-1)&&(jq.inArray("F",T)!==-1)}break;case"T":case"F":S=(jq.inArray(Q,T)!==-1);break}return S}function H(O,Q){var P=[];jq.each(O,function(S,R){if(jq(R.types).filter(Q).length>0){P.push(R)}});return P}function G(Q,O){var R=[];var P=O.split(",");jq.each(Q,function(T,S){jq.each(S.address_components,function(V,U){if(jq.inArray("country",U.types)!=-1&&jq.inArray(U.short_name,P)!=-1){R.push(S);return false}})});return R}function A(O){var P="";switch(O){case B.RFI:P="RID";break;case B.TDA:P="TDA";break;case B.RFO:P="RFO";break;case B.RFP:P="";break;case B.ESP:P="";break;case B.RFA:P="RFA";break;case B.RFS:P="RFS";break;default:console.error("dealerFilterHelper.mapFormTypeToFilterImpl - unknown request Type "+O)}return P}function F(O,P){return jq.inArray(O,P)!=-1}return{__init__:function(){},__start__:function(){},mapFormTypeToFilter:A,hasMismatch:I,hasBrandMismatch:C,hasFormTypeMismatch:J,filterLocationResults:M,isValidRfxType:E,isDealerPinValidForFilters:D,rfxTypes:B}}();var rlDealerTrackingAdapter=(function(){var J=[];var G=false;function F(){J.dealerWatchlistRemovedFromWatchlist={buildId:function(M){if(A(M,"dealerDloRemovedFromWatchlist")){var N=K(M,"dealerDloRemovedFromWatchlist");return"dloDealerOutletRemovedFromWatchList_"+N.key+"@"+N.formType}if(A(M,"dealerWatchlistFormOpened")){return"action/remove@dealeroutlet/"+M.info+"/managepreferreddealers"}},buildName:function(M){return(A(M,"dealerWatchlistFormOpened"))?"CustomEvent:action/remove@dealeroutlet":H()}};J.dealerHomepageLink={buildId:function(M){if(A(M,"dealerWatchlistDetails","dealerDloResultListDetails")){return"dloInfoBoxFromWatchListDealerOutletLinkClicked_"+M.info.key+"@"+M.info.formType}return undefined},buildName:H};J.dealerPreferredAddedToWatchlist={buildId:function(M){if(A(M,"dealerDloAddToWatchlist")){var N=K(M,"dealerDloAddToWatchlist");if(isDefined(N)){return"dloInfoBoxDealerOutletAddedToWatchList_"+N.key+"@"+N.formType}else{return"dloInfoBoxDealerOutletAddedToWatchList_"+M.info}}if(A(M,"dealerOutletInfoBoxAddToWatchlistLink")){return"action/bookmark@dealeroutlet/"+M.info}},buildName:function(M){return(A(M,"dealerOutletInfoBoxAddToWatchlistLink"))?"CustomEvent:action/dealeroutlet":H()}};J.dealerOutletOfferDownload={buildId:function(M){return"link/download@dealeroutlet_offer"},buildName:L};J.dealerOutletOfferMore={buildId:function(M){return"link/moreinfo@dealeroutlet_offer"},buildName:L};J.dealerOutletOfferDetails={buildId:function(M){return"link/details@dealeroutlet_expandableitem"},buildName:L};J.dealerOutletInfoBoxOpeningLink={buildId:function(M){return"link/moreinfo@dealeroutlet"},buildName:L};J.dealerOutletInfoBoxPlanRouteLink={buildId:function(M){return"link/getdirections@dealeroutlet"},buildName:L};J.dealerMyBmwHomepageLink={buildId:function(M){return"link/navigate_to_dealeroutlet/"+M.info+"@mybmw/preferreddealerslist"},buildName:L}}function E(){if(G){var N="[DealerTrackingAdapter] ",M;for(M=0;M<arguments.length;M+=1){N=N+arguments[M]}console.log(N)}}function H(){return"dloAction"}function L(){return"CustomEvent:click/link"}function A(Q,P,O){var M=false;for(var N=Q.listenerData.trackingHistory.length-1;N>0;N--){var R=Q.listenerData.trackingHistory[N].id;M=(R==P);if(M||R==O){break}}return M}function K(O,N){var P;for(var M=O.listenerData.trackingHistory.length-1;M>0;M--){var Q=O.listenerData.trackingHistory[M].id;if(Q==N){P=O.listenerData.trackingHistory[M].info;break}}return P}function D(M){E("data-tracking-id=",M.id,", data-tracking-info=",M.info,", data-tracking-type=",M.type);return J[M.id]}function I(){jq(window).bind(rlTrackingListener.EVENTS.EVENT_TRACKING_NOTIFICATION,function(M,N){C(N)})}function C(O){var N=D(O);if(N){var M=[].concat(N);jq.each(M,function(P,Q){B(Q,O)})}}function B(M,O){if(jq.isFunction(M.buildId)&&window.rlCoreServices&&window.rlCoreServices.trackEventAsClick){var P=M.buildId(O);var N=M.buildName(O);if(P&&N){E("fire track event: id=",P,", name=",N);window.rlCoreServices.trackEventAsClick(P,N)}}if(jq.isFunction(M.customAction)){M.customAction(O)}}return{__init__:function(){F();I()},__start__:function(){G=jq.cookie("EnableTrackingLog")=="all"||jq.cookie("EnableTrackingLog")=="dealer"}}}());var rlDeleteAccountForm=function(){function A(E,F){var L=CoreFormsBase.inheritanceFrom(rlMyBmwFormBase.create(E,F));var I=L.parent;L.typeName="rlDeleteAccountForm";var D=undefined;function C(){E.find(".deleteMyAccountButton").click(B)}function B(M){K();D=M;M.preventDefault();M.stopPropagation()}function K(){H({headline:jq("#"+F.formId+"DeleteDialogHeadline").text(),subHeadline:jq("#"+F.formId+"DeleteDialogSubHeadline").text(),copy:jq("#"+F.formId+"DeleteDialogCopy").text(),okButtonLabel:jq("#"+F.formId+"DeleteButton").text(),cancelButtonLabel:jq("#"+F.formId+"CancelButton").text()})}function H(M){rlGlassPaneLayerOkCancel.openDialog({dialogHeadline:M.headline||"",dialogSubHeadline:M.subHeadline||"",dialogContent:"<div class='richText' style='margin-top: 20px;'>"+M.copy+"</div>",okButtonLabel:M.okButtonLabel||"",cancelButtonLabel:M.cancelButtonLabel||"",defaultButton:"OK",reverseButtonOrder:true,okButtonCallback:G,cancelButtonCallback:J})}function G(){if(typeof D!=="undefined"){if(typeof window.bmwcsacaptureEvent==="function"){window.bmwcsacaptureEvent(D)}D=undefined}rlUserFormDS.createDS().remove({success:function(){rlGlassPaneLayerOkCancel.closeDialog();var M={protocol:window.location.protocol,hostname:window.location.hostname};rlUserDialog.redirectToMyDashboard(M)},error:function(){rlErrorService.errorHandler({actor:rlErrorService.ACTOR_USER})}})}function J(){rlGlassPaneLayerOkCancel.closeDialog()}C();return L}return{__init__:function(){},__start__:function(){},create:function(B,C){return A(B,C)}}}();var rlDloEventsController=function(){var B={};function A(){var E={};var D=[];var C=[];var F=[];E.addSearchEventListener=function(G){D.push(G)};E.removeSearchEventListener=function(H){var G=jq.inArray(H,D);if(G!==-1){D.splice(G,1)}};E.fireSearchEvent=function(H){for(var G=0;G<D.length;G++){D[G].onSearch(H)}};E.fireFilterChangedEvent=function(H){for(var G=0;G<D.length;G++){D[G].onFilterChanged(H)}};E.addSelectEventListener=function(G){C.push(G)};E.removeSelectEventListener=function(H){var G=jq.inArray(H,C);if(G!==-1){C.splice(G,1)}};E.fireSelectionEvent=function(I,H){for(var G=0;G<C.length;G++){C[G].onSelectionEvent(I,H)}};E.addShowMapEventListener=function(G){F.push(G)};E.removeShowMapEventListener=function(H){var G=jq.inArray(H,F);if(G!==-1){F.splice(G,1)}};E.fireShowMapEvent=function(H){for(var G=0;G<F.length;G++){F[G].onShowMapArea(H)}};return E}return{__init__:function(){},__start__:function(){},getController:function(C){var D=C.parents(".parbase.dloBaseFS").attr("data-dloid");if(isUndefined(B[D])){B[D]=A(C)}return B[D]}}}();var rlDloIcons=function(){return{getMapIcons:function(){return{empty:{icon:{image:("/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_location_marker_infowindow_open.png"),size:[47,17],anchor:[0,0]}},location:{icon:{image:("/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_locationmarker.png"),size:[37,32],anchor:[12,29]}},bmwDealerBig:{icon:{image:"/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_bmw_dealer_icon_big.png",size:[99,67],anchor:[0,67]}},bmwiDealerBig:{icon:{image:"/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_bmwi_dealer_icon_big.png",size:[99,67],anchor:[0,67]}},bmwDealer:{icon:{image:"/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_bmw_dealer_icon.png",size:[54,47],anchor:[0,47]}},bmwiDealer:{icon:{image:"/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_bmwi_dealer_icon.png",size:[54,47],anchor:[0,47]}},bmwPrimaryBig:{icon:{image:"/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_bmw_primary_dealer_icon_big.png",size:[99,67],anchor:[0,67]}},bmwiPrimaryBig:{icon:{image:"/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_bmwi_primary_dealer_icon_big.png",size:[99,67],anchor:[0,67]}},bmwPrimary:{icon:{image:"/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_bmw_primary_dealer_icon.png",size:[54,47],anchor:[0,47]}},bmwiPrimary:{icon:{image:"/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_bmwi_primary_dealer_icon.png",size:[54,47],anchor:[0,47]}},bmwServicePartner:{icon:{image:"/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_bmw_servicepartner_icon.png",size:[54,47],anchor:[0,47]}},bmwiServicePartner:{icon:{image:"/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_bmwi_servicepartner_icon.png",size:[54,47],anchor:[0,47]}},bmwServicePartnerBig:{icon:{image:"/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_bmw_servicepartner_icon_big.png",size:[54,47],anchor:[0,47]}},bmwiServicePartnerBig:{icon:{image:"/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_bmwi_servicepartner_icon_big.png",size:[54,47],anchor:[0,47]}},bmwPrimaryServicePartner:{icon:{image:"/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_bmw_primary_servicepartner_icon.png",size:[54,47],anchor:[0,47]}},bmwiPrimaryServicePartner:{icon:{image:"/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_bmwi_primary_servicepartner_icon.png",size:[54,47],anchor:[0,47]}},bmwPrimaryServicePartnerBig:{icon:{image:"/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_bmw_primary_servicepartner_icon_big.png",size:[99,67],anchor:[0,67]}},bmwiPrimaryServicePartnerBig:{icon:{image:"/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_bmwi_primary_servicepartner_icon_big.png",size:[99,67],anchor:[0,67]}}}},getDirectionIcons:function(){return{start:new google.maps.MarkerImage("/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_route_startpin_map.png",new google.maps.Size(33,39),new google.maps.Point(0,0),new google.maps.Point(12,35)),end:new google.maps.MarkerImage("/etc/designs/bmwnext/apps/bmwnext/requests/static/parComponents/formFieldSets/dealerHandling/dloMapFS/dloMapBaseFS/dlo_route_targetpin_do_not_show.png",new google.maps.Size(21,21),new google.maps.Point(0,0),new google.maps.Point(11,10))}}}}();var rlEspAbortLayer=function(){var G=rlPage.getLanguagePath()+"/esp/espabortlayer.html";var F=undefined;var E=undefined;var D="#saveConfiguration";var B="onclick";function C(){var T={};T.typeName="rlEspAbortLayer";function J(){if(rlEspForm.getCurrentInstance()){var U=rlEspForm.getCurrentInstance().getConfiguration().configUrl.value;jq(".espAbortLayer .configUrl").text(U)}}function K(V,U){J();S(V);Q(U);jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_LISTENER_NOTIFICATION,{id:rlTrackingListener.FORM_IDS.FORM_ESP_CANCEL_LAYER,info:"aboutCancel",type:rlTrackingListener.TRACKING_TYPES.GLASS_PANE_LAYER})}function Q(U){if(!U){jq(D).hide()}}function S(U){jq("#cancelPurchase").click(function(){rlEspForm.getCurrentInstance().clearBasket();if(typeof (U)==="function"){jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_LISTENER_NOTIFICATION,{id:rlTrackingListener.FORM_IDS.FORM_ESP_CANCEL_LAYER,info:"cancelPurchase",type:rlTrackingListener.TRACKING_TYPES.GLASS_PANE_LAYER});U()}});jq(D).click(function(){var V={configId:rlEspForm.getCurrentInstance().getConfigIdFromBasket()};jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_LISTENER_NOTIFICATION,{id:rlTrackingListener.FORM_IDS.FORM_ESP_CANCEL_LAYER,info:"saveConfiguration",type:rlTrackingListener.TRACKING_TYPES.GLASS_PANE_LAYER});rlUserDialog.showNccSave(V)});jq("#continueWithPurchase").click(function(){jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_LISTENER_NOTIFICATION,{id:rlTrackingListener.FORM_IDS.FORM_ESP_CANCEL_LAYER,info:"continueWithPurchase",type:rlTrackingListener.TRACKING_TYPES.GLASS_PANE_LAYER});rlGlassPaneLayerNext&&rlGlassPaneLayerNext.isOpen()&&rlGlassPaneLayerNext.closeLayer()})}function L(V,U){rlGlassPaneLayerNext&&!rlGlassPaneLayerNext.isOpen()&&rlGlassPaneLayerNext.openDialog({url:G,keepUrlHash:true,onAfterAjaxContentLoaded:function(){K(V,U)}})}function O(V){if(typeof rlEspForm==="undefined"||!rlEspForm.getCurrentInstance().getConfiguration()){V();return }window.bmwcsacaptureEvent(window.event);var U=rlEspForm.getCurrentInstance().getConfiguration().hasUnsavedChanges==="true"||rlEspForm.getCurrentInstance().getConfiguration().hasUnsavedChanges===true;L(V,U)}function P(U){O(function(){window.location.href=U});return false}function I(){jq(".bottomNav").find('[href^="javascript"]').each(function(U,V){var W="javascript:"+jq(V).attr(B);jq(V).removeAttr(B);jq(V).click(function(){return P(W)})})}function N(){jq("#searchQueryBarInputField").bind("keyup.myEvents",function(U){if(U.which==13){O(function(){E&&E.handler(U)});return false}else{E&&E.handler(U)}})}function H(){jq(".breadcrumb").find("a:not(:last)").click(function(){return P(this.href)})}function M(){jq(".menuBar, .bottomNav").find('a:not([target="_blank"],[href^="javascript"])').click(function(){return P(this.href)})}function R(){M();H();N();I()}R();return T}function A(K){var J=K.data("events");if(J){for(var I=0;I<J.keyup.length;I++){var H=J.keyup[I];if(H.namespace==""){return H}}}return undefined}return{__init__:function(){rlComponentLoader.deferredExec("espForm",function(){F||(F=C())});rlComponentLoader.deferredExec("searchQueryBar",function(){var H=jq("#searchQueryBarInputField");E=A(H);E&&H.unbind("keyup")})},__start__:function(){}}}();var rlEspAsGuestFS=function(){function A(L,D){var K=CoreFormsBase.inheritanceFrom(rlFormFieldSet.createFS(L,D));var I=K.parent;K.typeName="rlEspAsGuestFS";function B(M){C()}function F(M){C()}function J(M){G()}function E(M){K.formEvents.trigger(rlEspForm.ENUM.EVENT.ESP_AS_GUEST_REQUEST)}function H(){K.formEvents.subscribe(rlEspForm.ENUM.EVENT.ESP_AS_GUEST,function(M){B(M)});K.formEvents.subscribe(rlEspForm.ENUM.EVENT.ESP_LOGGED_IN,function(M){F(M)});K.formEvents.subscribe(rlEspForm.ENUM.EVENT.ESP_START,function(M){J(M)});if(!K.isInCqEditMode()){L.find(".espAsGuestButton").click(function(){E(jq(this))})}}function C(){L.parent(".espAsGuestFS").prev(".headlineEspAsGuestFS").hide();L.parent(".espAsGuestFS").hide()}function G(){L.parent(".espAsGuestFS").prev(".headlineEspAsGuestFS").show();L.parent(".espAsGuestFS").show()}H();return K}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlEspBasket=function(){var E=undefined;var H="espBasket";var D="basketId";var G="configId";var C="publicConfigId";var F="debugEsp";var B={STATE:{START:{name:"STATE_START",ordinal:0},LOGGED_IN:{name:"STATE_LOGGED_IN",ordinal:10},AS_GUEST:{name:"STATE_AS_GUEST",ordinal:20},STEP_2:{name:"STATE_STEP_2",ordinal:30},STEP_3:{name:"STATE_STEP_3",ordinal:40},STEP_4:{name:"STATE_STEP_4",ordinal:50},SUBMITTED:{name:"STATE_SUBMITTED",ordinal:60}},EVENT:{ESP_BASKET_CHANGED:"ESP_BASKET_CHANGED"}};function A(){var e=CoreFormsBase.inheritanceFrom(CoreFormsBase.createBaseType());e.typeName="rlEspBasket";var K=undefined;var T=false;var c={cookieKey:H,domain:rlCrossSubDomainAjax.getAllowedAJAXDomain(),path:"/"};var M={id:""+new Date().getTime(),currentState:B.STATE.START,configId:undefined,publicConfigId:undefined,maxState:B.STATE.START,formData:undefined,confirmationData:undefined};var g=["enabled"];var N=undefined;function R(){var p=S(F);T=typeof (p)!="undefined"&&(p===""||p.toLowerCase()==="true");if(U()){console.log("Basket cookie is not used in edit-/design-mode.")}var q=b();if(q&&q.id===S(D)){K=q}else{V()}var s=S(G);if(s){K.configId=s}var r=S(C);if(r){K.publicConfigId=r}}function b(){if(U()){return undefined}var p=rlCookieController.getCookie(c);if(p&&p.cookieValue){try{var r=jq.trim(jq.lzDecompressFromBase64(p.cookieValue));if(r){r=jq.secureEvalJSON(r);if(r){return r}}}catch(q){console.error("Could not load cookie: "+q)}}return undefined}function j(){if(U()){return false}var p=true;var q=clone(c);q.cookieValue=jq.lzCompressToBase64(jq.toJSON(K));q.callback=function(r){p=!!r;p&&console.warn('Cookie "'+q.cookieKey+'" could not be stored: '+r)};rlCookieController.setCookie(q);jq(window).trigger(B.EVENT.ESP_BASKET_CHANGED,K);return !p}function V(){!U()&&rlCookieController.removeCookie(c);K=clone(M)}function f(p){if(!p){console.error("Cannot set basket to new state: "+p);return false}K.currentState=p;K.maxState=(!K.maxState||K.maxState.ordinal<p.ordinal)?p:K.maxState;return !U()&&j()}function m(p){K.formData=J(p)?p:undefined;return !U()&&j()}function O(p){K.confirmationData=J(p)?p:undefined;return !U()&&j()}function X(){}function J(q){var p=false;if(q){jq.each(q,function(r){if(q.hasOwnProperty(r)){p=true;return false}return true})}return p}function Q(q){var u={};if(q){var p=q&&q.length>0?q.split("&"):[];for(var t=0;t<p.length;t++){var s=p[t];var v=s&&s.length>0?s.split("="):[];if(v.length>0){var r=v.shift();u[r]=(v.length>0)?v.join("="):undefined}}}return u}function o(p){var r=Y(window.location.href);var q=Q(r.search);return d(q,p)}function a(q){var r=Y(window.location.href);var p=Q(r.hash);return d(p,q)}function S(q){var p=o(q);if(typeof (p)==="undefined"){p=a(q)}return p}function d(q,p){var r=undefined;p=jq.trim(p);if(q&&p){jq.each(q,function(s,t){s=jq.trim(s);if(q.hasOwnProperty(s)&&(p.toLowerCase()==s.toLowerCase())){r=jq.trim(t)||"";return false}return true})}return r}function U(){return(rlPage.isEditMode()||rlPage.isDesignMode())}function Y(q){var s={prefix:undefined,search:undefined,hash:undefined};if(!q){if(q===0||q===""){s.prefix=q}return s}var r,p;if((r=q.indexOf("#"))>-1){s.hash=(r===q.length-1)?"":q.substring(r+1,q.length)}if((p=q.indexOf("?"))>-1){s.prefix=q.substring(0,p);s.search=((p===q.length-1)||(p===r-1))?"":q.substring(p+1,r<0?q.length:r)}else{s.prefix=q.substring(0,r<0?q.length:r)}return s}function Z(p,q){return P(p,D,e.getBasketId(),q)}function I(p,r,q){return P(p,G,r,q)}function W(p,r,q){return P(p,C,r,q)}function P(p,v,s,AB){function y(AD,AC,AI){var AF=[];for(var AE=0;AE<AD.length;AE++){var AG=AD[AE];var AH=AG&&AG.length>0?AG.split("="):[];if(AH.length>0&&AH[0].toLowerCase()===AC.toLowerCase()){AD[AE]=AH[0]+"="+AI;AF.push(AE)}}return AF}function q(AL,AC,AI){var AH=false;var AK=[];if(AC&&AC.length>0){for(var AG=AC.length-1;AG>=0;AG--){var AJ=AC[AG];var AE=AI?AI[AJ]:undefined;var AD=AL[AJ];if(AH||AE!==AD){for(var AF=AK.length-1;AF>=0;AF--){AL.splice(AK[AF],1)}AL.splice(AJ,1);AH=true}else{AK.push(AJ)}}}return AH}var r=Y(p);var z=r.search&&r.search.length>0?r.search.split("&"):[];var AA=clone(z,true);var u=y(z,v,s);var t=r.hash&&r.hash.length>0?r.hash.split("&"):[];var x=y(t,v,s);if(AB===true){var w=true;if(u&&u.length>0){w=q(z,u,AA);if(w){r.search=z.length>0?z.join("&"):undefined}}if(w){if(!x||x.length<1){t.push(v+"="+s)}}else{q(t,x,undefined)}r.hash=t.length>0?t.join("&"):undefined}else{if(x&&x.length>0){q(t,x,undefined);r.hash=t.length>0?t.join("&"):undefined}if(!u||u.length<1){z.push(v+"="+s)}r.search=z.length>0?z.join("&"):undefined}return(typeof (r.prefix)==="undefined"?"":r.prefix)+(typeof (r.search)==="undefined"?"":"?"+r.search)+(typeof (r.hash)==="undefined"?"":"#"+r.hash)}function l(r,s){var q=[];if(r){if(typeof (Object.keys)==="function"){q=Object.keys(r)}else{for(var p in r){if(r.hasOwnProperty(p)){q.push(p)}}}q=jq.grep(q,function(t){return(jq.inArray(t,s)<0)})}return q}function L(w,v,r,p){r=[].concat(r||[]);p=(p===true);p&&console.log("deepEquals: processing '"+w+"' and '"+v+"'.");if(w===v){return true}if(!w||!v||typeof (w)!=typeof (v)){p&&console.log("deepEquals: different type '"+w+"' and '"+v+"'.");return false}if(jq.isArray(w)){return n(w,v,r,p)}else{if(typeof (w)==="object"){var u=l(w,r);var t=l(v,r);if(u.length!=t.length){p&&console.log("deepEquals: Objects have different number of properties:");p&&console.log(w);p&&console.log(v);return false}for(var q=0;q<u.length;q++){var s=u[q];if(!v.hasOwnProperty(s)){p&&console.log("deepEquals: obj2 does not have the property '"+s+"':");p&&console.log(w);p&&console.log(v);return false}if(jq.inArray(s,r)<0&&!L(w[s],v[s],r,p)){p&&console.log("deepEquals: Objects are not deep equal:");p&&console.log(w);p&&console.log(v);return false}}}else{if(w!==v){p&&console.log("deepEquals: Thingies are not equal:");p&&console.log(w);p&&console.log(v);return false}}}return true}function n(v,u,s,p){if(v.length!=u.length){p&&console.log("deepEquals: Arrays have different length:");p&&console.log(v);p&&console.log(u);return false}for(var r=0;r<v.length;r++){var t=false;for(var q=0;q<u.length;q++){if(L(v[r],u[q],s,false)){t=true;break}}if(!t){p&&console.log("deepEquals: Arrays are not deep equal - the following object was not found in both arrays:");p&&console.log(v);return false}}return true}function k(p,q){var r=e.getFormData();g=g.concat(q||[]);return r&&!L(r,p.getEmptyFormInputCacheData(),g,false)}e.addBasketIdToURL=function(p,q){return Z(p,q)};e.addConfigIdToURL=function(p,r,q){return I(p,r,q)};e.addPublicConfigIdToURL=function(p,r,q){return W(p,r,q)};e.clearBasket=function(){return V()};e.deepEquals=function(s,r,q,p){return L(s,r,q,p)};e.getBasketId=function(){return(K&&K.id)?K.id:undefined};e.getConfigId=function(){return(K&&K.configId)?K.configId:undefined};e.getConfirmationData=function(){return(K&&K.confirmationData)?K.confirmationData:undefined};e.getPublicConfigId=function(){return(K&&K.publicConfigId)?K.publicConfigId:undefined};e.getFormData=function(){return K?(K.formData||undefined):undefined};e.getState=function(){return K?K.currentState:undefined};e.hasFormDataWithUserInput=function(p,q){return k(p,q)};e.isActive=function(){var p=S(D);return K&&K.id&&p&&K.id===p};e.isDebugEsp=function(){return T};e.isValid=function(){var p=S(D);return !p||K.id===p};e.mayShowCartBoxExtraCosts=function(){return K&&K.maxState&&K.maxState.ordinal>=B.STATE.START.ordinal};e.mayShowFinanceProductCosts=function(){return K&&K.currentState&&K.currentState.ordinal>=B.STATE.STEP_3.ordinal&&N===false};e.objectHasOwnProperty=function(p){return J(p)};e.setConfirmationData=function(p){return O(p)};e.setFormData=function(p){return m(p)};e.setState=function(p){return f(p)};e.splitUrl=function(p){return Y(p)};e.setCashBasketOption=function(p){N=p};e.isCashBasketOption=function(){return N};R();X();return e}return{__init__:function(){},__start__:function(){},ENUM:B,getCurrentInstance:function(){function I(){return(E=A())||undefined}return E||I()||undefined}}}();var rlEspConfigChangedLayer=function(){return{__init__:function(){},__start__:function(){},showLayer:function(B,A){rlGlassPaneLayerNext&&!rlGlassPaneLayerNext.isOpen()&&rlGlassPaneLayerNext.openDialog({url:rlPage.getLanguagePath()+"/esp/espconfigchangedlayer.html",keepUrlHash:true,onAfterAjaxContentLoaded:function(){jq(".espViewUpdatedSummaryButton").click(function(){B&&B()})},onClose:A||jq.noop})}}}();var rlEspConfigMock=function(){var A={"@type":"ConfigSummary",accessByIdUrl:{value:"/vc/ncc/xhtml/start/startWithConfigId.faces?configId=33560728"},accessUrl:{value:"/vc/ncc/xhtml/start/startWithConfigUrl.faces?name=s2v2x4p1&currentView=TILTVIEW"},bestConfiguration:"false",configId:"33560728",configUrl:{value:"mein.bmw.de/s2v2x4p1"},dealerShare:"false",disclaimerSection:{disclaimer:[{disclaimerNumber:"1",displayOrder:"1",paragraph:{value:"Kundennahe Reichweite im effizientesten Modus. Die Angaben zu Kraftstoffverbrauch und CO2-Emissionen gelten bei Angaben von Spannbreiten in Abhängigkeit vom gewählten Reifenformat und optionaler Sonderausstattung. Die Energieeffizienzklasse eines Fahrzeugs ist abhängig von der Art des Getriebes oder der Räder und kann sich während der Konfiguration verändern. Sie wird auf Grundlage der gemessenen CO2-Emissionen unter Berücksichtigung der Masse des Fahrzeugs ermittelt."}},{disclaimerNumber:"2",displayOrder:"2",paragraph:{value:"Bei den Preisangaben handelt es sich um unverbindliche Empfehlungen des Herstellers inkl. 19% MwSt und exklusive Überführungskosten. Änderungen und Irrtümer vorbehalten. Verbindliche Preisauskünfte gibt Ihnen gern Ihr BMW Partner."}},{disclaimerNumber:"3",displayOrder:"3",paragraph:{value:"Extra cost3: Bei den Preisangaben handelt es sich um unverbindliche Empfehlungen des Herstellers inkl. 19% MwSt und exklusive Überführungskosten. Änderungen und Irrtümer vorbehalten. Verbindliche Preisauskünfte gibt Ihnen gern Ihr BMW Partner."}},{disclaimerNumber:"4",displayOrder:"4",paragraph:{value:"Extra cost4: Bei den Preisangaben handelt es sich um unverbindliche Empfehlungen des Herstellers inkl. 19% MwSt und exklusive Überführungskosten. Änderungen und Irrtümer vorbehalten. Verbindliche Preisauskünfte gibt Ihnen gern Ihr BMW Partner."}},{disclaimerNumber:"5",displayOrder:"5",paragraph:{value:"Extra cost5: Bei den Preisangaben handelt es sich um unverbindliche Empfehlungen des Herstellers inkl. 19% MwSt und exklusive Überführungskosten. Änderungen und Irrtümer vorbehalten. Verbindliche Preisauskünfte gibt Ihnen gern Ihr BMW Partner."}},{displayOrder:"6",paragraph:[{displayOrder:"1",value:"Angegeben sind jeweils die Werte des Basismodells mit der Getriebeart laut Grundausstattung. Die angegebenen Werte wurden nach dem vorgeschriebenen Messverfahren (Richtlinie 80 / 1268 / EWG in der gegenwärtigen Fassung) ermittelt. Die Angaben beziehen sich nicht auf ein einzelnes Fahrzeug und sind nicht Bestandteil des Angebots, sondern dienen allein Vergleichszwecken zwischen den verschiedenen Fahrzeugtypen."},{displayOrder:"2",value:"Weitere Informationen zum offiziellen Kraftstoffverbrauch und zur offiziellen CO2-Emission neuer Personenkraftwagen können dem „Leitfaden über den Kraftstoffverbrauch und die CO2-Emission neuer Personenkraftwagen“ entnommen werden, der an allen Verkaufsstellen und bei der DAT Deutsche Automobil Treuhand GmbH, Hellmuth-Hirth-Straße 1, 73760 Ostfildern und unter http://www.dat.de/leitfaden/LeitfadenCO2.pdf unentgeltlich erhältlich ist."}]}]},exteriorSection:{name:"Exterieur",rim:{changeUrl:{name:"Räder ändern",value:"/vc/ncc/xhtml/start/startWithConfigUrl.faces?name=s2v2x4p1&currentView=RIMS"},displayType:"1",familyType:"FELGE",featureCode:"2D6",featureType:"R",featureTypeAndCode:"S02D6",price:{grossPrice:{decimalNumber:"0.00",disclaimerNumber:"2",name:"Listenpreis",value:"inklusive"},grossRentalPrice:{decimalNumber:"0.00",name:"Monatliche Rate",value:"inklusive"},netPrice:{decimalNumber:"0.0",name:"Listenpreis Netto",value:"inklusive"}},standard:"true",value:'19"BMW i LM Räder Sternspeiche 427, BMW EffDyn'}},financeSection:{changeUrl:{name:"Finanzierung ändern",value:"/vc/ncc/xhtml/start/startWithConfigUrl.faces?name=s2v2x4p1&currentView=FINANCE"},name:"Finanzierung",financeCondition:{name:"Finanzierungskonditionen"},financeDisclaimer:{name:"Gesetzlicher Hinweis",value:"Bei dieser Berechnung handelt es sich um eine freibleibende und unverbindliche Musterkalkulation. Direkter Ansprechpartner ist Ihr BMW Partner. Er berät Sie gerne ausführlich und berechnet für Sie das passende Leasingmodell. Ein Angebot der BMW Bank GmbH, Heidemannstr. 164, 80939 München.<br/><br/>* Einzelheiten ergeben sich aus Ihrem Leasingvertrag. Ein Angebot der BMW Bank GmbH."},financeParameter:[{code:"DepositPercent",description:"Sonderzahlung in %",displayOrder:"1",unit:"%",value:"9,59"},{code:"DepositAmount",description:"Sonderzahlung",displayOrder:"2",unit:"€",value:"3.351,71"},{code:"Term",description:"Laufzeit",displayOrder:"3",unit:"Monate",value:"36"},{code:"Mileage",description:"Laufleistung p.a.",displayOrder:"4",unit:"km",value:"15.000"}],financeProductCode:"765061",financeProductName:{name:"Finanzierung",value:"BMW Leasing"}},imageUrlBack:{value:"//cosy.bmwgroup.com/next/cosySec?COSY-EU-100-7331c9Nv2Z7d5yKtHS9P3AKWL2JeiPnsEgpn23HGfvQFMa5eqKDsH%25fMA8ad2fRFbNxCRifGDuKgAusWGPcPr1Y%25P6PaXo4fNEbnRxb10s9Ol%25TE4riIggKscCqXkOuADOPprDoubhl1oBHWp8ahtE6l5by2o3FxB%25KTjqL"},imageUrlBack180:{value:"//cosy.bmwgroup.com/next/cosySec?COSY-EU-100-7331c9Nv2Z7d5yKtHS9P3AKWL2JeiPnsEgpn23HGfvQFzs5eqKDsH%25fMA8ad2fRFbNxCRifGDuKgAusWGPcPr1Y%25P6PaXo4fNEbnRxb10s9Ol%25TE4riIggKscCqXkOuADOPprDoubhl1oBHWp8ahtE6l5by2o3FxB%25KTjqL"},imageUrlFront820:{value:"//cosy.bmwgroup.com/next/cosySec?COSY-EU-100-7331c9Nv2Z7d5yKtHS9P3AKWL2JeiPnsEgpn23HGfvQFMa5eqKDsH%25fMA8ad2fRFbNxCRifGDuKgAusWGPcPr1Y%25P6PaXo4fNEbnRxb10s9Ol%25TE4riIggKscCqXkOuADOPprDoubhl1oBHWpmQFe0P%25dxEaUmJCOy8sZR"},imageUrlFrontBig:{value:"//cosy.bmwgroup.com/next/cosySec?COSY-EU-100-7331c9Nv2Z7d5yKtHS9P3AKWL2JeiPnsEgpn23HGfvQFI55eqKSYpRl6swTF9QQ53RoIBeayVt6refTkqSbfFe0R23Ey2od0zuzHMxBzcztiOJeqhk7fSkMLoAC9BGhJHFlEE3oub5imC2yRCz4HRO2kn9MOXId48wTQLzB6ShtN8vbCUVo%25f"},imageUrlFrontMedium:{value:"//cosy.bmwgroup.com/next/cosySec?COSY-EU-100-7331c9Nv2Z7d5yKtHS9P3AKWL2JeiPnsEgpn23HGfvQFr%255eqKSYpRl6swTY1vQ53RoIBeayVt6refTkqSbfFe0R23Ey2od0zuzHMxBzcztiOJeqhk7fSkMLoAC9BGhJHFlEE3oub5imC2yRCz4HRO2kn9MOXId48wTQLzB6ShtN8vbCUVo%25f"},imageUrlFrontSmall:{value:"//cosy.bmwgroup.com/next/cosySec?COSY-EU-100-7331c9Nv2Z7d5yKtHS9P3AKWL2JeiPnsEgpn23HGfvQFi95eqKSYpRl6swTYAvQ53RoIBeayVt6refTkqSbfFe0R23Ey2od0zuzHMxBzcztiOJeqhk7fSkMLoAC9BGhJHFlEE3oub5imC2yRCz4HRO2kn9MOXId48wTQLzB6ShtN8vbCUVo%25f"},imageUrlFrontVeryBig:{value:"//cosy.bmwgroup.com/next/cosySec?COSY-EU-100-7331c9Nv2Z7d5yKtHS9P3AKWL2JeiPnsEgpn23HGfvQF%259meqKDsH%25fMA8ad2fRFbNxCRifGDuKgAusWGPcPr1Y%25P6PaXo4fNEbnRxb10s9Ol%25TE4riIggKscCqXkOuADOPprDoubhl1oBHWpmQFe0P%25dxEaUmJCOy8sZR"},imageUrlInterior:{value:"//cosy.bmwgroup.com/next/cosySec?COSY-EU-100-7331c9Nv2Z7d5yKtHS9P3AKWL2JeiPnsEgpn23HGfvQFz55JE470jR5gswTobVgLtXpyBLagd087uw8jCdlmlDvA5lkloMZYgp2XHLyXv6jQ%25e5W2YDafuu7jmB4Mi%258w0%25lzD0Z8XgY1nTN5bfPn7OL3BRtS"},imageUrlSide180:{value:"//cosy.bmwgroup.com/next/cosySec?COSY-EU-100-7331c9Nv2Z7d5yKtHS9P3AKWL2JeiPnsEgpn23HGfvQFzs5eqKDsH%25fMA8ad2fRFbNxCRifGDuKgAusWGPcPr1Y%25P6PaXo4fNEbnRxb10s9Ol%25TE4riIggKscCqXkOuADOPprDoubhl1oBHWpsQFe0P%25dxEaUmJCOy8sZR"},lastUpdate:{value:"2013-11-05T15:12:33.000Z"},modelSection:{changeUrl:{name:"Modell ändern",value:"/vc/ncc/xhtml/start/startWithConfigUrl.faces?name=s2v2x4p1&currentView=MODEL_ENGINE"},name:"Modell",averageConsumption:{disclaimerNumber:"1",name:"Strom-Verbrauch",unit:"kWh/100km",value:"0.0"},averageEmission:{disclaimerNumber:"1",name:"CO2-Emission",unit:"g/km",value:"0,0"},bodyType:{description:"HB",value:"HB"},brand:{value:"BI"},efficiencyCategory:{name:"CO2-Effizienz",value:"Aplus"},electricRange:{disclaimerNumber:"1",name:"Reichweite",unit:"km",value:"0"},engineHorsePower:{unit:"PS",value:"170"},enginePower:{unit:"kW",value:"125"},marketingModelRangeCode:{value:"I01"},modelCode:{value:"1Z21"},modelName:{value:"BMW i3"},series:{description:"BMW i",value:"i"},tax:[{name:"MwSt.",unit:"%",value:"19"}],title:{value:"BMW i3"}},note:{value:"Meine Konfiguration  05.11.2013 16:12"},optionSection:{changeUrl:{name:"Ausstattung ändern",value:"/vc/ncc/xhtml/start/startWithConfigUrl.faces?name=s2v2x4p1&currentView=OPTIONS"},name:"Sonderausstattung",salesGroup:[{displayOrder:"1",feature:[{displayOrder:"1",displayType:"1",familyType:"OTHER",featureCode:"6AP",featureType:"S",featureTypeAndCode:"S06AP",price:{grossPrice:{decimalNumber:"0.00",disclaimerNumber:"2",name:"Listenpreis",value:"inklusive"},grossRentalPrice:{decimalNumber:"0.00",name:"Monatliche Rate",value:"inklusive"},netPrice:{decimalNumber:"0.0",name:"Listenpreis Netto",value:"inklusive"}},standard:"false",value:"Remote Services"}],value:"ConnectedDrive Services&Apps"}]},packageSection:{changeUrl:{name:"Pakete ändern",value:"/vc/ncc/xhtml/start/startWithConfigUrl.faces?name=s2v2x4p1&currentView=PACKAGES"},name:"Pakete"},priceSection:{name:"Preisübersicht",basePrice:{name:"Listenpreis Netto",grossRentalPrice:{decimalNumber:"499.92",name:"Monatliche Rate",value:"499,92 €"},netPrice:{decimalNumber:"29369.75",name:"Listenpreis Netto",value:"29.369,75 €"}},equipmentPrice:{name:"Sonderausstattung Netto",grossRentalPrice:{decimalNumber:"0.00",name:"Monatliche Rate",value:"inklusive"},netPrice:{decimalNumber:"0.00",name:"Listenpreis Netto",value:"inklusive"}},taxVAT:{decimalNumber:"5580.25",name:"MwSt. 19%",value:"5.580,25 €"},totalPrice:{name:"Gesamtpreis",grossPrice:{decimalNumber:"34950.00",disclaimerNumber:"2",name:"Listenpreis",value:"34.950,02 €"},grossRentalPrice:{decimalNumber:"499.92",disclaimerNumber:"1",name:"Monatliche Rate",value:"499,92 €"},netPrice:{decimalNumber:"29369.75",name:"Listenpreis Netto",value:"29.369,75 €"}},extraCost:[{infoUrl:"/vc/api/v1/pub/esp/mc;brand=BM;market=IB;locale=en_GB;mandatorType=country;country=GB/priceInfo/s2v2x4p1?additionalCosts=true",name:"Zulassungskosten (Preis ohne Wunschkennzeichen)",disclaimerNumber:"3",value:"70,00 €",financeDisclaimer:{name:"Hinweis",value:""},grossPrice:{name:"grossPriceName",value:"grossPriceValue"}},{infoUrl:"/vc/api/v1/pub/esp/mc;brand=BM;market=IB;locale=en_GB;mandatorType=country;country=GB/priceInfo/s2v2x4p1?additionalCosts=true",name:"Auslieferungskosten",disclaimerNumber:"4",value:"1.200,00 €",financeDisclaimer:{name:"Hinweis",value:""},grossPrice:{name:"grossPriceName",value:"grossPriceValue"}},{infoUrl:"/vc/api/v1/pub/esp/mc;brand=BM;market=IB;locale=en_GB;mandatorType=country;country=GB/priceInfo/s2v2x4p1?additionalCosts=true",name:"Steuer",value:"750,00 €",disclaimerNumber:"5",financeDisclaimer:{name:"Hinweis",value:""},grossPrice:{name:"grossPriceName",value:"grossPriceValue"}}],extraCostsForTotalPrice:[{name:"Abholung in BMW Welt",value:"530,00 €",financeDisclaimer:{name:"Hinweis",value:""}}]},standardEquipmentSection:{name:"Grundausstattung"},transmissionSection:{name:"Getriebe",transmission:{name:"Getriebe",value:"Automatisches Getriebe"}},valid:"true"};return{__init__:function(){},__start__:function(){},getMockedConfiguration:function(){return A}}}();var rlEspConfirmation=function(){function A(){jq(".confirmationYourConfigContentItemContent").unbind("click");var E=rlEspBasket.getCurrentInstance().getConfirmationData();if(typeof E!=="undefined"){var D=E.configUrl;jq("#espConfirmationStageVehicleImage").attr("src",E.imageUrlFront820);jq("#confirmationYourConfigUrl").attr("href","http://"+D).text(D);var F=E.pdfURL;if(F.substr(0,4)!="http"){F="http://"+F}jq(".confirmationYourConfigPDF a").attr("href",F);jq(".confirmationYourConfigContentItemContent.confirmationYourConfigShare").click(function(){rlComponentLoader.deferredExec(["shareButton"],function(){rlShareButton.setShareUrl("http://"+D);rlShareButton.openLayer()})});jq("#confirmationYourConfigWrapper").show();if(E.paymentInCash){jq(".espConfirmationNextStepsContainer1").show()}else{jq(".espConfirmationNextStepsContainer2").show()}}if(typeof CQ==="object"){jq(".espConfirmationNextStepsContainer").show();jq("#confirmationYourConfigWrapper").show()}if(jq(".espConfirmationNextStepsContainer:visible").length<1){jq(".espConfirmationNextStepsContainer1").show()}jq(".espProcessStepContainer").each(function(){var G=0;jq(this).find(".headlineh4").each(function(){if(jq(this).height()>G){G=jq(this).height()}});jq(this).find(".headlineh4").css({height:G+"px"})});jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_LISTENER_NOTIFICATION,{id:rlTrackingListener.PAGE_IDS.PAGE_ESP_CONFIRMATION,info:null,type:rlTrackingListener.TRACKING_TYPES.PAGE})}function B(){jq(".confirmationSaveVehicleSaveButton").unbind("click").click(function(){rlUserDialog.showNccSave()});jq(".configurationShareButtonLabel").unbind("click").click(function(){jq(this).parent().parent().find(".shareButton .nextIcon").click()})}function C(){if(typeof CQ==="object"&&CQ.WCM.isEditMode()){jq("#espConfirmationStageHeadline").css({opacity:1});jq("#espConfirmationStageBackground").css({opacity:1});jq("#espConfirmationStageVehicleImage").css({opacity:1});jq("#espConfirmationMainContentWrapper").css({opacity:1})}else{jq("#espConfirmationStageHeadline").css({opacity:0});jq("#espConfirmationStageBackground").css({opacity:0});jq("#espConfirmationStageVehicleImage").css({opacity:0});jq("#espConfirmationMainContentWrapper").css({opacity:0});var D=jq("#espConfirmationStageVehicleImage").width();var E=jq("#espConfirmationStageVehicleImage").height();jq("#espConfirmationStageVehicleImage").css({width:D*1.15,height:E*1.15});jq("#espConfirmationStageVehicleImage").delay(200).animate({opacity:1,width:D,height:E},1600,function(){jq(this).css("filter","none")});jq("#espConfirmationStageHeadline").delay(700).animate({opacity:1},600,function(){jq(this).css("filter","none")});jq("#espConfirmationStageBackground").delay(1000).animate({opacity:1},1800,function(){jq(this).css("filter","none")});jq("#espConfirmationMainContentWrapper").delay(3000).animate({opacity:1},1100,function(){jq(this).css("filter","none")})}}return{__init__:function(){},__start__:function(){A();B();setTimeout("rlEspConfirmation.animateStage()",1000)},animateStage:C}}();var rlEspConfirmationSaverOrViewConfigTeaser=function(){var F=undefined;var D=".espSaveOrViewConfigTeaser .espViewConfigTeaser";var E=".espSaveOrViewConfigTeaser .espSaveConfigTeaser";function J(){if(rlPage.isDesignMode()){L();return }if(rlPage.isEditMode()){K();return }G();F=rlEspBasket.getCurrentInstance().getConfigId();var N=rlEspBasket.getCurrentInstance().getConfirmationData();if(N){var M=N.hasUnsavedChanges;B(M).done(function(O){if(O){L()}else{I()}H()})}}function B(N){var M=jq.Deferred();rlCoreServices.isLoggedIn({loggedIn:function(){var O={configId:F};rlEspCustomizations.isConfigSaved(O,true).done(function(P){if(P){if(N){M.resolve(true)}else{M.resolve(false)}}else{M.resolve(true)}})},loggedOut:function(){M.resolve(true)}});return M.promise()}function G(){jq(D).hide();jq(E).hide()}function K(){jq(D).show();jq(E).show()}function L(){jq(D).hide();jq(E).show()}function I(){jq(E).hide();jq(D).show()}function H(){jq(".espSaveOrViewConfigTeaser .confirmationSaveConfigButton").unbind("click",C).click(C);jq(".espSaveOrViewConfigTeaser .confirmationViewConfigButton").unbind("click",A).click(A)}function C(){var M={configId:F};rlUserDialog.showNccSave(M);return false}function A(){rlUserDialog.redirectToMyBmwMyConfigurationsPage(F);return false}return{__init__:function(){J()},__start__:function(){}}}();var rlEspFinanceCalculatorFS=function(){var C="";var A={FINANCE_TYPES:{LEASING:"leasing",CASH:"cash"}};function D(O,F){var N=CoreFormsBase.inheritanceFrom(rlFormFieldSet.createFS(O,F));var L=N.parent;N.typeName="rlEspFinanceCalculatorFS";var M=O.find(".radio_financing");var I=O.find(".radio_cash");N.init=function(){L.init();K();G()};function G(){M.attr("data-tracking-info",A.FINANCE_TYPES.LEASING);I.attr("data-tracking-info",A.FINANCE_TYPES.CASH)}function H(){C=A.FINANCE_TYPES.LEASING;O.addClass("financingSelected");O.removeClass("cashSelected");if(!N.isInCqEditMode()&&!rlPage.isPreviewMode()){rlNccEspApp.createFinancePage("nccFinancingProductSelector","nccFinancingProductPage");E(false)}}function J(){C=A.FINANCE_TYPES.CASH;O.addClass("cashSelected");O.removeClass("financingSelected");E(true)}function E(R){var P=rlEspBasket.getCurrentInstance();if(P){P.setCashBasketOption(R)}var Q=rlEspForm.getCurrentInstance();if(Q){var S=Q.getConfiguration();if(S){jq(window).trigger(rlCoreFormEvents.ENUM.NAMES.VEHICLE_CONFIG_CHANGED,S)}}}function K(){M.change(function(){M.prop("checked-in-config",false);if(M.prop("checked")){H()}});I.change(function(){M.prop("checked-in-config",false);if(I.prop("checked")){J()}})}N.onFormReady=function(){L.onFormReady();if(!N.isInCqEditMode()&&!rlPage.isPreviewMode()){var P=rlEspBasket.getCurrentInstance().getFormData();if(P&&P.FormFieldSetsEspFinanceCalculatorFSComponent){if(P.FormFieldSetsEspFinanceCalculatorFSComponent.financing&&P.FormFieldSetsEspFinanceCalculatorFSComponent.financing.enabled===true&&P.FormFieldSetsEspFinanceCalculatorFSComponent.financing.checked===true){H()}else{if(P.FormFieldSetsEspFinanceCalculatorFSComponent.cash&&P.FormFieldSetsEspFinanceCalculatorFSComponent.cash.enabled===true&&P.FormFieldSetsEspFinanceCalculatorFSComponent.cash.checked===true){J()}}}else{rlNccEspApp.isFinanceDefaultOffer(function(Q){if(!Q){M.prop("checked-in-config",true);M.prop("checked",true);H()}})}}};N.getPdfSummary=function(P,Q){if(isDefined(I)&&I.prop("checked")){P.push({type:Q.LABEL,id:O.find('[data-field]:not([data-field=""])').attr("data-field"),value:O.find(".cashContent p.copyText").text()})}return P};N.getValidationRules=function(P){P.fincancingMustBeSupported={when:"ELEM_INVALIDATED_BY_FORM",rule:function(U,R,T,Q,S){if(rlNccEspApp.isFinanceCalculationError()===true&&B()!==A.FINANCE_TYPES.CASH){return{fieldName:"espFinanceCalculatorError",level:"ERROR",messageText:"",feedbackCallback:function(){rlGlassPaneLayerNext&&!rlGlassPaneLayerNext.isOpen()&&rlGlassPaneLayerNext.openDialog({url:rlPage.getLanguagePath()+"/esp/esp-financecalculatorerrorLayer.ajax.html",keepUrlHash:true})}}}}};return P};return N}function B(){return C}return{__init__:function(){},__start__:function(){},createFS:function(E,F){return D(E,F)},getCurrentSelection:function(){return B()},FINANCE_TYPES:A.FINANCE_TYPES}}();var rlEspForm=function(){var F=undefined;var C={EVENT:{ESP_START:"EVENT_ESP_START",ESP_LOGGED_IN:"EVENT_ESP_LOGGED_IN",ESP_LOGGED_IN_REQUEST:"EVENT_ESP_LOGGED_IN_REQUEST",ESP_AS_GUEST:"EVENT_ESP_AS_GUEST",ESP_AS_GUEST_REQUEST:"EVENT_ESP_AS_GUEST_REQUEST"},STATE:undefined};var B=rlPage.getLanguagePath()+"/esp/esp-confirmation.html";var E=undefined;function A(G,l){var a=CoreFormsBase.inheritanceFrom(rlRfxForm.create(G,l));var T=a.parent;a.typeName="rlEspForm";var H=undefined;var m=undefined;var I=false;var Q=undefined;a.getContext=function(){return"ESP"};a.getUseCaseMetaDataRoot=function(){return"espRequest"};a.onReady=function(){T.onReady();if(H.isValid()){Z();a.showDitherLayer();c();O();W();rlTracking.startEspClick({configId:H.getConfigId(),publicConfigId:H.getPublicConfigId()})}else{b()}};function P(){H=rlEspBasket.getCurrentInstance({});if(!a.isInCqEditMode()){if(!H.getConfigId()){rlErrorService.handleError({actor:rlErrorService.ACTOR_SYSTEM,requestStatus:"ConfigId must be provided as URL parameter!"})}if(!H.getPublicConfigId()){rlErrorService.handleError({actor:rlErrorService.ACTOR_SYSTEM,requestStatus:"PublicConfigId must be provided as URL parameter!"})}}}function b(){jq(".espForm").show();jq(".espBasketExpiredWrapper").appendTo("#espProcessContent");jq(".espForm .wizardStep, .espForm .formFootnote").hide();jq(".espForm .wizardStepTab").removeClass("activeStep").addClass("newStep");jq(".espForm .wizardStepNumber, .espForm .wizardStepTitle").css("color","#e6e6e6");jq(".espProcessContent").addClass("basketErrorState")}function g(){!a.isInCqEditMode()&&S().hide()}function V(){j(C.STATE.AS_GUEST,C.EVENT.ESP_AS_GUEST);Z()}function n(){j(C.STATE.LOGGED_IN,C.EVENT.ESP_LOGGED_IN)}function j(q,p){H.setState(q);if(!a.isInCqEditMode()){c();if(H&&!H.hasFormDataWithUserInput(a)){H.setFormData(Q.collectInputCacheData())}S().show()}k().show();a.formEvents.trigger(p)}function c(){var p=window.location.href;var q=H.addBasketIdToURL(p,true);if(H.getConfigId()||H.getConfigId()===0){q=H.addConfigIdToURL(q,H.getConfigId(),true)}if(H.getPublicConfigId()||H.getPublicConfigId()===0){q=H.addPublicConfigIdToURL(q,H.getPublicConfigId(),true)}if(p!=q){window.location.href=q}}function N(p){!a.isInCqEditMode()&&rlGlassPaneLayerNext&&!rlGlassPaneLayerNext.isOpen()&&rlGlassPaneLayerNext.openDialog({url:GLOBAL_ESP_PROCESS_OVERVIEW_PAGE_URL,keepUrlHash:true})}function f(q,p){if(p){m=p}else{console.error("changedConfig undefined for: ",q)}}function e(q,p){var r=G.find(".espFormProperties").attr("data-ignoredCompareConfigProperties");r=jq.map(r.split(","),jq.trim);if(H.isDebugEsp()){console.debug(JSON.stringify(q));console.debug(JSON.stringify(p));console.debug(r)}return !H.deepEquals(q,p,r,H.isDebugEsp())}function Y(r){var p=jq.Deferred();try{a.allEvents.subscribe(a.allEvents.names.PONG_FIELDSET_PDF_SUMMARY,function(t,s){r.pdfSummary={};r.pdfSummary.summaryItems=s||{};r.pdfSummary.basketId=rlEspBasket.getCurrentInstance().getBasketId();r.pdfSummary.configUrl=rlEspBasket.getCurrentInstance().getPublicConfigId();p.resolve(r)});a.allEvents.trigger(a.allEvents.names.PING_FIELDSET_PDF_SUMMARY)}catch(q){p.resolve(r)}return p.promise()}a.getDataSink=function(q){var p=function(){D();rlErrorService.handleError({actor:rlErrorService.ACTOR_SYSTEM,requestStatus:"Save is not ok!!"})};return rlEspDataSink.createDataSink(q,p)};a.submitForm=function(r){var p=m;var q=f;rlNccEspApp.getConfiguration(function(s){f=q;if(e(p,s)){a.hideDitherLayer();rlEspConfigChangedLayer.showLayer(function(){window.location.reload()},function(){K(function(){a.hideDitherLayer()})})}else{if(r){var t=H.getConfirmationData()||{};t.paymentInCash=(r.espFinance!=="financing");H.setConfirmationData(t)}jq.when(Y(r)).then(function(u){T.submitForm(u)})}})};a.showSuccessView=function(){var p=a.getConfiguration();if(p){var q=H.getConfirmationData()||{};q.imageUrlFront820=p.imageUrlFront820&&p.imageUrlFront820.value?p.imageUrlFront820.value:undefined;q.configUrl=p.configUrl&&p.configUrl.value?p.configUrl.value:undefined;q.hasUnsavedChanges=(p.hasUnsavedChanges==="true"||p.hasUnsavedChanges===true);var r=rlCoreServices.getEspPdfSummaryUrl();q.pdfURL=r?r+"?basketId="+rlEspBasket.getCurrentInstance().getBasketId():undefined;H.setConfirmationData(q)}H.setFormData(undefined);H.setState(C.STATE.SUBMITTED);L()};function L(){if(B){var p=H.splitUrl(window.location.href);window.location.href=window.location.protocol+"//"+window.location.host+B+(typeof (p.search)==="undefined"?"":"?"+p.search)+(typeof (p.hash)==="undefined"?"":"#"+p.hash)}}a.showErrorView=function(p,q){H.setConfirmationData(undefined);T.showErrorView(p,q)};function X(q,r,p){switch(p){case 0:a.formEvents.trigger(a.isLoggedIn()?C.EVENT.ESP_LOGGED_IN_REQUEST:C.EVENT.ESP_AS_GUEST_REQUEST);break;case 1:H.setState(C.STATE.STEP_2);break;case 2:H.setState(C.STATE.STEP_3);break;case 3:H.setState(C.STATE.STEP_4);break;default:console.log("espForm: Ignoring step switch: "+r+" -> "+p)}a.formEvents.trigger(a.formEvents.names.ESP_WIZARD_STEP_DID_CHANGE,r,p);if(m){jq(window).trigger(rlCoreFormEvents.ENUM.NAMES.VEHICLE_CONFIG_CHANGED,m)}}function U(){a.formEvents.subscribe(C.EVENT.ESP_START,function(){g()});a.formEvents.subscribe(C.EVENT.ESP_AS_GUEST_REQUEST,function(){K(function(){V()})});a.formEvents.subscribe(C.EVENT.ESP_LOGGED_IN_REQUEST,function(){K(function(){n()})});a.formEvents.subscribe(a.formEvents.names.WIZARD_STEP_DID_CHANGE,function(q,r,p){X(q,r,p)})}function O(){var p=H.getState();switch(p.ordinal){case C.STATE.START.ordinal:H.setState(C.STATE.START);a.formEvents.trigger(C.EVENT.ESP_START);break;case C.STATE.AS_GUEST.ordinal:a.formEvents.trigger(C.EVENT.ESP_AS_GUEST_REQUEST);break;case C.STATE.LOGGED_IN.ordinal:if(a.isLoggedIn()){a.formEvents.trigger(C.EVENT.ESP_LOGGED_IN_REQUEST)}else{a.formEvents.trigger(C.EVENT.ESP_AS_GUEST_REQUEST)}break;case C.STATE.STEP_2.ordinal:k().show();a.formEvents.trigger(a.formEvents.names.WIZARD_STEP_REQUEST_JUMP,1);break;case C.STATE.STEP_3.ordinal:k().show();a.formEvents.trigger(a.formEvents.names.WIZARD_STEP_REQUEST_JUMP,2);break;case C.STATE.STEP_4.ordinal:k().show();a.formEvents.trigger(a.formEvents.names.WIZARD_STEP_REQUEST_JUMP,3);break;case C.STATE.SUBMITTED.ordinal:H.setFormData(undefined);L();break;default:console.error('Cannot restore unknown state "'+(p&&p.name?p.name:p)+'" from basket. Starting.');a.formEvents.trigger(C.EVENT.ESP_START)}}function K(p){p&&setTimeout(function(){p()},0)}function S(){var s=G.find(".espAsGuestFS").parents(".wizardStep");var r=s.find(".parbase");var p=-1;for(var q=0;q<r.length;q++){if(r[q]&&jq(r[q]).hasClass("espAsGuestFS")){p=q;break}}if(p>=0){r.splice(0,p+1)}return r}function W(){rlNccEspApp.startApp(H.getPublicConfigId(),a.isLoggedIn(),function(p){f(null,p);a.hideDitherLayer()},function(p,q){if(q&&q.status&&q.status.errorCode==="102-003"){console.error("Error starting up rlNccEspApp: No vehicle found for configId.",p,q);b();G.parents(".espForm").hide();return true}return false});jq(window).bind(rlCoreFormEvents.ENUM.NAMES.VEHICLE_CONFIG_CHANGED,f)}function o(){var p=G.find(".espFormProperties").attr("data-showProcessLinkLabel");var r=jq("<div></div>").addClass("showProcessLinkContainer clearfix");var q=jq('<a data-tracking-clickable="true" data-tracking-id="showProcessLinkContainer" data-tracking-type="link"></a>').addClass("linkArrow13px").attr("href","javascript:void(0)").text(p).click(N).appendTo(r);G.find(".wizardStep").prepend(r)}function Z(){G.show().parents(".espForm").show();if(!a.isInCqEditMode()&&H.getState().ordinal===C.STATE.AS_GUEST.ordinal&&!I){I=true;K(function(){var p=S();if(p.length>0){var q=jq(p[0]).offset().top-G.parent().find(".wizardtabs").outerHeight(true)-50;jq.scrollTo(q,400)}})}}function k(){return G.parent().find(".formButtonBar")}function M(){return G.parent().find(".formSpecialCustomerButtonBar")}function R(){rlEspSpecialCustomerButton.create({formButtonBar:k(),specialCustomerBar:M()},l)}function J(){Q=rlEspInputCache.create(a,G,{});Q.addEspInputCacheToForm()}function d(){window.rfxContextParams={configId:H.getConfigId()}}a.clearBasket=function(){H&&H.clearBasket()};a.getConfigIdFromBasket=function(){return H?H.getConfigId():undefined};a.getConfiguration=function(){return m||undefined};a.hasConfiguration=function(){return !!m};a.getEmptyFormInputCacheData=function(){return E};a.setEmptyFormInputCacheData=function(p){E=p};a.init=function(){T.init();P();d();U();o();R();J()};return a}function D(){rlErrorService.setCustomOptions({errorPageUrl:GLOBAL_ESP_ERROR_PAGE_URL,url:GLOBAL_ESP_ERROR_LAYER_URL,onAfterAjaxContentLoaded:function(){var H=F.getConfiguration();var G;if(H){if(H.configUrl&&H.configUrl.value){G=H.configUrl.value;if(typeof rlEspBasket!=="undefined"){G=rlEspBasket.getCurrentInstance().addBasketIdToURL(G,false)}}}if(G){jq(".glassPaneLayerContent .mybmw-feedbackLayer").addClass("espErrorLayer");jq(".glassPaneLayerContent .feedback-paragraphs").append(jq('<div class="par parsys espErrorLayerConfigURLContainer"></div>').append('<div class="text parbase base section"></div>').html(BL_Form_ESP_Error_myconfiguration_label+"&nbsp;").append(jq('<span class="fontBold"></span>').text(G)))}var I="ACTOR_USER:"+G;jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_LISTENER_NOTIFICATION,{id:rlTrackingListener.FORM_IDS.FORM_ESP_ERROR,info:I,type:rlTrackingListener.TRACKING_TYPES.FORM})}})}return{ENUM:C,__init__:function(){C.STATE=rlEspBasket.ENUM.STATE},__start__:function(){},create:function(G,H){D();return(F=A(G,H))||undefined},getCurrentInstance:function(){return F||undefined}}}();var rlEspInputCache=function(){function A(B,C,E){var L=CoreFormsBase.inheritanceFrom(CoreFormsBase.createBaseType());var K=L.parent;L.typeName="rlEspInputCache";var I=rlEspBasket.getCurrentInstance({});function G(M){return M.getInputCacheCookieName()||M.typeName||"default"}function F(N,M){return function(P){M.setEmptyFormInputCacheData(L.collectInputCacheData());var Q=["financing","cash"];if(I&&I.hasFormDataWithUserInput(M,Q)){var O={};jq.each(M.getFieldSetsById(),function(S,R){O[S]=R.supportsInputCache;R.supportsInputCache=function(){return true}});N&&N({});jq.each(M.getFieldSetsById(),function(S,R){R.supportsInputCache=O[S]})}else{N&&N(P)}}}function D(M,O,N){return function(){if(!M.supportsInputCache(true)||M.isRestoringFromInputCache){return }var R=I.getFormData()||{};var Q=G(M);var P={};P=M.getStateForInputCache(P);if(P&&I.objectHasOwnProperty(P)){R[Q]=R[Q]||{};R[Q]=P;I.setFormData(R)}else{if(R.hasOwnProperty(Q)){delete R[Q]}}if(!O&&N){return N()}}}function H(M,P,N,O){return function(T){var Q=G(M);var S=I.getFormData();var R;if(!P){R=(I.hasFormDataWithUserInput(O)?S[Q]:T)||{}}else{R=S&&S[Q]?S[Q]:{}}if(N){return N(R)}}}function J(N,M){return function(O){if(N){return N(O||I.hasFormDataWithUserInput(M))}}}L.addEspInputCacheToForm=function(){if(B.isInCqEditMode()){return }if(B.isEspInputCachingAdded===true){return }B.isEspInputCachingAdded=true;var N=B.isLoggedIn()===true;var M=B.onReady;B.onReady=function(){M&&M()};B.setData=F(B.setData,B);jq.each(B.getFieldSetsById(),function(Q,O){if(N){O.activateInputCache(true);if(I&&I.hasFormDataWithUserInput(B)){var P=O.switchToEditMode;O.switchToEditMode=function(){var R=O.supportsInputCache;O.supportsInputCache=function(){return R&&R(true)};P&&P();O.supportsInputCache=R}}}O.restoreStateFromCookie=J(O.restoreStateFromCookie,B);O.saveStateToInputCache=D(O,N,O.saveStateToInputCache);O.setStateFromInputCache=H(O,N,O.setStateFromInputCache,B)})};L.collectInputCacheData=function(){var M={};jq.each(B.getFieldSetsById(),function(Q,O){var P=G(O);var N={};if(O.supportsInputCache(true)){N=O.getStateForInputCache(N)}if(I.objectHasOwnProperty(N)){M[P]=N}});return M||{}};B.setEmptyFormInputCacheData(L.collectInputCacheData());return L}return{__init__:function(){},__start__:function(){},create:function(C,B,D){return A(C,B,D)}}}();var rlEspLoginFS=function(){function A(P,D){var O=CoreFormsBase.inheritanceFrom(rlFormFieldSet.createFS(P,D));var L=O.parent;O.typeName="rlEspLoginFS";function B(Q){J()}function I(Q){C()}function N(Q){if(D.isLoggedIn===true&&!O.isInCqEditMode()){O.formEvents.trigger(rlEspForm.ENUM.EVENT.ESP_LOGGED_IN_REQUEST)}else{J()}}function M(){O.formEvents.trigger(rlEspForm.ENUM.EVENT.ESP_LOGGED_IN_REQUEST);window.location.reload()}function H(R,T,Q){var S=G();T===0&&Q===1&&S&&S.hideErrorBorders()}function K(){O.formEvents.subscribe(rlEspForm.ENUM.EVENT.ESP_AS_GUEST,function(Q){B(Q)});O.formEvents.subscribe(rlEspForm.ENUM.EVENT.ESP_LOGGED_IN,function(Q){I(Q)});O.formEvents.subscribe(rlEspForm.ENUM.EVENT.ESP_START,function(Q){N(Q)});O.formEvents.subscribe(O.formEvents.names.WIZARD_STEP_WILL_CHANGE,function(R,S,Q){H(R,S,Q)})}function F(){return rlLoginLayer.getLoginLayerDom(P.find(".espLoginLayer"))}function G(){return rlLoginLayer.getInstance(F().attr("id"))}function E(){rlComponentLoader.deferredExec(["loginLayer"],function(){var Q=F();if(O.isInCqEditMode()){Q.find(".loginlayer_registerLink").unbind("click");Q.find(".loginlayer_forgottenPasswordLink").unbind("click");Q.find(".loginlayer_loginLink").unbind("click")}var R=P.parents("div.espForm");rlLoginLayer.setLoginSuccessCallback(function(){M()});rlLoginLayer.setDitherTarget(R);rlComponentLoader.deferredExec(["espCustomizations"],function(){rlLoginLayer.setLoginSuccessCallback(function(){M()})})})}function C(){P.parent().hide()}function J(){P.parent().show()}O.supportsInputCache=function(){return false};E();K();return O}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlEspPdfSummaryFS=function(){function A(L,C){var K=CoreFormsBase.inheritanceFrom(rlFormFieldSet.createFS(L,C));var I=K.parent;K.typeName="rlEspPdfSummaryFS";var H;var D;K.init=function(){I.init();if(!rlPage.isEditMode()&&!rlPage.isDesignMode()&&!rlPage.isPreviewMode()){F();J()}};function B(P,S){C.formEvents.unsubscribe(C.allEvents.names.PONG_FIELDSET_PDF_SUMMARY,B);var O={summaryItems:S,configUrl:rlEspBasket.getCurrentInstance().getPublicConfigId()};var Q=rlCoreServices.getEspPdfSummaryUrl();var N=jq.base64Encode(JSON.stringify(O));var M=G();var R=jq("<form action='"+Q+"' method='post'><input type='hidden' name='summaryData' value='"+N+"'/></form>").appendTo(M);R.submit();jq(R).remove();D=setInterval(E,500);setTimeout(function(){clearInterval(D)},CROSSSUBDOMAINAJAX_TIMEOUT||10000)}function E(){if(rlPage.isEditMode()||rlPage.isDesignMode()){clearInterval(D);return }try{var M=G();var N=jq(M).html();if(N!=""&&N!=null){rlErrorService.handleError({actor:rlErrorService.ACTOR_USER,requestStatus:"[espPdfSummary] "+N});clearInterval(D)}}catch(O){rlErrorService.handleError({actor:rlErrorService.ACTOR_USER,requestStatus:"[espPdfSummary] error loading PDF"});clearInterval(D)}}function J(){var N=document.domain;H=document.createElement("iframe");H.id="espPdfDownloadHelper";var M='javascript:(function(){document.open();document.domain="'+document.domain+'";document.close();})()';H.src=M;document.body.appendChild(H);jq(H).hide()}function G(){var M=H.contentDocument||H.contentWindow.document;return M.body}function F(){L.find(".pdfPrintSummaryLabel, .pdfPrintSummary").click(function(){C.formEvents.subscribe(C.allEvents.names.PONG_FIELDSET_PDF_SUMMARY,B);C.allEvents.trigger(C.allEvents.names.PING_FIELDSET_PDF_SUMMARY)})}return K}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlEspPriceNotificationLayer=function(){var D="espPriceNotification";var A=function(){if(rlCookieController.getCookie({cookieKey:D})==null){jq("#cartBoxLinkToNCC").click(function(E){if(jq("#cartBoxExtraCosts .cartBoxEntryRow").length>0){B();E.preventDefault()}})}};var C=function(){jq(".espPriceNotificationButton a").bind("click",function(){rlCookieController.setCookie({cookieKey:D,cookieValue:true});document.location.href=jq("#cartBoxLinkToNCC").attr("href")})};var B=function(){rlComponentLoader.requireComponents("glassPaneLayerNext");rlComponentLoader.deferredExec("glassPaneLayerNext",function(){rlGlassPaneLayerNext.openDialog({url:GLOBAL_ESP_PRICE_NOTIFICATION_LAYER_PATH,keepUrlHash:true,onAfterAjaxContentLoaded:function(){rlEspPriceNotificationLayer.initButton();rlGlassPaneLayerNext.subbrandChange("BI");jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_LISTENER_NOTIFICATION,{id:"cartBoxLinkPriceDisclaimerOpen"})}})})};return{__start__:function(){},__init__:function(){A()},initButton:function(){C()},openLayer:function(){B()}}}();var rlEspProcess=function(){return{__start__:function(){},__init__:function(){}}}();var rlEspProcessOverview=function(){var D=function(){jq(".espProcessStepContainer").each(function(){var E=0;jq(this).find(".headlineh4").each(function(){if(jq(this).height()>E){E=jq(this).height()}});jq(this).find(".headlineh4").css({height:E+"px"})})};var A=function(){var F,E;if(rlEspBasket.getCurrentInstance().isActive()||jq(".coreForm.espForm").length>0){F="Resume";E=jq(".espProcessOverviewButtonContinue");E.show()}else{F="Init";E=jq(".espProcessOverviewButtonStart");E.show()}E.closest("[data-tracking-id]").attr("data-tracking-info",F);jq(".espProcessOverviewButton").show()};var C=function(){jq(".espProcessOverviewButton").bind("click",function(){if(rlEspBasket.getCurrentInstance().isActive()||jq(".coreForm.espForm").length>0){rlGlassPaneLayerNext.closeLayer()}else{var E=GLOBAL_ESP_ORDER_PAGE_URL;if(rlContextObject.getIsNCC()){var F=rlEspBasket.getCurrentInstance();var G=rlContextObject.getContextObject().vehicle;E=F.addConfigIdToURL(E,G.configId,true);E=F.addPublicConfigIdToURL(E,G.publicConfigId,true)}document.location.href=E}})};var B=function(){rlComponentLoader.requireComponents("glassPaneLayerNext");rlComponentLoader.deferredExec("glassPaneLayerNext",function(){rlGlassPaneLayerNext.openDialog({url:GLOBAL_ESP_PROCESS_OVERVIEW_PAGE_URL,keepUrlHash:true,onAfterAjaxContentLoaded:function(){rlEspProcessOverview.initButton();rlGlassPaneLayerNext.subbrandChange("BI")}})})};return{__start__:function(){},__init__:function(){},initButton:function(){A();C();D()},openLayer:function(){B();if(!rlEspBasket.getCurrentInstance().isActive()&&jq(".coreForm.espForm").length===0){jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_LISTENER_NOTIFICATION,{id:rlTrackingListener.FORM_IDS.FORM_ESP_OVERVIEW_LAYER,info:"Open",type:rlTrackingListener.TRACKING_TYPES.GLASS_PANE_LAYER})}}}}();var rlEspSpecialCustomerButton=function(){function A(I,H){var D={};D.typeName="rlEspSpecialCustomerButton";D.containerEvents=H.containerEvents;var C=rlEspSpecialCustomerFS.ENUM;function E(){I.specialCustomerBar.hide();I.formButtonBar.show()}function G(){I.formButtonBar.hide();I.specialCustomerBar.show()}function F(){D.containerEvents.subscribe(C.EVENT.ESP_SPECIAL_CUSTOMER_OFF,E);D.containerEvents.subscribe(C.EVENT.ESP_SPECIAL_CUSTOMER_ON,G);I.specialCustomerBar.find(".rfoSpecialCustomerButton").click(B)}function B(){var J=rlContextObject.getContextObject().vehicle;var K=J?J.configId:undefined;if(!K){K=window.rfxContextParams?window.rfxContextParams.configId:undefined}rlUserDialog.showRequestRFOSpecialCustomer({configId:K,distributionPartnerId:J?J.distributionPartnerId:undefined,outletId:J?J.outletId:undefined,subBrand:J?J.subBrand:undefined})}F();return D}return{__init__:function(){},__start__:function(){},create:function(C,B){return A(C,B)}}}();var rlEspTermsFS=function(){function A(B,E){var C=CoreFormsBase.inheritanceFrom(rlFormFieldSet.createFS(B,E));var D=C.parent;C.typeName="rlEspTermsFS";C.init=function(){D.init()};C.getPdfSummary=function(H,G){var F=B.find(".checkboxContainer input");if(F.length>0){H.push({type:G.LABEL,value:F.first().next("label").text(),id:B.find('[data-field]:not([data-field=""])').attr("data-field")});if(F.prop("checked")){H.push({type:G.LABEL,value:"true",id:B.find('[data-field]:not([data-field=""])').attr("data-field")+".checked"})}}return H};return C}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlEspTrackingAdapter=(function(){var L={};var M={};var A;var B;var G=true;var H;var D="rlEspForm";function F(){var O="[ESPTrackingAdapter]: ",N;for(N=0;N<arguments.length;N+=1){O=O+arguments[N]}console.log(O)}function K(){return A}function I(){return B}function E(){return isDefined(H)&&(jq("#"+H).length>0)}function C(O){var P;if(O.type===rlTrackingListener.TRACKING_TYPES.FORM&&O.id===rlTrackingListener.FORM_IDS.FORM_CREATE&&O.info&&O.info.formName===D){H=O.info.formId;A=1}P=E();if(O.type===rlTrackingListener.TRACKING_TYPES.GLASS_PANE_LAYER){if(O.id===rlTrackingListener.FORM_IDS.OPEN_LAYER){G=false}else{if(O.id===rlTrackingListener.FORM_IDS.CLOSE_LAYER){G=true}}}else{if(O.type===rlTrackingListener.TRACKING_TYPES.FORM_WIZARD){if(P&&G){if(O.id===rlTrackingListener.FORM_IDS.SWITCH_TO_WIZARD_STEP){A=1+O.info}if(O.id===rlTrackingListener.FORM_IDS.CLICK_HEADER_STEP||O.id===rlTrackingListener.FORM_IDS.CLICK_NEXT_BUTTON||O.id===rlTrackingListener.FORM_IDS.CLICK_BACK_BUTTON){B=1+O.info}}}}var N=M[O.id];if(!N&&P&&G){N=L[O.id]}return N}function J(){jq(window).bind(rlTrackingListener.EVENTS.EVENT_TRACKING_NOTIFICATION,function(R,S){var O=C(S),T,P,N,Q;if(O&&window.rlCoreServices&&window.rlCoreServices.trackEventAsClick){if(O instanceof Array){N=O}else{N=[];N[0]=O}for(Q=0;Q<N.length;Q+=1){T=N[Q].buildId(S);P=N[Q].buildName(S);if(T&&P){F("fire track event: id=",T,", name=",P);window.rlCoreServices.trackEventAsClick(T,P)}else{F("cannot fire track event, missing values: id=",T,", name=",P)}}}})}return{__init__:function(){M.salesBar_topLine={buildId:function(O){return"ctxlOpenByClick_default-infoIconLayer-salesbarDeliveryPeriod"},buildName:function(O){return"ctxlAction"}};M.salesBarButtonESP=[{buildId:function(O){return"button/EnterESP_"+O.info+"@salesbar"},buildName:function(O){return"CustomEvent:click/button"}},{step:undefined,getStepFromBasket:function(){var O;if(this.step){return this.step}O=rlEspBasket.getCurrentInstance().getState();if(O.name==="STATE_STEP_2"){this.step=2}else{if(O.name==="STATE_STEP_3"){this.step=3}else{if(O.name==="STATE_STEP_4"){this.step=4}else{this.step=1}}}return this.step},buildId:function(O){if(O.info==="Resume"){return"process/ESP/open/step="+this.getStepFromBasket()+"/return/source=ncc"}return undefined},buildName:function(O){if(O.info==="Resume"){return"CustomEvent:process/return"}return undefined}}];M.formEspOverviewLayer={buildId:function(O){if(!E()){if(O.info==="Open"){return"process/ESP/open/step=0"}if(O.info==="Init"){return"button/StartESP@process/ESP/open/step=0"}}return undefined},buildName:function(O){if(!E()){if(O.info==="Open"){return"CustomEvent:process/start"}if(O.info==="Init"){return"CustomEvent:click/button"}}return undefined}};M.closeLayer={buildId:function(Q){if(!E()){if(Q.listenerData&&Q.listenerData.trackingHistory&&Q.listenerData.trackingHistory.length>2){var O=Q.listenerData.trackingHistory[Q.listenerData.trackingHistory.length-2];var P=Q.listenerData.trackingHistory[Q.listenerData.trackingHistory.length-3];if(O&&P&&O.id===rlTrackingListener.FORM_IDS.OPEN_LAYER&&P.id===rlTrackingListener.FORM_IDS.FORM_ESP_OVERVIEW_LAYER){return"process/ESP/cancel/step=0"}}}return undefined},buildName:function(Q){if(!E()){if(Q.listenerData&&Q.listenerData.trackingHistory&&Q.listenerData.trackingHistory.length>2){var O=Q.listenerData.trackingHistory[Q.listenerData.trackingHistory.length-2];var P=Q.listenerData.trackingHistory[Q.listenerData.trackingHistory.length-3];if(O&&P&&O.id===rlTrackingListener.FORM_IDS.OPEN_LAYER&&P.id===rlTrackingListener.FORM_IDS.FORM_ESP_OVERVIEW_LAYER){return"CustomEvent:process/cancel"}}}return undefined}};M.espConfirmationSaveConfigVehicleButton={buildId:function(O){return"button/ESPFinish_SaveConfig@process/ESP/open/step=finish"},buildName:function(O){return"CustomEvent:click/button"}};M.espConfirmationViewConfigVehicleButton={buildId:function(O){return"button/ESPFinish_ViewConfig@process/ESP/open/step=finish"},buildName:function(O){return"CustomEvent:click/button"}};M.myconfigSaveConfirmGotoMyBmw=[{buildId:function(){return"button/SaveConfig_GoToMyBMW@process/ESP/open/step=finish"},buildName:function(){return"CustomEvent:click/button"}},{buildId:function(){return"process/ESP/cancel/step=finish"},buildName:function(){return"CustomEvent:process/cancel"}}];M.espShareConfigurationTellAFriend={buildId:function(O){return"link/ESPFinish_Share@process/ESP/open/step=finish"},buildName:function(O){return"CustomEvent:click/link"}};M.espPdfPrintSummaryButton={buildId:function(P){var O=K()!==undefined?K():"finish";return"link/esp_overview_pdf_download@process/ESP/open/step="+O},buildName:function(O){return"CustomEvent:click/link"}};M.formEspCancelLayer={buildId:function(O){if(O&&O.info==="aboutCancel"){return"process/ESP/open/step=cancel"}if(O&&O.info==="cancelPurchase"){return"button/ESP_CancelLayer_Cancel@process/ESP/open/step="+K()}if(O&&O.info==="saveConfiguration"){return"button/ESP_CancelLayer_SaveConfig@process/ESP/open/step="+K()}if(O&&O.info==="continueWithPurchase"){return"button/ESP_CancelLayer_ContinueWithPurchase@process/ESP/open/step="+K()}return undefined},buildName:function(O){if(O&&O.info==="aboutCancel"){return"CustomEvent:process/stepping"}if(O&&(O.info==="cancelPurchase"||O.info==="saveConfiguration"||O.info==="continueWithPurchase")){return"CustomEvent:click/button"}return undefined}};M.formEspError=[{buildId:function(O){return"process/ESP/open/step=error"},buildName:function(O){return"CustomEvent:process/stepping"}},{buildId:function(O){return"error/"+O.info+"@process/ESP/open/step="+K()},buildName:function(O){return"CustomEvent:error/shown"}}];M[rlTrackingListener.PAGE_IDS.PAGE_ESP_CONFIRMATION]={buildId:function(O){return"process/ESP/open/step=finish"},buildName:function(O){return"CustomEvent:process/finish"}};L.formReady={buildId:function(O){if(K()===1&&O.info===D){return"process/ESP/open/step=1"}return undefined},buildName:function(O){if(K()===1){return"CustomEvent:process/stepping"}return undefined}};L.espInfolayerPolicy={buildId:function(O){return"link/ShowPolicyInfo@process/ESP/open/step="+K()},buildName:function(O){return"CustomEvent:click/link"}};L.clickHeaderStep={buildId:function(O){return"link/ESP_Navigate_"+I()+"@process/ESP/open/step="+K()},buildName:function(O){return"CustomEvent:click/link"}};L.showProcessLinkContainer={buildId:function(O){return"link/ESP_SalesProcessOverview@process/ESP/open/step="+K()},buildName:function(O){return"CustomEvent:click/link"}};L.cartBoxLinkToNCC={buildId:function(){return"link/JumpToNcc@process/ESP/open/step="+K()},buildName:function(){return"CustomEvent:click/link"}};L.cartBoxLinkPriceDisclaimerOpen={buildId:function(){return"process/ESP/open/step=disclaimer"},buildName:function(O){return"CustomEvent:process/stepping"}};M.cartBoxLinkPriceDisclaimerLinkToNCC={buildId:function(){return"process/ESP/leave/target=ncc/from/step=disclaimer"},buildName:function(){return"CustomEvent:process/leave"}};L.cartBoxEntryInfoIcon={buildId:function(O){return"ctxlOpenByClick_default-infoIconLayer-esp"+O.info},buildName:function(O){return"ctxlAction"}};L.esp_cartBox={buildId:function(O){return"ctxlOpenByClick_default-infoIconLayer-espDeliveryPeriod"},buildName:function(O){return"ctxlAction"}};L.clickNextButton={buildId:function(O){if(O.type===rlTrackingListener.TRACKING_TYPES.FORM_WIZARD){if(K()===3){return N()}else{return"link/next@process/ESP/open/step="+K()}}else{return null}},buildName:function(O){if(K()===3){return"CustomEvent:rawdata/json"}else{return"CustomEvent:click/link"}}};function N(){var O={};O.espFinanceType=rlEspFinanceCalculatorFS.getCurrentSelection();if(O.espFinanceType===rlEspFinanceCalculatorFS.FINANCE_TYPES.LEASING){O.financeSection=rlNccEspApp.getCurrentConfiguration().financeSection}return"rawdata/json/ESPFP/"+JSON.stringify(O)}L.clickBackButton={buildId:function(O){if(O.type===rlTrackingListener.TRACKING_TYPES.FORM_WIZARD){return"link/back@process/ESP/open/step="+K()}else{return null}},buildName:function(O){return"CustomEvent:click/link"}};L.espAsGuest={buildId:function(O){return"button/ContinueWithoutRegister@process/ESP/open/step="+K()},buildName:function(O){return"CustomEvent:click/button"}};L.vehicleProfileShowCarDetails={buildId:function(O){return"link/showDetails@process/ESP/open/step="+K()},buildName:function(O){return"CustomEvent:click/link"}};L.vehicleProfileHideCarDetails={buildId:function(O){return"link/hideDetails@process/ESP/open/step="+K()},buildName:function(O){return"CustomEvent:click/link"}};L.nccFinancingProductSelector={buildId:function(O){return"radio/ESP_financeproduct/"+O.info+"@process/ESP/open/step="+K()},buildName:function(O){return"CustomEvent:click/radio"}};L.textAreaFS={buildId:function(O){if(K()==2){return"textfield/dealercomment@process/ESP/open/step="+K()}else{return null}},buildName:function(O){return"CustomEvent:edit/textfield"}};L.wallboxFS={buildId:function(P){var O=P.info==="true"?"checked":"unchecked";return"checkbox/wallbox/"+O+"@process/ESP/open/step="+K()},buildName:function(O){return"CustomEvent:click/radio"}};L.espFinanceType={buildId:function(O){return"radio/ESP_financetype/"+O.info+"@process/ESP/open/step="+K()},buildName:function(O){return"CustomEvent:click/radio"}};L.espSpecialCustomerCheckBox={buildId:function(O){return"checkbox/SpecialCustomer/"+O.info+"@process/ESP/open/step="+K()},buildName:function(O){return"CustomEvent:click/checkbox"}};J()},getCurrentEspStep:function(){return K()},__start__:function(){}}}());var rlExtendedSearchForm=function(){var A,D;var F=new Array();var H=new Array();var E=new Array();var B=new Array();var C=new Array();var G=new Array();return{__start__:function(){jq(".extendedSearchInputField").keyup(function(N){if(N.which==13){go2result()}else{function J(R,P){newStringPart=jq.trim(R[P]);if(P%2==1&&P+1<R.length){newStringPart=newStringPart.replace(/ +/g,"|||");newStringPart=newStringPart+'" '}else{if(P+1<R.length){var Q=R[P].length;if((P+2==R.length)&&(R[P].substring(Q-1,Q)!=" ")){newStringPart=newStringPart+'"'}else{newStringPart=newStringPart+' "'}}}return newStringPart}function M(P,Q){var U;var T="";if(Q=="oq"){U=" OR "}else{if(Q=="eq"){U=" -";T="-"}else{return""}}var V=P.split('"');var S;P="";for(var R=0;R<V.length;R++){P+=J(V,R)}P=jq.trim(P);P=P.replace(/ +/g,U);P=P.replace(/\|\|\|/g," ");return T+P}var I,O,K,L;extendedSearch=I=O=K=L="";I=jq("#extendedSearch_as_q").val();I=jq.trim(I);if(I!=""){I=I.replace(/ +/g," ");extendedSearch=I}O=jq("#extendedSearch_as_epq").val();O=jq.trim(O);if(O!=""){O=O.replace(/ +/g," ");O=O.replace(/\"/g,"");extendedSearch=(extendedSearch+' "'+jq.trim(O)+'"');extendedSearch=jq.trim(extendedSearch)}K=jq("#extendedSearch_as_oq").val();K=jq.trim(K);if(K!=""){K=M(K,"oq");extendedSearch=(extendedSearch+" "+K);extendedSearch=jq.trim(extendedSearch)}L=jq("#extendedSearch_as_eq").val();L=jq.trim(L);if(L!=""){L=M(" "+L,"eq");extendedSearch=(extendedSearch+" "+L);extendedSearch=jq.trim(extendedSearch)}jq("#extendedSearchGenFieldQuery").val(extendedSearch)}})},setSearchFields:function(I){E=[];C=[];B=[];H=[];I=I.replace(/([\S])["]([\S])/g,"$1 $2");var J=rlExtendedSearchForm.findExacts(I);for(i=0;i<J.length;i++){I=I.replace(jq.trim(J[i])," ");J[i]=jq.trim(J[i]);J[i]=J[i].substr(1,J[i].length-2);J[i]=jq.trim(J[i])}I=I.replace(/ OR /g,"-OR-");F=I.split(" ");tmpTokens=new Array();tLength=F.length;for(i=0;i<tLength;i++){currentToken=F.pop();if(currentToken.indexOf("-")==0){H.push(currentToken)}else{tmpTokens.push(currentToken)}}F=tmpTokens;tmpTokens=new Array();indexTokens=F.length;anyIndex=0;for(i=0;i<indexTokens;i++){currentToken=F.pop();if(currentToken.indexOf("-OR-")==-1){C.push(currentToken)}else{if(jq.trim(currentToken).length>0){tokenSplit=currentToken.split("-OR-");E[anyIndex]=tokenSplit}anyIndex++}}G.any=E;G.all=C;G.exact=B;G.without=H;withoutString="";for(i=G.without.length-1;i>=0;i--){withoutString=withoutString+G.without[i].substr(1)+" "}exactString=(G.exact+"").replace(/,/g," ");allString=(""+G.all).replace(/,/g," ");anyString="";for(i=0;i<G.any.length;i++){if(i==0){anyString=(""+G.any[i]).replace(/,/g," ")}else{allString=allString+(""+G.any[i]).replace(/,/g,"|")}}jq("#extendedSearch_as_epq").val(jq.trim(exactString));jq("#extendedSearch_as_eq").val(jq.trim(withoutString));jq("#extendedSearch_as_oq").val(jq.trim(anyString));jq("#extendedSearch_as_q").val(jq.trim(allString));jq(".extendedSearchInputField").trigger("keyup")},findExacts:function(J){var L=new Array();J=" "+J+" ";var K=/([\s]"[^"]*"[\s])/;var I=K.exec(J);if(I){L.push(I[0])}while(I){J=J.substring(J.indexOf('"')+I[0].length);K=/("[^"]*")/;I=K.exec(J);if(I){L.push(I[0])}}B=L;return L},__init__:function(){jq(document).ready(function(){jq("#extendedSearch_as_q").focus()});jq("#extendedSearchButton").click(function(){I(jq("#extendedSearchGenFieldQuery").val())});function I(J){location.href="#"+rlSearchUtil.encodeQueryParam(J,"extendedSearchGenFieldQuery");rlSearchUtil.go2result(J,A,"extendedSearchGenFieldQuery")}},registerAjaxHistory:function(){var I=location.hash;if(I==""){}else{rlExtendedSearchForm.preFillFormFields(I)}},setSearchPagePath:function(I){A=I},getHashFromUrl:function(){},preFillFormFields:function(J){var K,I;if(!J){if(window.location.hash&&window.location.hash!=""&&window.location.hash.length>1){K=window.location.hash.substring(1);I=jq.base64Decode(K)}}else{I=jq.base64Decode(J)}if(I){D=jq.secureEvalJSON(I).q;D=rlSearchUtil.getConvertedSearchStringBackward(D);rlExtendedSearchForm.setSearchFields(D)}}}}();var rlFormBase=function(){var A={FORM:"FORM",MAIL:"MAIL",PDF:"PDF"};function B(C,V){var L=CoreFormsBase.inheritanceFrom(CoreFormsBase.createBaseType());var W={};var E=false;L.typeName="rlFormBase";var F=rlFeedbackCollector.create(C);L.formEvents=rlCoreFormEvents.create(C,L);L.containerEvents=V.containerEvents;L.allEvents={names:L.containerEvents.names,subscribe:function(Z,b,a){L.formEvents.subscribe(Z,b,a);L.containerEvents.subscribe(Z,b,a)},unsubscribe:function(Z,b,a){L.formEvents.unsubscribe(Z,b,a);L.containerEvents.unsubscribe(Z,b,a)},trigger:function(Z){L.formEvents.trigger.apply(L.formEvents,arguments);L.containerEvents.trigger.apply(L.containerEvents,arguments)}};L.triggerEvent=function(Z){L.allEvents.trigger.apply(L.allEvents,arguments)};var X=rlFormWizard.create(L,C,L.formEvents);L.getCurrentWizardStep=function(){return X.getCurrentStep()};var O=rlValidatorEventsController.create(C,V);L.getFieldSetsById=function(){return W};L.getFieldSetById=function(Z){return W?W[Z]:undefined};L.isLoggedIn=function(){return V.isLoggedIn};L.isUseMock=function(){return E};L.setUseMock=function(Z){E=Z};L.getJqForm=function(){return C};var P;L.getSources=function(){if(typeof P==="undefined"){P=[];jq.each(W,function(a,Z){P=P.concat(Z.getDataSources())})}return P};L.canCopeWithDataSourceError=function(c){jq.each(W,function(e,d){d.onDataSourceUnavailable(c.dataSourceId)});var a=L.getSources();for(var b=0,Z=a.length;b<Z;b++){if(a[b].id===c.dataSourceId){return false}}return true};L.removeFieldsetById=function(Z){if(W[Z]){W[Z].hide();delete W[Z]}};L.setMetaData=function(Z){jq.each(W,function(b,a){a.setMetaData(Z)})};L.setData=function(Z){F.reset();jq.each(W,function(b,a){a.setData(Z)})};L.getEditedData=function(Z){Z=Z||{};window.lastEditedCoreFormData={};jq.each(W,function(d,c){c.getEditedData(Z)});try{Z.mailSummary=D()}catch(b){console.error("Error creating mail-summary: ");console.error(b)}if(Z&&Z.user&&Z.user.profile&&Z.user.profile.additionalFields){var a=[];jq.each(Z.user.profile.additionalFields,function(c,d){a.push({key:c,value:d})});Z.user.profile.additionalFields=a}return Z};function D(Z){return K(Z,A.MAIL,rlFormBase.mailSummaryElementTypes)}function U(Z){return G(K(Z,A.FORM,rlFormBase.formSummaryElementTypes))}function Y(Z){return K(Z,A.PDF,rlFormBase.pdfSummaryElementTypes)}function G(Z){if(Z&&jq.isArray(Z)){jq.each(Z,function(b,a){if(a&&a.hasOwnProperty("value")&&a.value){a.value=jq("<div></div>").text(a.value).html().replace(/'/g,"&#39;").replace(/"/g,"&quot;")}})}return Z}function K(c,e,f){c=c||[];var b={type:f.SPACER};var g=function(k){var j=undefined;switch(e){case A.FORM:j=k.getFormSummary;break;case A.MAIL:j=k.getMailSummary;break;case A.PDF:j=k.getPdfSummary;break;default:console.error("Unknown summary type: '"+e+"'");return c}return j.call(k,c,f)};jq.each(W,function(m,l){g&&g(l);var j=C.find("#"+m).parent().nextUntil(":not(.spacer)");for(var k=0;k<j.length;k++){c.push(b)}});function a(j){return c[j].type==f.HEADLINE}function Z(j){return c[j].type==f.JUMP_TO_STEP}var d;for(d=c.length-1;d>=0;d--){if(c[d].type===f.KEY_VALUE&&c[d].value==""){c.splice(d,1)}}for(d=c.length-1;d>=0;d--){if(!a(d)&&!Z(d)){break}c.splice(d,1)}for(d=c.length-2;d>=0;d--){if(a(d)&&Z(d+1)){c.splice(d,1)}}for(d=c.length-1;d>0;d--){if(a(d)&&a(d-1)){c.splice(d-1,1)}}for(d=c.length-1;d>0;d--){if(Z(d)&&Z(d-1)){c.splice(d-1,1)}}return c}L.getFormProperties=function(){var Z={};C.find(".formProperties").each(function(a,b){jq.each(b.attributes,function(e,c){var d=c.name.toLowerCase();if(d.indexOf("data-")>=0){Z[d.replace("data-","")]=c.value}})});return Z};function J(){L.allEvents.subscribe(L.allEvents.names.PING_FIELDSET_SUMMARY,function(Z){Z.trigger(L.allEvents.names.PONG_FIELDSET_SUMMARY,U())});L.allEvents.subscribe(L.allEvents.names.PING_FIELDSET_PDF_SUMMARY,function(Z){Z.trigger(L.allEvents.names.PONG_FIELDSET_PDF_SUMMARY,Y())});L.allEvents.subscribe(L.allEvents.names.WIZARD_STEP_DID_CHANGE,function(Z){L.onWizardStepChanged()});L.formEvents.subscribe(L.formEvents.names.FIELDSET_REMOVED_ITSELF,function(Z){X.removeEmptyWizardSteps()});if(!L.isInCqEditMode()){L.allEvents.subscribe(L.allEvents.names.FIX_DOUBLED_STRUCTURE_ELEMENTS,function(Z){C.find(".hiddenByRemovedFS").removeClass("hiddenByRemovedFS");var a=C.find("fieldset:visible").filter(function(){return jq(this).css("opacity")==="1"});a=jq(a).parent();jq.each(a,function(c,e){var b=a[c+1];var d=a[c+2];if(jq(e).is(".headlineFS")&&isDefined(b)&&jq(b).is(".separatorFS, .headlineFS")){jq(e).addClass("hiddenByRemovedFS")}else{if(jq(e).is(".headlineFS, .separatorFS")&&isUndefined(b)){jq(e).addClass("hiddenByRemovedFS")}else{if(jq(e).is(".separatorFS")&&isDefined(b)&&jq(b).is(".separatorFS")){jq(e).addClass("hiddenByRemovedFS")}else{if(jq(e).is(".separatorFS")&&isDefined(b)&&isDefined(d)&&jq(b).is(".headlineFS")&&jq(d).is(".separatorFS")){jq(e).addClass("hiddenByRemovedFS");jq(b).addClass("hiddenByRemovedFS")}}}}})})}}L.getFormAuthorValidationRules=function(){return[]};L.authorValidate=function(){var a=[].concat(L.getFormAuthorValidationRules());jq.each(W,function(d,c){a=a.concat(c.getAuthorValidationRules())});for(var b=0,Z=a.length;b<Z;b++){a[b].validate(W)}};L.validate=function(){var Z=true;jq.each(W,function(b,a){a.validate()});if(F.hasErrorFeedback()){F.showFormFeedback();Z=false}return Z};function H(){var Z=true;jq.each(W,function(b,a){if(!a.isLiveValidationDone()){Z=false;return false}return true});return Z}L.waitForLiveValidation=function(c){var Z=10000;var b=0;var a=function(){var d=H();if(!d&&b<Z){b+=100;setTimeout(a,100)}else{if(typeof (c)!="undefined"){c(d)}}};setTimeout(a,100)};L.resetValidationMessages=function(){F.clearFormFeedback()};function S(c){var d=L.getUseCaseMetaDataRoot();if(d){var b=d+".";for(var a=0;a<c.length;a++){var e=c[a].fieldName;if(e&&e.indexOf(b)===0){var Z=e.split(".");Z.shift();c[a].fieldName=Z.join(".")}}}}L.showBackendMessages=function(Z){S(Z);jq.each(W,function(b,a){a.onBackendMessage(Z)});F.addFeedback(Z);F.showFormFeedback()};L.getFeedbackCollector=function(){return F};function I(){var Z=C.find("fieldset").last().parent("div");Z.after('<div class="fieldSetValidationFeedback fieldSetValidationMessage gcdmValidationPlacement" data-validationplacements="UM_METADATA_VIOLATION" style="display: none"></div>')}L.isInCqEditMode=function(){return(rlPage.isEditMode()||rlPage.isDesignMode())};function R(){if(L.isInCqEditMode()){C.addClass("cqEditMode")}}L.tracking={};L.tracking.prepareBufferedWebTrackingEvents=function(){try{var Z=window.lastEditedCoreFormData;if(!window.rlCoreServices||!window.rlCoreServices.bufferEventAsClick||typeof Z==="undefined"){return }for(var c in Z){if(Z.hasOwnProperty(c)){if(typeof (Z[c])!="object"){window.rlCoreServices.bufferEventAsClick("frmdataChange/"+c+"/CHANGED","frmdataSubmitChanges","BufferForSubmittedFormFieldChanges")}else{for(var a in Z[c]){if(Z[c].hasOwnProperty(a)){if(Z[c][a].name&&Z[c][a].action){window.rlCoreServices.bufferEventAsClick("frmdataChange/"+c+"/"+Z[c][a].name+"/"+Z[c][a].action,"frmdataSubmitChanges","BufferForSubmittedFormFieldChanges")}else{window.rlCoreServices.bufferEventAsClick("frmdataChange/"+c+"/"+a+"/"+Z[c][a],"frmdataSubmitChanges","BufferForSubmittedFormFieldChanges")}}}}}}}catch(b){console.log("Tracking of changedData failed. Exception: "+b)}};L.tracking.flushBufferedWebTrackingEvents=function(){if(window.rlCoreServices&&window.rlCoreServices.trackBufferedEvents){window.rlCoreServices.trackBufferedEvents("BufferForSubmittedFormFieldChanges")}};L.tracking.discardBufferedWebTrackingEvents=function(){if(window.rlCoreServices&&window.rlCoreServices.clearBufferedEvents){window.rlCoreServices.clearBufferedEvents("BufferForSubmittedFormFieldChanges")}};L.suspendEvent=function(Z){Z.preventDefault();Z.stopPropagation()};L.trackEvent=function(Z){if(typeof window.bmwcsacaptureEvent==="function"){window.bmwcsacaptureEvent(Z)}};L.hideDitherLayer=function(){if(rlGlassPaneLayerNext&&rlGlassPaneLayerNext.isOpen()){rlDither.off(jq(".gplnAjaxContent"))}else{rlDither.off(C)}};L.showDitherLayer=function(){if(rlGlassPaneLayerNext&&rlGlassPaneLayerNext.isOpen()){rlDither.on(jq(".gplnAjaxContent"))}else{rlDither.on(C)}};L.init=function(){};L.ready=function(){jq.each(W,function(a,Z){Z.onFormReady()});L.onReady();M()};L.onReady=function(){};L.closing=function(){jq.each(W,function(b,a){a.onFormClosing()});L.onClosing();var Z={formName:C.attr("data-jsModuleVar")};jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_LISTENER_NOTIFICATION,{id:"formClose",info:Z,type:rlTrackingListener.TRACKING_TYPES.FORM})};L.onClosing=function(){};L.getContext=function(){return"CREATE"};L.getUseCaseMetaDataRoot=function(){return"register"};function Q(Z){var a=Z.attr("data-jsModuleVar");if(a!=null){if(window[a]==null){throw ("Couldn't find instance for data-jsModuleVar="+a)}}return a==null?rlFormFieldSet:window[a]}L.determineFormSubBrand=function(){return C.attr("data-subbrand")};L.getFormType=function(){var Z="";if(typeof C.attr("data-rfxformtype")!="undefined"){Z=C.attr("data-rfxformtype")}return Z};L.onWizardStepChanged=function(){};function N(){var Z=V.subBrand||L.determineFormSubBrand();var a=L.getFormType();C.find("fieldSet").each(function(c,e){var b=jq(e);var f={};var d=b.attr("id");f.fsId=d;f.isLoggedIn=V.isLoggedIn;f.feedbackCollector=F;f.useInputCache=V.useInputCache;f.allEvents=L.allEvents;f.validatorEventsController=O;f.formEvents=L.formEvents;f.containerEvents=L.containerEvents;f.subBrand=Z;f.formType=a;f.isInCqEditMode=L.isInCqEditMode;if(W[d]==null){W[d]=Q(b).createFS(b,f);W[d].preInit();console.log("Registered field set: "+d)}else{throw ("Attempted to register duplicate field set: "+d)}});if(rlPage.isEditMode()){L.authorValidate()}jq.each(W,function(c,b){b.init();console.log("Initialised field set: "+c)})}function T(){C.find("input,select,textarea").each(function(Z,a){a=jq(a);if(a.attr("name")==null){a.attr("name",a.attr("id"))}})}function M(){var Z=function(b){var a=b.target;if(jq(a).is("label")){b.stopPropagation();return false}if(jq(a).is("input")||jq(a).is("textarea")||jq(a).is("select")){jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_LISTENER_NOTIFICATION,{id:rlTrackingListener.FORM_IDS.FORM_INITIAL_CLICK,info:L.typeName,type:rlTrackingListener.TRACKING_TYPES.FORM});jq(this).unbind(b)}};C.bind("click",Z)}console.log("Creating form: "+V.formId);X.prepareWizardSteps();I();J();N();T();R();return L}return{__init__:function(){},__start__:function(){},mailSummaryElementTypes:{HEADLINE:"Headline",KEY_VALUE:"KeyValue",SPACER:"Spacer",LABEL:"Label"},formSummaryElementTypes:{HEADLINE:"Headline",KEY_VALUE:"KeyValue",SPACER:"Spacer",LABEL:"Label",HTML:"Html",JUMP_TO_STEP:"JumpToStep"},pdfSummaryElementTypes:{KEY_VALUE:"KeyValue",LABEL:"Label"},create:function(C,D){D=jq.extend({},D);D.useInputCache=(C.attr("data-useinputcache")==="yes");return B(C,D)},getFieldSetById:function(C,G,D){var F=rlFormsContainer.getFormsContainerById(C);var E=F?F.getFormById(G):undefined;return E?E.getFieldSetById(D):undefined}}}();var rlFormWizard=function(){function A(Z,O,X){var J="div.multiStepLineFS fieldset";var g=4;var d="Single Page Form";var W=0,e=0;var B=false;var T=false;var K={};var m=rlBrowser.getInternetExplorerVersion();function L(){return K.useWizardSteps?W:d}function U(){return O.parent()}function E(){return O.parents(".formsContainer:first")}function C(){var p=O.parents(".glassPaneLayer").length>0;if(K.noglasspaneLayer){p=false}var o;if(p){o=O.parents(".glassPaneLayer:first")}else{o=E()}return o.find(".wizardtabs")}function M(){R();if(rlPage.isEditMode()||rlPage.isDesignMode()){return }a();var p=E();var u=p.find("div.formBaseParameters");K.labelNext=u.attr("data-labelnext");K.labelBack=u.attr("data-labelback");K.useWizardSteps=(u.attr("data-usewizardsteps")==="true");var s=p.find("div.summaryFsParameters");K.useLongFormSummary=(!K.useWizardSteps)&&(s.attr("data-uselongformsummary")==="true");var o=U().find(J);if(!K.useLongFormSummary){if(!K.useWizardSteps){return }else{if(o.length<=1){return }else{if(O.attr("data-supportswizardsteps")!=="yes"){return }else{if(window.location.href.indexOf("nowizards")>=0){return }}}}}if(K.useLongFormSummary){var r="<div class='multiStepLineFS'><fieldset id='multiStepLineFsDummy_{ID}'></fieldset></div>";p.find("div.multiStepLineFS").remove();var q=O.find(".fieldsetcontainer .fieldsets");switch(q.length){case 0:console.error("Cannot find fieldset containers for summary in long form.");break;case 1:q.prepend(jq(r.replace(/_\{ID}/g,"01")));break;default:console.error("Found too many ("+q.length+") fieldset containers for summary in long form.")}var t=q.find(".formSummaryFS");switch(t.length){case 0:console.error("Cannot find formSummaryFS for summary in long form.");break;case 1:t.before(jq(r.replace(/_\{ID}/g,"02")));break;default:console.error("Found too many ("+t.length+") formSummaryFS for summary in long form.")}}if(o.length>g){j("ERROR: Cannot add more than four wizard steps to a form.");return }else{if(!N(jq(O.find("fieldset").get(0)))){j("ERROR: First fieldset in a wizard form MUST be a multi-step line.");return }}if(U().find(".formHeader").length===0){throw ("Wizard initialisation: cannot find DOM element for form header.")}try{P();Y();n();if(O.attr("data-ensurewizardvisible")==="yes"){k()}if(O.attr("data-noglasspanelayer")==="true"){K.noglasspaneLayer=true}if(K.useLongFormSummary){C().hide()}S(0)}catch(v){console.error(v)}}function R(){if(rlPage.isEditMode()||rlPage.isDesignMode()||rlPage.isPreviewMode()){var p=function(){return(document.cookie.indexOf("wcmmode=preview")>=0)?"PREVIEW":"EDIT"};var q=p();var o=window.setInterval(function(){if(q!==p()){window.clearInterval(o);window.location.reload()}},1000)}}function j(o){if(rlPage.isPreviewMode()){O.html("<div style='color: red'>"+o+"</div>")}}function k(){var p=E();var o=p.offset().top-10;jq(window).scroll(function(){var q=C();var r=parseInt(q.outerHeight(true)+1);if(jq(window).scrollTop()>=o){p.addClass("formWizardFixed");O.css("padding-top",r+"px")}else{p.removeClass("formWizardFixed");O.css("padding-top","0px")}})}function P(){var o=O.find(".fieldsetcontainer");if(o.length===0){throw ("Cannot find fieldset container for wizard initialisation.")}var q=jq("<div class='fieldsetcontainer'></div>");var p;var r=function(s){p=jq("<div class='wizardStep'></div>");p.attr("data-steptitle",s);p.attr("data-stepindex",e++);q.append(p);return p};o.find("fieldset").each(function(t,s){s=jq(s);if(Q(s)){return true}if(N(s)){p=r(s.find("label").first().text());s.find(".multiStepLineContainer").attr("data-step",p.attr("data-stepindex"));s.parent().appendTo(p).hide()}else{if(c(s)){s.parent(".compoundFieldSetClip").parent().appendTo(p)}else{s.parent().appendTo(p)}}});o.after(q);o.remove()}function Y(){var p=U().find(".formHeader");if(p.length===0){throw ("Wizard initialisation: cannot find fieldset tab container.")}var q=jq("<div class='wizardtabs'></div>");q.appendTo(p);var o=0;O.find(".wizardStep").each(function(r,t){t=jq(t);o++;var s=jq("<div class='wizardStepTab step"+(o-1)+"'></div>");s.attr("data-stepindex",o-1);s.append(jq("<div class='wizardStepNumber headlineh1'>"+o+"</div>"));s.append(jq("<div class='wizardStepTitle headlineh4'>"+t.attr("data-steptitle")+"</div>"));s.appendTo(q)});p.addClass("formHeaderInWizard");if(jq("#gplnContentHeader").length>0){jq("#gplnContentHeader .space").append(p.clone());jq("#gplnContentHeader").addClass("gplnHeaderLine");p.remove()}C().find(".wizardStepTab").unbind().click(function(){var r=jq(this);if(r.hasClass("clickable")){var s=parseInt(r.attr("data-stepindex"),10);I(s);S(s)}});window.setTimeout(function(){var r=90;C().find(".wizardStepTab").each(function(s){if(jq(this).width()>r){r=Math.min(135,jq(this).width())}});C().find(".wizardStepTab").css("width",r+"px")},0)}function n(){var o=U().find(".formButtonBar");if(o.length===0){throw ("Wizard initialisation: cannot find button bar.")}var q=o.find("a");q.hide();var p=jq("<a>"+K.labelBack+"</a>");p.addClass("wizardBack buttonComp");p.attr("href","javascript:void(0)");q.first().after(p);p.click(function(){F(W-1);S(W-1)});var r=jq("<a class='wizardNextButton'>"+K.labelNext+"</a>");r.addClass("wizardNext buttonComp buttonBlue");r.attr("href","javascript:void(0)");q.first().after(r);r.click(function(){f()})}function V(q,p,o){if(o){q.addClass("clickable")}q.children(".wizardStepTitle").animate({color:p},200);q.children(".wizardStepNumber").animate({color:p},200)}function f(){var o=O.parents(".formBase");if(o.length<1){o=O}else{if(o.length>1){o=jq(o[0])}}rlDither.on(o);Z.waitForLiveValidation(function(){Z.resetValidationMessages();rlDither.off(o);Z.validate();if(O.find(".wizardStep.active .fieldSetIsShowingValidationMessage.fieldSetHasError").length==0){l(W+1);S(W+1)}})}function H(o){jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_LISTENER_NOTIFICATION,{id:"switchToWizardStep",info:o,type:rlTrackingListener.TRACKING_TYPES.FORM_WIZARD})}function l(o){jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_LISTENER_NOTIFICATION,{id:"clickNextButton",info:o,type:rlTrackingListener.TRACKING_TYPES.FORM_WIZARD})}function I(o){jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_LISTENER_NOTIFICATION,{id:"clickHeaderStep",info:o,type:rlTrackingListener.TRACKING_TYPES.FORM_WIZARD})}function F(o){jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_LISTENER_NOTIFICATION,{id:"clickBackButton",info:o,type:rlTrackingListener.TRACKING_TYPES.FORM_WIZARD})}function S(s){if(T){return }T=true;H(s);if(window.bmwGlassPaneUrl){window.bmwGlassPaneUrl=G(window.bmwGlassPaneUrl,s)}var v=jq(O.find(".wizardStep").get(W));var x=jq(O.find(".wizardStep").get(s));var o=jq("#gplnAjaxContent").outerHeight();var r=x.outerHeight();var t=r+jq("#gplnContentHeader").outerHeight(true)+jq(".formButtonBar").outerHeight(true)+jq("#gplnContentFooter").outerHeight(true);var u=O.parent().find(".formFootnote");if(B&&u.length>0){if(u.height()>0){u.css("opacity","0")}}if(u.height()>0){t+=u.height()-parseInt(u.css("padding-bottom"))-parseInt(u.css("padding-top"))+1}var p=jq(window).height()-60;if(t>p){t=p}var q=U().find(".formButtonBar");q.css("opacity","0");q.find("a").hide();if(B){v.css("opacity","0");jq("#gplnContentValue").css("overflow-y","hidden");var w=function(){X.trigger(X.names.WIZARD_STEP_WILL_CHANGE,W,s,e);v.removeClass("active");x.addClass("active");X.trigger(X.names.FIX_DOUBLED_STRUCTURE_ELEMENTS);rlGlassPaneLayerNext&&rlGlassPaneLayerNext.isOpen()&&rlGlassPaneLayerNext.layerSizeToWindowSize();q.animate({opacity:1},400,function(){if(m>0&&m<9){jq(this).css("filter","none")}});if(u.height()>0){u.animate({opacity:1},400,function(){if(m>0&&m<9){jq(this).css("filter","none")}})}x.animate({opacity:1},400,function(){if(m>0&&m<9){jq(this).css("filter","none")}T=false;var z=W;W=s;if(O.attr("data-focusonfirstinputfield")==="true"){x.find("input[type=text],textarea,select,input[type=checkbox],input[type=radio]").filter(":visible:first").focus()}jq("#gplnContentValue").css("overflow-y","auto");X.trigger(X.names.WIZARD_STEP_DID_CHANGE,z,W)})};var y=jq("#gplnAjaxContent");if(y.length==0){w()}else{y.animate({height:t+"px"},400,function(){w()})}}else{if(y){y.css("height",o+"px")}x.animate({opacity:1},0,function(){if(m>0&&m<9){jq(this).css("filter","none")}x.addClass("active");q.css("opacity","1");B=true;T=false;x.children("input:first-child").focus()})}C().find(".wizardStepTab").removeClass("clickable");C().find(".wizardStepTab").each(function(z,AA){if(z<s){V(jq(AA),"#666",true)}else{if(z==s){V(jq(AA),"#1c69d4")}else{if(z>s){V(jq(AA),"#bbb")}}}});if(s==0){C().find(".wizardStepTab").each(function(z,AA){if(z==0){V(jq(AA),"#1c69d4")}else{V(jq(AA),"#bbb")}});q.find(".wizardNext").show()}else{if(s==e-1){q.find("a").not(".wizardNext").show()}else{q.find(".wizardNext").show();q.find(".wizardBack").show()}}if(O.parents(".glassPaneLayer").length===0){jq("html, body").animate({scrollTop:jq("body").offset().top},0)}}function D(){var o=0;O.find(".wizardStep").each(function(u,v){v=jq(v);if(v.find("[data-field]").length===0){var w=v.attr("data-stepindex");C().find(".wizardStepTab[data-stepindex="+w+"]").remove();v.remove();++o}});if(o>0){var p=O.find(".wizardStep");for(var r=0;r<p.length;r++){var s=jq(p.get(r));var q=s.attr("data-stepindex");var t=jq(".wizardStepTab[data-stepindex="+q+"]");s.attr("data-stepindex",r);t.attr("data-stepindex",r);t.find(".wizardStepNumber").text(r+1)}}if(o>0){e-=o;S(0)}}function c(o){return(o.attr("data-isCompoundFieldSet")=="true")}function Q(o){var p=false;if(!c(o)&&o.parents(".compoundFieldSetClip").length>0){p=true}return p}function N(o){return o.parent().hasClass("multiStepLineFS")}function a(){O.find(J).hide()}function b(){X.subscribe(X.names.WIZARD_STEP_REQUEST_JUMP,function(o,p){S(p)})}function G(q,p){var o=p+1;var r;if(q.indexOf("?")>-1){if(q.indexOf("pagenumber=")>-1){r=q.substr(0,q.indexOf("pagenumber=")+11)+o}else{r=q+"&state=stepping&pagenumber="+o}}else{r=q+"?state=stepping&pagenumber="+o}return r}b();return{prepareWizardSteps:function(){return M()},removeEmptyWizardSteps:function(){D()},getCurrentStep:function(){return L()}}}return{__init__:function(){},__start__:function(){},create:function(D,C,B){return A(D,C,B)}}}();var rlHobbiesSet=function(){var G=["hobbies"];var M="";var D={};var A={getListAreaId:function(){return M},clickedElem:"undefined",formHeader:"undefined",listEditArea:{initFields:function(N){}},bindEvents:function(){bindEvents()},isValid:function(){return jq("#"+M+"form").valid()}};function B(){return G}function J(O,N){D.loadList(O,new DefaultEnumModel(N));isListsLoaded=true}function I(N,O){D.setData("hobbies",O.interestKeys,undefined,M)}function L(Q,O,N){var P=D.getData(G,Q,M);if(P){Q.interestKeys=P.hobbies}delete Q.hobbies;return Q}function F(O,N){D.setData("hobbies",N.interestKeys,undefined,M)}function E(O,N){return rlAbstractFormFieldSet.onError(O,N)}function C(N){jq.each(G,function(P,O){D.setData(O,"",undefined,M)})}function H(P,O){var N=O||{};var Q=L(jq.extend({},N),P);var R=rlAbstractFormFieldSet.getDiffs(G,N,Q);return R}function K(){var N={name:"hobbiesSet",coreId:["hobby"],getFieldsNames:B,setDataFromCache:function(O){I("hobbies",O)},callbackLoadedList:J,callbackLoadedData:I,callbackBeforeSaveData:L,callbackAfterSaveData:F,callbackError:E,callbackClearData:C,getDiffs:H,requestType:"interests"};rlAbstractForm.registerComponent(N)}return{__init__:function(){console.log("hobbiesSetComponent::__init__")},__start__:function(){console.log("hobbiesSetComponent::__start__")},registerComponent:function(){K()},initForm:function(S,R,O){D=new CheckboxTableFieldHandler();D.setNumberOfColumns(O);var N=rlPage.isEditMode()||rlPage.isDesignMode();if(!N){M=S;var Q="#"+M;rlAbstractFormFieldSet.initDefaultActions(A);var P=jq("#"+A.getListAreaId()+"form").closest("form");P.bmwValidate("addErrorPlacements",A.errorPlacements);P.bmwValidate("modifyValidationMessages",R);jq.extend(jq.validator.messages,{required:function(){return jq(Q+"RequiredFieldLabel").html()}})}}}}();var rlIframeRaw=function(){function B(D){if(typeof D.height!="undefined"){if(typeof D.xssEnablerTarget=="undefined"){jq(".iframeContainerWrap iframe").first().css("height",D.height)}else{jq("#"+D.xssEnablerTarget).find("iframe").css("height",D.height)}if(typeof rlGlassPaneLayerNext=="object"&&rlGlassPaneLayerNext.isOpen()==true){rlGlassPaneLayerNext.layerSizeToWindowSize()}}if(typeof D.scroll=="string"){D.scroll=0}if(typeof D.scroll=="number"){jq(window).scrollTop(D.scroll)}if(typeof D.reload!="undefined"){window.top.location.reload()}}function A(E){var F=E.url;var D="";var G=window.location.protocol+"//"+window.location.host+"/etc/designs/bmwnext/apps/bmwnext/base/static/xssEnabler.html";var I=window.location.search.substring(1);if(E.isAutoHeight===true){F+="="+G;D="iframeAutoheight"}if(E.isWhitelisted===true||rlCookieController.isRegulationThirdAccepted()){if(typeof E.height=="string"){jq("#"+E.componentId).css({"min-height":E.height+"px"})}}else{if(typeof E.fallbackPagePath=="string"){F=E.fallbackPagePath;F=C(F,"wcmmode=disabled");F+="#xssEnabler="+G+"?xssEnablerTarget="+E.componentId;D="iframeAutoheight";jq("#"+E.componentId).parents(".iframeContainer").addClass("iframeFallback")}}if(I!=""){F=C(F,I)}if((typeof (rlContextObject)!="undefined")&&F&&(F.indexOf("secure.bmw.com.cn")>-1)){var H=F.indexOf("?");if(H>-1){F+="&modelRange="+rlContextObject.getModelRangeId()}else{F+="?modelRange="+rlContextObject.getModelRangeId()}}jq("#"+E.componentId).empty();jq("<iframe/>").attr({src:F,"class":D,scrolling:E.scrolling,marginheight:0,marginwidth:0,frameborder:0}).appendTo("#"+E.componentId);if(E.height){jq("#"+E.componentId+" iframe").css({height:E.height+"px"})}if(jq(".glassPaneLayerContent .iframeContainer").length>0){window.setTimeout(function(){rlGlassPaneLayerNext.layerSizeToWindowSize()},1000);window.setTimeout(function(){rlGlassPaneLayerNext.layerSizeToWindowSize()},2000)}}function C(D,E){if(typeof E!=="string"){return D}result=D.split("#");if(result[0].indexOf("?")>-1){result[0]+="&"+E}else{result[0]+="?"+E}return result.join("#")}return{__init__:function(){},buildIframe:function(D){A(D)},resizeIframeHeight:function(D){B(D)}}}();var rlImplicitLoginFormDS=function(){function A(D){var B=CoreFormsBase.inheritanceFrom(rlBaseDataSource.createDS(D));var C=B.parent;B.typeName="rlImplicitLoginFormDS";B.getUserData=function(F,E){F({})};B.getMetaData=function(F,E){if(B.getUseMock()){F({implicitLogin:{canUse:false}})}else{rlCoreServices.canUseImplicitLogin({canUse:function(G){F({implicitLogin:{canUse:true}})},cannotUse:function(){F({implicitLogin:{canUse:false}})},error:E})}};return B}return{__init__:function(){},__start__:function(){},createDS:function(B){return A(B)}}}();var rlImpulseCallbackFS=function(){function A(B,I){var D=CoreFormsBase.inheritanceFrom(rlFormFieldSet.createFS(B,I));var F=D.parent;D.typeName="rlImpulseCallbackFS";function E(){B.find(".date_month, .date_year").change(function(){G(B)})}function H(J){var L=(new Date()).getFullYear();var K="<option value="+L+">"+L+"</option>";K+="<option value="+(L+1)+">"+(L+1)+"</option>";J.find(".date_year option").remove();J.find(".date_year").append(K)}function G(R){var J=R.find(".date_day");var P=R.find(".date_month");var Q=R.find(".date_year");var O=rlTime.getMaxDaysForMonth(P.val(),Q.val());if(O==undefined){return }var L=J.find("option");if(O>L.length){for(var M=L.length;M<O;M++){var N=(M<9?"0":"")+(M+1);J.append("<option value="+N+">"+N+"</option>")}}else{if(O<L.length){for(var K=L.length;K>O;K--){jq(J.find("option").get(K-1)).remove()}}}}function C(){var K=B.find("#"+I.fsId+"_day");var M=B.find("#"+I.fsId+"_month");var L=B.find("#"+I.fsId+"_year");var J=B.find("span.birthdaySel");if(rlFormatter.DATE_ENDIANNESS==="big"||rlFormatter.DATE_ENDIANNESS==="ymd"){K.remove();M.remove();L.remove();J.append(L);J.append(M);J.append(K)}else{if(rlFormatter.DATE_ENDIANNESS==="middle"||rlFormatter.DATE_ENDIANNESS==="mdy"){K.remove();M.remove();L.remove();J.append(M);J.append(K);J.append(L)}}}C();E();H(B);return D}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlImpulseCallbackForm=(function(){function A(F,I){var C=CoreFormsBase.inheritanceFrom(rlFormBase.create(F,I));var E=C.parent;var G=undefined;C.typeName="rlImpulseCallbackForm";var B=C.getFormProperties();function D(){if(!C.validate()){return }if(window.rlCoreServices&&window.rlCoreServices.trackEventAsClick){window.rlCoreServices.trackEventAsClick("impulseCallbackFormSubmitted","impulseCallbackFormAction")}var K=C.getEditedData();var J=jq("<iframe id='impulseiframe' name='impulseiframe' frameborder='0' width='650' height='115'></iframe>");J.load(function(){J.unbind().load(function(){jq(".impulseCallbackFormWrapper").hide();jq(".impulseCallbackResponseFrame").show()});var L=jq("<form action='"+B.impulsecallbackformaction+"' method='POST' target='impulseiframe'></form>");L.appendTo(".impulseCallbackResponseFrame");jq("<input type='HIDDEN' name='name' value='"+K.impulseCallback.name+"'>").appendTo(L);jq("<input type='HIDDEN' name='phoneLocalNumber' value='"+K.impulseCallback.phonenumber+"'>").appendTo(L);jq("<input type='HIDDEN' name='cbCallNow' value='"+K.impulseCallback.callNow+"'>").appendTo(L);jq("<input type='HIDDEN' name='day' value='"+K.impulseCallback.callbackDay+"'>").appendTo(L);jq("<input type='HIDDEN' name='month' value='"+K.impulseCallback.callbackMonth+"'>").appendTo(L);jq("<input type='HIDDEN' name='year' value='"+K.impulseCallback.callbackYear+"'>").appendTo(L);jq("<input type='HIDDEN' name='callAt' value='"+K.impulseCallback.callbackTime+"'>").appendTo(L);jq("<input type='HIDDEN' name='caller' value='jsp'>").appendTo(L);jq("<input type='HIDDEN' name='_danke_' value='"+B.impulsecallbackthankspage+"'>").appendTo(L);jq("<input type='HIDDEN' name='_fehler_' value='"+B.impulsecallbackerrorpage+"'>").appendTo(L);jq("<input type='HIDDEN' name='_geschaeftszeiten_' value='"+B.impulsecallbackbusinesshourspage+"'>").appendTo(L);jq("<input type='HIDDEN' name='_warteschlange_' value='"+B.impulsecallbackqueuepage+"'>").appendTo(L);L.submit()});jq(".impulseCallbackResponseFrame").prepend(J)}function H(){if(!rlPage.isEditMode()&&!rlPage.isDesignMode()){jq(".formSubmitButton").click(D)}}C.setData=function(J){E.setData(J);jq.each(C.getFieldSetsById(),function(L,K){K.switchToEditMode()})};H();return C}return{__init__:function(){},__start__:function(){},create:function(B,C){return A(B,C)}}}());var rlImpulsemessages=function(){var F=null;var S=null;var V=false;var N=30;var J=rlBrowser.getInternetExplorerVersion();var K="spriteIconPlusMedium";var L="spriteIconMinusMedium";function R(Y,W,X){if(Y){Y.removeClass(W);Y.addClass(X)}}function H(X){var W=Q(X);if(W){W.toggleClass("link13pxActive",C(X))}}function A(X){var W=E(X);R(W,K,L)}function B(X){var W=E(X);R(W,L,K)}function G(W){if(C(W)){A(W)}else{B(W)}}function M(X){V=true;var W=P(X);if(W){W.animate({height:"toggle",opacity:"toggle"},700,"linear",function(){V=false;if(J>0&&J<9){setTimeout(function(){jq(this).css("filter","")},300)}})}}function P(W){return W?W.find(".impulsemessageAccordionContent"):null}function E(W){return W?W.find(".impulsemessageAccordionOpenClose .baseIconSprite"):null}function C(W){return P(W).css("display")==="none"}function D(W){return W?W.find(".impulsemessageAccordionHeadline h3"):null}function I(X){if(!V){if(!X.hasClass("expanded")){var W=X.parents(".impulsemessageAccordionWrap").find(".impulsemessageAccordionItem.expanded");if(W.length>0){H(W);G(W);M(W);W.removeClass("expanded")}H(X);G(X);M(X);X.addClass("expanded")}}}function Q(W){return W?W.find(".impulsemessageAccordionHeadline"):null}function T(a,W){W-=3;a=jQuery.trim(a);if(a.length<=W){return a}var Z=a.split(/\s/);var X=Z[0];for(var Y=1;Y<Z.length;Y++){if(X.length+Z[Y].length+1>W){break}X+=" "+Z[Y]}if(X.length>W){X=X.substring(0,W)}return X+"..."}function U(Z,a){var W=jq("#impulsemessageAccordionWrap_"+a);if(W.length>0){if(!W.hasClass("isInitialized")){var X=jq(".impulsemessageAccordionItem",W);var Y=X.length;W.parents(".dashboardModule").addClass("total"+Y+"Messages");X.each(function(c,d){var e=jq(d);var b=e.find(".impulsemessageHeadline");b.text(T(b.text(),N));Q(e).click(function(){I(e)})});V=false;I(jq(X[0]));W.addClass("isInitialized")}}}function O(W){setTimeout(function(){filterValue=W.css("filter");if(filterValue&&filterValue!==""&&filterValue!=="auto"){W.css("filter","")}},700)}return{__init__:function(){},__start__:function(){},initComponent:function(W){F=W;jq("#"+F+" .invisibleImpulseMessage").animate({opacity:1},700,function(){V=false;if(J>0&&J<9){O(jq(this))}});jq("#"+F).find(".showAllLink").animate({opacity:1},700,function(){V=false;if(J>0&&J<9){O(jq(this))}});jq("#"+F).find("[data-vi-role]").bind("enableVI",function(X){jq("#impulsemessageAccordionWrap_"+F).find(".impulsemessageAccordionItem").each(function(Y,Z){if(Y>1){jq(Z).remove()}})});jq("#"+F).find(".showAllLink").css("margin-top","280px").css("opacity",0);rlVisualIdentifier.enableVisualIdentifiers();rlDashboardmodule.registerModule(W,this)},changeLoginStateCallback:function(W,X,Y){if(Y==true){U(W,X)}},showAllCallback:function(W,X){if(X===F){rlGlassPaneLayerNext.openDialog({content:".impulsemessageAccordionWrap .messageAreaContainer"})}}}}();var rlInfoMaterialDownloadFS=function(){var D={};var C=C||{};C.itemCssClass="infoMaterialBrochure";C.itemCssSelector="."+C.itemCssClass;C.itemRowCssClass="infoMaterialBrochureRow";C.itemRowCssSelector="."+C.itemRowCssClass;C.numAllowedItemsInRow=3;function A(E){if(E){var I=jq(".coreForm").attr("data-instantdownloadenabled")?"download":"formdownload";var H=rlEventTracker.create();var G=E.toLowerCase().indexOf("bmwi_")==0?"BI":"BM";H.trackCustomEvent("rfiBrochureDownload/"+I+"@"+G+"_"+E,"rfxAction");var F=D[E];if(F){jq("#infomaterialDownloadIFrame").attr("src",F)}}return false}function B(M,G){if(jq("#infomaterialDownloadIFrame").length==0){jq('<iframe id="infomaterialDownloadIFrame" style="display:none;"/>').appendTo("body")}var L=CoreFormsBase.inheritanceFrom(rlInfoMaterialFS.createFS(M,G));var K=L.parent;var J=M.parents(".coreForm").attr("data-instantdownloadenabled");L.typeName="rlInfoMaterialDownloadFS";L.isUnlimitedDownloadsEnabled=function(){return J};L.renderItem=function(S,R,T,Q){var P=jq("<div/>").addClass(C.itemCssClass).addClass("infoMaterialDownloadLayoutBox rfi_sel_"+S);P.append(jq("<img/>").attr("src",T===undefined?"":T).addClass("img_sel_"+S));if(J==="false"){E(S,R,T,Q)}P.append(jq("<span />").addClass("rfiRemoveBg").click(function(){L.removeInfomaterial(this)}));var O=jq('<a name="removeinfomateriallink" href="javascript:void(0);"/>').addClass("rfiRemoveBg linkArrow13px infoMaterialDownloadRemoveLink").html(L.getOptions().params.removeitemlabel);O.click(function(){L.removeItem(S);N(S)});if(J==="true"){P.append(jq("<div/>").addClass("infoDownloadLink infoMaterialDownloadFSBoxArea").append(jq("<div/>").addClass("downloadIcon medium icon_sel_"+S).append(jq("<div/>").addClass("baseIconSprite baseIconSizeMedium spriteIconDownloadMedium clickableIconDownloadMedium title_sel_"+S))).append(jq("<h4/>").addClass("infoMaterialDownloadH4 headlineh4 head_sel_"+S).html(R)).append(jq("<div/>").addClass("fieldSetLink infoMaterialDownloadFSTitleLabel").append(O)))}else{P.append(jq("<h4/>").addClass("infoMaterialDownloadH4 headlineh4").html(R));P.append(jq("<div/>").addClass("fieldSetLink").append(O))}M.find(L.getOptions().selectedBrochuresWrapperView).append(P.clone());P.css("display","none");P.append(jq("<input type='hidden'/>").addClass("infoMaterial").val(S));P.appendTo(H());if(J==="true"){I(S,Q,R);jq("div#.icon_sel_"+S).click(function(){A(S)});jq("h4#.head_sel_"+S).click(function(){A(S)});jq("img#.img_sel_"+S).click(function(){A(S)});jq("img#.img_sel_"+S).addClass("activateDownloadLinkForInfomaterialDownload");jq("h4#.head_sel_"+S).addClass("activateDownloadLinkForInfomaterialDownload");jq("div#.title_sel_"+S).attr("title",R)}rlRfxViewHelper.show(P,function(){jq(window).trigger(rlFormFieldSet.EVENT_FIELDSET_SIZE_CHANGED)})};function H(){var O=M.find(L.getOptions().selectedBrochuresWrapperEdit);var P=O.find(C.itemRowCssSelector);var Q=null;if(P.length>0){P.each(function(){var R=jq(this);var S=R.find(C.itemCssSelector).length;if(S<C.numAllowedItemsInRow){Q=R;return false}})}return Q||F(O)}function F(P){var O=jq("<div/>").addClass(C.itemRowCssClass).addClass("clearfix");O.appendTo(P);return O}function E(O,Q,S,P){var R='<div class="downloadLink clearfix">';R=R+"<a href=\"javascript:rlInfoMaterialDownloadFS.downloadPdf('"+O+'\');" id="link_'+O+'">';R=R+'<div class="downloadButton">';R=R+'<div class="base downloadIcon medium">';R=R+'<div class="baseIconSprite baseIconSizeMedium spriteIconDownloadMedium clickableIconDownloadMedium"></div>';R=R+"</div>";R=R+"</div>";R=R+'<div class="downloadTitle link13px">';R=R+Q;R=R+"</div></a><br/>";R=R+"</div>";jq("#downloadResults").append(jq(R).addClass("linkitem_"+O));I(O,P,Q)}function I(O,P,Q){D[O]=P}function N(O){jq("div.linkitem_"+O).remove();delete D[O]}return L}return{__init__:function(){},__start__:function(){},createFS:function(E,F){return B(E,F)},downloadPdf:function(E){A(E)}}}();var rlInfoMaterialFS=function(){function A(O,f){var X=CoreFormsBase.inheritanceFrom(rlFormFieldSet.createFS(O,f));var R=X.parent;X.typeName="rlInfoMaterialFS";var c="i";var G={};var N={};X.init=function(){R.init();T();P();B(false);M(false)};X.getOptions=function(){return G};X.supportsInputCache=function(){return false};X.getMetaDataRenderers=function(j){j.dropdownInfoMaterial=function(o,k,m){N=jq.extend(N,k);var n=jq(m).find(".seriesGroup").first();var l=jq(m).find(".moreInfoGroup").first();m.unbind().change(function(){d()});m.blur(function(){d();setTimeout(function(){jq(G.modelsDropDown).focus()},0)});jq.each(N.primarySelection,function(p,q){if(C(q)){n.append("<option value='"+p+"'>"+q.seriesTitle+"</option>")}});jq.each(N.singleSelection,function(p,q){if(C(q)){l.append("<option direct='true' value='"+p+"'>"+q.title+"</option>")}});I();d()};return j};X.getValidationRules=function(j){j.requiredInfoMaterial={event:"focusout",when:"ELEM_INVALIDATED_BY_FORM",rule:function(m,k,l){if(F()==0){return{fieldName:"infoMaterial",level:"ERROR",messageText:G.params.errornomaterialselected}}}};return j};X.getFieldMappers=function(j){j.infoMaterial={get:function(n,l){var m=U();var k=Y();return{materialCodes:m,materialTitles:k}},set:function(m,l,k){}};return j};X.renderItem=function(o,n,p,m){var k=jq("<div/>").addClass("infoMaterialBrochure").addClass("rfi_sel_"+o);k.append(jq("<h4/>").addClass("headlineh4").html(n));O.find(G.selectedBrochuresWrapperView).append(k.clone());k.css("display","none");k.append(jq("<input type='hidden'/>").addClass("infoMaterial").val(o).attr("data-title",n));var j=jq('<a name="removeinfomateriallink" href="javascript:void(0);"/>').addClass("rfiRemoveBg linkArrow13px").html(G.params.removeitemlabel);j.click(function(){X.removeItem(o)});var l=jq("<div/>").addClass("fieldSetLink");l.append(j);k.append(l);O.find(G.selectedBrochuresWrapperEdit).append(k);rlRfxViewHelper.show(k)};X.isUnlimitedDownloadsEnabled=function(){return"false"};function g(k){var j=O.find(G.modelsDropDown).first();jq(j).unbind();jq(j).find("option:not(.defaultOption)").remove();if(typeof k!="undefined"){jq.each(k,function(m,o){if(typeof o!="undefined"&&o.length>0){var l=o[0];if(typeof l!="undefined"){var n=jq("<option />").val(m).html(l.title);if(typeof l.bodytypeId!="undefined"){n.attr("data-bodyTypeId",l.bodytypeId)}if(typeof l.modelRangeId!="undefined"){n.attr("data-modelRangeId",l.modelRangeId)}if(typeof l.imageUrl!="undefined"){n.attr("data-imageUrl",l.imageUrl)}if(typeof l.pdfUrl!="undefined"){n.attr("data-pdfUrl",l.pdfUrl)}jq(j).append(n)}}});S();D();O.find(G.modelsDropDown+", label[for=rfimodels]").css("display","block")}else{O.find(G.modelsDropDown+", label[for=rfimodels]").hide()}if(jq.browser.msie){jq(j).click(function(){V()})}else{jq(j).change(function(){V()})}jq(j).keypress(function(m){var l=m.keyCode?m.keyCode:m.which;if(l==13){V()}})}function V(){var l=O.find(G.modelsDropDown).first();if(!l.find("option:selected").hasClass("defaultOption")){var j=e(l.val());var n=jq("option[value='"+j+"']",l).text();var k=l.find(":selected").attr("data-imageUrl");var m=l.find(":selected").attr("data-pdfUrl");b(l.val(),n,k,m);Q()}}function d(){var j=O.find(G.seriesDropDown).first();var k=j.val();if(j.find("option:selected").hasClass("defaultOption")){O.find(".selectionModel").fadeOut(400)}else{O.find(".selectionModel").fadeIn(700)}jq.each(N.primarySelection,function(l,m){if(k==l){g(N.primarySelection[l].brochures);return false}});jq.each(N.singleSelection,function(n,o){if(k==n){var l=e(k);var q=jq("option[value="+l+"]",j).text();var m=N.singleSelection[n].imageUrl;var p=N.singleSelection[n].pdfUrl;b(k,q,m,p);Q();return false}})}function Q(){jq(G.seriesDropDown+" option.defaultOption").prop("selected",true)}function F(){return O.find(G.selectedBrochuresWrapperEdit).find(".infoMaterialBrochure").length}function b(l,k,m,j){O.find("option").removeAttr("selected");g();X.renderItem(l,k,m,j);if(F()==1){M(true)}if(F()>=G.params.maxitems&&X.isUnlimitedDownloadsEnabled()=="false"){jq(G.addLink).addClass("linkArrow13pxInactive").removeClass("linkArrow13px")}J();S();D();E(false);B(true)}function J(){O.find("select#rfiseries").trigger("focusout")}X.removeItem=function(m){var l=function(){jq(k).remove();jq(G.addLink).addClass("linkArrow13px").removeClass("linkArrow13pxInactive");S();D()};var j=e(m);var k=O.find(G.selectedBrochuresWrapperEdit+" .infoMaterialBrochure.rfi_sel_"+j);if(F()==1){M(false,function(){l();E(true);B(false)})}else{rlRfxViewHelper.hide(jq(k),function(){l()})}};function S(){O.find("select option[disabled=disabled]").removeAttr("disabled");if(rlBrowser.getInternetExplorerVersion()==7){O.find("select option").css({color:"#000000"});O.find("select option[disabled=disabled]").removeAttr("style")}O.find(".infoMaterialSelectionArea input.infoMaterial").each(function(k,l){var j=e(l.value);O.find("select option[value="+j+"]").attr("disabled","disabled")});if(rlBrowser.getInternetExplorerVersion()==7){O.find("select option").css({color:"#000000"});O.find("select option[disabled]").css({color:"#cccccc"})}}function D(){jq(".fieldSetEditAreaRow").find(".infoMaterialBrochure").each(function(j,k){if(j%3==0){jq(k).css("margin-left","0")}else{jq(k).css("margin-left","65px")}})}function E(k){var j=G.dropdownDiv;if(jq(G.fieldSetCopyText,O).length>0){j+=", "+G.fieldSetCopyText}if(k===true){rlRfxViewHelper.show(jq(j,O))}else{if(!jq(j,O).is(":visible")){jq(j,O).hide();jq("#rfiSelectionModel").hide()}else{rlRfxViewHelper.hide(jq(j,O));jq("#rfiSelectionModel").hide()}}}function B(k,l){if(l){var j=l}else{var j=function(){jq(window).trigger(rlFormFieldSet.EVENT_FIELDSET_SIZE_CHANGED)}}l=function(){j()};if(k===true){rlRfxViewHelper.show(jq(G.addLinkArea,O),l)}else{rlRfxViewHelper.hide(jq(G.addLinkArea,O),l)}}X.onSelectionAreasDisplayed=function(j){};function M(k,l){if(l){var j=l}else{var j=function(){jq(window).trigger(rlFormFieldSet.EVENT_FIELDSET_SIZE_CHANGED)}}l=function(){j()};if(k===true){jq(G.selectionAnimationDiv,O).slideDown(G.selectionAnimationDiv,l)}else{jq(G.selectionAnimationDiv,O).slideUp(l)}X.onSelectionAreasDisplayed(k)}function C(k){var j=false;if(isUndefined(f.subBrand)||L(k)||H(k)){j=true}return j}function L(j){return((j.seriesId==="i"||(isDefined(j.materialCode)&&j.materialCode.toLowerCase().indexOf("bmwi_")==0))&&f.subBrand==="BI")}function H(j){return((j.seriesId!=="i"&&(isUndefined(j.materialCode)||j.materialCode.toLowerCase().indexOf("bmwi_")!=0))&&f.subBrand!=="BI")}function e(j){return j.replace(/[!"#$%&'()*+,.\/:;<=>?@\[\\\]^`{|}~]/g,"\\$&")}function I(){var k=window.rfxContextParams;if(typeof k!="undefined"){if(typeof k.configId!="undefined"){G.params.configid=k.configId}if(typeof k.bodyTypeId!="undefined"){G.params.bodytypeid=k.bodyTypeId}if(typeof k.modelRangeId!="undefined"){G.params.modelrangeid=k.modelRangeId}if(typeof k.seriesId!="undefined"){G.params.seriesid=k.seriesId}if(typeof k.materialCode!="undefined"){G.params.materialcode=k.materialCode}}if(typeof G.params=="undefined"){return }if(G.params.modelrangeid){var l=O.data("models");if(typeof l!="undefined"){for(var j=0;j<l.length;j++){if(l[j].modelRangeId===G.params.modelrangeid){G.params.seriesid=l[j].seriesId;G.params.bodytypeid=l[j].bodyTypeId;break}}}}if(typeof G.params.configid!="undefined"&&G.params.configid!="-1"){a(G.params.configid)}else{if(typeof G.params.seriesid!="undefined"&&G.params.seriesid!="-1"){K(G.params.seriesid,G.params.bodytypeid,G.params.modelrangeid)}else{if(typeof G.params.materialcode!="undefined"&&G.params.materialcode!="-1"){W(G.params.materialcode)}}}}function W(j){jq(G.seriesDropDown).val(escape(j));jq(G.seriesDropDown).trigger("change")}function a(k){var j={};j.configId=k;j.isPub=true;j.error=function(){console.log("Error getting NCC Data")};j.success=function(l){Z(l)};rlNccServices.getConfig(j)}function K(m,j,l){if(typeof N.primarySelection[m]!="undefined"){if(typeof N.primarySelection[m].brochures!="undefined"){var k=false;jq.each(N.primarySelection[m].brochures,function(o,n){jq.each(n,function(q,p){if((typeof p.modelRangeId!="undefined"&&p.modelRangeId==l)||(typeof p.bodytypeId!="undefined"&&p.bodytypeId==j)){var r={materialCode:o};if(C(r)){b(o,p.title,p.imageUrl,p.pdfUrl)}k=true}})});if(!k){jq(G.seriesDropDown).val(escape(m));jq(G.seriesDropDown).trigger("change")}}}}function Z(j){if(typeof j!=="undefined"){if(typeof j.status.responseStatus!=="undefined"&&j.status.responseStatus=="OK"){if(typeof j.content.modelSection!=="undefined"){G.params.seriesid=j.content.modelSection.series.value;G.params.bodytypeid=j.content.modelSection.bodyType.value;G.params.modelrangeid=j.content.modelSection.marketingModelRangeCode.value;K(G.params.seriesid,G.params.bodytypeid,G.params.modelrangeid)}}}}function U(){var j=[];O.find(".infoMaterialSelectionArea input.infoMaterial").each(function(k,l){j.push(unescape(l.value))});return j}function Y(){var j=[];O.find(".infoMaterialSelectionArea input.infoMaterial").each(function(k,l){j.push(unescape(jq(l).data("title")))});return j}function T(){G.params=X.getFieldsetProperties();G.dropdownDiv=".infoMaterialDdArea";G.seriesDropDown="#rfiseries";G.modelsDropDown="#rfimodels";G.fieldSetCopyText=".fieldSetCopyText";G.addLinkArea=".infoMaterialSelectionAddArea";G.addLink="#rfiSelectionAddLink";G.selectionAnimationDiv=".infoMaterialSelectionArea";G.selectedBrochuresWrapperEdit=".fieldSetEditAreaRow.selectedBrochures";G.selectedBrochuresWrapperView=".fieldSetViewAreaRow.selectedBrochures";G.params.unlimiteddownloads=true}function P(){O.find(G.addLink).click(function(){if(!jq(this).hasClass("linkArrow13pxInactive")){B(false);E(true)}})}X.testMethods=function(){return{renderItem:X.renderItem,addItem:b,removeItem:X.removeItem,isUnlimitedDownloadsEnabled:X.isUnlimitedDownloadsEnabled}};return X}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlInvertedCaptchaSet=function(){var I="";var A={getListAreaId:function(){return I},errorPlacements:function(){return{recaptcha_response_field:jq("#errorMsg_recaptcha_response_field")}},groups:{},clickedElem:"undefined",formHeader:"undefined",listEditArea:{initFields:function(J){}},bindEvents:function(){bindEvents()},isValid:function(){return jq("#"+I+"form").valid()}};function B(){return fields}function G(){var J={name:"invertedCaptchaSet",coreId:["profile"],cachingDisabled:true,getFieldsNames:["recaptcha_response_field"],callbackBeforeSaveData:H,callbackError:E};rlAbstractForm.registerComponent(J);C()}function H(L,K,J){L.captcha={};L.captcha.input=jq("#"+A.getListAreaId()+"form #recaptcha_response_field").val();return L}function E(K,J){rlCaptcha.reload();F();if(J.errorCodeId==="INVALID_CAPTCHA_SOLUTION"){jq("input#recaptcha_response_field, label.captchaComponentLabel").addClass("componentSetHighlightError");return rlAbstractFormFieldSet.onError("recaptcha_response_field",J)}}function C(){var J=rlPage.isEditMode()||rlPage.isDesignMode();if(!J){jq(".invertedCaptchaSet").hide()}jq("input#recaptcha_response_field").removeClass("required")}function D(){jq(".invertedCaptchaSet").show();jq("input#recaptcha_response_field").val("");jq("input#recaptcha_response_field").addClass("required")}function F(){jq("input#recaptcha_response_field, label.captchaComponentLabel").removeClass("componentSetHighlightError");jq("#errorMsg_recaptcha_response_field").html("")}return{__init__:function(){},__start__:function(){if(typeof rlCaptcha!="undefined"){rlCaptcha.registerReloadCallback(F)}jq("input#recaptcha_response_field").keypress(function(){F()})},registerComponent:function(){G()},initForm:function(N,M){console.log("invertedCaptchaSet::initForm: "+N);var J=rlPage.isEditMode()||rlPage.isDesignMode();if(!J){I=N;var L="#"+N;rlAbstractFormFieldSet.initDefaultActions(A);var K=jq("#"+A.getListAreaId()+"form").closest("form");if(K){K.bmwValidate("addErrorPlacements",A.errorPlacements());K.bmwValidate("modifyValidationMessages",M)}else{console.warn("invertedCaptchaSet::initForm: form not found")}jq.extend(jq.validator.messages,{required:function(){return jq(L+"RequiredFieldLabel").html()}})}},reload:function(){rlCaptcha.reload()},hide:function(){C()},show:function(){D()},showError:function(J){E(undefined,J)}}}();var rlJQuery_charcounter=function(){return{__start__:function(){},__init__:function(){(function(A){A.fn.charCounter=function(B,C){B=B||100;C=A.extend({container:"<span></span>",classname:"charcounter",format:"(%1 characters remaining)",pulse:true,delay:0},C);var G,F;function E(I,H){I=A(I);if(I.val().length>B){I.val(I.val().substring(0,B));if(C.pulse&&!G){D(H,true)}}if(C.delay>0){if(F){window.clearTimeout(F)}F=window.setTimeout(function(){H.html(C.format.replace(/%1/,(B-I.val().length)))},C.delay)}else{H.html(C.format.replace(/%1/,(B-I.val().length)))}}function D(H,I){if(G){window.clearTimeout(G);G=null}H.animate({opacity:0.1},100,function(){A(this).animate({opacity:1},100)});if(I){G=window.setTimeout(function(){D(H)},200)}}return this.each(function(){var H;if(!C.container.match(/^<.+>$/)){H=A(C.container)}else{A(this).next("."+C.classname).remove();H=A(C.container).insertAfter(this).addClass(C.classname)}A(this).unbind(".charCounter").bind("keydown.charCounter",function(){E(this,H)}).bind("keypress.charCounter",function(){E(this,H)}).bind("keyup.charCounter",function(){E(this,H)}).bind("focus.charCounter",function(){E(this,H)}).bind("mouseover.charCounter",function(){E(this,H)}).bind("mouseout.charCounter",function(){E(this,H)}).bind("paste.charCounter",function(){var I=this;setTimeout(function(){E(I,H)},10)});if(this.addEventListener){this.addEventListener("input",function(){E(this,H)},false)}E(this,H)})}})(jq)}}}();var rlJQuery_validate=function(){return{__start__:function(){},__init__:function(){(function(A){A.extend(A.fn,{validate:function(B){if(!this.length){B&&B.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing");return }var C=A.data(this[0],"validator");if(C){return C}C=new A.validator(B,this[0]);A.data(this[0],"validator",C);if(C.settings.onsubmit){this.find("input, button").filter(".cancel").click(function(){C.cancelSubmit=true});if(C.settings.submitHandler){this.find("input, button").filter(":submit").click(function(){C.submitButton=this})}this.submit(function(D){if(C.settings.debug){D.preventDefault()}function E(){if(C.settings.submitHandler){if(C.submitButton){var F=A("<input type='hidden'/>").attr("name",C.submitButton.name).val(C.submitButton.value).appendTo(C.currentForm)}C.settings.submitHandler.call(C,C.currentForm);if(C.submitButton){F.remove()}return false}return true}if(C.cancelSubmit){C.cancelSubmit=false;return E()}if(C.form()){if(C.pendingRequest){C.formSubmitted=true;return false}return E()}else{C.focusInvalid();return false}})}return C},valid:function(){if(A(this[0]).is("form")){return this.validate().form()}else{var C=true;var B=A(this[0].form).validate();this.each(function(){C&=B.element(this)});return C}},removeAttrs:function(D){var B={},C=this;A.each(D.split(/\s/),function(E,F){B[F]=C.attr(F);C.removeAttr(F)});return B},rules:function(E,B){var G=this[0];if(E){var D=A.data(G.form,"validator").settings;var I=D.rules;var J=A.validator.staticRules(G);switch(E){case"add":A.extend(J,A.validator.normalizeRule(B));I[G.name]=J;if(B.messages){D.messages[G.name]=A.extend(D.messages[G.name],B.messages)}break;case"remove":if(!B){delete I[G.name];return J}var H={};A.each(B.split(/\s/),function(K,L){H[L]=J[L];delete J[L]});return H}}var F=A.validator.normalizeRules(A.extend({},A.validator.metadataRules(G),A.validator.classRules(G),A.validator.attributeRules(G),A.validator.staticRules(G)),G);if(F.required){var C=F.required;delete F.required;F=A.extend({required:C},F)}return F}});A.extend(A.expr[":"],{blank:function(B){return !A.trim(""+B.value)},filled:function(B){return !!A.trim(""+B.value)},unchecked:function(B){return !B.checked}});A.validator=function(B,C){this.settings=A.extend(true,{},A.validator.defaults,B);this.currentForm=C;this.init()};A.validator.format=function(B,C){if(arguments.length==1){return function(){var D=A.makeArray(arguments);D.unshift(B);return A.validator.format.apply(this,D)}}if(arguments.length>2&&C.constructor!=Array){C=A.makeArray(arguments).slice(1)}if(C.constructor!=Array){C=[C]}A.each(C,function(D,E){B=B.replace(new RegExp("\\{"+D+"\\}","g"),E)});return B};A.extend(A.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:A([]),errorLabelContainer:A([]),onsubmit:true,ignore:[],ignoreTitle:false,onfocusin:function(B){this.lastActive=B;if(this.settings.focusCleanup&&!this.blockFocusCleanup){this.settings.unhighlight&&this.settings.unhighlight.call(this,B,this.settings.errorClass,this.settings.validClass);this.addWrapper(this.errorsFor(B)).hide()}},onfocusout:function(B){if(!this.checkable(B)&&(B.name in this.submitted||!this.optional(B))){this.element(B)}},onkeyup:function(B){if(B.name in this.submitted||B==this.lastElement){this.element(B)}},onclick:function(B){if(B.name in this.submitted){this.element(B)}else{if(B.parentNode.name in this.submitted){this.element(B.parentNode)}}},highlight:function(D,B,C){if(D.type==="radio"){this.findByName(D.name).addClass(B).removeClass(C)}else{A(D).addClass(B).removeClass(C)}},unhighlight:function(D,B,C){if(D.type==="radio"){this.findByName(D.name).removeClass(B).addClass(C)}else{A(D).removeClass(B).addClass(C)}}},setDefaults:function(B){A.extend(A.validator.defaults,B)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:A.validator.format("Please enter no more than {0} characters."),minlength:A.validator.format("Please enter at least {0} characters."),rangelength:A.validator.format("Please enter a value between {0} and {1} characters long."),range:A.validator.format("Please enter a value between {0} and {1}."),max:A.validator.format("Please enter a value less than or equal to {0}."),min:A.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=A(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||A(this.currentForm);this.containers=A(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var B=(this.groups={});A.each(this.settings.groups,function(E,F){A.each(F.split(/\s/),function(H,G){B[G]=E})});var D=this.settings.rules;A.each(D,function(E,F){D[E]=A.validator.normalizeRule(F)});function C(G){var F=A.data(this[0].form,"validator"),E="on"+G.type.replace(/^validate/,"");F.settings[E]&&F.settings[E].call(F,this[0])}A(this.currentForm).validateDelegate(":text, :password, :file, select, textarea","focusin focusout keyup",C).validateDelegate(":radio, :checkbox, select, option","click",C);if(this.settings.invalidHandler){A(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)}},form:function(){this.checkForm();A.extend(this.submitted,this.errorMap);this.invalid=A.extend({},this.errorMap);if(!this.valid()){A(this.currentForm).triggerHandler("invalid-form",[this])}this.showErrors();return this.valid()},checkForm:function(){this.prepareForm();for(var B=0,C=(this.currentElements=this.elements());C[B];B++){this.check(C[B])}return this.valid()},element:function(C){C=this.clean(C);this.lastElement=C;this.prepareElement(C);this.currentElements=A(C);var B=this.check(C);if(B){delete this.invalid[C.name]}else{this.invalid[C.name]=true}if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers)}this.showErrors();return B},showErrors:function(C){if(C){A.extend(this.errorMap,C);this.errorList=[];for(var B in C){this.errorList.push({message:C[B],element:this.findByName(B)[0]})}this.successList=A.grep(this.successList,function(D){return !(D.name in C)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){if(A.fn.resetForm){A(this.currentForm).resetForm()}this.submitted={};this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(D){var C=0;for(var B in D){C++}return C},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()==0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid){try{A(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(B){}}},findLastActive:function(){var B=this.lastActive;return B&&A.grep(this.errorList,function(C){return C.element.name==B.name}).length==1&&B},elements:function(){var C=this,B={};return A(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){!this.name&&C.settings.debug&&window.console&&console.error("%o has no name assigned",this);if(this.name in B||!C.objectLength(A(this).rules())){return false}B[this.name]=true;return true})},clean:function(B){return A(B)[0]},errors:function(){return A(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext)},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=A([]);this.toHide=A([]);this.currentElements=A([])},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers)},prepareElement:function(B){this.reset();this.toHide=this.errorsFor(B)},check:function(C){C=this.clean(C);if(this.checkable(C)){C=this.findByName(C.name).not(this.settings.ignore)[0]}var G=A(C).rules();var D=false;for(var H in G){var F={method:H,parameters:G[H]};try{var B=A.validator.methods[H].call(this,C.value.replace(/\r/g,""),C,F.parameters);if(B=="dependency-mismatch"){D=true;continue}D=false;if(B=="pending"){this.toHide=this.toHide.not(this.errorsFor(C));return }if(!B){this.formatAndAdd(C,F);return false}}catch(E){this.settings.debug&&window.console&&console.log("exception occured when checking element "+C.id+", check the '"+F.method+"' method",E);throw E}}if(D){return }if(this.objectLength(G)){this.successList.push(C)}return true},customMetaMessage:function(B,D){if(!A.metadata){return }var C=this.settings.meta?A(B).metadata()[this.settings.meta]:A(B).metadata();return C&&C.messages&&C.messages[D]},customMessage:function(C,D){var B=this.settings.messages[C];return B&&(B.constructor==String?B:B[D])},findDefined:function(){for(var B=0;B<arguments.length;B++){if(arguments[B]!==undefined){return arguments[B]}}return undefined},defaultMessage:function(B,C){return this.findDefined(this.customMessage(B.name,C),this.customMetaMessage(B,C),!this.settings.ignoreTitle&&B.title||undefined,A.validator.messages[C],"<strong>Warning: No message defined for "+B.name+"</strong>")},formatAndAdd:function(C,E){var D=this.defaultMessage(C,E.method),B=/\$?\{(\d+)\}/g;if(typeof D=="function"){D=D.call(this,E.parameters,C)}else{if(B.test(D)){D=jQuery.format(D.replace(B,"{$1}"),E.parameters)}}this.errorList.push({message:D,element:C});this.errorMap[C.name]=D;this.submitted[C.name]=D},addWrapper:function(B){if(this.settings.wrapper){B=B.add(B.parent(this.settings.wrapper))}return B},defaultShowErrors:function(){for(var C=0;this.errorList[C];C++){var B=this.errorList[C];this.settings.highlight&&this.settings.highlight.call(this,B.element,this.settings.errorClass,this.settings.validClass);this.showLabel(B.element,B.message)}if(this.errorList.length){this.toShow=this.toShow.add(this.containers)}if(this.settings.success){for(var C=0;this.successList[C];C++){this.showLabel(this.successList[C])}}if(this.settings.unhighlight){for(var C=0,D=this.validElements();D[C];C++){this.settings.unhighlight.call(this,D[C],this.settings.errorClass,this.settings.validClass)}}this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return A(this.errorList).map(function(){return this.element})},showLabel:function(C,D){var B=this.errorsFor(C);if(B.length){B.removeClass().addClass(this.settings.errorClass);B.attr("generated")&&B.html(D)}else{B=A("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(C),generated:true}).addClass(this.settings.errorClass).html(D||"");if(this.settings.wrapper){B=B.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()}if(!this.labelContainer.append(B).length){this.settings.errorPlacement?this.settings.errorPlacement(B,A(C)):B.insertAfter(C)}}if(!D&&this.settings.success){B.text("");typeof this.settings.success=="string"?B.addClass(this.settings.success):this.settings.success(B)}this.toShow=this.toShow.add(B)},errorsFor:function(C){var B=this.idOrName(C);return this.errors().filter(function(){return A(this).attr("for")==B})},idOrName:function(B){return this.groups[B.name]||(this.checkable(B)?B.name:B.id||B.name)},checkable:function(B){return/radio|checkbox/i.test(B.type)},findByName:function(B){return A(this.currentForm).find('input[name="'+B+'"],select[name="'+B+'"],textarea[name="'+B+'"]')},getLength:function(C,B){switch(B.nodeName.toLowerCase()){case"select":return A("option:selected",B).length;case"input":if(this.checkable(B)){return this.findByName(B.name).filter(":checked").length}}return C.length},depend:function(C,B){return this.dependTypes[typeof C]?this.dependTypes[typeof C](C,B):true},dependTypes:{"boolean":function(C,B){return C},string:function(C,B){return !!A(C,B.form).length},"function":function(C,B){return C(B)}},optional:function(B){return !A.validator.methods.required.call(this,A.trim(B.value),B)&&"dependency-mismatch"},startRequest:function(B){if(!this.pending[B.name]){this.pendingRequest++;this.pending[B.name]=true}},stopRequest:function(B,C){this.pendingRequest--;if(this.pendingRequest<0){this.pendingRequest=0}delete this.pending[B.name];if(C&&this.pendingRequest==0&&this.formSubmitted&&this.form()){A(this.currentForm).submit();this.formSubmitted=false}else{if(!C&&this.pendingRequest==0&&this.formSubmitted){A(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false}}},previousValue:function(B){return A.data(B,"previousValue")||A.data(B,"previousValue",{old:null,valid:true,message:this.defaultMessage(B,"remote")})}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},dateDE:{dateDE:true},number:{number:true},numberDE:{numberDE:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(B,C){B.constructor==String?this.classRuleSettings[B]=C:A.extend(this.classRuleSettings,B)},classRules:function(C){var D={};var B=A(C).attr("class");B&&A.each(B.split(" "),function(){if(this in A.validator.classRuleSettings){A.extend(D,A.validator.classRuleSettings[this])}});return D},attributeRules:function(C){var E={};var B=A(C);for(var F in A.validator.methods){var D=B.attr(F);if(D){E[F]=D}}if(E.maxlength&&/-1|2147483647|524288/.test(E.maxlength)){delete E.maxlength}return E},metadataRules:function(B){if(!A.metadata){return{}}var C=A.data(B.form,"validator").settings.meta;return C?A(B).metadata()[C]:A(B).metadata()},staticRules:function(C){var D={};var B=A.data(C.form,"validator");if(B.settings.rules){D=A.validator.normalizeRule(B.settings.rules[C.name])||{}}return D},normalizeRules:function(C,B){A.each(C,function(F,E){if(E===false){delete C[F];return }if(E.param||E.depends){var D=true;switch(typeof E.depends){case"string":D=!!A(E.depends,B.form).length;break;case"function":D=E.depends.call(B,B);break}if(D){C[F]=E.param!==undefined?E.param:true}else{delete C[F]}}});A.each(C,function(D,E){C[D]=A.isFunction(E)?E(B):E});A.each(["minlength","maxlength","min","max"],function(){if(C[this]){C[this]=Number(C[this])}});A.each(["rangelength","range"],function(){if(C[this]){C[this]=[Number(C[this][0]),Number(C[this][1])]}});if(A.validator.autoCreateRanges){if(C.min&&C.max){C.range=[C.min,C.max];delete C.min;delete C.max}if(C.minlength&&C.maxlength){C.rangelength=[C.minlength,C.maxlength];delete C.minlength;delete C.maxlength}}if(C.messages){delete C.messages}return C},normalizeRule:function(C){if(typeof C=="string"){var B={};A.each(C.split(/\s/),function(){B[this]=true});C=B}return C},addMethod:function(B,D,C){A.validator.methods[B]=D;A.validator.messages[B]=C!=undefined?C:A.validator.messages[B];if(D.length<3){A.validator.addClassRules(B,A.validator.normalizeRule(B))}},methods:{required:function(C,B,E){if(!this.depend(E,B)){return"dependency-mismatch"}switch(B.nodeName.toLowerCase()){case"select":var D=A(B).val();return D&&D.length>0;case"input":if(this.checkable(B)){return this.getLength(C,B)>0}default:return A.trim(C).length>0}},remote:function(F,C,G){if(this.optional(C)){return"dependency-mismatch"}var D=this.previousValue(C);if(!this.settings.messages[C.name]){this.settings.messages[C.name]={}}D.originalMessage=this.settings.messages[C.name].remote;this.settings.messages[C.name].remote=D.message;G=typeof G=="string"&&{url:G}||G;if(this.pending[C.name]){return"pending"}if(D.old===F){return D.valid}D.old=F;var B=this;this.startRequest(C);var E={};E[C.name]=F;A.ajax(A.extend(true,{url:G,mode:"abort",port:"validate"+C.name,dataType:"json",data:E,success:function(I){B.settings.messages[C.name].remote=D.originalMessage;var K=I===true;if(K){var H=B.formSubmitted;B.prepareElement(C);B.formSubmitted=H;B.successList.push(C);B.showErrors()}else{var L={};var J=I||B.defaultMessage(C,"remote");L[C.name]=D.message=A.isFunction(J)?J(F):J;B.showErrors(L)}D.valid=K;B.stopRequest(C,K)}},G));return"pending"},minlength:function(C,B,D){return this.optional(B)||this.getLength(A.trim(C),B)>=D},maxlength:function(C,B,D){return this.optional(B)||this.getLength(A.trim(C),B)<=D},rangelength:function(D,B,E){var C=this.getLength(A.trim(D),B);return this.optional(B)||(C>=E[0]&&C<=E[1])},min:function(C,B,D){return this.optional(B)||C>=D},max:function(C,B,D){return this.optional(B)||C<=D},range:function(C,B,D){return this.optional(B)||(C>=D[0]&&C<=D[1])},email:function(C,B){return this.optional(B)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(C)},url:function(C,B){return this.optional(B)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(C)},date:function(C,B){return this.optional(B)||!/Invalid|NaN/.test(new Date(C))},dateISO:function(C,B){return this.optional(B)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(C)},number:function(C,B){return this.optional(B)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(C)},digits:function(C,B){return this.optional(B)||/^\d+$/.test(C)},creditcard:function(F,C){if(this.optional(C)){return"dependency-mismatch"}if(/[^0-9-]+/.test(F)){return false}var G=0,E=0,B=false;F=F.replace(/\D/g,"");for(var H=F.length-1;H>=0;H--){var D=F.charAt(H);var E=parseInt(D,10);if(B){if((E*=2)>9){E-=9}}G+=E;B=!B}return(G%10)==0},accept:function(C,B,D){D=typeof D=="string"?D.replace(/,/g,"|"):"png|jpe?g|gif";return this.optional(B)||C.match(new RegExp(".("+D+")$","i"))},equalTo:function(C,B,E){var D=A(E).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){A(B).valid()});return C==D.val()}}});A.format=A.validator.format})(jQuery);(function(C){var A={};if(C.ajaxPrefilter){C.ajaxPrefilter(function(F,E,G){var D=F.port;if(F.mode=="abort"){if(A[D]){A[D].abort()}A[D]=G}})}else{var B=C.ajax;C.ajax=function(E){var F=("mode" in E?E:C.ajaxSettings).mode,D=("port" in E?E:C.ajaxSettings).port;if(F=="abort"){if(A[D]){A[D].abort()}return(A[D]=B.apply(this,arguments))}return B.apply(this,arguments)}}})(jQuery);(function(A){if(!jQuery.event.special.focusin&&!jQuery.event.special.focusout&&document.addEventListener){A.each({focus:"focusin",blur:"focusout"},function(C,B){A.event.special[B]={setup:function(){this.addEventListener(C,D,true)},teardown:function(){this.removeEventListener(C,D,true)},handler:function(E){arguments[0]=A.event.fix(E);arguments[0].type=B;return A.event.handle.apply(this,arguments)}};function D(E){E=A.event.fix(E);E.type=B;return A.event.handle.call(this,E)}})}A.extend(A.fn,{validateDelegate:function(D,C,B){return this.bind(C,function(E){var F=A(E.target);if(F.is(D)){return B.apply(F,arguments)}})}})})(jq)}}}();var rlLocalSearchServices=function(){function A(G,C,B,D){var F=C.join(",");var E=rlC2BConfig.getDealerLocatorServiceUrl(G);E=E.replace("_{distkeys}",F);rlCrossSubDomainAjax.call({type:"GET",url:E,dataType:"jsonp",contentType:"application/json; charset=utf-8",success:function(H){var I=[];if(H.data!==null){I=H.data.pois}B(I)},error:function(H){D(H)}})}return{__init__:function(){},__start__:function(){},requestPointOfInterests:function(E,C,B,D){A(E,C,B,D)}}}();var rlLoginFS=(function(){var A=function(G,P){var L=CoreFormsBase.inheritanceFrom(rlFormFieldSet.createFS(G,P));var I=L.parent;var H=false;L.typeName="rlLoginFS";var B="div.loginFS";var E="#"+P.fsId+" .fieldSetEditAreaRow.c2bInfoRow";var O="#"+P.fsId+" .fieldSetEditAreaRow.passwordRow";var C="#"+P.fsId+" .fieldSetEditAreaRow :input[data-field='account.login']";var N="#"+P.fsId+" .fieldSetEditAreaRow :input[data-field='account.password']";var F="#"+P.fsId+" .c2bButton";L.supportsInputCache=function(){return false};L.getMetaDataRenderers=function(T){T=I.getMetaDataRenderers(T);T.implicitLogin=function(W,U,V){H=U.canUse;S()};return T};L.getMailSummary=function(U,T){return U||[]};function D(){rlInstantCheck.hideIconLayer(N);jq(E).show();jq(O).hide();var T=rlDither.on(G.parents("form"),-1);G.css("z-index",T.overlay.css("z-index")+1)}function K(){rlDither.off(G.parents("form"));G.css("z-index","auto");jq(E).hide();jq(O).show()}function Q(){jq(C).focusout(function(){if(!jq(E).is(":visible")){if(this.value&&this.value.length>1){rlCoreServices.checkC2BLogin({login:this.value,existingC2bUser:D})}}});jq(C).keyup(function(){if(jq(E).is(":visible")){K()}});jq(F).click(function(){rlC2bInformationSet.c2bUserName=jq(C).val();rlDither.off(G.parents("form"));rlGlassPaneLayerNext.openDialog({url:jq(F).attr("data-url")})})}function M(){rlInstantCheck.prepareField(N)}function J(){jq(E).show()}function R(){if(H){var T=jq(B).prev();if(T&&T.hasClass("headline")){T.remove()}jq(B).remove();P.formEvents.trigger(P.formEvents.names.FIELDSET_REMOVED_ITSELF)}else{Q();M()}}function S(){if(rlPage.isEditMode()||rlPage.isDesignMode()){J()}else{R()}}return L};return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}());var rlMagnifierIconGeneric=function(){var E=30;function C(){return jq("body > .bigImageLayer")}function G(){return jq("body > .bigImageLayer img")}function B(){var H=C();var I=C();var K=I.data("originalWidth");var J=I.data("originalHeight");if(K===undefined){K=H.width();J=H.height();console.log("Original size of image is "+K+"/"+J);I.data("originalWidth",K);I.data("originalHeight",J)}return{w:K,h:J}}function F(){var L=C();if(L.length===0){return }var H=jq(window).width();var J=jq(window).height();var M=B();var P=(H-E*2)/M.w;var I=(J-E*2)/M.h;var O=null;var K=null;if(P<1||I<1){if(P<I){O=P*M.w;K=P*M.h}else{O=I*M.w;K=I*M.h}O=O+"px";K=K+"px"}var N=G();N.css("width",O);N.css("height",K);L.css("left",(H-(L.width()+E))/2+"px");L.css("top",(J-(L.height()+E))/2+"px")}function D(){greyLayer.greyLayer_hide();C().remove()}function A(){jq(".bigImageLayer .spriteIconCloseBig").click(D);jq("#grey_layer").one("click",D)}return{__init__:function(){jq(window).resize(function(){F()})},__start__:function(){jq(".magnifierIconBlue").click(function(){var H=jq(this).next(".bigImageLayer").find("img");rlGlassPaneLayerNext.openDialog({content:jq(H),flexible:true,flexibleSelector:"img"})})}}}();var rlMaxHeight=function(){return{__init__:function(){},normalize:function(A){var B=0;jq(A).each(function(C){h=jq(this).height();if(typeof h!="undefined"){if(h>B){B=h}}});if(B>0){jq(A).height(B)}}}}();var rlMultiRadioGroupFS=function(){function A(B,F){var C=CoreFormsBase.inheritanceFrom(rlFormFieldSet.createFS(B,F));var E=C.parent;C.typeName="rlMultiRadioGroupFS";var D=C.getFieldsetProperties();C.supportsInputCache=function(){return(D.supportinputcache=="true")};C.getFieldMappers=function(G){G.multiRadioGroup={get:function(K,H){var J=[];var I=H.find(".fieldSetRadioButtonGroup");jq.each(I,function(L,M){J.push(jq(M).find("input[type=radio]:checked").val())});return J},set:function(J,I,H){}};return G};C.getValidationRules=function(G){G.multiRadioRequired={event:"click",when:"ELEM_INVALIDATED_BY_FORM",rule:function(L,I,J){var H=true;if(D.required&&D.required==="true"){var K=I.find(".fieldSetRadioButtonGroup");jq.each(K,function(M,N){if(jq("input[type=radio]:checked",N).length==0){H=false;return false}})}if(H==false){return{fieldName:L,level:"ERROR",errorKey:"requiredRadio"}}}};return G};return C}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlMyBmwFormBase=function(){function A(D,E){var B=CoreFormsBase.inheritanceFrom(rlFormBase.create(D,E));var C=B.parent;B.typeName="rlMyBmwFormBase";B.switchToEditMode=function(){B.resetValidationMessages();jq.each(B.getFieldSetsById(),function(G,F){F.switchToEditMode()})};B.switchToViewMode=function(){B.resetValidationMessages();jq.each(B.getFieldSetsById(),function(G,F){F.switchToViewMode()})};B.getContext=function(){return"CREATE"};B.getUseCaseMetaDataRoot=function(){return"updateUser"};B.getModuleId=function(){return D.attr("data-jsModuleVar")};return B}return{__init__:function(){},__start__:function(){},create:function(B,C){return A(B,C)}}}();var rlMyBmwVehicleFS=function(){function A(O,F){var N=CoreFormsBase.inheritanceFrom(rlVehicleDetailsFS.createFS(O,F));var M=N.parent;N.typeName="rlMyBmwVehicleFS";var D=O.find("#"+F.fsId+"_brand");var B=O.find("#"+F.fsId+"_series");var H=O.find("#"+F.fsId+"_vin");var K=H.parents(".vehicleIdentMethodVINInputDiv").find(".fieldSetValidationFeedback");var C=O.find(".vehicleIdentMethodModelTreeDiv select");var I=undefined;N.getValidationRules=function(S){S=M.getValidationRules(S);var P=S.vin.rule;var Q=undefined;S.vin.rule=function(W,U,V,T){if(!Q){Q=function(X){X=X?(jq.isArray(X)?X:[X]):null;if(H.prop("disabled-marker")){T(null)}else{T(X)}}}return P(W,U,V,Q,N)};var R=S.requiredValue.rule;S.requiredValue.rule=function(V,T,U){if(T.prop("disabled-marker")){return null}else{return R(V,T,U)}};return S};N.onBrandsLoaded=function(){D.find("option[value='"+rlNccServices.modelTreeBrandKeyBMW()+"']").prop("selected",true).change();D.hide()};N.onSeriesLoaded=function(){C.prop("disabled",true);rlGlassPaneLayerNext&&rlGlassPaneLayerNext.isOpen()&&rlGlassPaneLayerNext.contentReady()};N.getEditedData=function(P){P=M.getEditedData(P);P&&P.vehicle&&delete P.vehicle.defaultFreeTextNote;return P};N.initVinTextbox=function(){};N.disableSeriesModelDropdowns=function(){return !H.prop("disabled")};function J(){var P={maxCharacterSize:50,originalStyle:"hide",warningStyle:"",warningNumber:50,displayFormat:jq("#vehicleNameFieldSaveMsgId").html()};O.find(".vehicleNameField").textareaCount(P,function(Q){O.find(".vehicleNameFieldRemainingCharactersInfo").html(Q.formattedText);O.find(".vehicleNameFieldRemainingCharactersInfo").css("color","")})}function L(){var Q=O.find(".vehicleIdentMethodVinRadioButtonContainer");var S=Q.find("input[type=radio]");var P=O.find(".vehicleIdentMethodModelTreeRadioButtonContainer");var R=P.find("input[type=radio]");Q.click(function(T){K.prop("disable-validationplacements",false);H.prop("disabled-marker",false);S.prop("checked",true);H.prop("disabled",false);if(!H.val()&&I){H.val(I);I=undefined;H.change().focusout()}C.not(D).each(function(U,W){var V=jq(W);V.val(V.prop("defaultSelected")).change()});C.prop("disabled-marker",true);C.change().focusout();C.prop("disabled",true)});P.click(function(T){C.prop("disabled-marker",false);R.prop("checked",true);if(!I){I=jq.trim(H.val());H.val("");H.prop("disabled-marker",true);H.change().focusout();H.prop("disabled",true);K.prop("disable-validationplacements",true)}B.prop("disabled",false);N.vgModelHelper.hideVGModelSection()})}function G(){H.prop("disabled",false);C.prop("disabled",true)}function E(){function P(){if(N.vgModelHelper.isVGModelVisible()){N.vgModelHelper.hideVGModelSection()}}if(rlGlobalConfig.isManualVinMapping&&!rlPage.isEditMode()){H.keyup(P);H.change(P)}}N.init=function(){M.init();G();L();J();E()};return N}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlMyConfigShare=function(){var C;function A(){rlDither.on(".myconfigshare");rlNccServices.shareConfig({doShare:true,configId:C,_charset_:"UTF-8",success:function(D){if(D&&D.status&&D.status.responseStatus==="OK"){jq(window).trigger("config_data_changed");rlUserDialog.showConfigShareSuccessDialog({configId:rlMyConfigsController.getCurrentConfigId(),onClose:function(E){if(E){hideToolbox()}}})}else{rlErrorService.handleError({actor:rlErrorService.ACTOR_SYSTEM})}},error:function(){rlErrorService.handleError({actor:rlErrorService.ACTOR_SYSTEM})}})}function B(){if(!rlPage.isEditMode()&&!rlPage.isDesignMode()){C=window.shareConfigId;jq("#shareBtn").click(function(){A()});rlNccServices.getConfig({configId:C,success:function(D){window.modelname=D.content.modelSection.title.value;jq("#myconfigShareConfigImage").attr("src",D.content.imageUrlFrontVeryBig.value);var E=jq(".gplContentHeadline h1").text();E=E.replace("$modelname$",D.content.modelSection.title.value);jq(".gplContentHeadline h1").text(E);rlGlassPaneLayerNext.contentReady()},error:function(){rlErrorService.handleError({actor:rlErrorService.ACTOR_USER})}})}}return{__init__:function(){},__start__:function(){jq("#cancelBtn").click(function(){rlGlassPaneLayerNext.closeDialog();return false})},initComponent:function(){B()}}}();var rlMybmwnews=function(){return{__init__:function(){}}}();var rlMybmwnewsfilter=function(){return{__init__:function(){jq(document).ready(function(){jq(".myBMWNewsFilterSelect").bind("change",function(){var A=jq(this).val();if(A){window.location=A}return false})})}}}();var rlNccEspApp=function(){var M=this;var K=jq.Deferred?jq.Deferred():null;M.isFinancePageCreated=false;function E(N,O){rlErrorService.handleError({actor:rlErrorService.ACTOR_SYSTEM,requestStatus:N})}function A(){if(B()||M.scriptLoaded){return jq.when(true)}console.debug("rlNccEspApp: load script");return jq.ajax({url:"/vc/apps/ncc-esp-app.js",cache:true,dataType:"script",success:function(){M.scriptLoaded=true},error:function(O,P,N){console.error("rlNccEspApp: Error creating ncc app. /vc/apps/ncc-esp-app.js not loaded. "+(N?N:""));E()}})}function B(){return rlPage.isEditMode()||rlPage.isDesignMode()||rlPage.isPreviewMode()}function I(N){window.setTimeout(function(){M.currentConfig=rlEspConfigMock.getMockedConfiguration();try{jq(window).trigger(rlCoreFormEvents.ENUM.NAMES.VEHICLE_CONFIG_CHANGED,M.currentConfig)}catch(O){console.error(O)}N.resolve(M.currentConfig)},500)}function C(P,R,O){if(B()){I(K);return K.promise()}var Q=function(S){console.debug("rlNccEspApp: started successfully");try{if(rlEspBasket.getCurrentInstance().getConfigId()!==S.configId){K.reject(this,"ConfigId is invalid")}else{jq(window).trigger(rlCoreFormEvents.ENUM.NAMES.VEHICLE_CONFIG_CHANGED,S);M.currentConfig=S;K.resolve(S)}}catch(T){K.reject(this,"startEspApp Exception",T)}};var N=function(S,T){if(typeof O!=="function"||!O(S,T)){K.reject(this,"Error esp.NccEspApp start",{status:S,data:T})}};A().done(function(){try{console.debug("rlNccEspApp: start nccEspApp");var S={mandatorContext:rlMandator.getMandatorContext(),serverUrl:rlHost.getCmxHost(),financeServerUrl:rlHost.getCmxHost(),loggedIn:R,publicConfigId:P,success:Q,error:N};console.debug("rlNccEspApp: Initializing esp.NccEspApp",S);M.nccEspApp=new esp.NccEspApp(S);M.nccEspApp.start();console.debug("rlNccEspApp: Initialized esp.NccEspApp")}catch(T){console.error("Error by esp.NccEspApp "+T);K.reject(this,"Error by esp.NccEspApp",T)}}).fail(function(){K.reject(this,"Errory by start nncEspApp")});return K.promise()}function L(){var N=jq.Deferred();if(B()){I(N);return N.promise()}var P=function(Q){console.debug("rlNccEspApp: config loaded successfully");M.currentConfig=Q;N.resolve(Q)};var O=function(Q,R){console.error("rlNccEspApp: Error esp.NccEspApp",Q,R);E(Q,R);N.reject(this,"Error by getConfig",{status:Q,data:R})};jq.when(A(),K).done(function(){try{console.debug("rlNccEspApp: loading config");M.nccEspApp.getConfiguration(P,O)}catch(Q){console.error("rlNccEspApp: error by load config"+Q)}}).fail(function(){N.reject(this,"Error by getConfig")});return N.promise()}function G(N,O){jq.when(A(),K).done(function(){if(M.nccEspApp&&!M.isFinancePageCreated){try{console.debug("rlNccEspApp: create FinancePage");M.nccEspApp.createFinancePage(N,O);H();M.isFinancePageCreated=true}catch(P){console.error("rlNccEspApp: Exception creating Finance Page: "+P);E()}}})}function H(){jq("#parametersResetLink").attr("data-tracking-clickable","true").attr("data-tracking-type","link").attr("data-tracking-id","espFinanceCalculatorReset");jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_PAGE_CHANGE_NOTIFICATION)}function J(N){jq.when(A(),K).done(function(){if(M.nccEspApp){try{var O=M.nccEspApp.inContentDisclaimerVisible();N(O)}catch(P){console.error("rlNccEspApp: Exception calling nccEspApp.inContentDisclaimerVisible(): "+P);E()}}})}function F(N){jq.when(A(),K).done(function(){if(M.nccEspApp){try{var P=M.nccEspApp.isFinanceDefaultOffer();N(P)}catch(O){console.error("rlNccEspApp: Exception calling nccEspApp.isFinanceDefaultOffer(): "+O);E()}}})}function D(){return M.scriptLoaded&&M.nccEspApp&&M.nccEspApp.isFinanceCalculationError()}return{__init__:function(){},__start__:function(){if(!(rlPage.isEditMode()||rlPage.isDesignMode()||rlPage.isPreviewMode())){jq(document).ready(function(){var N="/vc/apps/ncc-esp-app.css";if(document.createStyleSheet){document.createStyleSheet(N)}else{jq("head").prepend(jq("<link>").attr({rel:"stylesheet",type:"text/css",href:N}))}})}},startApp:function(P,Q,N,O){C(P,Q,O).done(function(R){console.debug("rlNccEspApp.startApp:: requestConfiguration.done",R);if(typeof N==="function"){N(R)}}).fail(function(S,T,R){console.error("rlNccEspApp.startApp:: Exception: "+(P?P:"")+" "+(T?T:"")+" "+(R?R:""));E()})},getConfiguration:function(N){L().done(function(O){console.debug("rlNccEspApp.getConfiguration:: requestConfiguration.done",O);if(typeof N==="function"){N(O)}}).fail(function(P,Q,O){console.error("rlNccEspApp.getConfiguration:: Exception:  "+(Q?Q:"")+(O?O:""));E()})},createFinancePage:function(N,O){G(N,O)},isInContentDisclaimerVisible:function(N){J(N)},isFinanceDefaultOffer:function(N){F(N)},isFinanceCalculationError:function(){return D()},getCurrentConfiguration:function(){return M.currentConfig}}}();var rlNumberVehiclesInHouseholdSet=function(){var F=["numberCarsInHousehold"];var L="";var A={getListAreaId:function(){return L},errorPlacements:function(){return{login:jq("#errorMsg_numberCarsInHousehold")}},clickedElem:"undefined",formHeader:"undefined",listEditArea:{initFields:function(M){}},bindEvents:function(){bindEvents()},isValid:function(){return jq("#"+L+"form").valid()}};function B(){return F}function I(N,M){rlAbstractForm.fillEnumList(N,M)}function H(M,N){rlAbstractForm.setData(M,N,undefined,L)}function K(O,N,M){return rlAbstractForm.getData(F,O,undefined,L)}function E(N,M){rlAbstractForm.setData(N,M,undefined,L)}function D(N,M){return rlAbstractFormFieldSet.onError(N,M)}function C(){jq.each(F,function(N,M){rlAbstractForm.setData(M,"",undefined,L)})}function G(O,N){var M=N||{};var P=K(jq.extend({},M),O);var Q=rlAbstractFormFieldSet.getDiffs(F,M,P);return Q}function J(){var M={name:"numberVehiclesInHouseholdSet",coreId:["profile"],getFieldsNames:B,callbackLoadedList:I,callbackLoadedData:H,callbackBeforeSaveData:K,callbackAfterSaveData:E,callbackError:D,callbackClearData:C,getDiffs:G};rlAbstractForm.registerComponent(M)}return{__init__:function(){},registerComponent:function(){J()},initForm:function(Q,P){console.log("numberVehiclesInHouseholdSet::initForm: "+Q);var M=rlPage.isEditMode()||rlPage.isDesignMode();if(!M){L=Q;var O="#"+Q;rlAbstractFormFieldSet.initDefaultActions(A);var N=jq("#"+A.getListAreaId()+"form").closest("form");if(N){N.bmwValidate("addErrorPlacements",A.errorPlacements());N.bmwValidate("modifyValidationMessages",P)}else{console.warn("numberVehiclesInHouseholdSet::initForm: form not found")}jq.extend(jq.validator.messages,{required:function(){return jq(O+"RequiredFieldLabel").html()}})}}}}();var rlPasswordresetInit=function(){var J="";var A="";function H(L){if(!L.length){return false}validator=jq(L[0].form).validate();var K=validator.element(L[0]);return K}function C(O,N){var K=rlPage.isEditMode()||rlPage.isDesignMode();J=O;A="#"+J;if(!K){var L=jq(A).closest("form");if(L&&L.length){var M={passwordresetLogin:jq(A+"errorMsg_login")};L.bmwValidate({bmwValidate:{highlightErrorClass:"componentSetHighlightError"},onkeyup:false,errorClass:"componentSetFieldErrorTextArea"});L.bmwValidate("addErrorPlacements",M);L.bmwValidate("modifyValidationMessages",N)}else{console.warn("passwordresetInitComponent::initForm: form not found or previewMode")}}}function D(L){var O={};var K=L.validationErrors?[].concat(L.validationErrors):undefined;var M=(L&&L.error&&L.error.errorCodeId)?L.error.errorCodeId:null;if(M!=null&&M===rlLoginservice.ERROR_CODE_ACCOUNT_NOT_ACTIVATED){F()}if(jq.isArray(K)){var N=[];jq.each(L.validationErrors,function(P,Q){N.push(Q.errorMessage)});O.passwordresetLogin=N.join("<br/>")}else{if(L.error&&L.error.errorMessage){O.passwordresetLogin=L.error.errorMessage}}return O}function I(M){var K=jq("#"+M+"login");G();if(H(K)){rlBmwStateOverlay.addDitherToContainer({_containerId:"gplContent",container:jq(".gplContent")});rlBmwStateOverlay.showLoadingState();var L={data:{login:K.val()},success:function(N){rlBmwStateOverlay.hideState();rlUserDialog.showPasswordLinkSendDialog(jq(A+"CloseLabel").val())},error:function(N){rlBmwStateOverlay.hideState();var O=D(N);jq(A).closest("form").bmwValidate("handleFieldErrors",O)},validationError:function(N){rlBmwStateOverlay.hideState();var O=D(N);jq(A).closest("form").bmwValidate("handleFieldErrors",O)}};rlCoreServices.resetPassword(L)}return false}function F(){jq("#passwordresetInitLaye_errorState_resendActivationLink").show()}function G(){jq("#passwordresetInitLaye_errorState_resendActivationLink").hide()}function B(){var K=E();rlLoginservice.resendActivationMail({mail:K.passwordresetLogin,success:function(L){rlUserDialog.showResendActivationLinkInfoDialog()},error:function(L){}})}function E(){return jq(".resetpasswordInitFields :input").serializeObject()}return{__init__:function(){},__start__:function(){},initComponent:function(L,K){console.log("passwordresetInitComponent::initForm: "+L);C(L,K);jq("#passwordresetInitLayer_resendActivation").click(function(){B()})},requestLink:function(K){return I(K)},showResendActivationLink:F,hideResendActivationLink:G}}();var rlPlannedPurchaseSet=function(){var N=["plannedPurchase","noPurchasePlanned"];var B="";var S=new Date();var J={getListAreaId:function(){return B},errorPlacements:function(){return{plannedPurchase_month:jq("#errorMsg_plannedPurchase"),plannedPurchase_year:jq("#errorMsg_plannedPurchase")}},groups:{plannedPurchase:"plannedPurchase_month plannedPurchase_year"},extendedRuls:{plannedPurchase_month:{required:"#noPurchasePlanned:unchecked"},plannedPurchase_year:{required:"#noPurchasePlanned:unchecked"}},clickedElem:"undefined",formHeader:"undefined",listEditArea:{initFields:function(T){}},bindEvents:function(){bindEvents()},isValid:function(){return jq("#"+B+"form").valid()}};function G(){rlAbstractForm.setData("plannedPurchase_year","",B);rlAbstractForm.setData("plannedPurchase_month","",B);rlAbstractForm.setData("plannedPurchase","",B);jq.each(N,function(U,T){rlAbstractForm.setData(T,"",B)});jq("input:checkbox[name='noPurchasePlanned']").attr("checked","checked")}function M(V,U){var T=U||{};var W=O(jq.extend({},T),V);var X=rlAbstractFormFieldSet.getDiffs(N,T,W);return X}function P(){var T={name:"plannedPurchaseSet",coreId:["profile"],getFieldsNames:L,getCacheFieldsNames:function(){return N.concat(["plannedPurchase_month","plannedPurchase_year"])},callbackLoadedList:D,callbackLoadedData:H,callbackBeforeSaveData:O,callbackAfterSaveData:F,callbackError:E,callbackClearData:G,getDiffs:M};R();rlAbstractForm.registerComponent(T)}function L(){return N}function R(){var T=S.getFullYear();var U=T+5;rlAbstractForm.fillDateEnumList("plannedPurchase_year",T,U)}function D(V,U,T){}function H(U,T){A(U,T)}function A(Z,W){if(Z==="plannedPurchase"&&W){var Y=W.split("-");var X=Y[1];var V=Y[0];var U=X+"/"+V;rlAbstractForm.setData("plannedPurchase_year",V,B);rlAbstractForm.setData("plannedPurchase_month",X,B);rlAbstractForm.setData("plannedPurchase",U,B)}if(Z==="noPurchasePlanned"&&typeof W!=="undefined"){rlAbstractForm.setData(Z,W,B);if(W+""==="true"){var T=jq(".noPurchasePlannedLabel:first").text();jq("span.plannedPurchaseReadOnly").text(T)}}jq(".plannedPurchase_month").click();jq(".plannedPurchase_year").click()}function I(){var T=rlAbstractForm.getData(["plannedPurchase_year","plannedPurchase_month"]);var U=null;if(T){U=T.plannedPurchase_year+"-"+T.plannedPurchase_month+"-01"}return U}function O(W,V,T){var U=jq('input:checkbox[name="noPurchasePlanned"]').is(":checked");var X=I();if(U||X==null){W.noPurchasePlanned=true;delete W.plannedPurchase}else{W.noPurchasePlanned=false;W.plannedPurchase=X}return W}function F(U,T){A(U,T)}function E(U,T){return rlAbstractFormFieldSet.onError(U,T)}function Q(T){if(T.val()===""){T.addClass("required");$plannedPurchase.val(null)}else{T.removeClass("required")}}function C(){var U=jq("input[name=plannedPurchase]");var V=jq(".plannedPurchase_month");var T=jq(".plannedPurchase_year");if(V.val()>0&&T.val()>0){U.val(V.val()+"/"+T.val())}else{U.val("")}if(U.hasClass("required")){Q(V);Q(T)}}function K(W){var T=jq(':input[name="plannedPurchase_year"],:input[name="plannedPurchase_month"]');var V=jq('input:checkbox[name="noPurchasePlanned"]').is(":checked");if(V){T.attr("disabled","disabled").val("-")}else{T.removeAttr("disabled")}var U=jq("#"+J.getListAreaId()+"form").closest("form");if(U&&U.bmwValidate){U.bmwValidate("extendRules",{plannedPurchase_month:{required:!V},plannedPurchase_year:{required:!V}})}if(W){T.valid()}}return{__init__:function(){jq('input:checkbox[name="noPurchasePlanned"]').change(K);jq("input:checkbox[name='noPurchasePlanned']").attr("checked","checked");K(undefined);jq(".plannedPurchase_month, .plannedPurchase_year").click(C)},registerComponent:function(){P()},initForm:function(W,V){console.log("plannedPurchaseSet::initForm: "+W);var T=rlPage.isEditMode()||rlPage.isDesignMode();if(!T){B=W;idPrefix="#"+B;rlAbstractFormFieldSet.initDefaultActions(J);var U=jq("#"+J.getListAreaId()+"form").closest("form");if(U){U.bmwValidate("addErrorPlacements",J.errorPlacements());U.bmwValidate("modifyGroups",J.groups);U.bmwValidate("modifyValidationMessages",V)}else{console.warn("plannedPurchaseSet::initForm: form not found")}jq.extend(jq.validator.messages,{required:function(){return jq(idPrefix+"RequiredFieldLabel").html()}})}}}}();var rlProfileDataSink=function(){function E(G){var I=G.addresses;if(I!=null){G.addresses={address:I}}var F=G.plannedPurchase;if(typeof F==="undefined"){G.purchasePlanned="unknown";G.plannedPurchase=undefined}else{if(F.isPlanned==="yes"){G.purchasePlanned="yes";G.plannedPurchase=F.date}else{G.purchasePlanned="no";G.plannedPurchase=undefined}}if(typeof G.optionalFields!=="undefined"){var H=[];jq.each(G.optionalFields,function(J,K){var L=null;if(typeof K!="undefined"&&K!=null){L=jq.isArray(K)?K.join(","):K}H.push({key:J,value:L})});G.optionalFields={optionalField:H}}}function D(F,G){if(typeof F.hobbies!=="undefined"){G.hobbies={interestKeys:F.hobbies.join(",")};delete F.hobbies}if(typeof F.technologies!=="undefined"){G.technologies={interestKeys:F.technologies.join(",")};delete F.technologies}if(typeof F.vehicleInterests!=="undefined"){G.vehicleInterests={vehicleInterest:F.vehicleInterests};delete F.vehicleInterests}}function C(G){var F=[];G.validationError=[].concat(G.validationError);jq.each(G.validationError,function(I,J){var H={fieldName:J.errorFieldKey.replace("$","."),errorKey:J.errorCodeId,messageText:J.errorMessage};if(H.fieldName.indexOf("profile")!==0){H.fieldName="profile."+H.fieldName}F.push(H)});return F}function A(F){return{validationError:[{errorFieldKey:"captcha.input",errorCodeId:F.errorCodeId,errorMessage:F.errorMessage,actionType:F.action}]}}function B(F,G){if(G){G(C(F))}}return{create:function(F){var G=jq.extend(true,{},F.data.profile);G.captcha=jq.extend(true,{},F.data.captcha);E(G);G.context={leadContext:G.leadContext};delete G.leadContext;delete F.captcha;rlCoreServices.createProfile({data:G,success:F.success||jq.noop,error:function(H){if(H.errorCodeId==="INVALID_CAPTCHA_SOLUTION"){B(A(H),F.validation)}else{if(F.error){F.error(H)}}},validation:function(H){B(H,F.validation)}})},save:function(F){var G=jq.extend(true,{},F.profile);var H={};E(G);D(G,H);if(F.useMock===true){console.info("dataSink.save() - profile:",G);console.info("dataSink.save() - interests:",H);F.success()}else{rlCoreServices.saveProfile(G,function(I){if(!jq.isEmptyObject(H)){rlCoreServices.saveInterests(H,F.success||function(){},function(J){console.log(J);F.error(J)},function(J){B(J.validationErrors,F.validation)})}else{jq(window).trigger(rlProfileDataSink.getDataChangedTriggerName(),F.profile);F.success()}},function(I){console.log(I);F.error(I)},function(I){B(I.validationErrors,F.validation)})}},getDataChangedTriggerName:function(){return"profileDataChanged"}}}();var rlRequestForm=function(){return{__init__:function(){},__start__:function(){var A=jq(".requestFormProperties").attr("data-backgroundImage");if(jq(".formBaseParameters[data-usewizardsteps]").data("usewizardsteps")!==true){rlLayerBackground.attachBackgroundImage(".rfxFormContainer",A)}}}}();var rlResultPageHeadline=function(){var E={};var D=false;function B(H,F){var G=H;E=F;rlComponentLoader.deferredExec(["coreServices"],function(){rlCoreServices.isLoggedIn({loggedIn:A,loggedOut:C})});if((!D&&E.showRpHlAnonymousUser!="true")||(D&&E.showRpHlLoggedInUser!="true")||(E.showRpHlLoggedInUser!="true"&&E.showRpHlAnonymousUser!="true")){jq("#"+G).parents(".resultPageHeadline").hide()}}function A(){D=true}function C(){D=false}return{__init__:function(){},__start__:function(){},initComponent:function(G,F){B(G,F)}}}();var rlRfiCheckBoxFS=function(){function A(B,I){var E=CoreFormsBase.inheritanceFrom(rlFormFieldSet.createFS(B,I));var G=E.parent;E.typeName="rlRfiCheckBoxFS";var D=B.find(".fieldSetFieldCheckbox");E.getValueRenderers=function(J){J.singleCheckbox=function(N,M,K,L){if(M===true){L.text(" ");L.addClass("spriteLabel spriteLabelCheckedGreen12")}else{L.removeClass("spriteLabel spriteLabelCheckedGreen12");L.text("--")}};return J};E.getFieldMappers=function(J){J.checkboxWithLabel={get:function(M,L){var K=L.parents(".fieldSetEditAreaRow").find("label");return K.text()+": "+L.prop("checked")},set:function(M,L,K){}};J.singleCheckbox={get:function(M,L){var K=E.getFieldsetProperties().rficheckboxmaterialcodes;return L.prop("checked")&&K?K.split(","):null},set:function(M,L,K){K.prop("checked",L===true)}};return J};E.preInit=function(){G.preInit();I.containerEvents.subscribe(I.containerEvents.names.POLL_NEED_RFI_METADATA,function(K,J){E.triggerEvent(I.allEvents.names.NEED_RFI_METADATA,true)})};E.init=function(){G.init();D.click(function(){H()});C()};var F=function(K){var J=true;jq.each(K,function(M,L){if(L.typeName=="rlCampaignInfoMaterialFS"){B.find(".notUniqueFieldSetNagMessage").css("display","block");J=false;return J}});return J};E.getAuthorValidationRules=function(){var J=G.getAuthorValidationRules();return J.concat([{validate:F},rlFormFieldSetDefaults.getAuthorValidationRules().requireAddressRefToggle(B)])};function C(){E.triggerEvent(I.allEvents.names.STATUS_RFI_CHECK_BOX,D.prop("checked"))}function H(){C()}return E}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlRfxFormTypeMapper=(function(){function A(F){var E=undefined;var B=F.jsmodulevar;var C=F.instantdownloadenabled;var D=F.campaignisstayinformed;switch(B){case"rlUserRegisterForm":E="REGISTRATION";break;case"rlCampaignResponseForm":D?E="ROI":E="CR";break;case"rlRfxDloForm":E="DLO";break;case"rlRfxContactForm":E="CONTACT";break;case"rlRfxRfaForm":E="RFA";break;case"rlRfxRfoForm":E="RFO";break;case"rlRfxRfpForm":E="RFP";break;case"rlRfxTdaForm":E="TDA";break;case"rlRfxRfiForm":E="RFI";break;case"rlRfxRfiDownloadForm":C?E="download_RFI":E="formdownload_RFI";break;case"rlEspForm":E="ESP";break;case"rlRfxRfoSpecialCustomerForm":E="scRFO";break;default:break}return E}return{__init__:function(){},__start__:function(){},getRfxType:A}}());var rlRfxRfaForm=function(){function A(D,E){var B=CoreFormsBase.inheritanceFrom(rlRfxForm.create(D,E));var C=B.parent;B.typeName="rlRfaForm";B.getUseCaseMetaDataRoot=function(){return"rfaRequest"};B.getContext=function(){return"RFX"};B.getDataSink=function(F){return rlRfaDataSink.createDataSink(F)};B.onReady=function(H){C.onReady(H);var G=window.rfxContextParams;if(typeof (G)!="undefined"){var F=G.accessoryName+", "+G.priceFormatted+", "+G.availableFor;jq(".fieldSetFieldTextarea",D).val(F)}};return B}return{__init__:function(){},__start__:function(){},create:function(B,C){return A(B,C)}}}();var rlRfxRfiForm=function(){function A(D,E){var B=CoreFormsBase.inheritanceFrom(rlRfxForm.create(D,E));var C=B.parent;B.typeName="rlRfxRfiForm";B.getContext=function(){return"RFI"};B.getUseCaseMetaDataRoot=function(){return"rfiRequest"};B.getDataSink=function(F){return rlRfiDataSink.createDataSink(F)};B.trackFormSubmitData=function(F){if(isDefined(F)&&isDefined(F.infoMaterial)&&isDefined(F.infoMaterial.materialCodes)){if(jq.isArray(F.infoMaterial.materialCodes)){jq.each(F.infoMaterial.materialCodes,function(G,I){var H={formAttributes:D.data(),materialCode:I};jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_LISTENER_NOTIFICATION,{id:"rfiTrackFormSubmitData",info:H,type:rlTrackingListener.TRACKING_TYPES.FORM})})}}};return B}return{__init__:function(){},__start__:function(){},create:function(B,C){return A(B,C)}}}();var rlRfxRfpForm=function(){var B={};function A(E,F){var C=CoreFormsBase.inheritanceFrom(rlRfxForm.create(E,F));var D=C.parent;C.typeName="rlRfxRfpForm";C.getUseCaseMetaDataRoot=function(){return"rfpRequest"};C.getContext=function(){return"RFP"};C.getDataSink=function(G){return rlRfpDataSink.createDataSink(G)};C.onReady=function(G){D.onReady(G);var H;if(typeof window.rfxContextParams!="undefined"){H=window.rfxContextParams.configId}if(typeof H=="undefined"&&!C.isUseMock()){C.switchToResultMode({},"RFP not allowed without config Id")}};return C}return{__init__:function(){B=rlEventTracker.create()},__start__:function(){},create:function(C,D){return A(C,D)}}}();var rlRfxTdaForm=function(){function A(D,E){var B=CoreFormsBase.inheritanceFrom(rlRfxForm.create(D,E));var C=B.parent;B.typeName="rlTdaForm";B.getUseCaseMetaDataRoot=function(){return"tdaRequest"};B.getContext=function(){return"TDA"};B.getDataSink=function(F){return rlTdaDataSink.createDataSink(F)};return B}return{__init__:function(){},__start__:function(){},create:function(B,C){return new A(B,C)}}}();var rlRfxTrackingAdapter=(function(){var R=[];var d;var j;var F=1;var a=0;var O="";var H=false;function f(){R.formCreate={buildId:function(){return V()+b()+Y()+"?page="+K()+S()},buildName:function(){return"rfxAction/layer/open"}};R.formInitialClick={buildId:function(){return"process/"+V()+"/interact/step=1"},buildName:function(){return"CustomEvent:process/interact"}};R.formClose={buildId:function(k){if(!U(k)){if(!X(k)&&V()==="form_scRFO"){return V()+b()+"?state=cancel&page="+K()}else{return V()+b()+"?page="+K()+S()}}return undefined},buildName:function(k){if(!X(k)){return"rfxAction/layer/cancel"}return undefined},customAction:function(k){if(!U(k)&&!X(k)){G()}}};R.formSubmit={buildId:function(){return V()+b()+"?page=sent"+S()},buildName:function(){return"rfxAction/layer/open"}};R.formSuccess={customAction:function(){G()}};R.formError={buildId:function(){return V()+b()+Y()+"?page=sent"},buildName:function(){return"rfxAction/layer/error"},customAction:function(){G()}};R.clickHeaderStep={buildId:function(){return V()+b()+"?page="+L()+S()},buildName:function(){return"rfxAction/layer/stepping"}};R.clickNextButton=R.clickHeaderStep;R.clickBackButton=R.clickHeaderStep;R.rfxConfirmationSaveConfigButton={buildId:function(){return"button/RFO_SaveConfig@"+C()},buildName:function(){return"CustomEvent:click/button"}};R.rfxConfirmationViewConfigButton=[{buildId:function(){return"button/RFO_ViewConfig@"+C()},buildName:function(){return"CustomEvent:click/button"}},{buildId:function(){return"process/ESP/cancel/step="+e()},buildName:function(){return"CustomEvent:process/cancel"}}];R.rfxConfirmationBackToConfigButton=[{buildId:function(){return"button/RFO_BackToNcc@"+C()},buildName:function(){return"CustomEvent:click/button"}},{buildId:function(){return"process/ESP/leave/target=ncc/from/step="+e()},buildName:function(){return"CustomEvent:process/leave"}}];R.rfiTrackFormSubmitData={buildId:function(l){var k=C()=="RFI"?"form":l.info.formAttributes.instantdownloadenabled?"download":"formdownload";return"rfiBrochureRequest/"+k+b()+"_"+l.info.materialCode},buildName:function(){return"rfxAction"}};R.openSwitchLayer={buildId:function(k){if(c()){return k.info.type+"_RFI"+b()}else{return k.info.type+"_"+C()+b()}},buildName:function(){return"rfxAction/layer/open"}};R.closeSwitchLayer={buildId:function(k){if(!E(k)){return k.info.type+"_"+C()}return undefined},buildName:function(){return"rfxAction/layer/close"},customAction:function(l){if(!E(l)){G()}else{var k=l.info.type+"_"+C();if(c()){k=l.info.type+"_RFI"}if(l.info.type=="typeswitch"){k+=b()}M(k)}}};R.selectSwitchLayer={buildId:function(k){if(!B(k,rlTrackingListener.FORM_IDS.FORM_CREATE,rlTrackingListener.SWITCHLAYER_IDS.OPEN_LAYER)){if(k.info.type=="typeswitch"){if(c()){return k.info.type+"_RFI"+b()+"/button_"+k.info.rfiType}else{return k.info.type+"_"+C()+b()+"/button_"+k.info.type}}else{return k.info.type+"_"+C()+"/button_"+k.info.subBrand}}return undefined},buildName:function(){return"rfxAction/layer/click"}};R.changeSwitchLayer={buildId:function(k){return V()+b()+"/brandswitch"},buildName:function(){return"rfxAction/layer/click"},customAction:function(k){M(V()+b());if(c()){d="RFI"}}}}function N(){if(H){var l="[RFXTrackingAdapter] ",k;for(k=0;k<arguments.length;k+=1){l=l+arguments[k]}console.log(l)}}function b(){if(isDefined(j)&&j.length>0){return"@"+j}else{return""}}function S(){if(O!=""){return"&path="+O}return""}function C(){return d}function V(){if(d=="download_RFI"||d=="formdownload_RFI"){return d}return"form_"+d}function Y(){if(d=="CONTACT"&&rlContextObject.isDealer()){if(isDefined(window.dealerOfferReferenceId)){return"/dealeroutlet_offer"}else{return"/dealeroutlet_default"}}return""}function c(){return d.toUpperCase().indexOf("RFI")!=-1}function K(){return F}function L(){return a}function e(){return rlComponentLoader.isRunning("espTrackingAdapter")?rlEspTrackingAdapter.getCurrentEspStep():1}function E(k){return B(k,rlTrackingListener.SWITCHLAYER_IDS.SELECT_LAYER,rlTrackingListener.SWITCHLAYER_IDS.OPEN_LAYER)}function U(k){return B(k,rlTrackingListener.FORM_IDS.SWITCH_LAYER,rlTrackingListener.FORM_IDS.FORM_CREATE)}function X(k){return B(k,rlTrackingListener.FORM_IDS.FORM_SUBMIT,rlTrackingListener.FORM_IDS.FORM_CREATE)}function B(o,n,m){var k=false;for(var l=o.listenerData.trackingHistory.length-1;l>0;l--){var p=o.listenerData.trackingHistory[l].id;k=(p==n);if(k||p==m){break}}return k}function M(k){if(O==""){O=k}else{O+="/"+k}}function G(){d=undefined;j=undefined;F=1;a=0;O=""}function D(k){N("data-tracking-id=",k.id,", data-tracking-info=",k.info,", data-tracking-type=",k.type);return R[k.id]}function g(k){if((isUndefined(d)||c())&&P(k)){return rlRfxFormTypeMapper.getRfxType(k.info.formAttributes)}else{if(isUndefined(d)&&W(k)){return k.info.rfxType}}return d}function Q(k){if(isDefined(k.info)&&isDefined(k.info.formAttributes)){j=k.info.formAttributes.subbrand}else{if(isDefined(k.info)&&isDefined(k.info.subBrand)){j=k.info.subBrand}else{if(isDefined(k.info)&&isDefined(k.info.subbrand)){j=k.info.subbrand}}}}function Z(k){if(k.type===rlTrackingListener.TRACKING_TYPES.FORM_WIZARD){if(k.id==="switchToWizardStep"){F=1+k.info}if(k.id==="clickHeaderStep"||k.id==="clickNextButton"||k.id==="clickBackButton"){a=1+k.info}}}function P(k){return isDefined(k)&&k.type==rlTrackingListener.TRACKING_TYPES.FORM&&k.id==rlTrackingListener.FORM_IDS.FORM_CREATE}function W(k){return isDefined(k)&&k.type==rlTrackingListener.TRACKING_TYPES.SWITCHLAYER&&k.id==rlTrackingListener.SWITCHLAYER_IDS.OPEN_LAYER}function I(l,k){if(isDefined(k.info)&&isDefined(k.info.formAttributes)&&k.info.formAttributes.donottrack==true){return false}return(isDefined(l)&&l!="ESP")||(isUndefined(l)&&isDefined(d)&&k.id=="formClose")}function T(){jq(window).bind(rlTrackingListener.EVENTS.EVENT_TRACKING_NOTIFICATION,function(k,l){var m=g(l);if(I(m,l)){d=m;Q(l);Z(l);J(l)}})}function J(m){var l=D(m);if(l){var k=[].concat(l);jq.each(k,function(n,o){A(o,m)})}}function A(k,m){if(jq.isFunction(k.buildId)&&window.rlCoreServices&&window.rlCoreServices.trackEventAsClick){var n=k.buildId(m);var l=k.buildName(m);if(n&&l){N("fire track event: id=",n,", name=",l);window.rlCoreServices.trackEventAsClick(n,l)}}if(jq.isFunction(k.customAction)){k.customAction(m)}}return{__init__:function(){f();T()},__start__:function(){H=jq.cookie("EnableTrackingLog")=="all"||jq.cookie("EnableTrackingLog")=="rfx"}}}());var rlSalesChannelFS=function(){function A(P,H){var E=rlPage.isEditMode()||rlPage.isDesignMode();var O=CoreFormsBase.inheritanceFrom(rlFormFieldSet.createFS(P,H));var L=O.parent;O.typeName="rlSalesChannelFS";var Q={};O.init=function(){L.init();C();N()};O.onFormReady=function(){L.onFormReady();if(!E){I();F();K()}};O.restoreStateFromCookie=function(){L.restoreStateFromCookie();if(H.subBrand==="BI"&&!E){F();K()}};O.getEditedData=function(R){if(isDefined(Q.fieldsetProperties.saleschannelcount)&&parseInt(Q.fieldsetProperties.saleschannelcount)<=1){var S=J();if(isDefined(S)){R.preferredSalesChannel=jq(S).val()}return R}return L.getEditedData(R)};O.getMetaDataRenderers=function(R){R.salesChannelSelection=function(U,S,T){if(isDefined(S)&&jq.isArray(S.valueList)){P.find(".saleschannelradio").each(function(V,W){M(W,S.valueList)});P.find("select[data-field=preferredSalesChannel] option").each(function(V,W){M(W,S.valueList)})}};return R};function I(){if(G()){rlRfxViewHelper.show(P,function(){H.allEvents.trigger(H.allEvents.names.FIX_DOUBLED_STRUCTURE_ELEMENTS);jq(window).trigger(rlFormFieldSet.EVENT_FIELDSET_SIZE_CHANGED)})}else{if(P.is(":visible")){rlRfxViewHelper.hide(P,function(){H.allEvents.trigger(H.allEvents.names.FIX_DOUBLED_STRUCTURE_ELEMENTS);jq(window).trigger(rlFormFieldSet.EVENT_FIELDSET_SIZE_CHANGED)})}else{P.hide();H.allEvents.trigger(H.allEvents.names.FIX_DOUBLED_STRUCTURE_ELEMENTS)}H.validatorEventsController.deactivateCommunicationsFSDynamicValidator();B()}}function G(){if(H.subBrand!=="BI"||(isDefined(Q.fieldsetProperties.saleschannelcount)&&parseInt(Q.fieldsetProperties.saleschannelcount)<=1)){return false}else{return true}}function F(){if(D()==true){H.allEvents.trigger(H.containerEvents.names.SHOW_DLO_FS)}else{H.allEvents.trigger(H.containerEvents.names.HIDE_DLO_FS)}}function D(){var R=true;if(G()){if(P.find(":selected")[0]){R=P.find(":selected").attr("data-dlo")==="true"}else{if(P.find("input[type=radio]:checked")[0]){R=P.find("input[type=radio]:checked").attr("data-dlo")==="true"}}}return R}function C(){Q.fieldsetProperties=O.getFieldsetProperties()}function N(){P.change(function(){if(!E){F()}K()})}function M(S,R){S=jq(S);jq.each(R,function(T,U){if(S.attr("value")==U.key){O.setTextInElement(S,U.value);O.setTextInElement(jq("label[for="+S.attr("id")+"]"),U.value);return false}})}function K(){var R;if(G()){R=P.find(":selected");if(R.length===0){R=P.find("input[type=radio]:checked")}}else{R=J()}if(H.subBrand==="BI"&&isDefined(R)&&R.attr("data-phone")==="true"){H.validatorEventsController.activateCommunicationsFSDynamicValidator()}else{H.validatorEventsController.deactivateCommunicationsFSDynamicValidator()}}function J(){var T;if(isDefined(Q.fieldsetProperties.saleschannelcount)&&parseInt(Q.fieldsetProperties.saleschannelcount)<=1){var S=P.find(".saleschannelradio")[0];var R=P.find("select[data-field=preferredSalesChannel] option:not(.defaultOption)")[0];if(isDefined(S)){T=jq(S)}else{if(isDefined(R)){T=jq(R)}}}return T}function B(){P.find(".saleschannelradio").each(function(R,S){jq(S).prop("checked",false)});P.find("select[data-field=preferredSalesChannel]").prop("selectedIndex",0)}return O}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlSeparatorFS=function(){function A(B,E){var C=CoreFormsBase.inheritanceFrom(rlFormFieldSet.createFS(B,E));var D=C.parent;C.typeName="rlSeparatorFS";C.supportsInputCache=function(){return false};return C}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlSmallAccordion=function(){var B=[];function A(D,H,I,F){var N={};var L=jq(D);var K=[];function G(){jq(document).ready(function(){L.find("[data-smallAccordionTabName]").each(function(O){var P=jq(this).attr("data-smallAccordionTabName");jq(this).find(":header").first().wrap("<div class='smallAccordion-head ditherWrapper clearfix'>");var Q=jq(this).find(".smallAccordion-head").first();Q.prepend("<div class='ditherOverlay'/>");jq(Q).prepend("<div class='baseIconSprite baseIconSizeMedium smallAccordion-icon'/>");if(P==H){jq(this).addClass("smallAccordion-tab smallAccordion-expanded");jq(Q).find(".smallAccordion-icon").addClass("spriteIconMinusMedium")}else{jq(this).addClass("smallAccordion-tab smallAccordion-collapsed");jq(Q).find(".smallAccordion-icon").addClass("spriteIconPlusMedium")}if(typeof I!="undefined"){jq(I).each(function(R,S){if(P==S){N.disableTab(S)}})}jq(this).find(".smallAccordion-head").next().wrap("<div class='smallAccordion-content'>")});M()})}N.addListener=function(O){K.push(O)};function J(P,O,S){var T={active:P,collapsed:O,expanded:S};for(var R=0;R<K.length;++R){var Q=K[R];Q(T)}}function M(){L.find(".smallAccordion-head").click(function(P){var O=jq(this).parent(".smallAccordion-tab");if(O.hasClass("smallAccordion-disabled")){return }if(O.hasClass("smallAccordion-collapsed")){N.expandTab(jq(O))}else{if(O.hasClass("smallAccordion-expanded")){N.collapseTab(jq(O))}}})}N.expandTab=function(Q){if(typeof Q=="string"){Q=E(Q)}var O;if(Q.hasClass("smallAccordion-collapsed")&&!Q.hasClass("disabled")){L.find(".smallAccordion-expanded").each(function(R,S){O=jq(S);O.find(".smallAccordion-content").slideUp();O.toggleClass("smallAccordion-expanded smallAccordion-collapsed");O.find(".smallAccordion-icon").toggleClass("spriteIconPlusMedium spriteIconMinusMedium")});Q.find(".smallAccordion-content").slideDown({complete:F});Q.toggleClass("smallAccordion-collapsed smallAccordion-expanded");Q.find(".smallAccordion-icon").toggleClass("spriteIconMinusMedium spriteIconPlusMedium");var P="";if(isDefined(O)){P=O.attr("data-smallAccordionTabName")}J(Q.attr("data-smallAccordionTabName"),P,Q.attr("data-smallAccordionTabName"))}};N.collapseTab=function(O){if(typeof O=="string"){O=E(O)}O.find(".smallAccordion-content").slideUp();if(O.hasClass("smallAccordion-expanded")){O.toggleClass("smallAccordion-expanded smallAccordion-collapsed");O.find(".smallAccordion-icon").toggleClass("spriteIconPlusMedium spriteIconMinusMedium");J(O.attr("data-smallAccordionTabName"),O.attr("data-smallAccordionTabName"),"")}};N.collapseAll=function(){L.find(".smallAccordion-expanded").each(function(P,Q){var O=jq(Q);N.collapseTab(O)})};N.getExpandedTabName=function(){var P=L.find(".smallAccordion-expanded");var O;if(typeof P!="undefined"){O=jq(P).attr("data-smallAccordionTabName")}return O};N.isExpanded=function(O){return(O==getExpandedTabName())};N.disableTab=function(P){var O=E(P);if(typeof O!="undefined"){O.addClass("disabled")}};N.enableTab=function(P){var O=E(P);if(typeof O!="undefined"){O.removeClass("disabled")}};function E(O){return L.find("[data-smallAccordionTabName="+O+"]").first()}G();return N}function C(D){return jq(D).attr("data-dloid")}return{__init__:function(){},__start__:function(){},create:function(E,F,H,G){var D=A(E,F,H,G);B[C(E)]=D;return D},getInstance:function(D){return B[C(D)]}}}();var rlStageTeaser=function(){var B;var E;function D(){var F=rlMandator.replaceCoreUrl(rlPage.getNextCoreUrl()+"/perso/services/_{mandatorContext}");B=F+"/campaign/default";E=F+"/campaign/list"}function A(F,I){if(!rlPage.isEditMode()){var G=jq(".stageTeaserContainer");if(typeof I!="function"&&G.length==0){return }var H=function(J){var L=undefined;if(typeof J!="undefined"&&typeof J.campaign!="undefined"){L=J.campaign[F]}if(typeof L=="undefined"){if(typeof I=="function"){I("")}}else{var K=rlJQuery_queryParams.getQueryParam("wcmmode");if(K&&K.length>0&&K!="null"){L+="?wcmmode="+K}jq.ajax({url:L,context:G,success:function(N){var M=C(N);if(typeof I=="function"){I(M)}else{jq(this).html(M)}},error:function(){}})}};rlCrossSubDomainAjax.call({type:"POST",url:B,contentType:"application/json",success:function(J){H(J)},error:function(J,L,K){H("")}})}}function C(G){var H=G.indexOf("<body>");if(H===-1){console.log("Can't find teaser body start.");return""}var F=G.indexOf("</body>");if(F===-1){console.log("Can't find teaser body end.");return""}return G.substring(H+"<body>".length,F)}return{__init__:function(){D()},__start__:function(){A("adfreshmentURL")},loadStageTeaserContent:function(F){A("stageURL",F)},loadStageTeaserList:function(F){rlCrossSubDomainAjax.call({type:"POST",url:E,contentType:"application/json",success:function(G){F(G)},error:function(G,I,H){}})}}}();var rlStaticTagCloud=function(){var A=".staticTagCloud";var G=".infoIconLayerIcon";var D=".staticTagCloudItemClickable span";var C="linkActive";var F="showroom-jsObject";function E(I){var H;jq(G,I).each(function(){var J=jq(this);var K=J.data(F);if(typeof K!="undefined"){K.addOpenListener(function(){if(undefined!==H){jq(D,H).removeClass(C)}jq(D,J).addClass(C);H=J});K.addCloseListener(function(){jq(D,J).removeClass(C)})}else{console.warn("staticTagCloud: JavaScript object not available ... ")}})}function B(){jq(A).each(function(){var H=jq(this);E(H)})}return{__init__:function(){},__start__:function(){jq(document).ready(function(){B()})}}}();var rlValidatorEventsController=function(){function A(B,C){var K={};var H={};var D="rlValidatorEventsController: ";var F="communicationsFSDynamicValidator";function G(M,L){if(isDefined(H[M])){console.error(D+"Listener for '"+M+"' already present!")}else{H[M]=L}}function E(L){if(isDefined(H[L])){delete H[L]}}function I(L){if(isDefined(H[L])){H[L].onDynamicValidatorActivated()}}function J(L){if(isDefined(H[L])){H[L].onDynamicValidatorDeactivated()}}K.setCommunicationsFSDynamicValidatorListener=function(L){G(F,L)};K.removeCommunicationsFSDynamicValidatorListener=function(){E(F)};K.activateCommunicationsFSDynamicValidator=function(){I(F)};K.deactivateCommunicationsFSDynamicValidator=function(){J(F)};return K}return{__init__:function(){},__start__:function(){},create:function(B,C){return A(B,C)}}}();var rlVehicleInterestSet=function(){var E="vehicleInterests";var K="KEY_NOTHING";var b=1;var m=3;var B="";var A=[E];var d="";var l=[];var M=[];var V=0;var r={getListAreaId:function(){return d},clickedElem:"undefined",formHeader:"undefined",listEditArea:{initFields:function(u){}},bindEvents:function(){bindEvents()},isValid:function(){return jq("#"+d+"form").valid()}};function X(){return A}function S(u){M=u;o()}function o(){U().empty();V=0;var y=new ListEnumModel(l);if(M.getSize()>0){for(var x=0;x<M.getSize();x++){var w=s();var v=M.getSeries(x);R(w,y,v);j(w,y.getBodyModelForSeriesKey(v),M.getBody(x))}}else{for(var u=1;u<=b;u++){var w=s();R(w,y,null);j(w,y.getBodyModelForSeriesKey(null),null)}}N();Q()}function s(){if(V<m){var v=t();U().append(v);V++;var u=U().find("div:last");O(u).click(W);G(u).change(H);N();return u}else{return null}}function n(y,w,z){y.empty();var v=(jq.browser&&jq.browser.msie&&jq.browser.msie===true);for(var u=0;u<w.getSize();u++){var x=(w.getKey(u)==z);if(v){y.each(function(AA,AC){var AB=document.createElement("option");AB.selected=x;AB.value=w.getKey(u);AB.text=w.getValue(u);AC.add(AB)})}else{y.append("<option "+(x?"SELECTED ":"")+"value='"+w.getKey(u)+"'>"+w.getValue(u)+"</option>")}}}function R(u,x,w){var v=G(u);n(v,x,w)}function j(u,x,w){var v=u.find('select[name="selBody"]');if(x!=null){v.show();n(v,x,w)}else{v.empty();v.hide()}}function Q(){var w=new Array();var AA=new ListEnumModel(l);for(var z=0;z<M.getSize();z++){var u=M.getSeries(z);var x=AA.getValueForKey(u);var AB=M.getBody(z);var y=AA.getBodyModelForSeriesKey(u);if(y!=null){var v=y.getValueForKey(AB);w.push(x+" "+v)}else{w.push(x)}}if(w.length==0){w.push("---")}jq(".vehicleInterestListReadOnlyTxt").html("<div>"+w.join("</div><div>")+"</div>")}function N(){if(V>=m){p().hide()}else{p().show()}}function c(){return jq("#"+d)}function U(){return jq("#"+d+"_list")}function p(){return jq("#"+d+"_add")}function O(u){return u.find('[name="btnDelete"]')}function t(){return jq("#"+d+"_template").html()}function T(u){return jq(u.currentTarget).parent()}function G(u){return u.find('select[name="selSeries"]')}function Y(u){return G(u).val()}function f(u){return u.find('select[name="selBody"]')}function P(u){var v=f(u).val();return v?v:""}function D(x,w,v){var AA=x.vehicleInterest;if(typeof AA==="object"){console.log("Old data:");console.dir(AA)}var z=U().children();var y=new Array();z.each(function(AC,AF){var AE=jq(AF);var AD=Y(AE);var AB=P(AE);if(AD!=K&&AB!=K){y.push({series:AD,body:AB})}});console.log("New data:");console.dir(y);var u=new Object();u.vehicleInterest=y;return u}function g(){S(new DataModel())}function F(u){console.log("vehicleInterestSetComponent::addNewModelImpl");var w=new ListEnumModel(l);var v=s();if(v!=null){R(v,w,null);j(v,w.getBodyModelForSeriesKey(null),null)}a()}function W(u){console.log("vehicleInterestSetComponent::deleteModelImpl");T(u).remove();V--;if(V<b){F()}N();a()}function a(){jq(".formBoxComponentFooter").hide().show()}function H(v){console.log("vehicleInterestSetComponent::seriesChangedImpl");var u=T(v);var x=new ListEnumModel(l);var w=Y(u);j(u,x.getBodyModelForSeriesKey(w),null)}function C(w,v){console.log("vehicleInterestSetComponent::onLoadList");var u=[{key:K,value:B,dependentFieldValues:{fieldValues:[{key:K,value:B}]}}];l=u.concat(v);g()}function Z(w,v){console.log("vehicleInterestSetComponent::onLoadData");var u;if(typeof v.vehicleInterest==="object"){if(v.vehicleInterest.length===undefined){u=new DataModel([v.vehicleInterest])}else{u=new DataModel(v.vehicleInterest)}}else{u=new DataModel()}S(u)}function k(w,v,u){return D(w,v,u)}function L(v,u){return rlAbstractFormFieldSet.onError(v,u)}function I(){console.log("vehicleInterestSetComponent::onClearData");g()}function e(){o()}function q(w,v){var u=v||{};var x=k(jq.extend({},u),w);var y=rlAbstractFormFieldSet.getDiffs(A,u,x);return y}function J(){console.log("vehicleInterestSetComponent::onStart");var u={name:"vehicleInterestSet",coreId:["vehicleinterest"],getFieldsNames:X,setDataFromCache:function(v){Z("field",v)},getCacheFieldsNames:function(){return["selSeries","selBody"]},callbackLoadedList:C,callbackLoadedData:Z,callbackBeforeSaveData:k,callbackError:L,callbackClearData:I,getDiffs:q,callbackCancelEdit:e,requestType:"interests"};rlAbstractForm.registerComponent(u)}return{__init__:function(){console.log("vehicleInterestSetComponent::__init__")},__start__:function(){console.log("vehicleInterestSetComponent::__start__")},registerComponent:function(){console.log("vehicleInterestSetComponent::registerComponent");J()},initForm:function(AA,z,w,v){console.log("vehicleInterestSetComponent::initForm: "+AA);d=AA;B=v;p().click(F);var u=rlPage.isEditMode()||rlPage.isDesignMode();if(!u){var y="#"+d;rlAbstractFormFieldSet.initDefaultActions(r);var x=jq("#"+r.getListAreaId()+"form").closest("form");x.bmwValidate("addErrorPlacements",r.errorPlacements);x.bmwValidate("modifyValidationMessages",z);jq.extend(jq.validator.messages,{required:function(){return jq(y+"RequiredFieldLabel").html()}})}}}}();function ListEnumModel(A){var C=this;var B=A;this.getKey=function(D){return B[D].key};this.getValue=function(D){return B[D].value};this.getSize=function(){if(typeof B==="object"){return B.length}else{return 0}};this.getIndexForKey=function(F){var E=null;for(var D=0;D<C.getSize();D++){if(C.getKey(D)==F){E=D;break}}return E};this.getValueForKey=function(E){var D=C.getIndexForKey(E);if(D!==null){return C.getValue(D)}else{return""}};this.getBodyModelForSeriesKey=function(E){var D=C.getIndexForKey(E);if(D&&B[D].dependentFieldValues){return new BodyEnumModel(B[D].dependentFieldValues.fieldValues)}else{return null}}}function BodyEnumModel(A){var C=this;var B=[];if(A.length>=0){B=A}else{B=[A]}this.getKey=function(D){return B[D].key};this.getValue=function(D){return B[D].value};this.getIndexForKey=function(F){var E=null;for(var D=0;D<C.getSize();D++){if(C.getKey(D)==F){E=D;break}}return E};this.getValueForKey=function(E){var D=C.getIndexForKey(E);if(D!==null){return C.getValue(D)}else{return""}};this.getSize=function(){if(typeof B==="object"){return B.length}else{return 0}}}function DataModel(A){var C=this;var B=A;this.getSeries=function(D){return B[D].series};this.getBody=function(D){return B[D].body};this.getSize=function(){if(typeof B==="object"){return B.length}else{return 0}}}var rlVideo=function(){var D="//www.bmw.tv/web/player/index.html";var C=rlPage.isEditMode()||rlPage.isDesignMode();var E={};function G(I){var H=I.componentId;if(E[H]!=true){E[H]=true;var J=jq("#"+H);J.attr("title",J.find(".videoItemTitle").text());if(I.videoType=="youtube"){jq("#"+H).click(function(){B(I.youtubeId)})}else{jq(".videoOverlay",J).click({compDiv:J},function(K){var L=K.data.compDiv;window.location.hash="#_"+L.attr("id");document.title=jq(".videoItemTitle",L).text();F(I,L)})}}}function B(L,K){var I=1024;var H=576;var K=typeof K!=="undefined"?1:0;var J='<div class="youtubeIFrameParent"><iframe class="ytplayer" type="text/html" width="'+I+'" height="'+H+'" data-src="//www.youtube.com/embed/'+L+"?wmode=transparent&showinfo=0&rel=0&autoplay="+K+'" frameborder="0"/></div>';jq(".youtubeIFrameParent").remove();jq("body").append(J);jq(".youtubeIFrameParent").hide();rlGlassPaneLayerNext.openDialog({content:".youtubeIFrameParent",flexible:true,flexibleSelector:".glassPaneLayer .ytplayer",onOpen:function(){jq(".glassPaneLayerContent").css({height:jq(".glassPaneLayer .ytplayer").height()+"px"});jq(".glassPaneLayer .ytplayer").attr("src",jq(".glassPaneLayer .ytplayer").attr("data-src"))},onClose:function(){jq(".glassPaneLayer .ytplayer").attr("src","")}})}function A(J){var L="765px";var H="430px";var N=["id="+J.videoId,"spaceID="+J.spaceId,"type=embed","limit=0"];N=N.join("&");var M='<div class="videoIFrameParent" ><iframe id="videoIframe" src="'+D+"?"+N+'" scrolling="no" frameborder="0" allowTransparency="true" hspace="0" vspace="0" style="border: 0; width: '+L+"; height:"+H+'; overflow: hidden"></iframe></div>';var I=jq(M);var K={autoWcmMode:"true",hidescrollbars:"true",allowoverflow:"true",flexible:true,flexibleSelector:"#gplnContentValue",onClose:function(){var P=jq("#videoIframe");var R=P.parents(".videoIFrameParent:first");if(R.length>0){var O=R.find(".videoThumbIFrameOverlay");var Q=R.data("bmw-digital-share-sourceDiv");if(Q){Q.append(O)}R.html("");R.remove()}else{P.remove()}}};K.content=I;rlGlassPaneLayerNext.openDialog(K)}function F(R,Q){var K=R.hidePlaylist;var I="1200px";var P="720px";var M=Q;var J=["id="+R.videoId,"spaceID="+R.spaceId];if(K){J.push("limit=0");P="475px"}J=J.join("&");var L='<div class="videoIFrameParent"><iframe id="videoIframe" src="'+D+"?"+J+'" scrolling="no" frameborder="0" allowTransparency="true" hspace="0" vspace="0" style="border: 0; width: '+I+"; height:"+P+'; overflow: hidden"></iframe></div>';var H=jq(L);if(M){var O=jq(".videoThumbIFrameOverlay",M).detach();H.data("bmw-digital-share-sourceDiv",M)}var N={autoWcmMode:"true",transparent:"true",hidescrollbars:"true",allowoverflow:"true",closebtnxpos:"280",closebtnypos:"63",flexible:true,flexibleSelector:"#gplnContentValue",showContentOnly:true,onClose:function(){var T=jq("#videoIframe");var V=T.parents(".videoIFrameParent:first");if(V.length>0){var S=V.find(".videoThumbIFrameOverlay");var U=V.data("bmw-digital-share-sourceDiv");V.html("");V.remove()}else{T.remove()}}};N.content=H;rlGlassPaneLayerNext.openDialog(N)}return{__init__:function(){jq(window).one(rlComponentLoader.getPageReadyTriggerName(),function(){if(rlCookieController.isRegulationThirdAccepted()||C){var H=window.location.hash;if(H.length>0){var K="#"+H.substr(2);var J=jq(K);var I=jq(".videoOverlay",J);I.click()}}else{rlConsentDisclaimerLayer.registerConsentLayer(".videoOverlay",true)}})},openVideo:function(I,J,H){H.videoId=I;H.spaceId=J;F(H)},openVideoEmbed:function(H,I){options={videoId:H,spaceId:I};A(options)},openYoutube:function(I,H){B(I,H)},__start__:function(){},initComponent:function(H){if(rlCookieController.isRegulationThirdAccepted()||C){G(H)}}}}();var rlWatchlistStandaloneFS=function(){function A(B,F){var C=CoreFormsBase.inheritanceFrom(rlWatchlistBaseFS.createFS(B,F));var D=C.parent;C.typeName="rlWatchlistStandaloneFS";C.onFormReady=function(){D.onFormReady();rlPreferredDealersModel.requestPreferredDealers(function(G){C.updateView(G);if(isDefined(C.options.params.showerrorsinitially)&&C.options.params.showerrorsinitially.toLowerCase()=="true"&&G.length>=rlPreferredDealersModelConfig.getNumMaxPreferredDealers()&&isDefined(window.rfxContextParams)&&window.rfxContextParams.initialError==rlPreferredDealersModel.errorTypes.ERROR_PDM_MAXIMUM_REACHED){D.onPreferredDealersModelError(rlPreferredDealersModel.errorTypes.ERROR_PDM_MAXIMUM_REACHED)}B.show()},function(G){console.error(G);B.hide()})};C.isDloMapVisible=function(){return(rlComponentLoader.isRunning("dloMapStandaloneFS"))};C.onSelectionEvent=function(H,G){if(H=="highlight"){B.find(C.options.divSelectedDealer).removeClass("selected")}};C.buildDealerInfo=function(H){var G=D.buildDealerInfo(H);G.click(E(H));return G};function E(G){return function(){C.toggleBrandContextIfNeeded(G);rlDloEventsController.getController(B).fireSelectionEvent("highlight",G);jq(window).trigger(rlTrackingListener.EVENTS.EVENT_TRACKING_LISTENER_NOTIFICATION,{id:"dealerWatchlistDetails",info:G.key,type:rlTrackingListener.TRACKING_TYPES.LINK});jq(this).addClass("selected");if(window.rlCoreServices&&window.rlCoreServices.trackEventAsClick){window.rlCoreServices.trackEventAsClick("dealerSelectedFromWatchList_"+G.key,"dloAction")}return false}}return C}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();