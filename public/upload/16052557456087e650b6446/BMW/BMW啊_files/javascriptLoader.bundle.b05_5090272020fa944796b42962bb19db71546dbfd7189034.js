(function(G){var E="width:100%; height:100%; background-color:#000; filter:alpha(opacity=70); -moz-opacity:0.7; opacity:0.7; position:fixed; left:0px; top:0px; display:none; z-index:9999999;";var H="width:98%;height:98%;border:0px solid grey;margin:1% auto";var K="width:480px; height:380px; position:fixed; top:190px; left:50%; opacity: 1;background-color:white; margin-left:-240px; display:none; z-index:9999999999;";var J='float: right;background-position: -570px -60px;cursor: pointer;width: 18px;height: 18px;background-image: url("/etc/designs/bmwnext/apps/bmwnext/base/static/parComponents/icon/base/icons.png.resource.1427130402186.png");margin-right: 3px;margin-top: 2px;';var B="<div style='"+E+"' id='popBack'></div>";B+="<div style='"+K+"' id='popBox'>";B+="<div id='popClose' style='"+J+"'></div>";B+="<div id='popContent' style='"+H+"'></div>";B+="</div>";G("body").append(B);var L=document.getElementById("popBack");var A=document.getElementById("popBox");var C=document.getElementById("popClose");var D=parseInt(G("#popBack").width());var F=parseInt(G("#popBack").height());window.onload=function(){C.onclick=function(M){L.style.display="none";A.style.display="none";M.stopPropagation()};L.onclick=function(M){L.style.display="none";A.style.display="none";M.stopPropagation()};A.onclick=function(M){M.stopPropagation()}};var I=function(){return{show:function(O,Q,M,T){var P=20;var S=40;if(Q<25){Q=25}if(Q>(D-2*S)){Q=D-2*S}A.style.width=Q+"px";if(M<100){M=100}if(M>960){M=960}A.style.height=M+"px";if((F-M)>(P*2)){P=(F-M)/2}A.style.top=P+"px";A.style.marginLeft=-(Q/2)+"px";L.style.display="block";A.style.display="block";if(G("#popContent").html()==""){var N="width:"+(Q-10)+"px; height:"+(M-30)+"px; orverflow:auto; margin-top:2px;";var R='<iframe src="'+O+'" frameBorder="0" scrolling="'+T+'" style="'+N+'"></iframe>';G("#popContent").append(R)}}}};$fixPop=new I()})(jQuery);var rlDLOButton=function(){function A(){if(B()==="SHOW"){var F=window.location.href;var H=F.indexOf("zh_CN")>0?"zh_CN":"en_CN";var D=F.indexOf("zh_CN")>0?"zh":"en";var E=F.indexOf("/content/")>0?true:false;var G="/";if(E){G="/content/brandBM/marketCN/countryCN/"}$fixPop.show(G+H+"/common/dealer_locator/dealerlocator_"+D+"_content.html","1280","608","no")}}function B(){return"SHOW"}function C(){var E=rlContextObject.getContextObject();var D=rlContextObject.getBrandSubbrand();var F=E.vehicle.seriesId;if(F!=undefined&&F.toUpperCase()=="I"){return rlTranslator.translate("salesbar_button_dlo_bmwi")}else{if(""!=D&&D!=undefined){if(D=="brand-bmwi"){return rlTranslator.translate("salesbar_button_dlo_bmwi")}else{if(D=="brand-bmw"){return rlTranslator.translate("salesbar_button_dlo_bmw")}}}}return rlTranslator.translate("salesbar_button_dlo_bmw")}return{__init__:function(){},__start__:function(){},getLabel:function(){return C()},getStatus:function(){return B()},click:function(){A()}}}();var rlMyVehiclesButton=function(){function A(){if(B()==="SHOW"){rlUserDialog.showVehicleSelector()}}function B(){if(rlContextObject.getPersoContextId()==="myvehicles"){return"SHOW"}return"HIDE"}function C(){return rlTranslator.translate("salesbar_button_my_vehicles")}return{__init__:function(){},__start__:function(){},getLabel:function(){return C()},getStatus:function(){return B()},click:function(){A()}}}();var rlRFC1Button=function(){function A(){if(B()==="SHOW"){rlUserDialog.showCampaignParticipationDialog()}}function B(){return"SHOW"}return{__init__:function(){},__start__:function(){},getLabel:function(){return rlTranslator.translate("salesbar_button_rfc_stay_informed")},getStatus:function(){return B()},click:function(){A()}}}();var rlAddressRefFS=function(){function A(s,G){var R=CoreFormsBase.inheritanceFrom(rlFormFieldSet.createFS(s,G));var U=R.parent;R.typeName="rlAddressRefFS";var d=s.find(".addressDataSourcePrefix:first").text();var J=".fieldSetViewAreaRow";var r=".fieldSetEditAreaRow";var F="[data-field$='"+d+".addressGUID']";var X={postalCode:{edit:r+" [data-field$='postalCode']",view:J+" [data-field$='postalCode']"},city:{edit:r+" [data-field$='city']",view:J+" [data-field$='city']"},street:{edit:r+" [data-field$='street']",view:J+" [data-field$='street']"},houseNumber:{edit:r+" [data-field$='houseNumber']",view:J+" [data-field$='houseNumber']"},additionalHouseID:{edit:r+" [data-field$='additionalHouseID']",view:J+" [data-field$='additionalHouseID']"},addressStatus:{edit:r+" [data-field$='addressStatus']",view:J+" [data-field$='addressStatus']"},regionCode:{edit:r+" [data-field$='regionCode']",view:J+" [data-field$='regionCode']"},districtName:{edit:r+" [data-field$='districtName']",view:J+" [data-field$='districtName']"},buildingID:{edit:r+" [data-field$='buildingID']",view:J+" [data-field$='buildingID']"},floorID:{edit:r+" [data-field$='floorID']",view:J+" [data-field$='floorID']"},streetType:{edit:r+" [data-field$='streetType']",view:J+" [data-field$='streetType']"},postOfficeBox:{edit:r+" [data-field$='postOfficeBox']",view:J+" [data-field$='postOfficeBox']"},strSuppl1:{edit:r+" [data-field$='strSuppl1']",view:J+" [data-field$='strSuppl1']"},strSuppl2:{edit:r+" [data-field$='strSuppl2']",view:J+" [data-field$='strSuppl2']"},strSuppl3:{edit:r+" [data-field$='strSuppl3']",view:J+" [data-field$='strSuppl3']"},roomID:{edit:r+" [data-field$='roomID']",view:J+" [data-field$='roomID']"},companyName:{edit:"div"+r+" [data-field$='companyName']",view:J+" [data-field$='companyName']"},country:{edit:r+" [data-field$='country']",view:J+" [data-field$='country']"}};var u="div.fieldSetEditAreaRow.companyName";var z=X.addressStatus.view;var b;var i=R.getFieldsetProperties();var C={postalCode:{minLength:i.autocompleteminlengthpostalcode,suggestions:undefined},city:{minLength:i.autocompleteminlengthcity,suggestions:undefined},street:{minLength:i.autocompleteminlengthstreet,suggestions:undefined},houseNumber:{minLength:i.autocompleteminlengthhousenumber,suggestions:undefined},regionCode:{minLength:i.autocompleteminlengthregioncode,suggestions:undefined}};var k={houseNumber:{active:(i.autofillhousenumber==="true")}};p();function AA(AI){return jq.trim(AI)}function p(){for(addressFieldSelectorKey in X){var AJ=X[addressFieldSelectorKey];var AI=s.find(AJ.edit);if(AI.length>0){var AL=AI.attr("data-field");if(AL.indexOf(d+".")!==0){AI.attr("data-field",d+"."+AL)}}var AK=s.find(AJ.view);if(AK.length>0){var AL=AK.attr("data-field");if(AL.indexOf(d+".")!==0){AK.attr("data-field",d+"."+AL)}}}}function AF(){return s.find('input[name^="addressStatus"]:checked')}function j(){var AI=AF();if(AI.length===1){return AI.val()}else{return""}}function V(){return{addressGUID:AA(s.find(F).val()),postalCode:AA(s.find(X.postalCode.edit).val()),city:AA(s.find(X.city.edit).val()),street:AA(s.find(X.street.edit).val()),houseNumber:AA(s.find(X.houseNumber.edit).val()),additionalHouseID:AA(s.find(X.additionalHouseID.edit).val()),addressStatus:j(),companyName:AA(s.find(X.companyName.edit).val()),regionCode:AA(s.find(X.regionCode.edit).val()),districtName:AA(s.find(X.districtName.edit).val()),buildingID:AA(s.find(X.buildingID.edit).val()),floorID:AA(s.find(X.floorID.edit).val()),streetType:AA(s.find(X.streetType.edit).val()),postOfficeBox:AA(s.find(X.postOfficeBox.edit).val()),strSuppl1:AA(s.find(X.strSuppl1.edit).val()),strSuppl2:AA(s.find(X.strSuppl2.edit).val()),strSuppl3:AA(s.find(X.strSuppl3.edit).val()),roomID:AA(s.find(X.roomID.edit).val()),country:AA(s.find(X.country.edit).val()),preferred:true,hasZipAndCity:function(){return this.postalCode!==""&&this.city!==""},isBusiness:function(){return this.addressStatus==="BUSINESS"},isComplete:function(){var AI=this.postalCode!==""&&this.city!==""&&this.street!==""&&this.houseNumber!=="";return AI},isEmpty:function(){return this.postalCode===""&&this.city===""&&this.street===""&&this.houseNumber===""&&this.companyName===""&&this.regionCode===""&&this.districtName===""&&this.buildingID===""&&this.floorID===""&&this.streetType===""&&this.postOfficeBox===""&&this.strSuppl1===""&&this.strSuppl2===""&&this.strSuppl3===""&&this.roomID===""&&this.houseNumberAddition===""},isEquals:function(AJ){if(typeof AJ==="undefined"||AJ===null){return false}var AI=this.allFields();for(var AK=0;AK<AI.length;AK++){if(this[AI[AK]]!==AJ[AI[AK]]){return false}}return true},allFields:function(){return["postalCode","city","street","houseNumber","additionalHouseID","companyName","regionCode","districtName","buildingID","floorID","streetType","postOfficeBox","strSuppl1","strSuppl2","strSuppl3","roomID"]}}}var q=undefined;var y=0;var g=0;var h=false;function AB(){var AI=s.find(X.postalCode.edit);if(AI.length>0){AI.focusout(function(){S(function(AJ){m(AJ);Y(AJ)});jq(".ui-autocomplete").fadeOut(400)})}}function l(){jq.each(X,function(AM,AI){if(!w(AM)){return }var AL=s.find(AI.edit);var AK=C[AM];var AJ=AL.autocomplete({source:function(AO,AN){AN(M(AK.suggestions,AL.val()))},open:function(AN,AO){jq(".ui-autocomplete").addClass("shadow")},close:function(){q={}},focus:function(AN,AO){AL.val(AO.item.value);return false},minLength:AK.minLength,appendTo:s.find(".fieldSetEditMode")}).data("autocomplete");if(AJ){AJ._renderItem=AC}AL.focusin(function(){if(AK.minLength==0&&AK.suggestions&&AK.suggestions.length>0){AL.autocomplete("search",AL.val())}});AL.bind("propertychange keypress input paste",function(AN){if(AL.val().length>=AK.minLength){var AO=V();if(!AO.isEquals(q)){B(AO)}}})})}function S(AJ){h=true;g++;var AI=0+g;rlCoreServices.addressAutocomplete({address:V(),success:function(AK){if(g===AI){AJ(AK||[]);h=false}},error:function(){h=false}})}function m(AK){var AI={};if(jq.isArray(AK)){AI=jq.extend(true,{},AK[0]);for(var AJ=1;AJ<AK.length;AJ++){jq.each(X,function(AL,AM){if(AI[AL]!==AK[AJ][AL]){AI[AL]=undefined}})}}else{if(typeof AK==="object"){AI=AK}}if(AI.houseNumber&&!k.houseNumber.active){AI.houseNumber=undefined}jq.each(X,function(AL,AN){var AO=AL;if(typeof AI[AO]==="undefined"){return true}var AM=s.find(AN.edit).val();if(jq.trim(AM)===""){s.find(AN.edit).val(AI[AO])}})}function B(AI){if(jq(".ui-autocomplete").is(":visible")){y++;setTimeout(function(){y--;if(y===0){S(Y);q=AI}},200)}else{S(Y);q=AI}}function Y(AI){if(!jq.isArray(AI)){AI=[AI]}jq.each(C,function(AO,AL){if(w(AO)){var AN=C[AO];AN.suggestions=[];for(var AK=0;AK<AI.length;AK++){var AJ=AI[AK][AO];if(AJ||AJ===0){AN.suggestions.push(AJ)}}AN.suggestions=makeArrayUnique(AN.suggestions);var AM=jq(X[AO].edit);if(AM.is(":focus")&&AM.val().length>=AN.minLength){AM.autocomplete("search",AM.val())}}})}function w(AI){return(typeof C[AI]!=="undefined"&&C[AI].minLength!==""&&C[AI].minLength>=0)}function M(AI,AJ){if(typeof AI!=="undefined"){var AK=[];for(var AL=0;AL<AI.length;AL++){AK.push({label:AD(AI[AL],AJ),value:AI[AL]})}return AK}}function AC(AI,AJ){return jq("<li class='searchQueryLiveSearchLayerListItem'></li>").data("item.autocomplete",AJ).append(jq("<a class='searchQueryLiveSearchLayerListItemLink'></a>").html(AJ.label)).appendTo(AI)}function AD(AJ,AI){var AK=new RegExp("("+jq.ui.autocomplete.escapeRegex(AI)+")","ig");return AJ.replace(AK,"<em class='searchQueryLiveSearchLayerHighlight'>$1</em>")}var T=0;var I=false;function c(AS){if(h===true){window.setTimeout(function(){c(AS)},200);return }var AR=s.find("input:text:visible").filter(function(){return this.value});if(AR.length===0){if(s.hasClass("fieldSetIsShowingValidationMessage")){AI()}return }var AL="OK";var AP="POSTAL_CODE_CITY_DONT_MATCH";var AO="ADDRESS_CANNOT_BE_VALIDATED";var AK="ADDRESS_INVALID";var AM=V();T++;var AJ=T;function AI(){AS.onValidate(null)}function AN(AW){if(AW===AL){AI();return }var AX={};AX[AP]="EM_UM_ADDRESS_POSTAL_CODE_CITY_DONT_MATCH";AX[AO]="addressCannotBeValidated";AX[AK]="addressInvalid";var AV=AX[AW]||"addressUnknownButSaveable";var AU=(AW===AP||AW===AK);if(!AU){var AT=(s.find("div.suppresswarnings").length>0);if(AT){AI();return }}AS.onValidate({level:AU?"ERROR":"WARNING",fieldName:"address",errorKey:"allErrors",messageText:rlTranslator.translate(AV),validationGroup:"addressCheck"})}function AQ(){rlCoreServices.addressCheckFS(AM,{success:function(AT){if(T===AJ){AN(AT.data["$"])}else{AS.onValidate(null,true)}},error:function(){if(T===AJ){AI()}else{AS.onValidate(null,true)}}})}if(AM.isEmpty()){AI();return }if(s.hasClass("fieldSetIsShowingValidationMessage")){AQ();I=false}else{setTimeout(function(){if(!I){var AT=jq(":focus").first();if(!s.has(AT).length>0){AQ();return }}else{I=false}AS.onValidate(null,true)},40)}}R.allScoringFieldsFilled=function(){return R.hasAddress};R.onFormReady=function(){U.onFormReady();s.find("input[name^='addressStatus']").click(function(){I=true});s.find("input[type='text']").click(function(){I=false})};R.setData=function(AI){U.setData(AI);AH();t(AI)};function t(AJ){R.hasAddress=false;try{if(AJ&&AJ.user&&AJ.user.profile&&AJ.user.profile.addresses){R.hasAddress=AA(AJ.user.profile.addresses.addressGUID)!==""}}catch(AI){console.error("Error finding addresses id: ");console.error(AI)}}function AH(){s.find("span[data-field]").show();s.find(".fieldSetViewMode .addressRow").each(function(AJ,AM){AM=jq(AM);if(AM.hasClass("addressRowDivided")||AM.find(".addressRowDivided").length>0){return }var AI=AM.find("[data-field]");var AL=AM.find("[data-field]:contains(--)");var AK=AI.length===AL.length;if(AK){AL=AL.not(":first")}AL.hide()})}R.getValidationRules=function(AI){AI.addressCheck={liveOnly:true,async:true,event:"focusout",rule:function(AM,AK,AL,AJ){c({fieldName:AM,focusOutSource:AK,onValidate:AJ})}};if(K()){AI.buildingNameOrHouseNumberRequired={event:"focusout",when:"ELEM_INVALIDATED_BY_FORM",rule:D}}return AI};R.getValueRenderers=function(AI){AI.companyNameRenderer=function(AN,AM,AJ,AK){var AL=s.find(z).text();if(AL==="BUSINESS"){AK.text(AM);jq(AK).parents(".fieldSetViewAreaRow").show()}else{jq(AK).parents(".fieldSetViewAreaRow").hide()}};AI.countryRenderer=function(AN,AK,AJ,AL){var AM="--";if(AK!=null&&AK!=""&&typeof AJ!="undefined"&&jq.isArray(AJ.valueList)){jq.each(AJ.valueList,function(AO,AP){if(AK===AP.key){AM=AP.value;return false}})}jq(AL).text(AM)};return AI};function n(AJ,AI){return jq.map(AJ,function(AK){return{label:AD(AK,AI.term),value:AK}})}function AE(AI){AI.attr("checked","checked");s.find(u).hide();AI.click(function(AK){var AJ=s.find(u).is(":visible")?400:0;s.find(u).animate({opacity:0,height:"0px"},AJ,"swing",function(){jq(this).hide()})})}function L(AI){AI.click(function AJ(){s.find(u).show();var AK=s.find(u).is(":visible")?700:0;s.find(u).animate({opacity:1,height:"20px"},AK,"swing")})}var o="<div class='fieldSetRadioButtonGroup clearfix'><input id='${id}' class='fieldSetFieldRadio' type='radio' value='${value}' name='addressStatus'/><label for='${id}' class='fieldSetInputLabel'>${label}</label></div>";function O(AJ,AI){return jq(o.replace(/\${id}/g,R.getUniqueId(AJ,AI.key)).replace(/\${value}/g,AI.key).replace(/\${label}/g,AI.value))}R.getMetaDataRenderers=function(AI){AI.addressStatusRadio=function(AN,AK,AL){if(AK&&AK.valueList){var AJ=AK.valueList;var AM=AJ.slice(0).reverse();jq.each(AM,function(AR,AS){var AO=O(AN,AS);AL.append(AO);var AQ=AO.find("input[type=radio]");AQ.attr("name",AQ.attr("name")+"_"+AO.parent().attr("id"));var AP=AQ.val();var AT=AP.search(/BUSINESS/i);if(AT!=-1){L(AQ)}else{if(AQ.val()==="PRIVATE"||AQ.val()==="CORRESPONDENCE"){AE(AQ)}}})}};AI.countryCode=function(AP,AL,AO){AI.dropdown(AP,AL,AO);b=AL;if(typeof b!=="undefined"&&jq.isArray(b.valueList)){var AK=b.valueList.length;if(AK>1){jq(AO).show().prev().hide()}if(AK===1){var AN=b.valueList[0].key;var AM=b.valueList[0].value;jq(AO).hide().prev().text(AM).show();jq(AO).val(AN);var AJ=jq(AO).find('option[value=""]');if(AJ.length===1){AJ.remove()}}}};return AI};R.getFieldMappers=function(AI){AI.countryMapper={get:function(AK,AJ){return jq(AJ).attr("data-key")},set:function(AM,AL,AK){var AJ=(AL!=null)?AL:rlMandator.getCountry();jq(AK).attr("data-key",AJ);R.getRegisteredValueRenderers().countryRenderer(AM,AJ,b,AK)}};return AI};R.getEditedData=function(AI){if(s.prop("disabled")===true){return AI}var AJ=V();if(!AJ.isBusiness()){delete AJ.companyName}AI.user=AI.user||{};AI.user.profile=AI.user.profile||{};AI.user.profile.addresses=[AJ];return AI};R.setStateFromInputCache=function(AI){U.setStateFromInputCache(AI);AF().click()};R.getRequiredValidators=function(){if(typeof (s.attr("data-no-meta-required-validators"))!="undefined"){return[]}return U.getRequiredValidators()};var e="input[data-field$=houseNumber]";var H="input[data-field$=buildingID]";var N="input[data-field$=postalCode]";var W="input[value='PRIVATE']";var x="input[value='BUSINESS']";var AG="[data-validators*=required]";var Q=e+","+H;var E=false;function K(){return rlMandator.getCountry()==="GB"}function a(){if(!K()){return false}var AK=jq(N);if(AK.length===0){return false}var AI=jq(e);var AJ=jq(H);if(AI.length===0||AJ.length===0){return false}if(AI.filter(AG).length>0){return false}if(AJ.filter(AG).length>0){return false}return true}function Z(){if(a()){var AI=jq(e);var AJ=jq(H);P(AI);P(AJ);var AL=jq(Q).first();var AK=AL.parents(".addressRow").find("span.fieldSetValidationFeedback");AK.attr("data-validationplacements","buildingNameOrHouseNumberRequired");E=true}}function D(){var AI=jq(e);var AK=jq(H);var AL=jq(N);var AJ=jq(W);if(AJ.is(":checked")){if(AL.val()!=""&&AI.val()==""&&AK.val()==""){return{level:"ERROR",fieldName:"address",errorKey:"buildingNameOrHouseNumberRequired",messageText:"Please enter a street number or building name",validationGroup:"buildingNameOrHouseNumberRequired"}}}}function P(AJ){var AK=AJ.attr("data-validators");var AI=["buildingNameOrHouseNumberRequired"];if(AK!=""){AI=AI.concat(AK.split(","))}AJ.attr("data-validators",AI.join(","))}function v(){s.find("input[name='addressType']").change(function(){jq(e).focusout()})}function f(){if(E){var AI=function(AJ){if(isDefined(AJ)&&AJ.length>0){var AK=AJ.parents(".addressRow").find("label.fieldSetRowLabel");var AL=AK.get(0).innerHTML.replace(/\*/,"(*)");AK.text(AL)}};AI(jq(e));AI(jq(H))}}R.onFormReady=function(){U.onFormReady();f()};AB();l();Z();return R}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlCmxServices=function(){function A(C,B,D){var G=C.join(",");var E=rlC2BConfig.getDealerLocatorServiceUrlCmx();var F=E.replace(/_{dealerKey}/g,G);rlCrossSubDomainAjax.call({type:"GET",url:F,dataType:"json",contentType:"application/json; charset=utf-8",success:function(H){B(H)},error:function(H){D(H)}})}return{__init__:function(){},__start__:function(){},requestDealers:function(C,B,D){A(C,B,D)}}}();var rlContractDialogForm=function(){function A(E,F){var B=CoreFormsBase.inheritanceFrom(rlFormBase.create(E,F));var D=B.parent;B.typeName="rlContractDialogForm";B.switchToEditMode=function(){B.resetValidationMessages();jq.each(B.getFieldSetsById(),function(I,H){H.switchToEditMode()})};B.switchToViewMode=function(){B.resetValidationMessages();jq.each(B.getFieldSetsById(),function(I,H){H.switchToViewMode()})};B.setData=function(H){D.setData(H);B.switchToEditMode()};function C(){if(!rlPage.isEditMode()&&!rlPage.isDesignMode()){E.find(".formSubmitButton").click(G)}}function G(){if(B.validate()){rlNccServices.createPreOwnedVehicle({vehicle:B.getEditedData(),success:function(H){rlGlassPaneLayerNext.closeDialog()},fail:function(H){B.showBackendMessages()},error:function(){rlErrorService.handleError({actor:rlErrorService.ACTOR_SYSTEM})}})}}C();B.switchToEditMode();return B}return{__init__:function(){},__start__:function(){jq("#cancelBtn").click(function(){rlGlassPaneLayerNext.closeDialog();return false})},create:function(B,C){return A(B,C)}}}();var rlCurrentvehicle=function(){var A="";return{__init__:function(){jq("#currentvehicle-manufacturer").change(function(B){var C=jq("#currentvehicle-manufacturer").val();if(C!="-1"){jq("#currentvehicle-series").removeAttr("disabled")}else{jq("#currentvehicle-series").attr("disabled","disabled").val("-1")}jq("#currentvehicle-model").attr("disabled","disabled").val("-1");jq("#currentvehicle-series").load(A+".vehicleData.option?_charset_=utf-8&targetField=series&manufacturer="+encodeURI(C))});jq("#currentvehicle-series").change(function(C){var D=jq("#currentvehicle-manufacturer").val();var B=jq("#currentvehicle-series").val();if(B!="-1"){jq("#currentvehicle-model").removeAttr("disabled")}else{jq("#currentvehicle-model").attr("disabled","disabled").val("-1")}jq("#currentvehicle-model").load(A+".vehicleData.option?_charset_=utf-8&targetField=model&series="+encodeURI(B)+"&manufacturer="+encodeURI(D))})},loadInitialData:function(){jq("#currentvehicle-manufacturer").load(A+".vehicleData.option?targetField=manufacturer");jq("#currentvehicle-yearHeadline").load(A+".vehicleData.option?targetField=year");jq("#currentvehicle-usageHeadline").load(A+".vehicleData.option?targetField=usage")},setPath:function(B){A=B}}}();var rlDealerSearchRfxFS=function(){function A(C,G){var D=CoreFormsBase.inheritanceFrom(rlDealerSearchBaseFS.createFS(C,G));var F=D.parent;var E={};D.typeName="rlDealerSearchRfxFS";D.init=function(){F.init();B()};D.onFormReady=function(){F.onFormReady();rlDloWorkflowController.getController(C).addWorkflowListener(D)};D.onFormClosing=function(){F.onFormClosing();rlDloWorkflowController.getController(C).removeWorkflowListener(D)};D.onWorkflowStepChanged=function(K,L,J,I){var H=C.parents(".dloFormSearchArea");switch(K){case 1:if(J.length===0&&I===null){H.show(0)}break;case 2:rlRfxViewHelper.show(H,function(){jq(window).trigger(rlFormFieldSet.EVENT_FIELDSET_SIZE_CHANGED)});break;case 3:if(H.is(":visible")){rlRfxViewHelper.hide(H,function(){jq(window).trigger(rlFormFieldSet.EVENT_FIELDSET_SIZE_CHANGED)})}else{H.hide()}break;default:console.error("Invalid WorkflowStep in dealerSearchRFXFS: "+K)}};D.fireSearchEvent=function(){jq(window).trigger(rlFormFieldSet.EVENT_FIELDSET_SIZE_CHANGED,rlDloSharedConfig.domSelectors.rfxScrollToElem);var H=D.getSearchParams();rlDloEventsController.getController(C).fireSearchEvent(H)};D.fireFilterChangedEvent=function(){jq(window).trigger(rlFormFieldSet.EVENT_FIELDSET_SIZE_CHANGED,rlDloSharedConfig.domSelectors.rfxScrollToElem);var H=D.getSearchParams();rlDloEventsController.getController(C).fireFilterChangedEvent(H)};function B(){E.params=D.getFieldsetProperties()}return D}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlElasticNaviBar=function(){function A(D){var C=D.next(".elasticNaviBar2ndLevel");var B=D.closest(".elasticNaviBar");jq(".elasticNaviBar2ndLevel",B).hide();jq(".elasticNaviBar1stLevelLink",B).removeClass("linkArrow13pxActive");C.show();D.addClass("linkArrow13pxActive")}return{__init__:function(){jq(".elasticNaviBar1stLevelLink").click(function(){var B=jq(this);A(B);return true})},highlightByID:function(B){var C=jq(".elasticNaviBar  #"+B);A(C)}}}();var rlFormFieldSet=function(){function A(J,W){var Q=CoreFormsBase.inheritanceFrom(CoreFormsBase.createBaseType());var L=Q.parent;Q.typeName="rlFormFieldSet";Q.isFieldsetMustBeUniqueInForm=false;var P=J.attr("id");var N;var H;var G=W.feedbackCollector;var D,E,I,B;var V;Q.containerEvents=W.containerEvents;Q.formEvents=W.formEvents;Q.allEvents=W.allEvents;Q.triggerEvent=function(Z){Q.allEvents.trigger.apply(Q.allEvents,arguments)};function K(Z,f){if(typeof (f)==="undefined"||f===null){return undefined}try{var j=f.split(".");var b=Z;while(j.length>0){var g=j.shift();if(typeof b==="undefined"||b==null){return undefined}var i=undefined;var a=Y(g);if(a!=null){var h=g.substring(0,g.indexOf(a));var c=parseInt(a[0].substring(1,a[0].length-1));if(typeof b[h]!=="undefined"){i=b[h][c]}if(typeof i==="undefined"){i=b[h]}}else{i=b[g]}if(typeof i==="undefined"){return undefined}b=i}return b}catch(d){throw ("Error resolving map key: "+f)}}function Y(Z){return Z.match(/\[[0-9]+\]/)}function X(c,b,a){var Z=b.split(".");var d=c;jq(Z).each(function(g,l){if(g<Z.length-1){var k=Y(l);if(k!=null){var h=l.substring(0,l.indexOf(k));var f=parseInt(k[0].substring(1,k[0].length-1));if(d[h]==null){d[h]=[]}var j=d[h][f];if(j==null){j={};d[h].splice(f,0,j)}d=j}else{if(typeof d[l]==="undefined"||d[l]==null){d[l]={}}d=d[l]}}else{d[l]=a}})}Q.getMetaFieldName=function(Z){return Z.attr("data-meta")||Q.getFieldName(Z)};Q.getFieldName=function(Z){return Z.attr("data-field")};Q.getMapperName=function(a){var Z=a.attr("data-mapper");return(Z==="")?undefined:(Z||"basic")};function R(Z,a){if(typeof a==="undefined"){return Z.basic}else{if(typeof Z[a]==="undefined"){throw ("Unknown mapper/renderer requested: "+a)}else{return Z[a]}}}function F(){J.find(".fieldSetEditMode [data-metarenderer]").each(function(a,b){b=jq(b);var d=Q.getMetaFieldName(b);var Z=K(H,d);if(Z!=null){var c=R(D,b.attr("data-metarenderer"));c(d,Z,b)}else{if(rlErrorHandler.showEnhanced()){console.error("metadata missing: "+d)}}})}function O(){return V.addMetaConstraintsToFieldSet()}function T(){J.find(".fieldSetViewMode [data-field]").each(function(b,c){c=jq(c);var f=Q.getFieldName(c);var e=Q.getMetaFieldName(c);var a=Q.getUserDataForKey(N,f);var Z=K(H,e);var d=R(E,c.attr("data-valuerenderer"));d(f,a,Z,c)})}function C(a){var Z=Q.getMapperName(a);return Z?R(I,Z):undefined}function S(){J.find(".fieldSetEditMode [data-field]").each(function(Z,a){a=jq(a);var c=C(a);if(c){var d=Q.getFieldName(a);var b=Q.getUserDataForKey(N,d);c.set(d,b,a)}})}Q.isInCqEditMode=W.isInCqEditMode;Q.isLoggedIn=function(){return W.isLoggedIn};Q.getFieldSetId=function U(){return P};Q.renderRequiredFieldIndicators=function(){jq("#"+Q.getFieldSetId()).find(".fieldSetEditMode [data-validators]").each(function(e,a){a=jq(a);var b=jq.trim(a.attr("data-validators")).split(",");for(var c=0,f=b.length;c<f;c++){var Z=b[c].toLowerCase();if(Z.indexOf("required")>=0){var g=a.closest(".fieldSetEditAreaRow").find(".fieldSetRowLabel");var d=jq.trim(g.text());var h=d.substr(d.length-1);if(h!="*"){g.append("*")}}}})};function M(){if(typeof rlPage!=="undefined"&&rlPage.isEditMode()){jq(window).bind("fieldsetaddedtopage",function(a,Z){if(Z===Q.getFieldSetId()){Q.renderRequiredFieldIndicators()}})}}Q.getMetaDataRenderers=function(Z){return Z};Q.getValueRenderers=function(Z){return Z};Q.getFieldMappers=function(Z){return Z};Q.getValidationRules=function(Z){return Z};Q.getAuthorValidationRules=function(){return[{validate:function(a){var Z=true;if(Q.getFieldsetProperties()["uniquefieldsetinform"]==="true"){jq.each(a,function(c,b){if(b.typeName==Q.typeName&&Q.getFieldSetId()!=b.getFieldSetId()){J.find(".notUniqueFieldSetNagMessage").css("display","block");Z=false;return Z}})}return Z}}]};Q.preInit=function(){};Q.init=function(){D=rlFormFieldSetDefaults.getMetaDataRenderers();E=rlFormFieldSetDefaults.getValueRenderers();I=rlFormFieldSetDefaults.getFieldMappers();B=rlFormFieldSetDefaults.getValidationRules();D=Q.getMetaDataRenderers(D);E=Q.getValueRenderers(E);I=Q.getFieldMappers(I);B=Q.getValidationRules(B);rlFormFieldSetValidation.addValidationToFieldset(Q,J,W,G,B);Q.renderRequiredFieldIndicators();Q.showPossibleErrorMessagesOnAuthor()};Q.onFormReady=function(){Q.initLiveValidators()};Q.onFormClosing=function(){};Q.onDataSourceUnavailable=function(){};Q.onBackendMessage=function(Z){};Q.getSources=function(){var Z=J.attr("data-sources");if(Z==null){return[]}else{return Z.split(",")}};Q.setMetaData=function(Z){Q.setMetaData=function(){};H=Z;F();O();Q.renderRequiredFieldIndicators();Q.activateInputCache()};Q.getMetaData=function(){return H};Q.setData=function(Z){N=Z;T();if(Q.isEditMode()){S();Q.restoreStateFromCookie()}};Q.getEditedData=function(Z){Z=Z||{};J.find(".fieldSetEditMode [data-field]").each(function(a,b){b=jq(b);var d=C(b);if(d){var e=Q.getFieldName(b);var c=d.get(e,b);if(typeof c!="undefined"){Q.setUserDataForKey(Z,e,c);if(typeof window.lastEditedCoreFormData=="undefined"){window.lastEditedCoreFormData={}}window.lastEditedCoreFormData[e+"/"+Q.getMapperName(b)]=c}}});return Z};Q.validate=function(){var Z=Q.getFormValidationResults();if(Z.length>0){G.addFeedback(Z);return false}return true};Q.allScoringFieldsFilled=function(){var Z=true;J.find('[data-scoring="yes"]').each(function(a,b){b=jq(b);var d=Q.getFieldName(b);if(typeof d!=="undefined"&&d!=""){var c=Q.getUserDataForKey(N,d);if(typeof c=="undefined"||c==null||c==""){Z=false}}});return Z};Q.getDataSources=function(){var Z=J.find("[data-field]");var a=[];jq.each(Z,function(b,d){var e;var d=jq(d);var c=d.attr("data-source");if(typeof c!=="undefined"){e=c}else{if(d.attr("data-field")){e=d.attr("data-field").split(".")[0]}}if(e){a.push({id:e,fieldSetId:Q.getFieldSetId()})}});return a};Q.getFieldsetProperties=function(){var Z={};J.find(".fieldsetProperties").each(function(a,b){jq.each(b.attributes,function(e,c){var d=c.name.toLowerCase();if(d.indexOf("data-")>=0){Z[d.replace("data-","")]=c.value}})});return Z};Q.renderTemplate=function(c,b){var a="";var Z=J.find(".fieldsetTemplate[data-name="+c+"]");if(Z){a=Z.html();if(b){jq.each(b,function(d,f){var e=new RegExp("{"+d+"}","g");a=a.replace(e,f)})}}return a};Q.getRegisteredMetaRenderers=function(){return D};Q.getRegisteredValueRenderers=function(){return E};Q.getRegisteredFieldMappers=function(){return I};Q.getRegisteredValidationRules=function(){return B};Q.getUserDataForKey=function(Z,a){return K(Z,a)};Q.setUserDataForKey=function(Z,b,a){return X(Z,b,a)};Q.getUniqueId=function(a,Z){return rlFormFieldSet.getUniqueId(J,a,Z)};Q.switchToViewMode=function(Z){var Z=false;if(J.hasClass("editMode")){Z=true}J.attr("data-mode","view");if(Z==true){if(!J.hasClass("viewMode")){J.animate({opacity:0.1},400,function(){J.addClass("viewMode").removeClass("editMode");J.animate({opacity:1},700,function(){J.css("filter","none")})})}}else{J.addClass("viewMode").removeClass("editMode")}};Q.switchToEditMode=function(){var Z=false;if(J.hasClass("viewMode")){Z=true}S();Q.restoreStateFromCookie();J.attr("data-mode","edit");if(Z==true){if(!J.hasClass("editMode")){J.animate({opacity:0.1},400,function(){J.addClass("editMode").removeClass("viewMode");J.animate({opacity:1},700,function(){J.css("filter","none")})})}}else{J.addClass("editMode").removeClass("viewMode")}};Q.isEditMode=function(){return J.attr("data-mode")=="edit"};Q.hide=function(){J.hide()};Q.show=function(){J.show()};Q.showDitherLayer=function(Z){if(typeof Z=="undefined"){Z=J}rlDither.on(Z)};Q.hideDitherLayer=function(Z){if(typeof Z=="undefined"){Z=J}rlDither.off(Z)};Q.getMailSummary=function(b,Z,c){b=b||[];function d(h){if(h){h=[].concat(h);for(var g=0,f=h.length;g<f;g++){var e=h[g];if(e.type&&(c!==true||e.id)){b.push(e)}}}}function a(j,o,g){var n=[];var e,k;if((e=j.find(".fieldSetFieldText")).length>0){o.type=Z.KEY_VALUE;for(k=0;k<e.length;k++){n.push(jq(e[k]).val())}}else{if((e=j.find(".fieldSetRadioButtonGroup")).length>0){o.type=Z.KEY_VALUE;var h=e.find(".fieldSetFieldRadio:checked");var m="";if(h.length>0){var l=e.find("label.fieldSetInputLabel[for="+jq(h[0]).attr("id")+"]");var m=l.text()}n.push(m)}else{if((e=j.find(".fieldSetFieldSelect")).length>0){o.type=Z.KEY_VALUE;var f=e.find("option:selected");if(f.length>0){f=f.filter(":[value]:[value!='']");for(k=0;k<f.length;k++){n.push(jq(f[k]).text())}}}}}if(g){return n.join(" ")}else{return n}}J.find(".fieldSetEditMode").find(".fieldSetEditAreaRow, h3, [class^='headlineh']").each(function(n,f){var g=jq(f);var t={};if(g.is(".fieldSetEditAreaRow")&&g.css("display")!="none"){var p=g.find(".fieldSetLayoutCol1");if(p.length>0){var h=p.find(".fieldSetRowLabel");if(h.length>0&&h[0]){var s=jq(h[0]).text();s=s&&s.replace(/\s*\(?\s*([*]+\s*)+\)?\s*$/,"");t.key=jq.trim(s)||undefined}}if(!t.key){return true}var j=g.find(".fieldSetLayoutCol2");var l;if(j.length>0){var q=a(j,t,true);if(typeof (q)!="undefined"){t.value=jq.trim(q)}}if(c===true){var m=g.is('[data-field]:not([data-field=""])')?g:g.find('[data-field]:not([data-field=""])');if(m.length<1){console.warn("Found no data-field in row: ");console.warn(f)}else{var e=[];for(l=0;l<m.length;l++){var r=jq(m[l]);var o=(r.find(".fieldSetLayoutCol2").length>0?r:r.parent());var u=jq.trim(r.attr("data-field"));var k={};jq.extend(k,t);k.id=u||undefined;k.value=a(o,t,false)[l];e.push(k)}t=e}}d(t)}else{if(g.is("h3, [class^='headlineh']")){d({type:Z.HEADLINE,value:jq.trim(g.text())})}else{if(g.css("display")=="none"){}else{console.error("Unhandled element in mailSummary: ");console.error(f)}}}});return b};Q.getFormSummary=function(Z,a){return Q.getMailSummary(Z,a)};Q.getPdfSummary=function(Z,a){return Q.getMailSummary(Z,a,true)};Q.addOptionToSelect=function(Z,b,c,a){rlFormFieldSetDefaults.addOptionToSelect(Z,b,c,a)};Q.trackEvent=function(Z){if(typeof window.bmwcsacaptureEvent==="function"){window.bmwcsacaptureEvent(Z)}};Q.setTextInElement=function(a,b,Z){return rlFormFieldSetDefaults.setTextInElement(a,b,Z)};Q.getValueOfField=function(b,Z,a){return rlFormFieldSetDefaults.getValueOfField(b,Z,a)};Q.resetValidationMessages=function(){};rlFormFieldSetInputCache.addInputCacheToFieldset(Q,J,W);M();V=rlFormFieldSetMetaConstraints.create(Q,J,W,K);return Q}return{EVENT_FIELDSET_SIZE_CHANGED:"EVENT_FIELDSET_SIZE_CHANGED",__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)},setInitialDisplayMode:function(C){var B=C.parents("[data-initialdisplaymode]").attr("data-initialdisplaymode");if(B!=""){C.addClass(B)}},getUniqueId:function(E,G,D){var C=E.attr("id");if(!C){var B=E.parents("[id]");if(B.length>0){C=jq(B[0]).attr("id")}else{C="unknownID_"}}var F=C+"_"+G;if(D){F+="_"+D}return F.replace(/[^a-zA-Z0-9_]/g,"_")}}}();var rlGrid=function(){return{__init__:function(){var A=0;jq(document).keydown(function(C){if(C.ctrlKey&&C.altKey&&C.which==71){switch(A){case 0:jq(".grid1280").show();A++;break;case 1:jq(".grid1280").hide();jq(".gridDealer").show();A++;break;case 2:jq(".gridDealer").hide();A=0;break}}});var B=parseInt(rlJQuery_queryParams.getQueryParam("grid"));if(B==1280){jq(".grid1280").show()}}}}();var rlJQuery_numberFormatter=function(){return{__start__:function(){},__init__:function(){var A=(function(){var C="function";var E=(typeof Array.prototype.splice==C)?function(S,T){S.splice(T,1)}:function(T,U){var V,S,W;if(U===T.length-1){T.length=U}else{V=T.slice(U+1);T.length=U;for(S=0,W=V.length;S<W;++S){T[U+S]=V[S]}}};function R(S){var U;if(typeof S=="string"){return S}else{if(typeof S.hashCode==C){U=S.hashCode();return(typeof U=="string")?U:R(U)}else{if(typeof S.toString==C){return S.toString()}else{try{return String(S)}catch(T){return Object.prototype.toString.call(S)}}}}}function L(T,S){return T.equals(S)}function N(T,S){return(typeof S.equals==C)?S.equals(T):(T===S)}function P(S){return function(T){if(T===null){throw new Error("null is not a valid "+S)}else{if(typeof T=="undefined"){throw new Error(S+" must not be undefined")}}}}var B=P("key"),G=P("value");function O(S,U,T,V){this[0]=S;this.entries=[];this.addEntry(U,T);if(V!==null){this.getEqualityFunction=function(){return V}}}var K=0,I=1,M=2;function D(S){return function(V){var W=this.entries.length,T,U=this.getEqualityFunction(V);while(W--){T=this.entries[W];if(U(V,T[0])){switch(S){case K:return true;case I:return T;case M:return[W,T[1]]}}}return false}}function H(S){return function(U){var T=U.length;for(var V=0,W=this.entries.length;V<W;++V){U[T+V]=this.entries[V][S]}}}O.prototype={getEqualityFunction:function(S){return(typeof S.equals==C)?L:N},getEntryForKey:D(I),getEntryAndIndexForKey:D(M),removeEntryForKey:function(S){var T=this.getEntryAndIndexForKey(S);if(T){E(this.entries,T[0]);return T[1]}return null},addEntry:function(T,S){this.entries[this.entries.length]=[T,S]},keys:H(0),values:H(1),getEntries:function(U){var S=U.length;for(var T=0,V=this.entries.length;T<V;++T){U[S+T]=this.entries[T].slice(0)}},containsKey:D(K),containsValue:function(S){var T=this.entries.length;while(T--){if(S===this.entries[T][1]){return true}}return false}};function F(U,T){var V=U.length,S;while(V--){S=U[V];if(T===S[0]){return V}}return null}function J(U,T){var S=U[T];return(S&&(S instanceof O))?S:null}function Q(W,Y){var T=this;var U=[];var V={};var S=(typeof W==C)?W:R;var X=(typeof Y==C)?Y:null;this.put=function(f,e){B(f);G(e);var c=S(f),b,a,d=null;b=J(V,c);if(b){a=b.getEntryForKey(f);if(a){d=a[1];a[1]=e}else{b.addEntry(f,e)}}else{b=new O(c,f,e,X);U[U.length]=b;V[c]=b}return d};this.get=function(a){B(a);var d=S(a);var c=J(V,d);if(c){var b=c.getEntryForKey(a);if(b){return b[1]}}return null};this.containsKey=function(a){B(a);var b=S(a);var c=J(V,b);return c?c.containsKey(a):false};this.containsValue=function(a){G(a);var b=U.length;while(b--){if(U[b].containsValue(a)){return true}}return false};this.clear=function(){U.length=0;V={}};this.isEmpty=function(){return !U.length};var Z=function(a){return function(){var b=[],c=U.length;while(c--){U[c][a](b)}return b}};this.keys=Z("keys");this.values=Z("values");this.entries=Z("getEntries");this.remove=function(e){B(e);var d=S(e),c,a=null;var b=J(V,d);if(b){a=b.removeEntryForKey(e);if(a!==null){if(!b.entries.length){c=F(U,d);E(U,c);delete V[d]}}}return a};this.size=function(){var a=0,b=U.length;while(b--){a+=U[b].entries.length}return a};this.each=function(c){var b=T.entries(),a=b.length,d;while(a--){d=b[a];c(d[0],d[1])}};this.putAll=function(f,b){var c=f.entries();var i,h,a,e,d=c.length;var g=(typeof b==C);while(d--){i=c[d];h=i[0];a=i[1];if(g&&(e=T.get(h))){a=b(h,e,a)}T.put(h,a)}};this.clone=function(){var a=new Q(W,Y);a.putAll(T);return a}}return Q})();(function(C){var B=new A();var H=["ae","au","ca","cn","eg","gb","hk","il","in","jp","sk","th","tw","us"];var D=["at","br","de","dk","es","gr","it","nl","pt","tr","vn"];var K=["cz","fi","fr","ru","se","pl"];var F=["ch"];var I=[[".",","],[",","."],[","," "],[".","'"]];var E=[H,D,K,F];function L(O,M,N){this.dec=O;this.group=M;this.neg=N}function J(){for(var M=0;M<E.length;M++){localeGroup=E[M];for(var N=0;N<localeGroup.length;N++){B.put(localeGroup[N],M)}}}function G(M,S){if(B.size()==0){J()}var R=".";var P=",";var Q="-";if(S==false){if(M.indexOf("_")!=-1){M=M.split("_")[1].toLowerCase()}else{if(M.indexOf("-")!=-1){M=M.split("-")[1].toLowerCase()}}}var O=B.get(M);if(O){var N=I[O];if(N){R=N[0];P=N[1]}}return new L(R,P,Q)}C.fn.formatNumber=function(M,N,O){return this.each(function(){if(N==null){N=true}if(O==null){O=true}var Q;if(C(this).is(":input")){Q=new String(C(this).val())}else{Q=new String(C(this).text())}var P=C.formatNumber(Q,M);if(N){if(C(this).is(":input")){C(this).val(P)}else{C(this).text(P)}}if(O){return P}})};C.formatNumber=function(R,X){var X=C.extend({},C.fn.formatNumber.defaults,X);var M=G(X.locale.toLowerCase(),X.isFullLocale);var O=M.dec;var V=M.group;var P=M.neg;var N="0#-,.";var U="";var T=false;for(var S=0;S<X.format.length;S++){if(N.indexOf(X.format.charAt(S))==-1){U=U+X.format.charAt(S)}else{if(S==0&&X.format.charAt(S)=="-"){T=true;continue}else{break}}}var W="";for(var S=X.format.length-1;S>=0;S--){if(N.indexOf(X.format.charAt(S))==-1){W=X.format.charAt(S)+W}else{break}}X.format=X.format.substring(U.length);X.format=X.format.substring(0,X.format.length-W.length);var Q=new Number(R);return C._formatNumber(Q,X,W,U,T)};C._formatNumber=function(N,R,O,k,U){var R=C.extend({},C.fn.formatNumber.defaults,R);var h=G(R.locale.toLowerCase(),R.isFullLocale);var g=h.dec;var X=h.group;var M=h.neg;var a=false;if(isNaN(N)){if(R.nanForceZero==true){N=0;a=true}else{return null}}if(O=="%"){N=N*100}var c="";if(R.format.indexOf(".")>-1){var j=g;var V=R.format.substring(R.format.lastIndexOf(".")+1);if(R.round==true){N=new Number(N.toFixed(V.length))}else{var o=N.toString();o=o.substring(0,o.lastIndexOf(".")+V.length+1);N=new Number(o)}var b=N%1;var d=new String(b.toFixed(V.length));d=d.substring(d.lastIndexOf(".")+1);for(var l=0;l<V.length;l++){if(V.charAt(l)=="#"&&d.charAt(l)!="0"){j+=d.charAt(l);continue}else{if(V.charAt(l)=="#"&&d.charAt(l)=="0"){var S=d.substring(l);if(S.match("[1-9]")){j+=d.charAt(l);continue}else{break}}else{if(V.charAt(l)=="0"){j+=d.charAt(l)}}}}c+=j}else{N=Math.round(N)}var W=Math.floor(N);if(N<0){W=Math.ceil(N)}var f="";if(R.format.indexOf(".")==-1){f=R.format}else{f=R.format.substring(0,R.format.indexOf("."))}var n="";if(!(W==0&&f.substr(f.length-1)=="#")||a){var Y=new String(Math.abs(W));var Q=9999;if(f.lastIndexOf(",")!=-1){Q=f.length-f.lastIndexOf(",")-1}var P=0;for(var l=Y.length-1;l>-1;l--){n=Y.charAt(l)+n;P++;if(P==Q&&l!=0){n=X+n;P=0}}if(f.length>n.length){var m=f.indexOf("0");if(m!=-1){var e=f.length-m;var T=f.length-n.length-1;while(n.length<e){var Z=f.charAt(T);if(Z==","){Z=X}n=Z+n;T--}}}}if(!n&&f.indexOf("0",f.length-1)!==-1){n="0"}c=n+c;if(N<0&&U&&k.length>0){k=M+k}else{if(N<0){c=M+c}}if(!R.decimalSeparatorAlwaysShown){if(c.lastIndexOf(g)==c.length-1){c=c.substring(0,c.length-1)}}c=k+c+O;return c};C.fn.parseNumber=function(M,N,P){if(N==null){N=true}if(P==null){P=true}var Q;if(C(this).is(":input")){Q=new String(C(this).val())}else{Q=new String(C(this).text())}var O=C.parseNumber(Q,M);if(O){if(N){if(C(this).is(":input")){C(this).val(O.toString())}else{C(this).text(O.toString())}}if(P){return O}}};C.parseNumber=function(T,Y){var Y=C.extend({},C.fn.parseNumber.defaults,Y);var N=G(Y.locale.toLowerCase(),Y.isFullLocale);var Q=N.dec;var W=N.group;var R=N.neg;var M="1234567890.-";while(T.indexOf(W)>-1){T=T.replace(W,"")}T=T.replace(Q,".").replace(R,"-");var X="";var P=false;if(T.charAt(T.length-1)=="%"||Y.isPercentage==true){P=true}for(var U=0;U<T.length;U++){if(M.indexOf(T.charAt(U))>-1){X=X+T.charAt(U)}}var S=new Number(X);if(P){S=S/100;var V=X.indexOf(".");if(V!=-1){var O=X.length-V-1;S=S.toFixed(O+2)}else{S=S.toFixed(X.length-1)}}return S};C.fn.parseNumber.defaults={locale:"us",decimalSeparatorAlwaysShown:false,isPercentage:false,isFullLocale:false};C.fn.formatNumber.defaults={format:"#,###.00",locale:"us",decimalSeparatorAlwaysShown:false,nanForceZero:true,round:true,isFullLocale:false};Number.prototype.toFixed=function(M){return C._roundNumber(this,M)};C._roundNumber=function(O,N){var M=Math.pow(10,N||0);var P=String(Math.round(O*M)/M);if(N>0){var Q=P.indexOf(".");if(Q==-1){P+=".";Q=0}else{Q=P.length-(Q+1)}while(Q<N){P+="0";Q++}}return P}})(jq)}}}();var rlLoginbox=function(){var Z=null;var f={};var a=false;var F=700;var P=rlBrowser.getInternetExplorerVersion();if(navigator.userAgent.match("MSIE")&&P<9){F=0}function Y(j,i){if(j!==Z){Z=j;f=i;A();U()}}function U(){jq("#"+Z+".mybmw-loginbox .backLink").click(function(){E()});jq("#"+Z+" .mybmw-loginbox-footer .registerLink").click(function(i){i.preventDefault();if(D()){g("SHOW_REGISTRATION_LAYER")}else{rlUserDialog.showRegistrationDialog()}});jq("#loginbox_forgottenPasswordLink,#loginbox_errorState_forgottenPasswordLink").click(function(){if(D()){g("SHOW_PWD_FORGOTTEN")}else{rlUserDialog.showForgottenPasswordDialog()}});jq("#loginbox_errorState_resendActivationLink").click(function(){G()});jq("#loginbox_errorState_resendUsernameLink").click(function(){b()});jq("#"+Z+".mybmw-loginbox :input[type=text], #"+Z+".mybmw-loginbox :input[type=password]").each(function(){jq(this).focus(function(){X();jq(this).siblings("span").hide()});var i=jq(this).prev();i.click(function(){X();jq(this).hide();jq(this).next().focus()});jq(this).blur(function(){if(jq.trim(jq(this).val())===""){jq(this).siblings("span").show()}});jq(this).keydown(function(j){if(j.keyCode==13){j.stopPropagation();j.preventDefault();jq("#"+Z+".mybmw-loginbox .loginLink").click()}})})}function c(){A();jq("#"+Z+".mybmw-loginbox").removeAttr("style");jq("#"+Z+".mybmw-loginbox").show();jq(".mybmw-loginbox").show();if((navigator.userAgent.indexOf("Safari")!=-1)&&(navigator.userAgent.indexOf("Chrome")==-1)){jq("#mybmw-loginbox-fieldParagraph-emailLabel").addClass("loginboxLabelSafari");jq("#mybmw-loginbox-fieldParagraph-passwordLabel").addClass("loginboxLabelSafari")}}function N(){jq("#"+Z+".mybmw-loginbox").hide()}function e(){jq("#"+Z+".mybmw-loginbox .errorContent").toggle();jq("#"+Z+".mybmw-loginbox .mainContent").toggle()}function A(){jq("#"+Z+".mybmw-loginbox :input[type=password]").val("").prev().show();jq("#"+Z+".mybmw-loginbox .errorContent").removeAttr("style").css("display","none");X();d(false);C(false);H(true)}function X(){jq("#"+Z+".mybmw-loginbox :input").removeClass("border")}function J(i){jq("#"+Z+".mybmw-loginbox :input[name="+i.attr("name")+"]").addClass("border")}function W(){return jq("#"+Z+".mybmw-loginbox :input").serializeObject()}function R(){var k=jq("#"+Z+".mybmw-loginbox :input[type=text]");var i=jq("#"+Z+".mybmw-loginbox :input[type=password]");var j=true;if(jq.trim(k.val())===""){J(k);j=false}if(jq.trim(i.val())===""){J(i);j=false}return j}function Q(l){if(typeof l==="object"&&typeof l.stopPropagation==="function"){l.stopPropagation()}if(!R()){return }jq("#loginbox_emailTextbox").blur();jq("#loginbox_passwordTextbox").blur();rlBmwStateOverlay.showLoadingState("loginBoxState");a=true;var k=W();var i={account:{login:k.login,password:k.password}};var j={login:i,onError:B,onLoggedIn:function(o){try{var n=jq("#loginbox_loginLink");if(n.length>0){var m=n[0];window.bmwcsaclick(m)}}catch(p){console.error("Tracking error ",p)}h(o)},onC2BLoggedIn:V,onPolicyInvalid:T};rlLoginservice.login(j)}function B(k){rlBmwStateOverlay.hideState("loginBoxState");if(k&&k.error){var i=true;var l=(typeof k.error.errorCodeId!="undefined")?k.error.errorCodeId:null;var j=(k.error.errorMessage)?k.error.errorMessage:f.generalError;if(l==null){j=f.generalError}else{switch(l){case rlLoginservice.GCDM_AUTH_NOT_AUTHENTICATED:j=rlTranslator.translate(l);break;case rlLoginservice.GCDM_AUTH_ACCOUNT_NOT_ACTIVATED:j=rlTranslator.translate(l);H(false);d(true);break;case rlLoginservice.GCDM_AUTH_ADMIN_LOCKED:j=rlTranslator.translate(l);i=false;A();L();break;case rlLoginservice.GCDM_AUTH_PASSWORD_EXPIRED:j=rlTranslator.translate(l);break;case rlLoginservice.GCDM_1014_101:j=rlTranslator.translate(l);break;case rlLoginservice.GCDM_1014_102:j=rlTranslator.translate(l);L();break;default:j=f.generalError;break}}if(i){I(j);e()}}}function I(i){jq("#loginbox_errorMessageLabel").html(i)}function H(i){M("#loginbox_errorState_forgottenPasswordLink",i)}function C(i){M("#loginbox_errorState_resendUsernameLink",i)}function d(i){M("#loginbox_errorState_resendActivationLink",i)}function h(i){if(a==true){if(O()){rlLoginservice.doDefaultPostLoginBehaviour()}else{g("AFTER_LOGIN")}}else{N()}}function L(){if(D()){g("SHOW_ACCOUNT_DEACTIVATED_DIALOG")}else{rlUserDialog.showAccountDeactivatedDialog()}}function V(i){if(D()){g("SHOW_C2B_REGISTER_LAYER")}else{rlBmwStateOverlay.hideState("loginBoxState");rlUserDialog.showC2bRegistrationDialog({firstName:i.firstName,lastName:i.lastName})}}function T(i){if(D()){g("NEWPOLICYREQUIRED_"+i.data.cmxUrl)}else{rlBmwStateOverlay.hideState("loginBoxState");rlUserDialog.showPolicyAgreeDialog({policyUrl:i.data.cmxUrl})}}function G(){var i=W();rlLoginservice.resendActivationMail({mail:i.login,success:function(j){if(D()){g("SHOW_RESENDACTIVATIONLINK")}else{rlUserDialog.showResendActivationLinkInfoDialog();E()}},error:function(j){E()}})}function b(){var i=W();rlLoginservice.resendLoginChangeMail({mail:i.login,success:function(j){if(D()){g("SHOW_RESENDUSERNAMECHANGELINK")}else{rlUserDialog.showResendUsernameChangeLinkInfoDialog();E()}},error:function(j){E()}})}function O(){return rlLoginservice.isHttps()}function D(){return(top!==self)}function g(i){window.parent.postMessage(i,"*")}function M(i,k){var j=jq(i).parent(".linkListItem");if(k){j.show()}else{j.hide()}}function E(){e();A()}function S(){var i=window.location.hash;if(i.indexOf("#")>=0){i=i.replace("#","")}if(i==="undefined"||i===""){console.error("No http Host Defined")}console.log("Http Host: "+i);return i}function K(){g("SWITCHHTTPS")}return{initComponent:function(i,j){Y(i,j);rlC2bInformationSet.resetInformation();if(jq("html").hasClass("ie7")){jq(".mybmw-loginbox").removeClass("shadow")}if((navigator.userAgent.indexOf("Safari")!=-1)&&(navigator.userAgent.indexOf("Chrome")==-1)){jq("#mybmw-loginbox-fieldParagraph-emailLabel").addClass("loginboxLabelSafari");jq("#mybmw-loginbox-fieldParagraph-passwordLabel").addClass("loginboxLabelSafari")}jq(".loginbox").animate({opacity:1},F)},show:function(){c()},hide:function(){N()},toggle:function(){e()},doLogin:function(i){Q(i)},switchToHttps:function(){K()},__init__:function(){if(!O()){jq("body").css("background","none")}}}}();var rlMixedteaserarea=function(){function A(B){jq(B.destination).html("");rlTeaserArea.loadDynamicTeaserIntoDest(B.destination,B.persoTeaserCount)}return{__init__:function(){},loadTeasers:function(B){A(B)}}}();var rlNbgvDataSink=function(){function A(){var B=CoreFormsBase.inheritanceFrom(CoreFormsBase.createBaseType());var C=B.parent;B.typeName="rlNbgvDataSink";B.update=function(H){var G=jq.extend({},H.data);if(!G.vehicle){throw ("nbgvForm expects an nbgvFS fieldset that provides data.vehicle")}G=F(G);rlUserFormDS.createDS().update({data:G,success:function(I){H.success(E(I,G))},error:H.error,validation:function(I){H.validation(D(I,G))}})};B.deleteIt=function(H){var G=jq.extend({},H.data.vehicle);G.vehicleId="";var I={user:{profile:{vehicleId:null}},vehicle:G};rlUserFormDS.createDS().update({data:I,success:H.success,error:H.error,validation:H.validation})};function F(G){G.user=G.user||{};return G}function E(H,G){H=jq.extend({},H);if(G.vehicle.brand){H.nbgv=G.vehicle}return H}function D(I,H){var G=[];if(I){jq.each(I,function(J,K){K=jq.extend({},K);G.push(K);if(K.fieldName){K.fieldName=K.fieldName.replace("vehicle.","nbgv.")}})}return G}return B}return{__init__:function(){},__start__:function(){},createDataSink:function(){return A()}}}();var rlPolicyCurrentFS=function(){function A(B,F){var C=CoreFormsBase.inheritanceFrom(rlPolicyBaseFS.createFS(B,F));var E=C.parent;C.typeName="rlPolicyCurrentFS";var D=rlPolicyCurrentLegacyFS.createInstance(C,B,F);C.getMetaDataRenderers=function(G){G=E.getMetaDataRenderers(G);G.policyCurrentRenderer=function(J,H,I){C.determinePolicyVersion(H.policyText);if(C.policyVersion==rlPolicyBaseFS.POLICY_VERSION_1){return D.policyCurrentRenderer(J,H,I)}else{if(C.policyVersion==rlPolicyBaseFS.POLICY_VERSION_2){C.renderPolicyEditMode(H.policyUrl,H.policyText)}else{throw"Unsupported policy version"}}};return G};C.getValidationRules=function(G){G=E.getValidationRules(G);G.consentRequired={event:"click",when:"ELEM_INVALIDATED_BY_FORM",rule:function(I,H){if(C.policyVersion==rlPolicyBaseFS.POLICY_VERSION_1){return D.consentRequiredValidationRule(I,H)}}};return G};C.getFieldMappers=function(G){G=E.getFieldMappers(G);G.policyCurrentMapper={get:function(I,H){if(C.policyVersion==rlPolicyBaseFS.POLICY_VERSION_1){return D.getCurrentPolicyData(I,H)}else{return C.getPolicyFromEditMode()}},set:function(J,I,H){}};return G};C.getPdfSummary=function(M,N){var K={};C.getEditedData(K);for(var I in K){if(K.hasOwnProperty(I)){var H=K[I].consentedUsages;var J=K[I].revokedUsages;for(var L=0,G=H.length;L<G;L++){M.push({type:N.KEY_VALUE,value:true,id:"policy.usages."+H[L].usageId})}for(var L=0,G=J.length;L<G;L++){M.push({type:N.KEY_VALUE,value:false,id:"policy.usages."+J[L].usageId})}}}return M};return C}return{__init__:function(){},__start__:function(){},createFS:function(B,C){return A(B,C)}}}();var rlPolicyCurrentFormDS=function(){function A(G,B){var C=CoreFormsBase.inheritanceFrom(rlBaseDataSource.createDS(G));var D=C.parent;C.typeName="rlPolicyCurrentFormDS";C.get=function(H){rlComponentLoader.deferredExec(["coreServices"],function(){D.get.call(C,H)})};C.getUserData=function(I,H){I()};C.mapMetaData=function(K,J){var I={};var H=jq("<div/>");H[0].innerHTML=K;I["policyCurrent_"+B]={policyText:jq(H).find(".policyTextblock"),policyUrl:J};return I};C.getMetaData=function(I,H){if(C.getUseMock()){C.getMockedMetaData(I,H);return }rlCoreServices.getCurrentPolicyUrl({policyType:B,success:function(K){var J=E(K);if(J){var L=J;if(L.indexOf(".ajax")==-1){L=L.replace(".html",".ajax.html")}F({url:rlMandator.getShortPolicyUrlFromLongUrl(L),success:function(N){var M=C.mapMetaData(N,J);I(M)},error:H})}else{H("Unsupported policyType: "+B)}},error:H})};function F(H){rlCrossSubDomainAjax.call({url:H.url,success:H.success,error:H.error})}function E(H){return(H.data.$)}C.getMockedMetaData=function(J,I){var H={};H["policyCurrent_"+B]={policyText:'Policy HTML Text <input type="checkbox" name="consent" class="required" checked value="true">',policyUrl:"/content/brandBM/marketIB/countryGB/en_GB/publicPools/policyPool/RFI_0_0"};J(H)};return C}return{__init__:function(){},__start__:function(){},createDS:function(C,B){return new A(C,B)}}}();var rlPreferredDealersDS=function(){function A(D){var B=CoreFormsBase.inheritanceFrom(rlBaseDataSource.createDS(D));var C=B.parent;B.typeName="rlPreferredDealersDS";B.get=function(E){rlComponentLoader.deferredExec(["preferredDealersModel"],function(){B.parent.get.call(B,E)})};B.getUserData=function(F,E){if(B.getUseMock()){F({})}else{rlPreferredDealersModel.requestPreferredDealers(function(G){F(G)},function(G){E("The preferred dealers are not available!")})}};B.getMetaData=function(F,E){F({})};return B}return{__init__:function(){},__start__:function(){},createDS:function(B){return A(B)}}}();var rlRfiDownloadDataSink=function(){function A(D){var B=CoreFormsBase.inheritanceFrom(rlRfxBaseDataSink.createDataSink());var C=B.parent;B.typeName="rlRfiDownloadDataSink";B.prepareData=function(E){var F=C.prepareData(E);F.policy=F.policyCurrent_RFI_DOWNLOAD;delete F.policyCurrent_RFI_DOWNLOAD;if(typeof F.infoMaterial!=="undefined"){if(typeof F.infoMaterial.materialCodes!=="undefined"){F.infoMaterial.materialCodes=makeArrayUnique(F.infoMaterial.materialCodes)}F=jq.extend(true,F,F.infoMaterial);delete F.infoMaterial}return F};B.save=function(E){var F=B.prepareData(D);rlCoreServices.sendRequestForInformationDownload(F,function(G){E.success(G)||function(H){}},function(G){console.log(G);B.handleErrors(G,E.error,E.validation)},function(G){console.log(G);B.handleValidationErrors(G,E.validation)})};return B}return{__init__:function(){},__start__:function(){},createDataSink:function(B){return A(B)}}}();var rlRfxFormContainer=function(){return{__init__:function(){},__start__:function(){}}}();var rlSearchQueryBar=function(){var G,D,B,A;var C,E,H,F;return{__start__:function(){},go2result:function(I){rlSearchUtil.go2result(I,D,A)},initAutosuggest:function(){rlAutosuggest.autosuggest("page",{id:A,className:"searchQueryBarLiveSearchLayerSuggest",minCharsForAutoSuggest:C,minCharsForLiveSearch:E,numLiveSearchResults:H,numAutoSuggestResults:F,rtnIDs:false,searchFunction:rlSearchQueryBar.go2result,methodType:"GET",dataFile:G});jq("#"+A).focus(function(){if(B&&B!=""){if(jq(this).val()==B){jq(this).val("")}}jq(this).css("color","#000000")});jq("#"+A).blur(function(){if(jq(this).val()==""){if(B&&B!=""){jq(this).val(B)}}jq(this).css("color","")})},setSearchResultPagePath:function(I){D=I},setMinCharsForAutoSuggest:function(I){C=I},setMinCharsForLiveSearch:function(I){E=I},setNumLiveSearchResults:function(I){H=I},setNumAutoSuggestResults:function(I){F=I},setSearchQueryBarFieldInitValue:function(I){B=I},setGsaProxyHost:function(I){G=I},setSearchQueryBarFieldId:function(I){A=I},getSearchQueryBarFieldId:function(){return A},__init__:function(){rlSearchQueryBar.setSearchQueryBarFieldInitValue(cfSearchQueryBarLabel);rlSearchQueryBar.setMinCharsForAutoSuggest(cfMinCharAutoSuggest);rlSearchQueryBar.setMinCharsForLiveSearch(cfMinCharLiveSearch);rlSearchQueryBar.setNumLiveSearchResults(cfNumLiveSearchResults);rlSearchQueryBar.setNumAutoSuggestResults(cfNumAutoSuggestResults);rlAutosuggest.setTextAutosuggestTitle(cfTextAutosuggestTitle);rlAutosuggest.setTextLiveSearchTitle(cfTextLiveSearchTitle);rlSearchQueryBar.setSearchResultPagePath(externalSearchPagePath);rlSearchQueryBar.setGsaProxyHost(rlPage.getNextCoreUrl()+cfGsaBaseUrl);rlSearchQueryBar.setSearchQueryBarFieldId("searchQueryBarInputField");rlSearchQueryBar.initAutosuggest()}}}();var rlSocialmedialike=function(){function A(){if(jq("#googleplusButton").length<1){return }var D=(navigator.language)?navigator.language:navigator.userLanguage;window.___gcfg={lang:D};var C=document.createElement("script");C.type="text/javascript";C.async=true;C.src="https://apis.google.com/js/plusone.js";var E=document.getElementsByTagName("script")[0];E.parentNode.insertBefore(C,E)}function B(){if(jq("#facebookLikeButton").length<1){return }var C="<iframe src='//www.facebook.com/plugins/like.php?layout=button_count&amp;show_faces=false&amp;width=198&amp;action=like&amp;font&amp;colorscheme=light&amp;height=21&amp;href="+window.location.href+"' scrolling='no' frameborder='0' style='margin:0; border:none; overflow:hidden; width:198px; height:21px;' allowTransparency='true'></iframe>";jq("#facebookLikeButton .content").html(C)}return{__init__:function(){jq(window).one(rlComponentLoader.getPageReadyTriggerName(),function(C,D){if(rlCookieController.isRegulationThirdAccepted()){jq(".socialMediaIcons, .socialMediaIconsText").hide();jq(".socialMediaButtons").show();if(/MSIE (7.\d+);/.test(navigator.userAgent)){jq("#googleplusButton").hide()}B();A()}else{jq(".socialMediaButtons").hide();jq(".socialMediaIcons, .socialMediaIconsText").show();rlConsentDisclaimerLayer.registerConsentLayer(".socialmedialike",false)}})}}}();var rlUserMgmtConverter=(function(){function H(M){if(M){jq.each(M,function(N,O){if(!O.id){O.action="INSERT"}else{var P=parseInt(O.id,10);if(P<0){O.id=-P;O.action="DELETE"}else{O.action="UPDATE"}}})}}function K(M,N){var P,O;if(M&&M[N]){var Q={};for(P=0,len=M[N].length;P<len;P++){O=jq.extend({},M[N][P]);Q[O.key]=O}M[N]=Q}}function I(M,N){var O;if(M&&M[N]){var P=[];for(O in M[N]){if(M[N].hasOwnProperty(O)){P.push(M[N][O])}}H(P);M[N]=P}}function D(P,O){var N=O.key.split("$");var M=P;while(N.length>0){var Q=N.shift();if(N.length===0&&!M[Q]){M[Q]=O;M[Q].origKey=O.key;delete M[Q].key}else{if(M[Q]==null){M[Q]={}}M=M[Q]}}}function L(Q,P){var O={};if(Q&&Q.fieldDescriptions&&Q.fieldDescriptions.fieldDescription){jq.each(Q.fieldDescriptions.fieldDescription,function(S,R){if(typeof R.fieldValues!=="undefined"&&typeof R.fieldValues.fieldValue!=="undefined"){R.valueList=[].concat(R.fieldValues.fieldValue);delete R.fieldValues}if(typeof R.key!=="undefined"&&R.key.indexOf("address$")==0){R.key=R.key.replace(/address/,"profile$addresses")}D(O,R)});function N(S){if(!S||typeof (S)!="object"){return }if(S&&S.hasOwnProperty("complexType")&&S.complexType&&O[S.complexType]){var R=O[S.complexType];S.copiedProperties=[];jq.each(R,function(T,U){if(R.hasOwnProperty(T)){S[T]=R[T];S.copiedProperties.push(T)}})}jq.each(S,function(T,U){if(S.hasOwnProperty(T)&&S[T]){N(S[T])}})}function M(V,R){var S=V;var U=(R&&R.useCaseMetaDataRoot)?R.useCaseMetaDataRoot:undefined;if(V&&U&&V[U]){S=V[U].hasOwnProperty("user")?V[U].user:{};var T=V[U];jq.each(T,function(W,X){if(T.hasOwnProperty(W)&&T[W]){if(W!="user"){S[W]=T[W]}}})}else{if(typeof (rlPage)=="undefined"||(!rlPage.isEditMode()&&!rlPage.isDesignMode()&&!rlPage.isPreviewMode())){console.error("Could not find metaDataRoot '"+U+"' in: ");console.error(V)}}return S}O.profile.birthday={minYear:1920,maxYear:(new Date()).getFullYear()};N(O);O=M(O,P)}else{console.error("MetaData response is invalid.");throw"invalidResponse"}return{user:O}}function C(M){var O=[];if(M&&M.validationErrors){var P=[];var N=[];jq.each([].concat(M.validationErrors.validationError),function(S,R){if(R&&R.errorCodeId&&R.errorCodeId.indexOf("UM_NCC_")===0){var Q=jq.extend(true,{},R);Q.errorCodeId=Q.errorCodeId.split("UM_NCC_")[1];P.push(Q)}else{N.push(R)}});if(P.length>0){O=rlNccConverter.translateValidationMessagesFromResponse(P,undefined,undefined);jq.each(O,function(Q,R){var S=P[Q].errorObjectPath;if(S){R.fieldName=S}})}if(N.length>0){jq.each(N,function(S,R){var Q={fieldName:R.errorObjectPath,errorKey:R.errorCodeId,messageText:undefined};O.push(Q)})}}return O}function G(N){if(N){var M=N.data;if(M){var O=M.profile;K(M,"hobbies");K(M,"technologyInterests");if(O){if(O.purchasePlanned){O.plannedPurchase={date:O.plannedPurchase,isPlanned:O.purchasePlanned.toLowerCase()}}if(O.adresses){O.adresses=[].concat(O.adresses)}K(O,"optionalFields")}}return M}else{console.error("UserData response is not valid");return{user:{}}}}function F(M){if(typeof M.plannedPurchase!=="undefined"){if(M.plannedPurchase==null){M.purchasePlanned="UNKNOWN";M.plannedPurchase=null}else{M.purchasePlanned=M.plannedPurchase.isPlanned.toUpperCase();M.plannedPurchase=M.plannedPurchase.date}}}function J(M){if(undefined===M){return"Undefined"}if(M===null){return"Null"}return{}.toString.call(M).slice(8,-1)}function B(O,M){if(typeof M=="undefined"||!M){for(var N in O){if(O.hasOwnProperty(N)){if(J(O[N])==="Object"){B(O[N])}if(J(O[N])==="String"&&O[N]==""){O[N+"Delete"]=true}}}}return O}function E(P,M){var N={},O;jq.extend(true,N,P);if(N&&N.user){I(N.user,"hobbies");I(N.user,"technologyInterests");I(N.user,"vehicleInterests");O=N.user.profile;if(O){I(O,"optionalFields");F(O);if(O.addresses){H(O.addresses)}}}if(N&&N.vehicle){if(N.vehicle.vin){N.vehicle.bmwVIN=N.vehicle.vin;delete N.vehicle.vin}if(N.vehicle.hasOwnProperty("defaultFreeTextNote")){if(N.vehicle.defaultFreeTextNote&&!N.vehicle.freeTextNote){N.vehicle.freeTextNote=N.vehicle.defaultFreeTextNote}delete N.vehicle.defaultFreeTextNote}}return B(N,M)}function A(N){var M={};jq.extend(true,M,N);M=E(M,true);return M}return{__init__:function(){},__start__:function(){},setListActions:function(M){H(M)},arrayToObject:function(M,N){K(M,N)},objectToArray:function(M,N){I(M,N)},translateMetaFromResponse:function(N,M){return L(N,M)},translateUserDataFromResponse:function(M){return G(M)},translateValidationMsgsFromResponse:function(M){return C(M)},translateUserDataToRequest:function(M){return E(M)},translateCreateDataToRequest:function(M){return A(M)},translatePlannedPurchaseToRequest:function(M){F(M)}}}());var rlVehicleProfileDS=function(){function A(H){var C=CoreFormsBase.inheritanceFrom(rlBaseDataSource.createDS(H));C.summaryType="";var F=C.parent;C.NCC_MOCK_URL="";C.typeName="rlVehicleProfileDS";jq('div.printButton:has(".printButtonWrapper")').attr("style",function(J,K){K=K||"";var I="display: inline-block !important";if(!new RegExp(I,"i").test(K)){if(K.lastIndexOf(";")!==(K.length-1)){K+=";"}return K+I+";"}return K});var D="/vc/resources/ncc/css/main_gen.css";if(document.createStyleSheet){document.createStyleSheet(D)}else{jq("head").append('<link rel="stylesheet" href="'+D+'" type="text/css" />')}jq.getScript("/vc/resources/js/StringUtil.js");jq.getScript("/vc/resources/ncc/js/detailsAnimation.js");C.get=function(I){rlComponentLoader.deferredExec(["nccServices"],function(){F.get.call(C,I)})};C.getUserData=function(J,I){J()};C.getMetaData=function(J,I){var K=C.getCarConfigId();if(K==null){C.successCallback("",J)}else{if(C.getUseMock()){E(J,I)}else{G(K,J,I)}}};function G(K,J,I){rlNccServices.getNccSummaryForConfig(K,C.summaryType,function(L){if(L!=null&&L.length>0){C.successCallback(L,J)}else{B(I)}},function(L){B(I)})}function E(J,I){rlNxt.call({type:"GET",url:C.NCC_MOCK_URL,success:function(K){if(K!=null&&K.length>0){C.successCallback(K,J)}else{B(I)}},error:function(K){B(I)},dataType:"html"})}C.successCallback=function(I,J){console.error("successCallback: Not Implemented!");return null};function B(I){I("NCC vehicle profile is not available!")}C.getCarConfigId=function(){console.error("getCarConfigId: Not Implemented!");return null};return C}return{__init__:function(){},__start__:function(){},createDS:function(B){return new A(B)}}}();var rlVehicleselector=function(){var J=null;var U=false;var R;var M=false;var K=false;var O=undefined;var N=[];var G=460;var S=".gplnAjaxContent";function D(){J=null;jq(".myVehicleSelectorRemoveButton").click(function(){if(J!=null){J.css("visibility","hidden")}J=jq(this).parent().siblings(".myVehicleDeleteLayer");J.css("visibility","visible")});jq(".myvehicleDeleteVehicleButton").click(function(){var Y=J.attr("name");if(J!=null){jq(J).parent().delay(10).fadeOut(10);U=true;console.log("Deleting currently shown vehicle");if(N.length%3==1){jq(S).height(jq(S).height()-jq(".myvehicleSelectorThumb4inARow").height());jq(".gplnContentValue").height(jq(S).height()-(jq(".myvehicleSelectorThumb4inARow").height()-jq(".myvehicleSelectorThumbHeadline").height()))}rlDither.on(S);rlMyVehiclesController.deleteVehicle({vehicleId:Y,noConfirmationLayer:true,success:function(Z){O&&O();rlDither.off(S)},error:function(Z){rlErrorService.handleError({actor:rlErrorService.ACTOR_USER})}})}});jq(".myvehicleDeleteCancelButton").click(function(){if(J!=null){J.css("visibility","hidden");J=null}})}function B(){var Z=function(a){a.find(".myVehicleSelectorSelect_ChooseButton").stop(true,true);a.find(".myVehicleSelectorRemoveButton").stop(true,true);a.find(".myVehicleSelectorSelect_DividerBar").stop(true,true)};var Y=jq(".myvehicleSelectorVehicleItem .myvehicleSelectorContent");Y.mouseenter(function(){var a=jq(this);Z(a);a.find(".myVehicleSelectorSelect_DividerBar").delay(200).animate({opacity:1,top:"0"},400);a.find(".myVehicleSelectorRemoveButton").stop(true,true).delay(600).fadeIn(400);a.find(".myvehicleSelectorThumbHeadlineContainer").css("background-color","#e6e6e6")});Y.mouseleave(function(){var a=jq(this);Z(a);a.find(".myVehicleSelectorSelect_DividerBar").animate({opacity:0,top:"100px"},400);a.find(".myVehicleSelectorRemoveButton").delay(400).fadeOut(400);a.find(".myvehicleSelectorThumbHeadlineContainer").css("background-color","#ffffff")})}function E(){rlComponentLoader.deferredExec(["myVehiclesController"],function(){rlMyVehiclesController.addVehicleListLoadedListener({success:function(Y){N=Y;H()}})})}function C(){rlGlassPaneLayerNext.addOpenListener(function(){L(N.length)},true)}function I(Y){if(K){return }if(!M){rlMyVehiclesController.loadVehicle(Y);rlGlassPaneLayerNext.closeDialog()}else{var Z=vehicleuratorUrl+Y;document.location=Z}}function W(){M=(typeof nccData!=="undefined");H();if(K){X()}rlGlassPaneLayerNext.contentReady()}function V(){var Y=jq(".myvehicleselector");return(Y.length>0)}function H(){if(V()==false){return }var m=jq("#myvehicleSelectorThumbContainerContentTemplate > div");var a;var b=jq("#myvehicleSelectorThumbContainerContent_bmw");var o=jq("#myvehicleSelectorThumbContainerContent_bmwi");b.empty();o.empty();var Z=jq("#myvehicleSelectorThumbContainerContent_bmw,#myvehicleSelectorThumbContainerContent_bmwi");var f=function(i,q){var p=jq("<h1></h1>");p.text(q);p.addClass("subBrandLabel fontBold");i.append(p)};f(b,"BMW");f(o,"BMW i");L(N.length);var h=undefined;if(!M&&!K){h=rlMyVehiclesController.getCurrentVehicleId()}var c=0,j=0;for(var d=0;d<N.length;d++){if(rlMyVehiclesController.isSubBrandBMWi(N[d])){j++}else{c++}}var l=Math.max(c,j);if(l==0){jq(".myVehicleSelectorNoVehicle").css("display","block");rlGlassPaneLayerNext.contentReady();rlGlassPaneLayerNext.layerSizeToWindowSize();return }else{if(l==1){Z.removeClass("myvehicleSelectorTwoColumns");Z.addClass("myvehicleSelectorOneColumns");jq(".imageArea")[0].coords="15,20,400,210"}else{if(l<3){Z.addClass("myvehicleSelectorTwoColumns");jq(".imageArea")[0].coords="15,20,240,150"}}}var Y=R.bigPlaceholderImgUrl;if(l==2){Y=R.mediumPlaceholderImgUrl}else{if(l>2){Y=R.smallPlaceholderImgUrl}}R.selectedPlaceholderImgUrl=Y;for(var d=0;d<N.length;d++){var k=N[d];var a=k.vehicleId;var g=(a===rlMyVehiclesController.getCurrentVehicleId());var e=m.clone();e.attr("vehicleId",a);if(g){e.addClass("selectedVehicle")}e.find(".myvehicleSelectorThumbnail").each(function(){var i=a;var p=A(k.images,l);jq(this).bind("load",function(){if(jq(this).width()>G){this.parentElement.style.background="url("+R.selectedPlaceholderImgUrl+")";jq(this).hide()}jq(this).unbind("load")});jq(this).attr("src",p).stop(true,true).hide().fadeIn(600);jq(this).attr("usemap","#map"+i)});var n=function(i,p){i.find(".imageMap").each(function(){var q=p;jq(this).attr("name","map"+q)});i.find(".imageArea").click(function(){I(p)});i.find(".myVehicleSelectorSelect_DividerBarLink").click(function(){I(p)})};n(e,a);e.find(".myVehicleDeleteLayer").each(function(){jq(this).attr("name",k.vehicleId)});if(k.primary==="true"){e.find(".myvehicleSelPrimaryFlag").each(function(){jq(this).css("display","inline-block");jq(this).addClass("spriteLabelFavoritGrey12")})}e.attr("vehicleId",a);e.find(".myvehicleSelectorThumbHeadline > span").each(function(){var i=a;jq(this).text(k.modelText)});e.find(".myvehicleSelectorThumbSubHeadline > span").each(function(){var i=a;var p=F(k.freeTextNote,302);jq(this).text(p)});if(a==h){e.find(".myVehicleSelectorSelectIndicator").css("display","block")}if(rlMyVehiclesController.isSubBrandBMWi(k)){e.appendTo(o)}else{e.appendTo(b)}}if(b.find(".myvehicleSelectorVehicleItem").length===0){b.hide()}else{b.show()}if(o.find(".myvehicleSelectorVehicleItem").length===0){o.hide()}else{o.show()}rlDither.center(S);B();D()}function A(Y,a){var Z;if(a==1){Z=Y.bigUrl}else{if(a==2){Z=Y.mediumUrl}else{Z=Y.smallUrl}}return Z}function L(Y){jq("#myvehicleCount").html(Y);jq("#myvehicleEmptySlots").html((GLOBAL_MAX_GARAGE_ENTRIES-Y));if(Y==0){jq(".subBrandVehicleContainer").hide()}}function F(b,Z){b=b.replace(/\s{2,}/g," ");var c=jq("<span></span>");c.addClass("pixelRuler").css("visibility","hidden").css("position","absolute").css("left","-1000px").css("font-size","13px").css("line-height","15px");jq("body").append(c);var a=b;var Y=b;if(T(a,c)>Z){Y+="...";while(T(Y,c)>Z){a=a.substring(0,a.length-1);Y=a+"..."}}jq(".pixelRuler").remove();return Y}function T(Y,Z){Z.text(Y);return Z.width()}function Q(){M=true;K=false;rlUserDialog.showVehicleSelector();console.log("VehicleSelector Layer opened")}function P(Y,Z){M=false;K=true;O=Y;rlUserDialog.showVehicleSelector()}function X(){jq(".myvehicleDeleteMessage").css("display","block");jq(".myvehicleSelectorSubHeaderContainer").addClass("myvehicleSelectorDeleteAdjust")}return{setParams:function(Y){},bindOnVehicleItemHover:function(){B()},openDeleteDialog:function(Y){P(Y)},openLoadDialogLoggedIn:function(){Q()},initUi:function(Y){R=Y;W()},__init__:function(){rlCoreServices.isLoggedIn({loggedIn:function(){E()}});C()},__start__:function(){}}}();var rlVisualIdentifier=function(){var B=false;var H=2;var I="visualIdentifier";function C(){if(E()){G()}else{rlCoreServices.isLoggedIn({loggedIn:G})}}function E(){if(typeof rlPage!="undefined"&&rlPage.isEditMode()){return true}if(typeof rlCoreServices=="undefined"){return true}return false}function G(){jq("div[data-vi-role]").each(function(J,K){var L=jq(K).attr("data-vi-role");if(E()){A(L)}else{rlCoreServices.checkForRole({role:L,callbackData:L,yes:A})}})}function D(K){var J=null;jq(availableRoles.roles).each(function(L,M){if(M.roleId==K){J=M}});return J}function F(K,J){jq('[data-vi-role-label="'+K+'"]').each(function(L,M){jq(M).html(J)})}function A(K){var J=D(K);if(J!=null){jq('div[data-vi-role="'+K+'"]').each(function(L,M){jq(M).addClass("enableVI");jq(M).trigger("enableVI",[K])});F(K,J.ribbonLabel)}}return{__init__:function(){jq(document).ready(function(){C()})},enableVisualIdentifiers:function(){C()}}}();var rlVoucher=function(){var B=rlPage.isEditMode()||rlPage.isDesignMode();function A(){rlComponentLoader.deferredExec(["coreServices"],function(){rlCoreServices.isLoggedIn({loggedIn:function(){var D=jq(".voucher .pageProperties").html().replace(/\s/,"").split(",");console.log("User roles assigned to page: "+D);rlCoreServices.checkForRoles({roles:D,any:C,none:function(){var E=(window.location.protocol=="https:")?GLOBAL_CMX_SSL_SERVER:GLOBAL_CMX_SERVER;var F=GLOBAL_CONFIG_ERROR_PAGE_ACCESS_DENIED_URL;window.location.href=F}})},loggedOut:function(){console.log("Redirect to dashboard");var D=window.location.protocol+"//"+window.location.hostname+GLOBAL_MY_DASHBOARD_PAGE_PATH;window.location.href=D}})})}function C(){jq(".voucher .voucherUserData").html("");rlCoreServices.loadUserData({success:function(I){var L=jq.trim(I.salutation);var N=jq.trim(I.firstName);var O=jq.trim(I.lastName);var J=L+"<br/>"+N+"&nbsp;"+O+"<br/>";var M=I.profile.addresses;if(M){var G=jq.trim(M.street);var K=jq.trim(M.houseNumber);var F=M.country?jq.trim(M.country)+"-":"";var E=jq.trim(M.postalCode);var H=jq.trim(M.city);J+=G+"&nbsp;"+K+"<br/>"+F+E+"&nbsp;"+H+"<br/>"}jq(".voucher .voucherUserData").append(J)},error:function(E){console.log("Failed rlCoreServices.loadUserData: "+E)}});jq(".voucher .voucherImage").removeClass("hidden");jq(".voucher .voucherUserData").removeClass("hidden");if(!B){var D=parseInt(jq(".voucher .voucherTimeout").html())*1000;window.setTimeout("window.print()",D)}}return{__init__:function(){if(!B){A();var D={};D.tagName="DIV";D.id="vchrPageLoad";D.name="vchrAction";if(window.bmwcsaclick){console.log('Tracking click on <DIV id="'+D.id+'" name="'+D.name+'" />');window.bmwcsaclick(D)}else{console.log("Tracking click failed. bmwcsaclick not defined.")}}else{C()}}}}();